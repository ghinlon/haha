<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Haha</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Haha.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="index.html">哈哈</a></li><li class="expanded "><a href="brain.html">My Brain</a></li><li class="expanded "><a href="meaningless/index.html">Meaninglessness: The point of living</a></li><li class="expanded "><a href="bible/index.html">Bible</a></li><li><ol class="section"><li class="expanded "><a href="bible/Ecclesiastes_1.1.html">Ecclesiastes 1:1</a></li></ol></li><li class="expanded "><a href="infosec/index.html">Information Security</a></li><li><ol class="section"><li class="expanded "><a href="infosec/shred.html">shred: Shred File</a></li><li class="expanded "><a href="infosec/gpg.html">gpg: The GNU Privacy Guard</a></li><li class="expanded "><a href="infosec/pass.html">pass: Password management</a></li></ol></li><li class="expanded "><a href="collectedTopics.html">Collected Topics</a></li><li class="expanded "><a href="events.html">Events</a></li><li class="expanded "><a href="collection.html">Collection</a></li><li class="expanded "><a href="en/index.html">English</a></li><li><ol class="section"><li class="expanded "><a href="en/examples.html">Examples</a></li><li class="expanded "><a href="en/words-in-chain.html">Words in chain</a></li><li class="expanded "><a href="en/pronunciation.html">Pronunciation</a></li><li class="expanded "><a href="en/synonyms-antonyms.html">Synonyms and Antonyms</a></li><li class="expanded "><a href="en/exercise_practise_practice.html">exercise vs practise vs practice</a></li><li class="expanded "><a href="en/incidents.vs.accidents.html">incidents vs accidents</a></li></ol></li><li class="expanded "><a href="inet/index.html">INET</a></li><li><ol class="section"><li class="expanded "><a href="inet/search.html">How to Search</a></li><li class="expanded "><a href="inet/must.html">MUST</a></li><li class="expanded "><a href="inet/speedtest.html">speedtest-cli</a></li><li class="expanded "><a href="inet/veracrypt.html">VeraCrypt: Whole-drive Encryption</a></li><li class="expanded "><a href="inet/proxy.html">Proxy Setting</a></li><li class="expanded "><a href="inet/wireguard.html">WireGuard: fast, modern, secure VPN tunnel</a></li><li class="expanded "><a href="inet/tor/index.html">Tor</a></li><li class="expanded "><a href="inet/chisel.html">chisel</a></li><li class="expanded "><a href="inet/shadowsocks.html">shadowsocks</a></li><li class="expanded "><a href="inet/ss-redir.html">ss-redir</a></li><li class="expanded "><a href="inet/redsocks.html">redsocks: transparent TCP-to-proxy redirector</a></li><li class="expanded "><a href="inet/zerotier.html">ZeroTier</a></li><li class="expanded "><a href="inet/dns/index.html">DNS</a></li><li><ol class="section"><li class="expanded "><a href="inet/dns/dnscrypt.html">DNSCrypt</a></li><li class="expanded "><a href="inet/dns/doh.html">DoH: DNS over HTTPS</a></li><li class="expanded "><a href="inet/dns/unbound.html">DNS: unbound</a></li><li class="expanded "><a href="inet/dns/systemd-resolved.html">systemd-resolved</a></li></ol></li><li class="expanded "><a href="inet/firewall/index.html">Firewall</a></li><li><ol class="section"><li class="expanded "><a href="inet/firewall/iptables.html">iptables</a></li><li class="expanded "><a href="inet/firewall/firewalld.html">firewalld</a></li><li class="expanded "><a href="inet/firewall/nftables.html">nftables</a></li></ol></li><li class="expanded "><a href="inet/network/index.html">NETWORK</a></li><li><ol class="section"><li class="expanded "><a href="inet/network/optimization.html">Network Optimization</a></li><li class="expanded "><a href="inet/network/tunnels.html">linux virtual interfaces: Tunnels</a></li><li class="expanded "><a href="inet/network/virtual-networking.html">linux interfaces for virtual networking</a></li><li class="expanded "><a href="inet/network/iproute2/index.html">iproute2</a></li><li><ol class="section"><li class="expanded "><a href="inet/network/iproute2/gre.html">GRE tunneling</a></li><li class="expanded "><a href="inet/network/iproute2/ip-link-type-bridge.html">ip link type bridge</a></li><li class="expanded "><a href="inet/network/iproute2/ip-link-type-vxlan.html">ip link type vxlan</a></li><li class="expanded "><a href="inet/network/iproute2/ip-rule.html">ip rule</a></li></ol></li></ol></li><li class="expanded "><a href="inet/vps/index.html">VPS</a></li></ol></li><li class="expanded "><a href="sync/index.html">Sync</a></li><li><ol class="section"><li class="expanded "><a href="sync/rsync.html">rsync</a></li></ol></li><li class="expanded "><a href="music/index.html">Music</a></li><li><ol class="section"><li class="expanded "><a href="music/choral.html">choral music</a></li><li class="expanded "><a href="music/Freedom-Anthony_Hamilton.html">Freedom - Anthony Hamilton</a></li><li class="expanded "><a href="music/Ariana-grande-imagine-lyrics.html">Ariana-grande-imagine-lyrics</a></li><li class="expanded "><a href="music/wong4.hau6.daai6.dou6.dung1.html">皇后大道东</a></li></ol></li><li class="expanded "><a href="movies.html">Movies</a></li><li class="expanded "><a href="math/index.html">Math</a></li><li><ol class="section"><li class="expanded "><a href="math/euler_totient_function.html">Euler's totient function</a></li></ol></li><li class="expanded "><a href="vim/index.html">vim</a></li><li><ol class="section"><li class="expanded "><a href="vim/help.html">help</a></li><li class="expanded "><a href="vim/plugins.html">Plugins</a></li><li class="expanded "><a href="vim/vim-plug.html">vim-plug: Minimalist Vim Plugin Manager</a></li><li class="expanded "><a href="vim/table.html">table</a></li><li class="expanded "><a href="vim/autopair.html">automatic pair insertion</a></li><li class="expanded "><a href="vim/ultisnips.html">Ultisnips</a></li><li class="expanded "><a href="vim/fzf.html">fzf</a></li><li class="expanded "><a href="vim/ale.html">ale: Asynchronous Lint Engine</a></li></ol></li><li class="expanded "><a href="terminal/index.html">Terminal</a></li><li><ol class="section"><li class="expanded "><a href="terminal/tmux.html">tmux: a terminal multiplexer</a></li><li class="expanded "><a href="terminal/iterm2.html">iTerm2</a></li></ol></li><li class="expanded "><a href="font/index.html">Font</a></li><li><ol class="section"><li class="expanded "><a href="font/firacode.html">firacode</a></li><li class="expanded "><a href="font/sanfranciscomono.html">Getting Apple’s SF Mono Font</a></li><li class="expanded "><a href="font/fontconfig.html">fontconfig</a></li><li class="expanded "><a href="font/hanyiqihei.html">汉仪旗黑</a></li></ol></li><li class="expanded "><a href="color.html">Color</a></li><li class="expanded "><a href="go/index.html">Go</a></li><li><ol class="section"><li class="expanded "><a href="go/note.html">Note</a></li><li class="expanded "><a href="go/algorithm/index.html">Algorithm</a></li><li><ol class="section"><li class="expanded "><a href="go/algorithm/Knuth–Morris–Pratt-algorithm.html">Knuth–Morris–Pratt algorithm</a></li><li class="expanded "><a href="go/algorithm/read-until-strings-in-stream.html">read until strings in stream</a></li></ol></li><li class="expanded "><a href="go/basis/index.html">Basis</a></li><li><ol class="section"><li class="expanded "><a href="go/basis/go_command.html">Command go</a></li><li class="expanded "><a href="go/basis/encodings.html">Character Sets and Encodings</a></li><li class="expanded "><a href="go/basis/struct.html">struct</a></li><li class="expanded "><a href="go/basis/closure.html">closure</a></li><li class="expanded "><a href="go/basis/interfaces.html">interfaces</a></li><li class="expanded "><a href="go/basis/concurrency.html">Concurrency</a></li><li class="expanded "><a href="go/basis/channels.html">Channels</a></li><li class="expanded "><a href="go/basis/slices.html">slices</a></li><li class="expanded "><a href="go/basis/astrings.html">strings</a></li><li class="expanded "><a href="go/basis/socket.html">socket</a></li><li class="expanded "><a href="go/basis/initfunc.html">init functions in Go</a></li><li class="expanded "><a href="go/basis/gc.html">Garbage Collector</a></li><li class="expanded "><a href="go/basis/type_variable_value.html">type vs variable vs value</a></li><li class="expanded "><a href="go/basis/loop.html">Loop is so complicated</a></li><li class="expanded "><a href="go/basis/gomod.html">Modules</a></li><li class="expanded "><a href="go/basis/async_vs_sync.html">Asynchronous vs synchronous</a></li><li class="expanded "><a href="go/basis/monitor_goroutines.html">Monitor goroutines</a></li><li class="expanded "><a href="go/basis/how_to_check_if_a_file_exists.html">How to check if a file exists in Go</a></li><li class="expanded "><a href="go/basis/distinguish_ipv4_and_ipv6.html">distinguish ipv4 and ipv6</a></li><li class="expanded "><a href="go/basis/gorutine_and_cwd.html">gorutine and CWD</a></li><li class="expanded "><a href="go/basis/cs.html">How to WRITE A CS</a></li><li class="expanded "><a href="go/basis/exec_Cmd_signal.html">How to signal a exec.Cmd</a></li><li class="expanded "><a href="go/basis/pipe_io.ReadWriteCloser.html">Pipe io.ReadWriteCloser</a></li></ol></li><li class="expanded "><a href="go/pkg/index.html">Packages</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/io/io.html">io</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/io/ioutil.html">ioutil</a></li></ol></li><li class="expanded "><a href="go/pkg/errors.html">errors</a></li><li class="expanded "><a href="go/pkg/bufio.html">bufio</a></li><li class="expanded "><a href="go/pkg/unicode/unicode.html">unicode</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/unicode/utf8.html">utf8</a></li><li class="expanded "><a href="go/pkg/unicode/utf16.html">utf16</a></li></ol></li><li class="expanded "><a href="go/pkg/regexp.html">regexp</a></li><li class="expanded "><a href="go/pkg/os/os.html">os</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/os/exec.html">exec</a></li><li class="expanded "><a href="go/pkg/os/signal.html">signal</a></li></ol></li><li class="expanded "><a href="go/pkg/path.html">path</a></li><li class="expanded "><a href="go/pkg/sync/sync.html">sync</a></li><li class="expanded "><a href="go/pkg/context.html">context</a></li><li class="expanded "><a href="go/pkg/log/log.html">log</a></li><li class="expanded "><a href="go/pkg/net/net.html">net</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/net/textproto.html">textproto</a></li><li class="expanded "><a href="go/pkg/net/smtp.html">smtp</a></li><li class="expanded "><a href="go/pkg/net/mail.html">mail</a></li></ol></li><li class="expanded "><a href="go/pkg/encoding/encoding.html">encoding</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/encoding/asn1.html">asn1</a></li><li class="expanded "><a href="go/pkg/encoding/json.html">json</a></li><li class="expanded "><a href="go/pkg/encoding/gob.html">gob</a></li><li class="expanded "><a href="go/pkg/encoding/base64.html">base64</a></li><li class="expanded "><a href="go/pkg/encoding/hex.html">hex</a></li><li class="expanded "><a href="go/pkg/encoding/pem.html">pem</a></li></ol></li><li class="expanded "><a href="go/pkg/crypto/crypto.html">crypto</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/crypto/rand.html">rand</a></li><li class="expanded "><a href="go/pkg/crypto/sha256.html">sha256</a></li><li class="expanded "><a href="go/pkg/crypto/sha512.html">sha512</a></li><li class="expanded "><a href="go/pkg/crypto/sha1.html">sha1</a></li><li class="expanded "><a href="go/pkg/crypto/md5.html">md5</a></li><li class="expanded "><a href="go/pkg/crypto/aes.html">aes</a></li><li class="expanded "><a href="go/pkg/crypto/cipher.html">cipher</a></li><li class="expanded "><a href="go/pkg/crypto/rsa.html">rsa</a></li><li class="expanded "><a href="go/pkg/crypto/x509/x509.html">x509</a></li></ol></li><li class="expanded "><a href="go/pkg/internal/index.html">internal</a></li><li><ol class="section"><li class="expanded "><a href="go/pkg/internal/poll.html">poll</a></li></ol></li></ol></li><li class="expanded "><a href="go/pkgx/index.html">Package x</a></li><li><ol class="section"><li class="expanded "><a href="go/pkgx/crypto/index.html">crypto</a></li><li><ol class="section"><li class="expanded "><a href="go/pkgx/crypto/ssh.html">ssh</a></li></ol></li><li class="expanded "><a href="go/pkgx/text/index.html">text</a></li><li><ol class="section"><li class="expanded "><a href="go/pkgx/text/transform.html">transform</a></li><li class="expanded "><a href="go/pkgx/text/encoding/encoding.html">encoding</a></li><li class="expanded "><a href="go/pkgx/text/unicode/index.html">unicode</a></li><li><ol class="section"><li class="expanded "><a href="go/pkgx/text/unicode/norm.html">norm</a></li></ol></li></ol></li></ol></li><li class="expanded "><a href="go/pkgy/index.html">Package y</a></li><li><ol class="section"><li class="expanded "><a href="go/pkgy/protobuf.html">protobuf</a></li><li class="expanded "><a href="go/pkgy/grpc.html">grpc</a></li><li class="expanded "><a href="go/pkgy/yaml.v2.html">yaml.v2</a></li><li class="expanded "><a href="go/pkgy/cobra.html">cobra</a></li><li class="expanded "><a href="go/pkgy/viper.html">viper</a></li><li class="expanded "><a href="go/pkgy/pflag.html">pflag</a></li><li class="expanded "><a href="go/pkgy/systemstat.html">systemstat</a></li><li class="expanded "><a href="go/pkgy/zap.html">zap</a></li><li class="expanded "><a href="go/pkgy/ftp.html">ftp</a></li><li class="expanded "><a href="go/pkgy/smtpd.html">smtpd</a></li><li class="expanded "><a href="go/pkgy/telnet.html">telnet</a></li><li class="expanded "><a href="go/pkgy/netconf.html">netconf</a></li><li class="expanded "><a href="go/pkgy/gobot.html">gobot</a></li><li class="expanded "><a href="go/pkgy/kcp-go.html">kcp-go</a></li><li class="expanded "><a href="go/pkgy/go-libp2p.html">go-libp2p</a></li><li class="expanded "><a href="go/pkgy/nff-go/index.html">nff-go</a></li><li><ol class="section"><li class="expanded "><a href="go/pkgy/nff-go/flow.html">flow</a></li><li class="expanded "><a href="go/pkgy/nff-go/packet.html">packet</a></li></ol></li><li class="expanded "><a href="go/pkgy/goexpect.html">goexpect</a></li></ol></li><li class="expanded "><a href="go/protocols/index.html">Protocols</a></li><li><ol class="section"><li class="expanded "><a href="go/protocols/application_level_protocols.html">Application-Level Protocols</a></li><li class="expanded "><a href="go/protocols/ping.html">ICMP:ping</a></li><li class="expanded "><a href="go/protocols/socks5.html">socks5</a></li><li class="expanded "><a href="go/protocols/shadowsocks.html">shadowsocks</a></li><li class="expanded "><a href="go/protocols/smtp.html">SMTP</a></li><li class="expanded "><a href="go/protocols/telnet.html">TELNET</a></li><li class="expanded "><a href="go/protocols/ftp.html">FTP</a></li><li class="expanded "><a href="go/protocols/yaml.html">YAML</a></li><li class="expanded "><a href="go/protocols/x509.html">X.509</a></li><li class="expanded "><a href="go/protocols/ssh.html">SSH</a></li></ol></li><li class="expanded "><a href="go/utils/index.html">Utils</a></li><li><ol class="section"><li class="expanded "><a href="go/utils/cfssl.html">cfssl</a></li><li class="expanded "><a href="go/utils/meshbird.html">meshbird</a></li><li class="expanded "><a href="go/utils/go-shadowsocks2.html">go-shadowsocks2</a></li><li class="expanded "><a href="go/utils/markdown-toc.html">sebdah/markdown-toc</a></li><li class="expanded "><a href="go/utils/orgalorg.html">reconquest/orgalorg</a></li><li class="expanded "><a href="go/utils/u-root.html">u-root</a></li><li class="expanded "><a href="go/utils/sweet.html">sweet</a></li><li class="expanded "><a href="go/utils/bad/index.html">Bad</a></li><li><ol class="section"><li class="expanded "><a href="go/utils/bad/jazigo.html">jazigo</a></li></ol></li></ol></li></ol></li><li class="expanded "><a href="webdev/index.html">Web Development</a></li><li><ol class="section"><li class="expanded "><a href="webdev/rest.html">REST</a></li><li class="expanded "><a href="webdev/organising-database-access.html">Organising Database Access</a></li><li class="expanded "><a href="webdev/routers.html">Routers</a></li><li class="expanded "><a href="webdev/sessions.html">Sessions</a></li><li class="expanded "><a href="webdev/protocol-http.html">Protocol http</a></li><li class="expanded "><a href="webdev/protocol-tls.html">Protocol tls</a></li><li class="expanded "><a href="webdev/go/pkg/http.html">Package http</a></li><li class="expanded "><a href="webdev/go/pkg/url.html">Package url</a></li><li class="expanded "><a href="webdev/go/pkg/text-template.html">Package template</a></li><li class="expanded "><a href="webdev/go/pkg/tls.html">Package tls</a></li><li class="expanded "><a href="webdev/go/pkgy/alice.html">Package alice</a></li><li class="expanded "><a href="webdev/webassembly.html">Webassembly</a></li><li class="expanded "><a href="webdev/gioui.html">gioui</a></li><li class="expanded "><a href="webdev/vugu.html">vugu</a></li><li class="expanded "><a href="webdev/vecty.html">vecty</a></li><li class="expanded "><a href="webdev/hugo.html">Hugo</a></li><li class="expanded "><a href="webdev/bootstrap.html">Bootstrap</a></li></ol></li><li class="expanded "><a href="db/index.html">DB</a></li><li><ol class="section"><li class="expanded "><a href="db/oracle/oracle.html">Oracle</a></li><li class="expanded "><a href="db/go/pkg/sql.html">Package sql</a></li><li class="expanded "><a href="db/redis.html">redis: a data structures server</a></li><li class="expanded "><a href="db/sqlite.html">SQLite</a></li><li class="expanded "><a href="db/mysql.html">MySQL</a></li></ol></li><li class="expanded "><a href="IT/index.html">IT</a></li><li><ol class="section"><li class="expanded "><a href="IT/dpdk.html">DPDK</a></li><li class="expanded "><a href="IT/minio.html">MinIO: OBJECT STORAGE FOR AI</a></li></ol></li><li class="expanded "><a href="api/index.html">API</a></li><li><ol class="section"><li class="expanded "><a href="api/telegram_bot.html">Telegram Bots</a></li><li class="expanded "><a href="api/weixin_web.html">WEIXIN WEB</a></li></ol></li><li class="expanded "><a href="devops/index.html">Devops</a></li><li><ol class="section"><li class="expanded "><a href="devops/mtail.html">mtail</a></li><li class="expanded "><a href="devops/prometheus/index.html">prometheus</a></li><li><ol class="section"><li class="expanded "><a href="devops/prometheus/usage.html">Usage</a></li><li class="expanded "><a href="devops/prometheus/client_golang/index.html">client_golang</a></li><li><ol class="section"><li class="expanded "><a href="devops/prometheus/client_golang/promhttp.html">promhttp</a></li><li class="expanded "><a href="devops/prometheus/client_golang/promauto.html">promauto</a></li><li class="expanded "><a href="devops/prometheus/client_golang/api.html">api</a></li></ol></li><li class="expanded "><a href="devops/prometheus/alertmanager.html">alertmanager</a></li><li class="expanded "><a href="devops/prometheus/node_exporter.html">node_exporter</a></li><li class="expanded "><a href="devops/prometheus/sql_exporter.html">sql_exporter</a></li><li class="expanded "><a href="devops/prometheus/procfs.html">procfs</a></li></ol></li><li class="expanded "><a href="devops/grafana.html">grafana</a></li><li class="expanded "><a href="devops/messagebird-sachet.html">messagebird/sachet</a></li></ol></li><li class="expanded "><a href="git/index.html">Git</a></li><li><ol class="section"><li class="expanded "><a href="git/undoing.html">Undoing Commits &amp; Changes</a></li></ol></li><li class="expanded "><a href="infra/index.html">Infrastructure</a></li><li><ol class="section"><li class="expanded "><a href="infra/vagrant.html">Vagrant: HashiCorp Development Environments Made Easy</a></li><li class="expanded "><a href="infra/terraform.html">Terraform: HashiCorp Infrastructure as Code</a></li><li class="expanded "><a href="infra/packer.html">Packer</a></li><li class="expanded "><a href="infra/ipxe.html">iPXE</a></li><li class="expanded "><a href="infra/dnsmasq.html">dnsmasq</a></li><li class="expanded "><a href="infra/matchbox.html">matchbox</a></li><li class="expanded "><a href="infra/ignition.html">Ignition: machine provisioning utility</a></li><li class="expanded "><a href="infra/typhoon.html">Typhoon: a minimal and free Kubernetes distribution</a></li><li class="expanded "><a href="infra/travis/index.html">Travis CI</a></li><li><ol class="section"><li class="expanded "><a href="infra/travis/gh-pages.html">GitHub Pages Deployment</a></li></ol></li><li class="expanded "><a href="infra/ansible.html">Ansible</a></li></ol></li><li class="expanded "><a href="k8s/index.html">k8s</a></li><li><ol class="section"><li class="expanded "><a href="k8s/client-go.html">Client Go</a></li><li class="expanded "><a href="k8s/concepts/index.html">CONCEPTS</a></li><li><ol class="section"><li class="expanded "><a href="k8s/concepts/ingress.html">Ingress</a></li></ol></li><li class="expanded "><a href="k8s/haproxy.html">HAProxy</a></li><li class="expanded "><a href="k8s/docker/index.html">Docker</a></li><li class="expanded "><a href="k8s/kubeadm.html">kubeadm quickstart</a></li><li class="expanded "><a href="k8s/kubeadm_ha.html">Creating Highly Available clusters with kubeadm</a></li><li class="expanded "><a href="k8s/calico.html">Calico: Secure networking for the cloud native era</a></li><li class="expanded "><a href="k8s/kubectl.html">kubectl</a></li><li class="expanded "><a href="k8s/k8s.html">Kubernetes</a></li><li class="expanded "><a href="k8s/etcd.html">etcd: A distributed, reliable key-value store</a></li><li class="expanded "><a href="k8s/helm.html">Helm: The package manager for Kubernetes</a></li><li class="expanded "><a href="k8s/rook.html">Rook: Cloud-Native Storage for Kubernetes</a></li><li class="expanded "><a href="k8s/harbor.html">Harbor</a></li><li class="expanded "><a href="k8s/traefik.html">Traefik: The Cloud Native Edge Router</a></li><li class="expanded "><a href="k8s/consul.html">Consul: HashiCorp a distributed service mesh</a></li><li class="expanded "><a href="k8s/rancher.html">Rancher</a></li><li class="expanded "><a href="k8s/coreos/index.html">CoreOS: Container Linux</a></li><li class="expanded "><a href="k8s/sig-storage-lib-external-provisioner.html">sig-storage-lib-external-provisioner</a></li><li class="expanded "><a href="k8s/nfs-provisioner.html">nfs-provisioner</a></li><li class="expanded "><a href="k8s/nfs-client.html">Kubernetes NFS-Client Provisioner</a></li><li class="expanded "><a href="k8s/change-default-storage-class.html">Change the default StorageClass</a></li></ol></li><li class="expanded "><a href="linux/index.html">Linux</a></li><li><ol class="section"><li class="expanded "><a href="linux/newvps.html">NewVPS</a></li><li class="expanded "><a href="linux/screen.html">GNU Screen</a></li><li class="expanded "><a href="linux/zsh.html">Zsh</a></li><li class="expanded "><a href="linux/bash.html">Bash</a></li><li class="expanded "><a href="linux/namespace.html">namespace</a></li><li class="expanded "><a href="linux/systemd.timer.html">systemd.timer</a></li><li class="expanded "><a href="linux/systemd.html">systemd</a></li><li class="expanded "><a href="linux/grub2.html">GRUB 2</a></li><li class="expanded "><a href="linux/tmpfs.html">RAM disk: tmpfs</a></li><li class="expanded "><a href="linux/ubuntu/index.html">Ubuntu</a></li><li><ol class="section"><li class="expanded "><a href="linux/ubuntu/ubuntu_lts.html">LTS: Long Term Support</a></li><li class="expanded "><a href="linux/ubuntu/apt.html">APT: Advanced Packaging Tool</a></li></ol></li><li class="expanded "><a href="linux/archlinux/install.html">Install archlinux</a></li><li class="expanded "><a href="linux/udevil.html">automatic mount: udevil</a></li><li class="expanded "><a href="linux/videoplayers.html">Video Player</a></li><li class="expanded "><a href="linux/de.html">Desktop Environment</a></li><li class="expanded "><a href="linux/wm.html">Window Manager</a></li><li class="expanded "><a href="linux/bluetooth.html">Bluetooth</a></li><li class="expanded "><a href="linux/im.html">Input Method</a></li><li class="expanded "><a href="linux/mail.html">Mail Server:postfix/dovecot</a></li><li class="expanded "><a href="linux/grep.html">grep</a></li><li class="expanded "><a href="linux/sed.html">sed</a></li><li class="expanded "><a href="linux/awk.html">awk</a></li><li class="expanded "><a href="linux/wifi.html">wifi</a></li><li class="expanded "><a href="linux/vsftpd/simple_anonymous_ftp_server.html">vsftpd</a></li><li class="expanded "><a href="linux/archlinux/index.html">archlinux</a></li><li><ol class="section"><li class="expanded "><a href="linux/archlinux/install.html">Install</a></li></ol></li><li class="expanded "><a href="linux/rhel/index.html">rhel</a></li><li><ol class="section"><li class="expanded "><a href="linux/rhel/yum.html">YUM</a></li><li class="expanded "><a href="linux/rhel/yumdownloader.html">Yumdownloader</a></li><li class="expanded "><a href="linux/rhel/network.html">Networking</a></li></ol></li><li class="expanded "><a href="linux/cpu_time.html">cpu time</a></li><li class="expanded "><a href="linux/context_switch.html">context switch</a></li><li class="expanded "><a href="linux/cgroups.html">cgroups</a></li><li class="expanded "><a href="linux/ssh/index.html">ssh</a></li><li><ol class="section"><li class="expanded "><a href="linux/ssh/ssh_agent.html">ssh-agent</a></li></ol></li><li class="expanded "><a href="linux/qemu.html">qemu</a></li><li class="expanded "><a href="linux/kvm/index.html">KVM</a></li><li><ol class="section"><li class="expanded "><a href="linux/kvm/kvm.html">KVM</a></li><li class="expanded "><a href="linux/kvm/admin.html">Administration</a></li></ol></li><li class="expanded "><a href="linux/kernel/index.html">kernel</a></li><li><ol class="section"><li class="expanded "><a href="linux/kernel/kexec.html">kexec - directly boot into a new kernel</a></li></ol></li><li class="expanded "><a href="linux/initramfs.html">initramfs</a></li><li class="expanded "><a href="linux/dracut.html">dracut</a></li><li class="expanded "><a href="linux/liveos.html">LiveOS image</a></li><li class="expanded "><a href="linux/modules.html">modules</a></li><li class="expanded "><a href="linux/dhcpd.html">dhcpd</a></li><li class="expanded "><a href="linux/nginx.html">nginx</a></li></ol></li><li class="expanded "><a href="console/index.html">Console</a></li><li><ol class="section"><li class="expanded "><a href="console/cmus.html">cmus: C Music Player</a></li><li class="expanded "><a href="console/ffplay.html">ffplay: Media Player</a></li><li class="expanded "><a href="console/youtube-dl.html">youtube-dl: Download videos from YouTube</a></li><li class="expanded "><a href="console/wkhtmltopdf.html">wkhtmltopdf</a></li><li class="expanded "><a href="console/openssl.html">openssl</a></li><li class="expanded "><a href="console/pandoc.html">pandoc</a></li></ol></li><li class="expanded "><a href="tools/index.html">Tools</a></li><li><ol class="section"><li class="expanded "><a href="tools/firefox.html">Firefox</a></li><li class="expanded "><a href="tools/ungoogled-chromium.html">Eloston/ungoogled-chromium</a></li><li class="expanded "><a href="tools/ascii.html">Four Column ASCII</a></li><li class="expanded "><a href="tools/markdown.html">markdown</a></li><li class="expanded "><a href="tools/mdbook.html">mdbook</a></li><li class="expanded "><a href="tools/zhengma.html">Zhengma</a></li><li class="expanded "><a href="tools/virtualbox.html">VirtualBox</a></li><li class="expanded "><a href="tools/github.html">Github</a></li><li class="expanded "><a href="tools/anki.html">Anki</a></li><li class="expanded "><a href="tools/krita.html">krita</a></li><li class="expanded "><a href="tools/gimp.html">GIMP - GNU Image Manipulation Program</a></li><li class="expanded "><a href="tools/sxiv.html">sxiv: Simple X Image Viewer</a></li><li class="expanded "><a href="tools/kodi.html">Kodi: entertainment hub</a></li><li class="expanded "><a href="tools/mpv.html">mpv and mplayer: media player</a></li><li class="expanded "><a href="tools/photoprism.html">PhotoPrism: Browse your life in pictures</a></li><li class="expanded "><a href="tools/transmission.html">Transmission</a></li><li class="expanded "><a href="tools/audacity.html">Audacity: audio editor and recorder</a></li></ol></li><li class="expanded "><a href="macOS/index.html">macOS</a></li><li><ol class="section"><li class="expanded "><a href="macOS/shortcuts.html">Shortcuts</a></li><li class="expanded "><a href="macOS/diskutil.html">diskutil</a></li><li class="expanded "><a href="macOS/homebrew.html">homebrew</a></li></ol></li><li class="expanded "><a href="raspberrypi/index.html">Raspberry Pi</a></li><li><ol class="section"><li class="expanded "><a href="raspberrypi/install.html">Install</a></li></ol></li><li class="expanded "><a href="android/index.html">Android</a></li><li><ol class="section"><li class="expanded "><a href="android/adb.html">adb</a></li><li class="expanded "><a href="android/rom.html">ROM</a></li><li class="expanded "><a href="android/lineageos.html">Install Lineageos</a></li><li class="expanded "><a href="android/termux.html">termux</a></li><li class="expanded "><a href="android/scrcpy.html">scrcpy: Display and control your Android device</a></li><li class="expanded "><a href="android/magisk.html">Magisk and EdXposed(deprecated)</a></li></ol></li><li class="expanded "><a href="network/index.html">Network</a></li><li><ol class="section"><li class="expanded "><a href="network/simulators.html">Open-Source Network Simulators</a></li></ol></li><li class="expanded "><a href="switch/index.html">switch</a></li><li><ol class="section"><li class="expanded "><a href="switch/protocols/index.html">Protocols</a></li><li><ol class="section"><li class="expanded "><a href="switch/protocols/stp.html">STP</a></li></ol></li><li class="expanded "><a href="switch/S5720_56C_EI.html">S5720-56C-EI</a></li></ol></li><li class="expanded "><a href="blockchains/index.html">Blockchains</a></li><li><ol class="section"><li class="expanded "><a href="blockchains/mew.html">MyEtherWallet</a></li></ol></li><li class="expanded "><a href="misc/index.html">Misc</a></li><li><ol class="section"><li class="expanded "><a href="misc/shure_bt2.html">Shure Bluetooth® Earphones</a></li><li class="expanded "><a href="misc/images_9_to_3x3.html">把9张图片3X3在一张A4纸上打印</a></li><li class="expanded "><a href="misc/hhkb_linux.html">使用xmodmap简易模仿HHKB</a></li><li class="expanded "><a href="misc/d7000.html">D7000</a></li><li class="expanded "><a href="misc/hp_laserjet_1536dnf_mfp.html">HP LaserJet 1536dnf MFP</a></li><li class="expanded "><a href="misc/jav.html">JAV</a></li><li class="expanded "><a href="misc/comedy.html">Comedy</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Haha</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#哈哈" id="哈哈">哈哈</a></h1>
<h1><a class="header" href="#释义" id="释义">释义</a></h1>
<p>原文:【廣韻】五合切【集韻】鄂合切，音。【玉篇】魚多貌。 　
又【集韻】魚口貌。 　
又【集韻】色洽切，音喢。【玉篇】以口歃飮。【淮南子·氾論訓】嘗一哈水，而甘苦知矣。【集韻】本作歃。或作。 　
又姓。【正字通】楊愼希姓有哈永森。 　
又【集韻】曷閤切，音合。與同。或作，齧聲也。 　
又呼合切，音。與欱同，大歠也。 　
又【集韻】【類篇】葛合切，音閤。與同，食也。 　
又託合切，音榻。義同。</p>
<p>分类:【丑集上】【口字部】 </p>
<p><strong>I must die someday. may tomorrow. may now.</strong></p>
<p><strong>Valar Morghulis</strong></p>
<p><strong>Valar Dohaeris</strong></p>
<p><strong>Do you really understand it, and also this sentence.</strong></p>
<h1><a class="header" href="#my-brain" id="my-brain">My Brain</a></h1>
<h1><a class="header" href="#links" id="links">Links</a></h1>
<ul>
<li>
<p><a href="https://www.quora.com/Why-does-math-make-my-head-brain-hurt">Why does math make my head / brain hurt? - Quora</a></p>
</li>
<li>
<p><a href="https://www.quora.com/A-lot-of-times-when-Im-done-reading-a-paragraph-I-forget-its-content-How-do-I-correct-this">A lot of times when I'm done reading a paragraph, I forget its content. How do I correct this? - Quora</a></p>
<p>Don't just read but think. Don't try to merely remember the text but
construct it; storage it in your memory in a way that's suitable for you.
For example visualise what you are reading. Afterwards, you can come back
to those visions when you have to recall the information you have read.</p>
</li>
<li>
<p><a href="https://www.quora.com/Why-do-I-quickly-forget-what-I-read#">Why do I quickly forget what I read? - Quora</a></p>
</li>
</ul>
<h1><a class="header" href="#meaninglessness-the-point-of-living" id="meaninglessness-the-point-of-living">Meaninglessness: The point of living</a></h1>
<h1><a class="header" href="#links-1" id="links-1">Links</a></h1>
<ul>
<li><a href="https://voice.dts.edu/article/fear-god-enjoy-life-the-message-of-ecclesiastes-zuck-roy-b/">Fear God, Enjoy Life: The Message of Ecclesiastes - DTS Voice</a></li>
</ul>
<p>bible</p>
<h1><a class="header" href="#ecclesiastes-11" id="ecclesiastes-11">Ecclesiastes 1:1</a></h1>
<h1><a class="header" href="#links-2" id="links-2">Links</a></h1>
<ul>
<li><a href="https://biblehub.com/niv/ecclesiastes/1.htm">Ecclesiastes 1 NIV</a></li>
</ul>
<p>Enjoy life and fear God! </p>
<p>infosec</p>
<h1><a class="header" href="#shred" id="shred">Shred</a></h1>
<h1><a class="header" href="#links-3" id="links-3">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Shred_(Unix)">shred (Unix) - Wikipedia</a></li>
<li><a href="https://linux.die.net/man/1/shred">shred(1) - Linux man page</a></li>
<li><a href="https://superuser.com/questions/617515/using-shred-from-the-command-line">macos - Using <code>shred</code> from the command line - Super User</a></li>
</ul>
<pre><code>brew install coreutils
</code></pre>
<h1><a class="header" href="#howto" id="howto">HowTo</a></h1>
<pre><code>shred &lt;foofile&gt;
</code></pre>
<p>因为现在各种文件系统都会自动备份，所以这个方法不一定起作用。</p>
<p>可以写入之后不要删除，这样就会被同步到备份里去，过段时间再删除</p>
<p>正确的做法是<strong>MUST</strong>文件系统加密</p>
<h1><a class="header" href="#shred-a-usb-disk" id="shred-a-usb-disk">shred a usb disk</a></h1>
<ul>
<li><a href="https://ubuverse.com/securely-erase-a-disk-or-flash-drive-with-shred-2/">How to Securely Erase a Disk or Flash Drive with Shred</a></li>
</ul>
<pre><code>diskutil list

diskutil umount /Volumes/xx

sudo shred -vz -n2 /dev/disk2

       -n, --iterations=N
              overwrite N times instead of the default (3)
       -v, --verbose
              show progress
       -z, --zero
              add a final overwrite with zeros to hide shredding
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgnupgorgthe-gnu-privacy-guarda" id="a-hrefhttpsgnupgorgthe-gnu-privacy-guarda"><a href="https://gnupg.org/">The GNU Privacy Guard</a></a></h1>
<h1><a class="header" href="#links-4" id="links-4">Links</a></h1>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/GnuPG">GnuPG - ArchWiki</a></li>
</ul>
<h1><a class="header" href="#install" id="install">Install</a></h1>
<pre><code># Arch
pacman -S gnupg

# Mac
brew install gnupg
</code></pre>
<p>cfg:</p>
<p>By default, the gnupg directory has its permissions set to 700 and the files it contains have their permissions set to 600. </p>
<p>CfgFile: <code>.gnupg/gpg.conf</code></p>
<pre><code>default-key &lt;secret-key&gt;
default-recipient-self
</code></pre>
<h1><a class="header" href="#decrypt" id="decrypt">decrypt</a></h1>
<pre><code>$ gpg -o &lt;file&gt; -d foo.gpg

--output file
-o file
      Write output to file.  To write to stdout use - as the filename.

--decrypt
      -d  Decrypt the file given on the command line (or STDIN if no file is specified) and write it to STDOUT (or the file specified with --output). If the
      decrypted file is signed, the signature is also verified. This command differs from the default operation, as it never writes to the filename which is
      included in the file and it rejects files that don't begin with an encrypted message.
</code></pre>
<h1><a class="header" href="#encrypt" id="encrypt">encrypt</a></h1>
<pre><code>$ gpg -r &lt;user-id&gt; -e &lt;data&gt;
$ gpg -c &lt;data&gt;

--recipient name
      -r Encrypt for user id name. If this option or --hidden-recipient is not specified, GnuPG asks for the user-id unless --default-recipient is given.

--encrypt
      -e  Encrypt  data to one or more public keys. This command may be combined with --sign (to sign and encrypt a message), --symmetric (to encrypt a mes-
      sage that can decrypted using a secret key or a passphrase), or --sign and --symmetric together (for a signed message that can be  decrypted  using  a
      secret key or a passphrase).  --recipient and related options specify which public keys to use for encryption.

--symmetric
      -c  Encrypt with a symmetric cipher using a passphrase. The default symmetric cipher used is AES-128, but may be chosen with the --cipher-algo option.
      This command may be combined with --sign (for a signed and symmetrically encrypted message), --encrypt (for a message that  may  be  decrypted  via  a
      secret  key  or  a  passphrase),  or --sign and --encrypt together (for a signed message that may be decrypted via a secret key or a passphrase).  gpg
      caches the passphrase used for symmetric encryption so that a decrypt operation may not require that the user needs  to  enter  the  passphrase.   The
      option --no-symkey-cache can be used to disable this feature.
</code></pre>
<h1><a class="header" href="#key-maintenance" id="key-maintenance">Key maintenance</a></h1>
<ul>
<li>backup secret key</li>
</ul>
<pre><code>$ gpg --export-secret-keys --armor &lt;user-id&gt; &gt; privkey.asc
</code></pre>
<ul>
<li>import secret key, same as import public key</li>
</ul>
<pre><code>$ gpg --import privkey.asc
$ gpg --import public.key
</code></pre>
<ul>
<li>export public key</li>
</ul>
<pre><code>$ gpg -o public.key -a --export &lt;user-id&gt;

--armor
	     -a Create ASCII armored output.  The default is to create the binary OpenPGP format.
</code></pre>
<h1><a class="header" href="#list-keys" id="list-keys">list keys</a></h1>
<pre><code>gpg --list-keys
gpg --list-secret-keys
</code></pre>
<h1><a class="header" href="#create-a-key-pair" id="create-a-key-pair">create a key pair</a></h1>
<pre><code>$ gpg --full-gen-key

--full-generate-key
	     --full-gen-key Generate a new key pair with dialogs for all options.  This is an extended version of --generate-key.
</code></pre>
<h1><a class="header" href="#change-passphrase-of-the-private-key" id="change-passphrase-of-the-private-key">Change Passphrase of the Private Key</a></h1>
<pre><code>gpg --list-keys
gpg --edit-key your-key-ID
	
gpg&gt; passwd
gpg&gt; save
</code></pre>
<h1><a class="header" href="#a-hrefhttpswwwpasswordstoreorgpassa" id="a-hrefhttpswwwpasswordstoreorgpassa"><a href="https://www.passwordstore.org/">pass</a></a></h1>
<h1><a class="header" href="#links-5" id="links-5">Links</a></h1>
<ul>
<li><a href="https://www.passwordstore.org/">Pass: The Standard Unix Password Manager</a></li>
</ul>
<p><code>pass</code> makes managing these individual password files extremely easy. All
passwords live in <code>~/.password-store</code>, and pass provides some nice commands for
adding, editing, generating, and retrieving passwords.</p>
<h1><a class="header" href="#install-1" id="install-1">Install</a></h1>
<pre><code>brew install pass
</code></pre>
<h1><a class="header" href="#first-time" id="first-time">First Time</a></h1>
<pre><code>pass init &lt;gpg-id&gt;
pass git init
</code></pre>
<h1><a class="header" href="#using-the-password-store" id="using-the-password-store">Using the password store</a></h1>
<pre><code>pass						// list all
pass Email/zx2c4.com				// show
pass -c Email/zx2c4.com				// copy to clipboard
pass insert Business/account			// insert
pass edit pass-name				// edit passwords
pass generate Email/jasondonenfeld.com 15	// generate password
						// It's possible to generate
// passwords with no symbols using --no-symbols or -n 
pass rm Business/cheese-whiz-factory		// remove

pass find regrex				// find
</code></pre>
<h1><a class="header" href="#data-organization" id="data-organization">Data Organization</a></h1>
<p>One approach is to use the multi-line functionality of pass (<code>--multiline</code> or
<code>-m</code> in <code>insert</code>), and store the password itself on the first line of the file,
and the additional information on subsequent lines. For example,
<code>Amazon/bookreader</code> might look like this:</p>
<pre><code>Yw|ZSNH!}z&quot;6{ym9pI
URL: *.amazon.com/*
Username: AmazonianChicken@example.com
Secret Question 1: What is your childhood best friend's most bizarre superhero fantasy? Oh god, Amazon, it's too awful to say...
Phone Support PIN #: 84719
</code></pre>
<h1><a class="header" href="#import-from-keepass" id="import-from-keepass">Import From Keepass</a></h1>
<p><a href="https://github.com/roddhjav/pass-import#readme">roddhjav/pass-import: A pass extension for importing data from most of the existing password manager.</a></p>
<h1><a class="header" href="#collected-topics" id="collected-topics">Collected Topics</a></h1>
<h1><a class="header" href="#links-6" id="links-6">Links</a></h1>
<ul>
<li><a href="https://www.ss.ncu.edu.tw/%7Ecalin/textbook2008/V7.pdf">《攝類學》的要義</a></li>
<li><a href="https://www.youtube.com/watch?v=danZUp6Ao1g">摄类学 - YouTube</a></li>
<li><a href="https://ibd-buddhist.blogspot.com/2004/04/collected-topics-handouts.html">Institute for Buddhist Dialectical Studies: English classes in Tibetan Buddhist Philosophy: Collected Topics Handouts</a></li>
</ul>
<h1><a class="header" href="#攝類學的要義" id="攝類學的要義">《攝類學》的要義</a></h1>
<ul>
<li><a href="https://www.ss.ncu.edu.tw/%7Ecalin/textbook2008/V7.pdf">《攝類學》的要義</a></li>
</ul>
<p>《攝類學》是佛教邏輯的初階訓練和因明的啟蒙教材，其目的在於透過因明推理的訓練，
來掌握佛法經論中重要名相的定義、同義詞、分類、實例等，培養出正思維和思所成慧，
進一步配合正定生起修所成慧，從而破除無明，得到解脫，所以《攝類學》是一門以邏輯
推理來瞭解身心現象的基本課程，包含許多佛學論題，因而也稱做《正理啟門集課》。</p>
<h2><a class="header" href="#佛教邏輯與因明論式的運用" id="佛教邏輯與因明論式的運用">佛教邏輯與因明論式的運用</a></h2>
<p>佛教的邏輯學，通稱為「因明」。</p>
<h2><a class="header" href="#邏輯與因明論式的結構與對答" id="邏輯與因明論式的結構與對答">邏輯與因明論式的結構與對答</a></h2>
<p>佛教邏輯與因明的論式，源自印度的因明，以陳那（480AD）的《集量論》及法稱（560AD
）的《釋量論》作為根本的依據。因明論式雖不等同於形式邏輯的三段論法，但用三段論
法來比對說明，則甚為方便；先舉一三段論法如下：</p>
<pre><code>大前提：凡是白色都是顏色。
小前提：白法螺的顏色是白色。
結論：白法螺的顏色是顏色 。

大前提＝中詞＋大詞
小前提＝小詞＋中詞
結論＝小詞＋大詞
</code></pre>
<p>一個完整的因明論式也具有三詞：（1）前陳＝有法（2）後陳＝所立法（3）因＝理由。例
如：</p>
<pre><code>「以白法螺的顏色作為有法，應是顏色，因為是白色故。」或：「白法螺的顏色（有法）
，應是顏色，因為是白色故。」或略為：「白法螺的顏色，應是顏色，因為是白色故。」
</code></pre>
<p>此論式中，（1）白法螺的顏色是「前陳」，（2）顏色是「後陳」，（3）白色是「因」。</p>
<p>1.「前陳」又稱作「有法」、「諍由」，相當於邏輯中的「小詞」。
2.「後陳」又稱作「所立法」，相當於形式邏輯中的「大詞」。
3.「因」就是理由，相當於形式邏輯中的「中詞」。</p>
<p>因明論式與三段論法的構成比較如下：</p>
<pre><code>    「前陳＋後陳，因故。」
或：「有法＋所立法，因故。」
即：「小詞＋大詞，中詞故。」
</code></pre>
<ol>
<li>宗＝前陳＋後陳＝有法＋所立法＝小詞＋大詞＝結論。</li>
<li>前陳＋因＝有法＋因＝小詞＋中詞＝小前提。</li>
<li>因＋後陳＝因＋所立法＝中詞＋大詞＝大前提。</li>
</ol>
<p><strong>我思：</strong> 三段论有大前提 ＋ 小前提 ＝ 结论，因明有什么？
因明只有前头的前陈（有法，小词）＋后陈（所立法，大词），因（中词）故</p>
<p>似乎因明逻辑是无三段论逻辑严密的。
应该曰因明跟三段论是等价的，只是形式不同。二者是相同的逻辑。</p>
<p><strong>这世上只有一种逻辑可以运行吗？</strong></p>
<p>比如这个世界的逻辑是<code>!true == false</code>（未必正确）, 是否有一个世界，运行着 
<code>!true == true</code>的逻辑。</p>
<h1><a class="header" href="#events" id="events">Events</a></h1>
<h1><a class="header" href="#2019" id="2019">2019</a></h1>
<ul>
<li>
<p><a href="https://www.nytimes.com/2019/10/25/world/europe/39-bodies-essex-lorry.html">Mystery of 39 Bodies in Truck Leads to More Arrests in U.K. - The New York Times</a></p>
<p>Sun Oct 27 00:10:54 CST 2019</p>
</li>
<li>
<p><a href="https://www.nytimes.com/2019/07/20/world/asia/china-explosion-yima.html">Gas Plant Explosion in Central China Kills at Least 10 - The New York Times</a></p>
<p>这一次爆炸，己经没有人再问起。就像没有发生过一样。</p>
</li>
<li>
<p><a href="https://www.bloomberg.com/news/videos/2019-06-13/hong-kong-s-protest-explained-video">Hong Kong's Protest Explained – Bloomberg</a></p>
</li>
<li>
<p><a href="https://www.nytimes.com/2019/05/16/technology/huawei-ban-president-trump.html">Trump’s Latest Move Takes Straight Shot at Huawei’s Business - The New York Times</a><br />
Sat May 25 00:11:23 CST 2019</p>
</li>
<li>
<p><a href="https://cn.nytimes.com/china/20190423/china-pigs-african-swine-fever/">中国非洲猪瘟疫情到底有多严重？ - 纽约时报中文网</a><br />
2019年4月23日</p>
<ul>
<li><a href="https://cn.nytimes.com/asia-pacific/20190515/african-swine-fever-asia-china/">非洲猪瘟从中国蔓延至亚洲多国 - 纽约时报中文网</a></li>
</ul>
</li>
<li>
<p>盐城爆炸</p>
<p><a href="https://www.nytimes.com/2019/03/21/world/asia/china-explosion-jiangsu.html">Explosion Rocks Industrial Zone in Eastern China</a></p>
</li>
</ul>
<h1><a class="header" href="#before" id="before">Before</a></h1>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Panama_Papers">Panama Papers - Wikipedia</a></p>
<p>The Panama Papers are 11.5 million leaked documents that detail financial and
attorney–client information for more than 214,488 offshore entities.  The
documents, some dating back to the 1970s, were created by, and taken from,
Panamanian law firm and corporate service provider Mossack Fonseca, and were
leaked in 2015 by an anonymous source.</p>
<ul>
<li><a href="https://offshoreleaks.icij.org/pages/database">How to download this database | ICIJ Offshore Leaks Database</a></li>
</ul>
</li>
</ul>
<h1><a class="header" href="#collection" id="collection">Collection</a></h1>
<ul>
<li><a href="https://www.duyaoss.com/index.php/archives/3/">浅谈部分机场（SS/SSR提供商）的使用感受--完整版持续更新中 - DuyaoSS-毒药机场简介</a></li>
</ul>
<h1><a class="header" href="#misc" id="misc">Misc</a></h1>
<ul>
<li><a href="https://github.com/shadowsocks/shadowsocks-windows/issues/293#issuecomment-132253168">国内开源开发现状· Issue #293 · shadowsocks</a></li>
<li><a href="https://t.du9l.com/2015/08/qi-wen-gong-shang/">奇文共赏，关于ShadowsocksR事件 – Xiaodu Blog</a></li>
</ul>
<h1><a class="header" href="#english" id="english">English</a></h1>
<h1><a class="header" href="#links-7" id="links-7">Links</a></h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=dKk-_AntZoY">How to pronounce though, thought and tough - YouTube</a></li>
<li><a href="https://jadejoddle.com/remember-words/">Why Can't I Remember English Vocabulary? | Jade Joddle, Speak Well</a></li>
</ul>
<h1><a class="header" href="#howto-1" id="howto-1">Howto</a></h1>
<ul>
<li>Devil’s advocate</li>
<li><strong>Wanted...But...So...Then...</strong></li>
</ul>
<h1><a class="header" href="#examples" id="examples">Examples</a></h1>
<h1><a class="header" href="#links-8" id="links-8">Links</a></h1>
<ul>
<li></li>
</ul>
<h1><a class="header" href="#overview" id="overview">Overview</a></h1>
<ul>
<li>&quot;teachers are being asked to unlearn rigid rules for labeling children&quot;</li>
</ul>
<h1><a class="header" href="#words-in-chain" id="words-in-chain">Words in chain</a></h1>
<ul>
<li>
<p>inconsistency</p>
<p>Sun Oct 27 00:34:19 CST 2019</p>
</li>
</ul>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>inconsistency</td><td>the fact or state of being inconsistent.</td></tr>
<tr><td>inconsistent</td><td>not staying the same throughout.</td></tr>
<tr><td>throughout</td><td>in every part of (a place or object). &quot;it had repercussions throughout Europe&quot;</td></tr>
<tr><td>repercussion</td><td>an unintended consequence occurring some time after an event or action, especially an unwelcome one.</td></tr>
<tr><td>repercussion</td><td>&quot;the move would have grave repercussions for the entire region&quot;</td></tr>
<tr><td>grave</td><td>a place of burial for a dead body, typically a hole dug in the ground and marked by a stone or mound.</td></tr>
<tr><td>burial</td><td>the action or practice of interring a dead body.</td></tr>
<tr><td>inter</td><td>place (a corpse) in a grave or tomb, typically with funeral rites.</td></tr>
<tr><td>rite</td><td>a religious or other solemn ceremony or act.</td></tr>
<tr><td>tomb</td><td>a large vault, typically an underground one, for burying the dead.</td></tr>
<tr><td>vault</td><td>a roof in the form of an arch or a series of arches, typical of churches and other large, formal buildings.</td></tr>
<tr><td>ceremony</td><td>a formal religious or public occasion, typically one celebrating a particular event or anniversary.</td></tr>
<tr><td>solemn</td><td>formal and dignified.</td></tr>
<tr><td>occasion</td><td>a particular time or instance of an event.</td></tr>
<tr><td>religious</td><td>relating to or believing in a religion.</td></tr>
<tr><td>dignified</td><td>having or showing a composed or serious manner that is worthy of respect.</td></tr>
<tr><td>composed</td><td>having one's feelings and expression under control; calm.</td></tr>
<tr><td>mound</td><td>a rounded mass projecting above a surface.</td></tr>
<tr><td>mass</td><td>a coherent, typically large body of matter with no definite shape.</td></tr>
<tr><td>coherent</td><td>united as or forming a whole.</td></tr>
<tr><td>united</td><td>joined together politically, for a common purpose, or by common feelings.</td></tr>
<tr><td>---------------</td><td>-------------------------------------------------------------------------------------------------------------</td></tr>
</tbody></table>
<ul>
<li>
<p>conquer</p>
<p>Sun Oct 27 14:26:01 CST 2019</p>
</li>
</ul>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>conquer</td><td>overcome and take control of (a place or people) by use of military force.</td></tr>
<tr><td>overcome</td><td>defeat (an opponent); prevail.</td></tr>
<tr><td>opponent</td><td>someone who competes against or fights another in a contest, game, or argument; a rival or adversary.</td></tr>
<tr><td>prevail</td><td>prove more powerful than opposing forces; be victorious.</td></tr>
<tr><td>opposing</td><td>in conflict or competition with a specified or implied subject.</td></tr>
<tr><td>victorious</td><td>having won a victory; triumphant.</td></tr>
<tr><td>triumphant</td><td>having won a battle or contest; victorious.</td></tr>
<tr><td>contest</td><td>an event in which people compete for supremacy in a sport, activity, or particular quality.</td></tr>
<tr><td>supremacy</td><td>the state or condition of being superior to all others in authority, power, or status.</td></tr>
<tr><td>rival</td><td>a person or thing competing with another for the same objective or for superiority in the same field of activity.</td></tr>
<tr><td>adversary</td><td>one's opponent in a contest, conflict, or dispute.</td></tr>
<tr><td>------------</td><td>-------------------------------------------------------------------------------------------------------------------</td></tr>
</tbody></table>
<ul>
<li>
<p>ravenous</p>
<p>Sun Oct 27 15:00:45 CST 2019</p>
</li>
</ul>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>ravenous</td><td>extremely hungry.</td></tr>
<tr><td>cheek</td><td>either side of the face below the eye.</td></tr>
<tr><td>----------</td><td>----------------------------------------</td></tr>
</tbody></table>
<ul>
<li>
<p>imply</p>
<p>Sun Oct 27 18:15:00 CST 2019</p>
</li>
</ul>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>imply</td><td>strongly suggest the truth or existence of (something not expressly stated).</td></tr>
<tr><td>express</td><td>convey (a thought or feeling) in words or by gestures and conduct.</td></tr>
<tr><td>convey</td><td>transport or carry to a place.</td></tr>
<tr><td>conduct</td><td>the action or manner of managing an activity or organization.</td></tr>
<tr><td>---------</td><td>------------------------------------------------------------------------------</td></tr>
</tbody></table>
<ul>
<li>
<p>proponent</p>
<p>Sun Oct 27 19:09:45 CST 2019</p>
</li>
</ul>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>proponent</td><td>a person who advocates a theory, proposal, or project.</td></tr>
<tr><td>advocate</td><td>a person who publicly supports or recommends a particular cause or policy.</td></tr>
<tr><td>cause</td><td>a person or thing that gives rise to an action, phenomenon, or condition.</td></tr>
<tr><td>give rise to</td><td>cause or induce to happen.</td></tr>
<tr><td>induce</td><td>bring about or give rise to.</td></tr>
<tr><td>--------------</td><td>----------------------------------------------------------------------------</td></tr>
</tbody></table>
<ul>
<li>
<p>squishy</p>
<p>Tue Oct 29 21:29:11 CST 2019</p>
</li>
</ul>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>squishy</td><td>soft and moist</td></tr>
<tr><td>moist</td><td>slightly wet; damp or humid.</td></tr>
<tr><td>damp</td><td>slightly wet.</td></tr>
<tr><td>humid</td><td>marked by a relatively high level of water vapor in the atmosphere.</td></tr>
<tr><td>vapor</td><td>a substance diffused or suspended in the air, especially one normally liquid or solid.</td></tr>
<tr><td>substance</td><td>a particular kind of matter with uniform properties.</td></tr>
<tr><td>uniform</td><td>remaining the same in all cases and at all times; unchanging in form or character.</td></tr>
<tr><td>diffuse</td><td>spread or cause to spread over a wide area or among a large number of people.</td></tr>
<tr><td>suspend</td><td>temporarily prevent from continuing or being in force or effect.</td></tr>
<tr><td>liquid</td><td>a substance that flows freely but is of constant volume, having a consistency like that of water or oil.</td></tr>
<tr><td>constant</td><td>occurring continuously over a period of time.</td></tr>
<tr><td>volume</td><td>the amount of space that a substance or object occupies, or that is enclosed within a container, especially when great.</td></tr>
<tr><td>solid</td><td>firm and stable in shape; not liquid or fluid.</td></tr>
<tr><td>fluid</td><td>a substance that has no fixed shape and yields easily to external pressure; a gas or (especially) a liquid.</td></tr>
<tr><td>yield</td><td>produce or provide (a natural, agricultural, or industrial product).</td></tr>
<tr><td>-----------</td><td>-------------------------------------------------------------------------------------------------------------------------</td></tr>
</tbody></table>
<ul>
<li>
<p>conspiracy</p>
<p>Wed Oct 30 22:53:11 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>conspiracy</td><td>a secret plan by a group to do something unlawful or harmful.</td></tr>
<tr><td>------------</td><td>---------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>interleave</p>
<p>Thu Oct 31 22:23:52 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>interleave</td><td>insert pages, typically blank ones, between the pages of (a book).</td></tr>
<tr><td>------------</td><td>--------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>inventory</p>
<p>Thu Oct 31 22:26:02 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>inventory</td><td>a complete list of items such as property, goods in stock, or the contents of a building.</td></tr>
<tr><td>stock</td><td>the goods or merchandise kept on the premises of a business or warehouse and available for sale or distribution.</td></tr>
<tr><td>merchandise</td><td>goods to be bought and sold.</td></tr>
<tr><td>premise</td><td>a previous statement or proposition from which another is inferred or follows as a conclusion.</td></tr>
<tr><td>premise</td><td>&quot;if the premise is true, then the conclusion must be true&quot;</td></tr>
<tr><td>warehouse</td><td>a large building where raw materials or manufactured goods may be stored before their export or distribution for sale.</td></tr>
<tr><td>-------------</td><td>------------------------------------------------------------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>intricate</p>
<p>Thu Oct 31 22:33:03 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>intricate</td><td>very complicated or detailed.</td></tr>
<tr><td>-----------</td><td>-------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>verbatim</p>
<p>Thu Oct 31 22:34:43 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>verbatim</td><td>in exactly the same words as were used originally.</td></tr>
<tr><td>verbatim</td><td>&quot;subjects were instructed to recall the passage verbatim&quot;</td></tr>
<tr><td>instruct</td><td>direct or command someone to do something, especially as an official order.</td></tr>
<tr><td>passage</td><td>the act or process of moving through, under, over, or past something on the way from one place to another.</td></tr>
<tr><td>----------</td><td>------------------------------------------------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>consolation</p>
<p>Thu Oct 31 23:22:22 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>consolation</td><td>the comfort received by a person after a loss or disappointment.</td></tr>
<tr><td>-------------</td><td>------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>parenthetical</p>
<p>Thu Oct 31 23:56:24 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>parenthetical</td><td>relating to or inserted as a parenthesis.</td></tr>
<tr><td>parenthetical</td><td>&quot;ignore the parenthetical remarks that pockmark every page&quot;</td></tr>
<tr><td>remark</td><td>say something as a comment; mention.</td></tr>
<tr><td>pockmark</td><td>a pitted scar or mark on the skin left by a pustule or pimple.</td></tr>
<tr><td>pit</td><td>make a hollow or indentation in the surface of.</td></tr>
<tr><td>hollow</td><td>having a hole or empty space inside.</td></tr>
<tr><td>pustule</td><td>a small blister or pimple on the skin containing pus.</td></tr>
<tr><td>blister</td><td>a small bubble on the skin filled with serum and caused by friction, burning, or other damage.</td></tr>
<tr><td>friction</td><td>the resistance that one surface or object encounters when moving over another.</td></tr>
<tr><td>resistance</td><td>the refusal to accept or comply with something; the attempt to prevent something by action or argument.</td></tr>
<tr><td>refusal</td><td>an act or an instance of refusing; the state of being refused.</td></tr>
<tr><td>comply</td><td>(of a person or group) act in accordance with a wish or command.</td></tr>
<tr><td>serum</td><td>an amber-colored, protein-rich liquid that separates out when blood coagulates.</td></tr>
<tr><td>coagulate</td><td>(of a fluid, especially blood) change to a solid or semisolid state.</td></tr>
<tr><td>coagulate</td><td>&quot;blood had coagulated around the edges of the wound&quot;</td></tr>
<tr><td>amber</td><td>hard translucent fossilized resin produced by extinct coniferous trees of the Tertiary period, typically yellowish in color.</td></tr>
<tr><td>translucent</td><td>(of a substance) allowing light, but not detailed shapes, to pass through; semitransparent.</td></tr>
<tr><td>fossilize</td><td>preserve (an organism) so that it becomes a fossil.</td></tr>
<tr><td>fossil</td><td>the remains or impression of a prehistoric organism preserved in petrified form or as a mold or cast in rock.</td></tr>
<tr><td>resin</td><td>a sticky flammable organic substance, insoluble in water, exuded by some trees and other plants (notably fir and pine).</td></tr>
<tr><td>pimple</td><td>a small hard inflamed spot on the skin.</td></tr>
<tr><td>inflamed</td><td>(of a part of the body) red or swollen as a result of inflammation.</td></tr>
<tr><td>inflammation</td><td>a localized physical condition in which part of the body becomes reddened, swollen, hot, and ...</td></tr>
<tr><td>inflammation</td><td>... often painful, especially as a reaction to injury or infection.</td></tr>
<tr><td>inflection</td><td>a change in the form of a word (typically the ending) to express a grammatical function ...</td></tr>
<tr><td>inflection</td><td>... or attribute such as tense, mood, person, number, case, and gender.</td></tr>
<tr><td>pus</td><td>a thick yellowish or greenish opaque liquid produced in infected tissue, ...</td></tr>
<tr><td>pus</td><td>... consisting of dead white blood cells and bacteria with tissue debris and serum.</td></tr>
<tr><td>---------------</td><td>------------------------------------------------------------------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>prominent</p>
<p>Sun Nov 03 20:53:28 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>prominent</td><td>important; famous.</td></tr>
<tr><td>-----------</td><td>--------------------</td></tr>
</tbody></table>
</li>
<li>
<p>substantive</p>
<p>Sun Nov 03 23:10:29 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>substantive</td><td>having a firm basis in reality and therefore important, meaningful, or considerable.</td></tr>
<tr><td>substantive</td><td>&quot;there is no substantive evidence for the efficacy of these drugs&quot;</td></tr>
<tr><td>-------------</td><td>--------------------------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>fraction</p>
<p>Sun Nov 03 23:10:29 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>fraction</td><td>a numerical quantity that is not a whole number (e.g. 1/2, 0.5).</td></tr>
<tr><td>----------</td><td>------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>innovative</p>
<p>Sun Nov 03 23:10:29 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>innovative</td><td>(of a product, idea, etc.) featuring new methods; advanced and original.</td></tr>
<tr><td>------------</td><td>--------------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>inflate</p>
<p>Sun Nov 03 23:10:29 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>inflate</td><td>fill (a balloon, tire, or other expandable structure) with air or gas so that it becomes distended.</td></tr>
<tr><td>distended</td><td>swollen due to pressure from inside; bloated.</td></tr>
<tr><td>swollen</td><td>past participle of swell.</td></tr>
<tr><td>swell</td><td>(especially of a part of the body) become larger or rounder in size, typically as a result of an accumulation of fluid.</td></tr>
<tr><td>bloat</td><td>make or become swollen with fluid or gas.</td></tr>
<tr><td>accumulaton</td><td>the acquisition or gradual gathering of something.</td></tr>
<tr><td>acquisition</td><td>an asset or object bought or obtained, typically by a library or museum.</td></tr>
<tr><td>gradual</td><td>taking place or progressing slowly or by degrees.</td></tr>
<tr><td>-------------</td><td>-------------------------------------------------------------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>facilitate</p>
<p>Mon Nov 04 22:03:57 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>facilitate</td><td>make (an action or process) easy or easier.</td></tr>
<tr><td>------------</td><td>---------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>perpetual</p>
<p>Mon Nov 04 22:55:20 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>perpetual</td><td>never ending or changing.</td></tr>
<tr><td>-----------</td><td>---------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>deliberate</p>
<p>Sat Nov 09 15:28:52 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>delibrate</td><td>done consciously and intentionally.</td></tr>
<tr><td>conscious</td><td>aware of and responding to one's surroundings; awake.</td></tr>
<tr><td>intentional</td><td>done on purpose; deliberate.</td></tr>
<tr><td>-------------</td><td>-------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>convolute</p>
<p>Sat Nov 09 17:41:54 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>convolute</td><td>make (an argument, story, etc.) complex and difficult to follow.</td></tr>
<tr><td>-----------</td><td>------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
<li>
<p>potent</p>
<p>Sun Nov 10 14:11:31 CST 2019</p>
<table><thead><tr><th>Word</th><th>Meaning</th></tr></thead><tbody>
<tr><td>potent</td><td>having great power, influence, or effect.</td></tr>
<tr><td>potent</td><td>&quot;thrones were potent symbols of authority&quot;</td></tr>
<tr><td>potential</td><td>having or showing the capacity to become or develop into something in the future.</td></tr>
<tr><td>potential</td><td>&quot;a two-pronged campaign to woo potential customers&quot;</td></tr>
<tr><td>prong</td><td>each of two or more projecting pointed parts at the end of a fork.</td></tr>
<tr><td>woo</td><td>seek the favor, support, or custom of.</td></tr>
<tr><td>-----------</td><td>-----------------------------------------------------------------------------------</td></tr>
</tbody></table>
</li>
</ul>
<h1><a class="header" href="#pronunciation" id="pronunciation">Pronunciation</a></h1>
<h1><a class="header" href="#links-9" id="links-9">Links</a></h1>
<h1><a class="header" href="#pronunciation-1" id="pronunciation-1">Pronunciation</a></h1>
<table><thead><tr><th>Word</th><th>Pronunciation</th></tr></thead><tbody>
<tr><td>pronunciation</td><td>pruh·nuhn·see·ei·shn</td></tr>
<tr><td>different</td><td>di·fr·uhnt</td></tr>
<tr><td>---------------</td><td>-------------------------------------------------------------------------------------------------------------------------</td></tr>
<tr><td>religious</td><td>[ree·li·juhs](<a href="https://www.google.com/search?q=how+to+pronounce+religious">how to pronounce religious - Google Search</a>)</td></tr>
</tbody></table>
<h1><a class="header" href="#synonyms-and-antonyms" id="synonyms-and-antonyms">Synonyms and Antonyms</a></h1>
<h1><a class="header" href="#links-10" id="links-10">Links</a></h1>
<h1><a class="header" href="#synonyms-and-antonyms-1" id="synonyms-and-antonyms-1">Synonyms and Antonyms</a></h1>
<table><thead><tr><th>Word</th><th>Synonyms</th><th>Antonyms</th></tr></thead><tbody>
<tr><td>rot</td><td>decay</td><td>recover</td></tr>
<tr><td>outrageous</td><td>disgraceful</td><td>moderate</td></tr>
<tr><td>furious</td><td>raging</td><td>calm</td></tr>
<tr><td>------------</td><td>-------------</td><td>----------</td></tr>
</tbody></table>
<h1><a class="header" href="#exercise_practise_practice" id="exercise_practise_practice">exercise_practise_practice</a></h1>
<h1><a class="header" href="#links-11" id="links-11">Links</a></h1>
<ul>
<li><a href="https://www.dictionary.com/e/practice-vs-practise/">Practice vs. Practise - Everything After Z by Dictionary.com</a></li>
<li><a href="https://forum.wordreference.com/threads/exercise-vs-practise.799528/">exercise vs. practise | WordReference Forums</a></li>
</ul>
<p>Generally, exercise is used for physical training.</p>
<p>In British English, practise is a verb and practice is a noun. </p>
<p>In American English, practice is both the noun and verb form.</p>
<p>American English doesn’t really use practise.</p>
<h1><a class="header" href="#incidents-vs-accidents" id="incidents-vs-accidents">incidents vs accidents</a></h1>
<h1><a class="header" href="#links-12" id="links-12">Links</a></h1>
<ul>
<li><a href="https://blog.safetysync.com/whats-the-difference-between-incidents-and-accidents">Incidents vs Accidents: What's the Difference?</a></li>
</ul>
<p>Accidents are defined as: ...an unexpected event that may result in property
damage, and does result in an injury or illness to an employee.</p>
<p>Incidents, on the other hand, are:... an unexpected event that may result in
property damage, but does not result in an injury or illness. Incidents are
also called, &quot;near misses,&quot; or &quot;near hits.&quot;</p>
<h1><a class="header" href="#this-world-is-dangerous" id="this-world-is-dangerous">THIS WORLD IS DANGEROUS</a></h1>
<h1><a class="header" href="#reserved-ip-addresses" id="reserved-ip-addresses">Reserved IP addresses</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Reserved_IP_addresses">Reserved IP addresses - Wikipedia</a></li>
</ul>
<pre><code>0.0.0.0/8 
10.0.0.0/8 
100.64.0.0/10 
127.0.0.0/8 
169.254.0.0/16 
172.16.0.0/12 
192.0.0.0/24 
192.0.2.0/24 
192.88.99.0/24 
192.168.0.0/16 
198.18.0.0/15 
198.51.100.0/24 
203.0.113.0/24 
224.0.0.0/4 
240.0.0.0/4 
</code></pre>
<h1><a class="header" href="#all-tls-ports" id="all-tls-ports">All TLS Ports</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers">List of TCP and UDP port numbers - Wikipedia</a></li>
</ul>
<pre><code>443
465 		Authenticated SMTP[10] over TLS/SSL (SMTPS)[83]
563 		NNTP over TLS/SSL (NNTPS) 
585 		Legacy use of Internet Message Access Protocol over TLS/SSL (IMAPS), now in use at port 993.
636 		Lightweight Directory Access Protocol over TLS/SSL (LDAPS)[10]
853 		DNS over TLS (RFC 7858) 
989 		FTPS Protocol (data), FTP over TLS/SSL
990 		FTPS Protocol (control), FTP over TLS/SSL
992 		Telnet protocol over TLS/SSL
993 		Internet Message Access Protocol over TLS/SSL (IMAPS)[10]
994 		Internet Relay Chat over TLS/SSL (IRCS). Previously assigned, but not used in common practice.[76]
995 		Post Office Protocol 3 over TLS/SSL (POP3S)[10]
4116 		Smartcard-TLS
4843 		OPC UA TCP Protocol over TLS/SSL for OPC Unified Architecture from OPC Foundation
5061 		Session Initiation Protocol (SIP) over TLS
5349 		TURN over TLS/DTLS, a protocol for NAT traversal[169]
5671 		Advanced Message Queuing Protocol (AMQP)[216] over TLS
6436 		Leap Motion Websocket Server TLS
6513 		NETCONF over TLS
6514 		Syslog over TLS[228]
6619 		odette-ftps, Odette File Transfer Protocol (OFTP) over TLS/SSL
8883 		Secure MQTT (MQTT over TLS)[277][278]
10514 		TLS-enabled Rsyslog (default by convention)
</code></pre>
<h1><a class="header" href="#dns-leak" id="dns-leak">DNS leak</a></h1>
<p>If only run socks5, the DNS leak will happen. this is why I more like vpn than
socks5 proxy.</p>
<h1><a class="header" href="#all-go-through-socks5" id="all-go-through-socks5">all go through socks5</a></h1>
<ul>
<li><code>proxychains</code> or tools alike just let one soft go through.</li>
<li><code>redsocks</code> is used for such case. And <code>ss-redir</code> also do such things too.</li>
</ul>
<p><strong>Caution: this method doesn't really proxy UDP.</strong></p>
<h1><a class="header" href="#udp-over-tcp" id="udp-over-tcp">UDP over TCP</a></h1>
<p>It seams this trick doesn't fit this case.</p>
<p><a href="https://www.quora.com/How-do-you-forward-UDP-packets-through-an-SSH-tunnel">How to forward UDP packets through an SSH tunnel - Quora</a></p>
<pre><code>#!/bin/bash
# $0 UDPPort TCPPort &lt;Client|Server&gt;

if [[ $3 == &quot;client&quot; ]]; then
mkfifo /tmp/udp2tcp
netcat -l -u -p $1 &lt; /tmp/udp2tcp | netcat localhost $2 &gt; /tmp/udp2tcp
fi
if [[ $3 == &quot;server&quot; ]]; then
mkfifo /tmp/tcp2udp
netcat -l -p $2 &lt; /tmp/tcp2udp | netcat -u localhost $1 &gt; /tmp/tcp2udp
fi
</code></pre>
<h1><a class="header" href="#how-to-search" id="how-to-search">How to Search</a></h1>
<h1><a class="header" href="#links-13" id="links-13">Links</a></h1>
<ul>
<li><a href="https://time.com/4116259/google-search/">11 Google Tricks That'll Change the Way You Search | Time.com</a> </li>
</ul>
<h1><a class="header" href="#overview-1" id="overview-1">Overview</a></h1>
<h1><a class="header" href="#must" id="must">MUST</a></h1>
<h1><a class="header" href="#tools" id="tools">Tools</a></h1>
<ul>
<li><a href="https://www.mozilla.org/en-US/firefox/">Firefox</a>
<ul>
<li><a href="https://addons.mozilla.org/en-US/firefox/addon/noscript/">Script Security Suite</a></li>
<li><a href="https://addons.mozilla.org/en-US/firefox/addon/https-everywhere/">HTTPS Everywhere</a></li>
</ul>
</li>
</ul>
<h1><a class="header" href="#config" id="config">Config</a></h1>
<ul>
<li><a href="https://www.technipages.com/firefox-enable-disable-referrer">Firefox: Enable/Disable Referrer</a></li>
</ul>
<pre><code>1. about:config
1. network.http.sendRefererHeader
1. 
    0 – Disable referrer.
    1 – Send the Referer header when clicking on a link, and set document.referrer for the following page.
    2 – Send the Referer header when clicking on a link or loading an image.
</code></pre>
<h1><a class="header" href="#test" id="test">Test</a></h1>
<ul>
<li>One Time Link can be used to test if you are being monitored.</li>
</ul>
<h1><a class="header" href="#caution" id="caution">Caution</a></h1>
<ul>
<li>Never use same username, password and avatar at any circumstance.</li>
</ul>
<h1><a class="header" href="#delete-telegram-account" id="delete-telegram-account">Delete telegram account</a></h1>
<ul>
<li><a href="https://telegram.org/faq#q-how-do-i-delete-my-account">Telegram F.A.Q.</a></li>
</ul>
<p><a href="https://my.telegram.org/auth?to=delete">This page to delete account</a></p>
<p>Please make sure you are entering your mobile phone number in the international format.</p>
<p>I.e.: <code>+(country code)(city or carrier code)(your number)</code></p>
<h1><a class="header" href="#virtual-phone" id="virtual-phone">Virtual Phone</a></h1>
<h1><a class="header" href="#speedtest-cli" id="speedtest-cli">speedtest-cli</a></h1>
<h1><a class="header" href="#links-14" id="links-14">Links</a></h1>
<ul>
<li><a href="https://github.com/sivel/speedtest-cli">sivel/speedtest-cli: Command line interface for testing internet bandwidth using speedtest.net</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpswwwveracryptfrenhomehtmlveracrypta" id="a-hrefhttpswwwveracryptfrenhomehtmlveracrypta"><a href="https://www.veracrypt.fr/en/Home.html">VeraCrypt</a></a></h1>
<h1><a class="header" href="#links-15" id="links-15">Links</a></h1>
<ul>
<li><a href="https://askleo.com/how-do-i-encrypt-a-hard-drive-using-veracrypt/">How Do I Encrypt a Hard Drive Using VeraCrypt? - Ask Leo!</a></li>
</ul>
<h1><a class="header" href="#notes" id="notes">Notes</a></h1>
<ul>
<li>When create volume, all data will <strong>lost</strong>, not as the article says, can
encrypt on the fly.</li>
</ul>
<h1><a class="header" href="#proxy-setting" id="proxy-setting">Proxy Setting</a></h1>
<p>If the program doesn't support socks5，There's two way:</p>
<ol>
<li>Use <a href="https://www.privoxy.org/">provixy</a> or <a href="https://www.irif.fr/%7Ejch/software/polipo/">polipo</a> change socks5 to http
Now I more like to use <a href="https://github.com/zenhack/socks2http">zenhack/socks2http</a>, It's simple and worked.<br />
Sun Dec 08 18:24:15 CST 2019</li>
<li>Use <a href="https://github.com/rofl0r/proxychains-ng">proxychains-ng</a> forward to socks5</li>
</ol>
<h1><a class="header" href="#links-16" id="links-16">Links</a></h1>
<ul>
<li><a href="https://stackoverflow.com/questions/27658665/how-convert-socks-to-http-in-mac-osx">proxy - How convert Socks to HTTP in Mac OSX? - Stack Overflow</a></li>
</ul>
<h1><a class="header" href="#socks2http" id="socks2http">socks2http</a></h1>
<ul>
<li><a href="https://github.com/zenhack/socks2http">zenhack/socks2http</a></li>
</ul>
<h1><a class="header" href="#ssh-socks5-proxy" id="ssh-socks5-proxy">ssh socks5 proxy</a></h1>
<p><code>ssh -gfNTD 1080 &lt;sshd&gt;</code></p>
<h1><a class="header" href="#proxychains-ng" id="proxychains-ng">proxychains-ng</a></h1>
<p><a href="https://github.com/rofl0r/proxychains-ng">proxychains-ng</a></p>
<pre><code>sudo apt update
sudo apt install build-essential

./configure --prefix=/usr --sysconfdir=/etc
make
sudo make install

// sample config file:
cp src/proxychains.conf /etc/
</code></pre>
<p>cfgFile: <code>/etc/proxychains.conf</code></p>
<pre><code>[ProxyList]
socsk5 localhost 1080
</code></pre>
<p>Use:</p>
<pre><code>proxychains4 &lt;cmd&gt;
proxychains4 apt upgrade
</code></pre>
<h1><a class="header" href="#privoxy" id="privoxy">Privoxy</a></h1>
<p><a href="http://www.privoxy.org/">Website</a></p>
<pre><code>// Ubuntu 18.04
apt install privoxy

// Mac
proxychains4 brew install privoxy
</code></pre>
<p>cfgFile:</p>
<ul>
<li><code>/usr/local/etc/privoxy/config</code>		// Mac</li>
<li><code>/etc/privoxy/config</code></li>
</ul>
<pre><code>// There's a &quot;dot&quot; at the end.
forward-socks5 / 127.0.0.1:1080 .

// default port: 8118
systemctl enable privoxy
systemctl start privoxy 

// Mac
privoxy /usr/local/etc/privoxy/config
</code></pre>
<h2><a class="header" href="#config-autostart" id="config-autostart">Config Autostart</a></h2>
<p>cfgFile: <code>Library/LaunchAgents/local.privoxy.plist</code></p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
        &lt;key&gt;Label&lt;/key&gt;
        &lt;string&gt;privoxy&lt;/string&gt;
        &lt;key&gt;ProgramArguments&lt;/key&gt;
        &lt;array&gt;
          &lt;string&gt;/usr/local/sbin/privoxy&lt;/string&gt;
          &lt;string&gt;--no-daemon&lt;/string&gt;
          &lt;string&gt;/usr/local/etc/privoxy/config&lt;/string&gt;
        &lt;/array&gt;
        &lt;key&gt;RunAtLoad&lt;/key&gt;
        &lt;true/&gt;
        &lt;key&gt;StandardErrorPath&lt;/key&gt;
        &lt;string&gt;~/privoxy.log&lt;/string&gt;
        &lt;key&gt;StandardOutPath&lt;/key&gt;
        &lt;string&gt;~/privoxy.log&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<p>Execute:</p>
<p><code>launchctl load local.privoxy.plist</code></p>
<h1><a class="header" href="#polipo" id="polipo">polipo</a></h1>
<p><a href="https://www.irif.fr/%7Ejch/software/polipo/">polipo</a></p>
<p>This stupid program can't use single quote in variable assignment, such as:</p>
<p><code>proxyAddress = '0.0.0.0'</code></p>
<p><strong>This won't work. MUST use double quote.</strong></p>
<pre><code>// Mac
brew install polipo
</code></pre>
<p>cfgFile: <code>.poliporc</code></p>
<pre><code>socksParentProxy = 127.0.0.1:1080
socksProxyType = socks5

// default port is 8123
proxyAddress = &quot;0.0.0.0&quot;
// proxyPort = 8123
</code></pre>
<p>Execute: <code>polipo</code></p>
<h1><a class="header" href="#apt" id="apt">apt</a></h1>
<ul>
<li>Support http_proxy</li>
<li>Doesn't support socks5</li>
</ul>
<p>cfgFile: <code>/etc/apt/apt.conf.d/01proxy</code></p>
<pre><code>Acquire::http::Proxy &quot;http://localhost:8118&quot;;
Acquire::https::Proxy &quot;http://localhost:8118&quot;;
</code></pre>
<h1><a class="header" href="#docker" id="docker">docker</a></h1>
<p>using the <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code>, and <code>NO_PROXY</code> environment variables. </p>
<h1><a class="header" href="#git" id="git">git</a></h1>
<ul>
<li>use ssh protocol doesn't support http_proxy</li>
<li>http_proxy here can config with a socks5 proxy</li>
</ul>
<pre><code>// set
git config --global http.proxy $http_proxy
git config --global https.proxy $https_proxy

// unset
git config --global --unset http.proxy
git config --global --unset https.proxy

// check
cat  ~/.gitconfig
</code></pre>
<h1><a class="header" href="#go-get" id="go-get">go get</a></h1>
<ul>
<li>Doesn't support forwarding with proxychains</li>
<li>support http_proxy</li>
</ul>
<h1><a class="header" href="#chrome" id="chrome">chrome</a></h1>
<p><code>./chrome.exe --proxy-server=&quot;socks5://localhost:1080&quot;</code></p>
<h1><a class="header" href="#npm" id="npm">npm</a></h1>
<p>cfgFile: <code>.npmrc</code></p>
<pre><code>proxy=http://localhost:8118/
https-proxy=http://localhost:8118
</code></pre>
<h1><a class="header" href="#android" id="android">android</a></h1>
<ul>
<li><a href="https://android.stackexchange.com/questions/98287/how-to-set-wifi-proxy-via-adb-shell">wi fi - How to set WIFI proxy via adb shell? - Android Enthusiasts Stack Exchange</a></li>
<li><a href="https://stackoverflow.com/questions/31807559/undo-setting-proxy-via-settings-global-in-android">Undo setting proxy via Settings.Global in Android - Stack Overflow</a></li>
</ul>
<pre><code>// add
adb shell settings put global http_proxy &lt;address&gt;:&lt;port&gt;
// delete
adb shell settings delete global global_http_proxy_port
</code></pre>
<h1><a class="header" href="#a-hrefhttpswwwwireguardcomwireguard-fast-modern-secure-vpn-tunnela" id="a-hrefhttpswwwwireguardcomwireguard-fast-modern-secure-vpn-tunnela"><a href="https://www.wireguard.com/">WireGuard: fast, modern, secure VPN tunnel</a></a></h1>
<p>When use vpn, the server knows who you are.</p>
<h1><a class="header" href="#links-17" id="links-17">Links</a></h1>
<ul>
<li><a href="https://www.wireguard.com/install/">Installation - WireGuard</a></li>
<li><a href="https://www.wireguard.com/quickstart/">Quick Start - WireGuard</a></li>
<li><a href="https://wiki.debian.org/Wireguard">Wireguard - Debian Wiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/WireGuard">WireGuard - ArchWiki</a></li>
<li><a href="https://medium.com/@headquartershq/setting-up-wireguard-on-a-mac-8a121bfe9d86">Cheatsheet for setting up a WireGuard client on a Mac</a></li>
<li><a href="https://emanuelduss.ch/2018/09/wireguard-vpn-road-warrior-setup/">WireGuard VPN Road Warrior Setup – emanuelduss.ch</a></li>
<li><a href="https://www.ckn.io/blog/2017/11/14/wireguard-vpn-typical-setup/">Wireguard VPN: Typical Setup - The poetry of (in)security</a></li>
<li><a href="https://www.ckn.io/blog/2017/12/28/wireguard-vpn-portable-raspberry-pi-setup/">Wireguard VPN: Portable Raspberry Pi Setup - The poetry of (in)security</a></li>
</ul>
<h1><a class="header" href="#howto-2" id="howto-2">HowTo</a></h1>
<p><a href="https://angristan.xyz/how-to-setup-vpn-server-wireguard-nat-ipv6/">How to setup a VPN server using WireGuard (with NAT and IPv6)</a></p>
<ol>
<li>Make the client's WireGuard interface its gateway (default route)</li>
<li>Enable IP Forwarding on the server</li>
<li>Enable NAT between the WireGuard interface and public interface on the
server</li>
</ol>
<h1><a class="header" href="#install-2" id="install-2">Install</a></h1>
<pre><code>// Ubuntu
$ sudo add-apt-repository ppa:wireguard/wireguard
$ sudo apt-get update
$ sudo apt-get install wireguard

// macOS
brew install wireguard-tools

// Raspberry Pi
// building kernel first. 
git clone https://git.zx2c4.com/WireGuard
cd WireGuard/src
make
sudo make install
sudo modprobe wireguard

//  Red Hat Enterprise Linux / CentOS
sudo curl -Lo /etc/yum.repos.d/wireguard.repo https://copr.fedorainfracloud.org/coprs/jdoss/wireguard/repo/epel-7/jdoss-wireguard-epel-7.repo
sudo yum install epel-release
sudo yum install wireguard-dkms wireguard-tools
</code></pre>
<h1><a class="header" href="#ip-forwarding" id="ip-forwarding">IP Forwarding</a></h1>
<p><code>net.ipv4.ip_forward = 1</code> </p>
<p>meaning allowing the kernel to forward packets from one network interface to
another. </p>
<p>cmd:</p>
<pre><code>cat /proc/sys/net/ipv4/ip_forward
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
// or
sysctl -w net.ipv4.ip_forward=1
</code></pre>
<p>cfg:</p>
<p>Config File <code>/etc/sysctl.conf</code>:</p>
<pre><code>net.ipv4.ip_forward=1
</code></pre>
<p>apply:</p>
<p><code>sysctl -p /etc/sysctl.conf</code></p>
<h1><a class="header" href="#nat" id="nat">NAT</a></h1>
<p>vpn server needs to config nat masquerade.</p>
<pre><code>nft add table nat
nft add chain nat prerouting { type nat hook prerouting priority 0 \; }
nft add chain nat postrouting { type nat hook postrouting priority 100 \; }

nft add rule nat postrouting oif ens4 masquerade
</code></pre>
<h1><a class="header" href="#import-by-reading-a-qr-code" id="import-by-reading-a-qr-code">Import by reading a QR code</a></h1>
<pre><code>apt install qrencode

qrencode -t ansiutf8 &lt; client.conf
</code></pre>
<h1><a class="header" href="#conceptual-overview" id="conceptual-overview">Conceptual Overview</a></h1>
<p>Wireguard works like ssh. </p>
<p><strong>Cryptokey Routing</strong></p>
<p>works by associating public keys with a list of tunnel IP addresses that are
allowed inside the tunnel. </p>
<p>Each network interface has a private key and a list of peers. Each peer has
a public key. Public keys are short and simple, and are used by peers to
authenticate each other. They can be passed around for use in configuration
files by any out-of-band method, similar to how one might send their SSH public
key to a friend for access to a shell server.</p>
<p>In other words, when sending packets, the list of allowed IPs behaves as a sort
of routing table, and when receiving packets, the list of allowed IPs behaves
as a sort of access control list.</p>
<p>This is what we call a Cryptokey Routing Table: the simple association of
public keys and allowed IPs.</p>
<h1><a class="header" href="#quick-start" id="quick-start">Quick Start</a></h1>
<ul>
<li>
<p>Generate key and exchange public key with server</p>
<p>Every wireguard interface needs a pair of key:</p>
<pre><code>wg genkey | tee -a privatekey | wg pubkey &gt;&gt; publickey
chmod 600 *key
</code></pre>
</li>
<li>
<p>Create config file <code>/etc/wireguard/wg0.conf</code>: </p>
<pre><code>[Interface]
PrivateKey = &lt;server privatekey&gt;
// client doesn't need config ListenPort
ListenPort = &lt;public listen port&gt;
Address = &lt;client ip&gt;
// client append below
DNS = x.x.x.x

[Peer]
PublicKey = &lt;client publickey&gt;
AllowedIPs = &lt;client ip&gt;
// client append below
AllowedIPs = 0.0.0.0/0
Endpoint = &lt;server public ip:port&gt;
PersistentKeepalive = 25

</code></pre>
</li>
<li>
<p>wg-quick </p>
<pre><code>wg-quick [up|down] wg0
// or
wg-quick [up|down] ./wg0.conf
</code></pre>
</li>
<li>
<p>auto start</p>
</li>
</ul>
<p><code>systemctl enable wg-quick@wg0</code> </p>
<ul>
<li>show</li>
</ul>
<pre><code># ip a
# wg 
</code></pre>
<h1><a class="header" href="#manual-setup" id="manual-setup">Manual setup</a></h1>
<p><a href="https://git.zx2c4.com/WireGuard/about/src/tools/man/wg-quick.8">WireGuard - Fast and secure kernelspace VPN</a></p>
<pre><code>ip link add dev wg0 type wireguard
ip address add dev wg0 192.168.2.1/24
ip link set dev wg0 up
wg setconf wg0 myconfig.conf
// or
wg setconf wgpi &lt;(wg-quick strip ./wgpi.conf)
</code></pre>
<h1><a class="header" href="#config-with-systemd" id="config-with-systemd">Config with systemd</a></h1>
<p>Config File <code>/etc/systemd/network/wg0.netdev</code>:</p>
<pre><code>[NetDev]
Name=wg0
Kind=wireguard
Description=Wireguard

[WireGuard]
PrivateKey=&lt;paste the private key of the local host here&gt;
DNS = &lt;server ip&gt;

[WireGuardPeer]
PublicKey=&lt;paste the public key of the remote host here&gt;
AllowedIPs=0.0.0.0/0
AllowedIPs=::/0
Endpoint=&lt;remote IP or hostname&gt;:&lt;remote port&gt;
</code></pre>
<p>change file permissions:</p>
<pre><code class="language-sh">chown root.systemd-network /etc/systemd/network/wg0.netdev
chmod 0640 /etc/systemd/network/wg0.netdev
</code></pre>
<p>Config File <code>/etc/systemd/network/wg0.network</code>:</p>
<pre><code>[Match]
Name=wg0

[Network]
Address=10.88.88.1/24
Address=2001:db8:1234:5678::1
</code></pre>
<p>Start</p>
<pre><code>systemctl daemon-reload
systemctl start systemd-networkd
</code></pre>
<h1><a class="header" href="#rule-based-routing" id="rule-based-routing">Rule-based Routing</a></h1>
<h1><a class="header" href="#chain-routing" id="chain-routing">Chain Routing</a></h1>
<ul>
<li><a href="https://www.wireguard.com/netns/">Routing &amp; Network Namespaces - WireGuard</a></li>
<li><a href="https://www.ckn.io/blog/2017/12/28/wireguard-vpn-chained-setup/">Wireguard VPN: Chained Setup - The poetry of (in)security</a></li>
</ul>
<h1><a class="header" href="#delete-utunn-on-macos" id="delete-utunn-on-macos">Delete utunN on macOS</a></h1>
<p><code>rm -f /var/run/wireguard/utun1.sock</code></p>
<h1><a class="header" href="#cant-self-ping-wg0s-ip" id="cant-self-ping-wg0s-ip">can't self ping wg0's ip</a></h1>
<p><a href="https://lists.zx2c4.com/pipermail/wireguard/2018-March/002559.html">can't ping remote side IP range from WG instance</a></p>
<p>the method is to remove masquerade rule in firewall. but, then how the vpn will
work ?</p>
<h1><a class="header" href="#a-hrefhttpswwwtorprojectorgdocsonion-serviceshtmlentor-onion-service-protocola" id="a-hrefhttpswwwtorprojectorgdocsonion-serviceshtmlentor-onion-service-protocola"><a href="https://www.torproject.org/docs/onion-services.html.en">Tor: Onion Service Protocol</a></a></h1>
<h1><a class="header" href="#links-18" id="links-18">Links</a></h1>
<ul>
<li><a href="https://www.torproject.org/docs/onion-services.html.en">Tor: Onion Service Protocol</a></li>
<li><a href="https://www.torproject.org/docs/tor-onion-service.html.en">Tor Project: Onion Service Configuration Instructions</a></li>
<li><a href="https://www.torproject.org/docs/tor-doc-unix.html.en">Tor: Linux Install Instructions</a></li>
<li><a href="https://www.torproject.org/docs/tor-doc-osx.html.en">Tor Project: Mac OS X Install Instructions</a></li>
<li><a href="https://program-think.blogspot.com/2013/11/tor-faq.html">关于 Tor 的常见问题解答</a></li>
<li><a href="http://www.dest-unreach.org/socat/">socat</a></li>
<li><a href="https://trac.torproject.org/projects/tor/wiki/doc/TorFAQ#SOCKSAndDNS">doc/TorFAQ – Tor Bug Tracker &amp; Wiki</a></li>
<li><a href="https://www.torproject.org/docs/tor-manual.html.en">Tor Project: manual</a></li>
</ul>
<p>Tor allows clients and relays to offer onion services. That is, you can offer a web server, SSH server, etc., without revealing your IP address to its users. In fact, because you don't use any public address, you can run an onion service from behind your firewall. </p>
<h1><a class="header" href="#really-important-thing" id="really-important-thing">Really Important Thing</a></h1>
<ul>
<li>
<p><strong><a href="https://www.torproject.org/download/download.html.en#warning">Warning</a></strong></p>
</li>
<li>
<p>什么是“陷阱节点”/“蜜罐节点”？</p>
<p>如果你使用的线路中，“出口节点”正好是蜜罐，那么该蜜罐就会窥探到你的上网行为——前面已经说了，出口节点肯定会知道你的访问了哪个网站。并且，假如你访问的目标网站没有 HTTPS 加密，蜜罐就会知道你浏览的页面内容。</p>
</li>
<li>
<p>如何避免“陷阱节点”/“蜜罐节点”？</p>
<p>比较简单的做法，就是通过修改 Tor 的配置文件，规避这些不安全国家的节点。</p>
<p>in the end of <code>torrc</code>, add these config, 表示排除这些国家/地区的节点，StrictNodes 表示强制执行）:</p>
<pre><code>ExcludeNodes {cn},{hk},{mo},{kp},{ir},{sy},{pk},{cu},{vn}
StrictNodes  1
Socks5Proxy 127.0.0.1:1080
// 北朝鲜  {kp} 伊朗  {ir} 叙利亚  {sy} 巴基斯坦  {pk} 古巴  {cu} 越南  {vn}
</code></pre>
</li>
</ul>
<h1><a class="header" href="#install-3" id="install-3">Install</a></h1>
<ul>
<li><a href="https://www.torproject.org/download/download.html.en#warning">Download Tor</a></li>
</ul>
<pre><code>// Mac 
brew install tor

You will find a sample Tor configuration file at /usr/local/etc/tor/torrc.sample. Remove the .sample extension to make it effective.
</code></pre>
<h1><a class="header" href="#needtouseaproxy" id="needtouseaproxy">NeedToUseAProxy</a></h1>
<ul>
<li><a href="https://www.torproject.org/docs/faq.html.en#NeedToUseAProxy">Tor Project: FAQ</a></li>
</ul>
<pre><code>// config in `torrc`
Socks5Proxy host[:port] 
// Tor will make all OR connections through the SOCKS 5 proxy at host:port (or host:1080 if port is not specified). 
</code></pre>
<p>Raspberry:</p>
<pre><code>apt install tor
</code></pre>
<p>Termux</p>
<pre><code>pkg install tor torsocks
</code></pre>
<p>Launch it: <code>tor</code></p>
<h1><a class="header" href="#tbb" id="tbb">TBB</a></h1>
<p>The recommended way to use Tor is to simply download the Tor Browser and you are done. </p>
<p><a href="https://www.torproject.org/projects/torbrowser.html.en">Tor Browser</a></p>
<h1><a class="header" href="#onion-service" id="onion-service">Onion Service</a></h1>
<pre><code>// config in torrc

HiddenServiceDir $HOME/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:8080
HiddenServicePort 22 127.0.0.1:22
</code></pre>
<p>When Tor starts, it will automatically create the HiddenServiceDir that you specified (if necessary), and it will create two files there.</p>
<p><code>private_key</code> and <code>hostname</code></p>
<h1><a class="header" href="#chisel" id="chisel">chisel</a></h1>
<h1><a class="header" href="#links-19" id="links-19">Links</a></h1>
<ul>
<li><a href="https://github.com/jpillora/chisel/blob/master/README.md">chisel/README.md at master · jpillora/chisel · GitHub</a></li>
</ul>
<h1><a class="header" href="#install-4" id="install-4">Install</a></h1>
<p><code>go get -v github.com/jpillora/chisel</code></p>
<h1><a class="header" href="#shadowsocks" id="shadowsocks">shadowsocks</a></h1>
<h1><a class="header" href="#links-20" id="links-20">Links</a></h1>
<h1><a class="header" href="#install-5" id="install-5">Install</a></h1>
<h1><a class="header" href="#configuration" id="configuration">Configuration</a></h1>
<h1><a class="header" href="#server" id="server">Server</a></h1>
<pre><code>{
        &quot;server&quot;:&quot;0.0.0.0&quot;,
        &quot;server_port&quot;:8388,
        &quot;password&quot;:&quot;mypassword&quot;,
        &quot;timeout&quot;:300,
        &quot;method&quot;:&quot;aes-128-gcm&quot;,
        &quot;fast_open&quot;: true,
}
</code></pre>
<p>Run:</p>
<pre><code>ss-server -uv -c config.json
// run in the background
ss-server -uv -c config.json -d [start|stop]
</code></pre>
<h1><a class="header" href="#client" id="client">Client</a></h1>
<ul>
<li><a href="https://github.com/shadowsocks/shadowsocks/wiki/Configuration-via-Config-File">Configuration via Config File · shadowsocks/shadowsocks Wiki · GitHub</a></li>
</ul>
<p>Config File <code>/etc/shadowsocks-libev/config.json</code>:</p>
<pre><code>{
    &quot;server&quot;:&quot;my_server_ip&quot;,
    &quot;server_port&quot;:8388,
    &quot;local_address&quot;: &quot;0.0.0.0&quot;,
    &quot;local_port&quot;:1080,
    &quot;password&quot;:&quot;mypassword&quot;,
    &quot;timeout&quot;:300,
    &quot;method&quot;:&quot;aes-128-gcm&quot;,
    &quot;fast_open&quot;: true,
    &quot;plugin&quot;: &quot;obfs-local&quot;,
    &quot;plugin_opts&quot;: &quot;obfs=tls;obfs-host=bing.com&quot;,
}
</code></pre>
<p>run:</p>
<pre><code>ss-local -uv -c config.json
</code></pre>
<h1><a class="header" href="#shadowsocks-on-raspberry-pi" id="shadowsocks-on-raspberry-pi">shadowsocks on raspberry pi</a></h1>
<p>do this is because I need to access the content in network B ( which pi in)
from network A ( which vps in).</p>
<p>and the important thing is , vps in network B is expensive.</p>
<ol>
<li>both need to enable IP_FORWARDING</li>
<li>ss on pi</li>
<li>wireguard between pi and vps</li>
<li>dnat and masquerade on vps.
<pre><code>table ip nat {
		chain prerouting {
				type nat hook prerouting priority -100; policy accept;
				iifname &quot;ens4&quot; tcp 12345 tproxy counter log dnat to 10.0.0.1:8388
		}

		chain postrouting {
				type nat hook postrouting priority 100; policy accept;
				ip daddr 10.0.0.1 tcp dport 8388 oif &quot;wg0&quot; counter log masquerade
		}
}
</code></pre>
</li>
</ol>
<p><a href="https://www.netfilter.org/documentation/HOWTO/NAT-HOWTO-10.html">Linux 2.4 NAT HOWTO: Destination NAT Onto the Same Network</a></p>
<p><strong>Note:</strong> <strong>MUST</strong> config NAT( snat or masquerade) on vps, cause pi has no
route to the clients. this problem wasted me several hours just now. if you run
<code>tcpdump</code>, you can find both vps and pi, there's only packages in, but no
packages out.</p>
<p>[Sun Apr 7 20:21:27 CST 2019]</p>
<h1><a class="header" href="#pac" id="pac">PAC</a></h1>
<p><a href="https://github.com/h2y/Shadowrocket-ADBlock-Rules">Shadowrocket-ADBlock-Rules</a></p>
<h1><a class="header" href="#troubleshooting" id="troubleshooting">Troubleshooting</a></h1>
<ul>
<li><a href="https://github.com/shadowsocks/shadowsocks-libev/issues/1177">[已解决]执行make的时候失败 · Issue #1177 · shadowsocks/shadowsocks-libev · GitHub</a></li>
</ul>
<p>Compile on Pi need this:</p>
<p><code>./configure --with-sodium-include=/usr/local/include --with-sodium-lib=/usr/local/lib --with-mbedtls-include=/usr/local/include --with-mbedtls-lib=/usr/local/lib</code></p>
<h1><a class="header" href="#ss-redir" id="ss-redir">ss-redir</a></h1>
<h1><a class="header" href="#links-21" id="links-21">Links</a></h1>
<ul>
<li><a href="https://huntxu.github.io/2015-01-20-shadowsocks-transparent-proxy-with-nft.html">使用 nftables 与 ss-redir 实现 shadowsocks transparent proxy</a></li>
<li><a href="https://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest">ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest</a></li>
</ul>
<h1><a class="header" href="#postrouting" id="postrouting">postrouting</a></h1>
<p>why the masquerade rule in nat chain hook at postrouting lead to no connection when redirect:</p>
<ul>
<li>when packages in, they are being redirected to <code>:12345</code>, the <code>saddr</code> left no
change.</li>
<li>the next step packages will go through <code>input</code>, and then processed by <code>ss-redir</code>,
after this, the packages daadr will be encapsulated with the server's ip. it
will go through <code>output</code> directly due to the rule <code>ip daddr &lt;server&gt; return</code>.</li>
<li>I have found why:<br />
cause the package back from server which need to send to client or send to
another middle man, these packages saddr is the target server's. so the rule
should be limited to your local saddr like:<br />
<code>ip saddr 192.168.0.0/24 oif eth0 masquerade</code></li>
<li>BUT I'M WRONG, the rule above totaly doesn't work.</li>
</ul>
<pre><code>table ip nat {
        chain prerouting {
                type nat hook prerouting priority -1; policy accept;
                ip daddr { 0.0.0.0/8, 10.0.0.0/8, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16, 224.0.0.0/4, 240.0.0.0/4, 172.16.39.0/24} return
                ip daddr &lt;server&gt; return
                # By using redirect, packets will be forwarded to local machine. 
                # Is a special case of DNAT where the destination is the current machine. 
                # tcp sport {32768-61000} redirect to 12345     # /proc/sys/net/ipv4/ip_local_port_range
                ip protocol tcp redirect to 12345  
        }

        chain input {
                type nat hook input priority 0; policy accept;
        }


        # this is for local packages generated from &quot;lo&quot;
        chain output {
                type nat hook output priority 0; policy accept;
                ip daddr { 0.0.0.0/8, 10.0.0.0/8, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16, 224.0.0.0/4, 240.0.0.0/4, 172.16.39.0/24} return 
                ip daddr &lt;server&gt; return 
                ip protocol tcp redirect to 12345  
        }

        chain postrouting {
                type nat hook postrouting priority 0; policy accept;
        }

}
</code></pre>
<h1><a class="header" href="#with-iptables" id="with-iptables">With iptables</a></h1>
<ul>
<li><a href="https://github.com/shadowsocks/shadowsocks-libev/blob/master/doc/ss-redir.asciidoc">shadowsocks-libev/ss-redir.asciidoc at master · shadowsocks/shadowsocks-libev · GitHub</a></li>
<li><a href="https://github.com/17mon/china_ip_list/blob/master/china_ip_list.txt">china_ip_list/china_ip_list.txt at master · 17mon/china_ip_list · GitHub</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgithubcomdarkkredsocksdarkkredsocks-transparent-tcp-to-proxy-redirectora" id="a-hrefhttpsgithubcomdarkkredsocksdarkkredsocks-transparent-tcp-to-proxy-redirectora"><a href="https://github.com/darkk/redsocks/">darkk/redsocks: transparent TCP-to-proxy redirector</a></a></h1>
<h1><a class="header" href="#links-22" id="links-22">Links</a></h1>
<p>more like to use <a href="inet/./ss-redir.html">ss-redir</a></p>
<h1><a class="header" href="#zerotier" id="zerotier">ZeroTier</a></h1>
<h1><a class="header" href="#links-23" id="links-23">Links</a></h1>
<ul>
<li><a href="https://www.zerotier.com/">ZeroTier | Home</a></li>
<li><a href="https://www.zerotier.com/manual.shtml">ZeroTier | Manual</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/getting-started-software-defined-networking-creating-vpn-zerotier-one?utm_medium=social&amp;utm_source=twitter&amp;utm_campaign=zerotier_tut&amp;utm_content=no_image#prerequisites">Getting Started with Software-Defined Networking and Creating a VPN with ZeroTier One | DigitalOcean</a></li>
</ul>
<h1><a class="header" href="#uninstall" id="uninstall">Uninstall</a></h1>
<p><a href="https://github.com/zerotier/ZeroTierOne/blob/master/ext/installfiles/mac/uninstall.sh">ZeroTierOne/uninstall.sh at master · zerotier/ZeroTierOne · GitHub</a></p>
<pre><code>apt remove zerotier-one
</code></pre>
<h1><a class="header" href="#quick-start-1" id="quick-start-1">Quick Start</a></h1>
<pre><code>curl -s 'https://pgp.mit.edu/pks/lookup?op=get&amp;search=0x1657198823E52A61' | gpg --import &amp;&amp; \
if z=$(curl -s 'https://install.zerotier.com/' | gpg); then echo &quot;$z&quot; | sudo bash; fi

sudo systemctl enable zerotier-one

sudo zerotier-cli status

sudo zerotier-cli join [Network ID]

Authenticate your device by going to https://my.zerotier.com/network/[Network ID]
</code></pre>
<h1><a class="header" href="#managed-routes" id="managed-routes">Managed Routes</a></h1>
<p>Go to the top-right of your ZeroTier Networks page and add a new route with the following parameters. You can find the ZeroTier IP for your server in the Members section of your ZeroTier Network configuration page. In the network/bits field, enter in 0.0.0.0/0, in the (LAN) field, enter your ZeroTier server's IP address.</p>
<ul>
<li>
<p>Enable allowDefault and net.ipv4.conf.all.rp_filter=2 on client</p>
<pre><code>sudo zerotier-cli set NetworkID allowDefault=1

Each time the ZeroTier service on the client is restarted, the allowDefault=1 value gets reset to 0, so remember to re-execute it in order to activate the VPN functionality.

</code></pre>
</li>
</ul>
<h1><a class="header" href="#firewall" id="firewall">Firewall</a></h1>
<p>allow traffic to/from port 9993.</p>
<h1><a class="header" href="#dns" id="dns">DNS</a></h1>
<h1><a class="header" href="#links-24" id="links-24">Links</a></h1>
<h1><a class="header" href="#flushing-your-dns-cache-in-mac-os-x-and-linux" id="flushing-your-dns-cache-in-mac-os-x-and-linux">Flushing your DNS cache in Mac OS X and Linux</a></h1>
<p><a href="https://help.dreamhost.com/hc/en-us/articles/214981288-Flushing-your-DNS-cache-in-Mac-OS-X-and-Linux">Flushing your DNS cache in Mac OS X and Linux – DreamHost</a></p>
<pre><code>// OS X 12 (Sierra) and later
sudo killall -HUP mDNSResponder;sudo killall mDNSResponderHelper;sudo dscacheutil -flushcache

// rhel6
sudo service nscd restart 
</code></pre>
<h1><a class="header" href="#clear-dns-cache-in-firefox" id="clear-dns-cache-in-firefox">Clear DNS cache in Firefox</a></h1>
<p><code>about:config</code> -&gt; <code>network.dnsCacheExpiration</code> and
<code>network.dnsCacheExpirationGracePeriod</code> with the values set as 60.</p>
<p>set both to <code>0</code> then <code>right click</code> then <code>reset</code>.</p>
<h1><a class="header" href="#dnscrypt" id="dnscrypt">DNSCrypt</a></h1>
<h1><a class="header" href="#links-25" id="links-25">Links</a></h1>
<h1><a class="header" href="#install-6" id="install-6">Install</a></h1>
<ul>
<li><a href="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Installation-macOS">Installation macOS · DNSCrypt/dnscrypt-proxy Wiki · GitHub</a></li>
<li><a href="https://github.com/DNSCrypt/dnscrypt-proxy/releases">Releases · DNSCrypt/dnscrypt-proxy · GitHub</a></li>
</ul>
<h1><a class="header" href="#dns-over-https-doh" id="dns-over-https-doh">DNS over HTTPS (DoH)</a></h1>
<h1><a class="header" href="#links-26" id="links-26">Links</a></h1>
<ul>
<li><a href="https://developers.cloudflare.com/1.1.1.1/dns-over-https/cloudflared-proxy/">Running a DNS over HTTPS Client - Cloudflare Resolver</a></li>
</ul>
<h1><a class="header" href="#install-7" id="install-7">Install</a></h1>
<ul>
<li><a href="https://developers.cloudflare.com/argo-tunnel/downloads/">Downloads - Argo Tunnel</a></li>
</ul>
<pre><code>brew install cloudflare/cloudflare/cloudflared
</code></pre>
<h1><a class="header" href="#set-up-cloudflared-as-a-service" id="set-up-cloudflared-as-a-service">Set up cloudflared as a service</a></h1>
<pre><code>mkdir -p /usr/local/etc/cloudflared
cat &lt;&lt; EOF &gt; /usr/local/etc/cloudflared/config.yml
proxy-dns: true
proxy-dns-upstream:
 - https://1.1.1.1/dns-query
 - https://1.0.0.1/dns-query
EOF
</code></pre>
<p>install</p>
<pre><code>sudo cloudflared service install
</code></pre>
<h1><a class="header" href="#comments" id="comments">Comments</a></h1>
<p>Used a several days. It's not stable.<br />
Sat Oct 12 22:34:37 CST 2019</p>
<h1><a class="header" href="#unbound" id="unbound">Unbound</a></h1>
<h1><a class="header" href="#links-27" id="links-27">Links</a></h1>
<ul>
<li><a href="https://www.ckn.io/blog/2017/11/14/wireguard-vpn-typical-setup/">Wireguard VPN: Typical Setup - The poetry of (in)security</a></li>
</ul>
<h1><a class="header" href="#install-8" id="install-8">Install</a></h1>
<pre><code>pacman -S unbound

apt install unbound unbound-host
</code></pre>
<h1><a class="header" href="#config-1" id="config-1">Config</a></h1>
<pre><code>curl -o /var/lib/unbound/root.hints https://www.internic.net/domain/named.cache
chown unbound:unbound /var/lib/unbound/root.hints

// solve root.key anchor error
sudo -u unbound unbound-anchor -v -a /var/lib/unbound/root.key
</code></pre>
<p>Config File: [repo]</p>
<p>Check Config: <code>unbound-checkconf</code></p>
<p>run:</p>
<pre><code>systemctl stop systemd-resolved
systemctl disable systemd-resolved
systemctl start unbound


// view log
journalctl -f -u unbound
</code></pre>
<h1><a class="header" href="#troubleshooting-1" id="troubleshooting-1">Troubleshooting</a></h1>
<p><a href="https://www.claudiokuenzler.com/blog/695/unbound-behind-a-virtual-ip-vip-reply-from-unexpected-source">Unbound DNS server behind a VIP - solving reply from unexpected source</a></p>
<h1><a class="header" href="#resolvconf" id="resolvconf">resolv.conf</a></h1>
<p>There has trouble with set <code>nameserver</code> to <code>127.0.0.1</code>, so I set it to the ip
of the external interface, then there's no trouble.</p>
<p>some days later, I find this is because the masquerade rule in the firewall.
just remove it, then everything's ok.</p>
<h1><a class="header" href="#systemd-resolved" id="systemd-resolved">systemd-resolved</a></h1>
<h1><a class="header" href="#links-28" id="links-28">Links</a></h1>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Systemd-resolved">systemd-resolved - ArchWiki</a></li>
</ul>
<h1><a class="header" href="#dnsovertls" id="dnsovertls">DNSOverTLS</a></h1>
<p>DNS over TLS is disabled by default. To enable it change the <code>DNSOverTLS=</code>
setting in the <code>[Resolve]</code> section in <code>resolved.conf(5)</code>. </p>
<h1><a class="header" href="#mannually-config" id="mannually-config">Mannually Config</a></h1>
<pre><code># cat /etc/systemd/resolved.conf 

[Resolve]
DNS=8.8.8.8
#FallbackDNS=
#Domains=
#LLMNR=no
#MulticastDNS=no
#DNSSEC=no
#DNSOverTLS=no
#Cache=yes
#DNSStubListener=yes
#ReadEtcHosts=yes
</code></pre>
<h1><a class="header" href="#check" id="check">Check</a></h1>
<pre><code>systemctl status systemd-resolved

resolvectl status
</code></pre>
<h1><a class="header" href="#dnssec" id="dnssec">DNSSEC</a></h1>
<pre><code>[Resolve]
DNSSEC=true
</code></pre>
<p>firewall</p>
<h1><a class="header" href="#ip-forwarding-and-nat" id="ip-forwarding-and-nat">IP FORWARDING and NAT</a></h1>
<h1><a class="header" href="#links-29" id="links-29">Links</a></h1>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Iptables">iptables - ArchWiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Simple_stateful_firewall">Simple stateful firewall - ArchWiki</a></li>
<li><a href="https://www.frozentux.net/iptables-tutorial/images/tables_traverse.jpg">tables_traverse.jpg (JPEG Image, 647 × 1100 pixels) - Scaled (78%)</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/getting-started-software-defined-networking-creating-vpn-zerotier-one?utm_medium=social&amp;utm_source=twitter&amp;utm_campaign=zerotier_tut&amp;utm_content=no_image">Getting Started with Software-Defined Networking and Creating a VPN with ZeroTier One | DigitalOcean</a></li>
<li><a href="https://www.cnblogs.com/shineshqw/articles/2351028.html">【转】iptables配置——NAT地址转换 - veryhappy - 博客园</a></li>
</ul>
<h1><a class="header" href="#system-config" id="system-config">system config</a></h1>
<p><strong>net.ipv4.ip_forward=1</strong></p>
<p>cmd: </p>
<pre><code>// print
sysctl net.ipv4.ip_forward
net.ipv4.ip_forward = 1

// set
sysctl net.ipv4.ip_forward=1
net.ipv4.ip_forward = 1
</code></pre>
<p>cfg file: <code>/etc/sysctl.conf</code></p>
<pre><code>net.ipv4.ip_forward = 1
</code></pre>
<p>Save and close the file, then run <code>sysctl -p</code> to trigger the kernel's adoption
of the new configuration</p>
<p><strong>net.ipv4.conf.all.rp_filter=2</strong></p>
<p>This configuration change is required to alter the kernel's view of what an
acceptable return path for your client traffic is. Due to the way that the
ZeroTier VPN is configured, the traffic coming back from your server to
your client can sometimes appear to come from a different network address
than the one it was sent it to. By default, the Linux kernel views these as
invalid and drops them, making it necessary to override that behavior.</p>
<h1><a class="header" href="#waht-is-iptables" id="waht-is-iptables">waht is iptables</a></h1>
<p><img src="inet/firewall/imgs/tables_traverse.jpg" alt="img:tables_traverse.jpg" title="tables_traverse" /></p>
<pre><code>PREROUTING(nat/DNAT) 	- FORWARD(filter) 					- POSTROUTING(nat/SNAT)
PREROUTING 				- INPUT - LOCAL PROCESS - OUTPUT	- POSTROUTING 
</code></pre>
<h1><a class="header" href="#nat-原理" id="nat-原理">NAT 原理</a></h1>
<p>同filter表一样，nat表也有三条缺省的&quot;链&quot;(chains)：</p>
<ul>
<li>
<p>PREROUTING: when DNAT</p>
<p>把从外来的访问重定向到其他的机子上，比如内部SERVER，或者DMZ。</p>
<p>因为路由时只检查数据包的目的ip地址，所以必须在路由之前就进行目的PREROUTING DNAT;</p>
<p><strong>系统先PREROUTING DNAT翻译——&gt;再过滤（FORWARD）——&gt;最后路由。</strong></p>
<p><strong>路由和过滤（FORWARD)中match 的目的地址，都是针对被PREROUTING DNAT之后的。</strong></p>
</li>
<li>
<p>POSTROUTING: when SNAT</p>
<p>在路由以后在执行该链中的规则。</p>
<p><strong>系统先路由——&gt;再过滤（FORWARD)——&gt;最后才进行POSTROUTING SNAT地址翻译</strong></p>
<p><strong>其match 源地址是翻译前的。</strong></p>
</li>
<li>
<p>OUTPUT:定义对本地产生的数据包的目的NAT规则</p>
</li>
</ul>
<p>-i ，-o 参数在NAT中的用途:</p>
<p><code>-i</code> only used in <code>PREROUTING</code>, when <code>-o</code> only used in <code>POSTROUTING and OUTPUT</code></p>
<h1><a class="header" href="#internal-to-access-internet-with--j-snat" id="internal-to-access-internet-with--j-snat">Internal to access Internet with -j SNAT</a></h1>
<pre><code>-j SNAT --to-source ipaddr[-ipaddr][:port-port]
网络地址转换，SNAT就是重写包的源IP地址
only valid in POSTROUTING

iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j SNAT --to 你的eth0地址

-j MASQUERADE
用于外网口public地址是DHCP动态获取的（如ADSL）

iptables -t nat -A POSTROUTING –o eth1 –s 192.168.1.0/24 –j MASQUERADE
</code></pre>
<p>真正实现还需要FORWARD链中两条rule的配合,并且这两条规则是先执行的：</p>
<pre><code>iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i zt0 -o eth0 -j ACCEPT
</code></pre>
<h2><a class="header" href="#internet-to-access-internal-with-j-dnat" id="internet-to-access-internal-with-j-dnat">Internet to access Internal with –j DNAT</a></h2>
<pre><code>-j DNAT --to-destination ipaddr[-ipaddr][:port-port]
目的网络地址转换，重写包的目的IP地址
only valid in PREROUTING

DNAT Example:

外部接口ip：	210.83.2.206
内部接口ip：	192.168.1.1
ftp Server:		192.168.1.3
web Server:		192.168.1.4

iptables -t nat -A PREROUTING -d 210.83.2.206 -p tcp --dport 21 -j DNAT --to 192.168.1.3
iptables -t nat -A PREROUTING -d 210.83.2.206 -p tcp --dport 80 -j DNAT --to 192.168.1.4
</code></pre>
<p>需要在FORWARD链中允许DNAT后的目的地址：</p>
<pre><code>-A FORWARD -d 192.168.1.3/32 -p tcp --dport 21 -j ACCEPT  
-A FORWARD -d 192.168.1.4/32 -p tcp --dport 80 -j ACCEPT  
</code></pre>
<p>而且用于转发的机器是<strong>不需要监听</strong>这两个端口的。以前我一直觉得凡能接受连接必有监听...</p>
<p>And no matter SNAT or DNAT, because the packets always will go though the
filter table, so must config the FORWARD chain to accept them.</p>
<h1><a class="header" href="#dnat-for-port-mapping" id="dnat-for-port-mapping">DNAT for Port Mapping</a></h1>
<pre><code>iptables -t nat -A PREROUTING -p tcp -d 216.94.87.37 --dport 2121 -j DNAT --to-destination 192.168.100.125:21
</code></pre>
<h1><a class="header" href="#dnat-as-load-balance" id="dnat-as-load-balance">DNAT as load-balance</a></h1>
<pre><code>iptables –t nat –A PREROUTING –d 219.142.217.161 –j DNAT --to-destination 192.168.1.24-192.168.1.25
</code></pre>
<h1><a class="header" href="#used-for-jumping" id="used-for-jumping">Used for Jumping</a></h1>
<pre><code>iptables -t nat -A PREROUTING -i zt0 -p tcp -d 216.94.87.37 --dport 8443 -j DNAT --to-destination 192.168.100.125:443

iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
// 如果eth0的IP是固定的，也可以用 -j SNAT --to-source ipaddr[-ipaddr][:port-port]

iptables -A FORWARD -d 192.168.100.125 -p tcp --dport 443 -j ACCEPT
</code></pre>
<h1><a class="header" href="#iptables-config" id="iptables-config">iptables config</a></h1>
<ul>
<li>enable </li>
</ul>
<pre><code># iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
// 这条命令大小写敏感,何必呢
// 这条命令不指定 -o 也是可以的,就所有网卡上都可以NAT了
</code></pre>
<ul>
<li>Permit traffic and track active connections:</li>
</ul>
<pre><code>iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
这里为什么要conntrack, 为什么要--ctstate呢?
conntrack是一个模块,提供追踪连接状态的功能.
后面--ctstate是它的选项.ctstate就是conntrack state的简写,就是我要追踪后面这两个状态的报文.
</code></pre>
<ul>
<li>指定从zt0进的报文转发到eth0</li>
</ul>
<pre><code>iptables -A FORWARD -i zt0 -o eth0 -j ACCEPT
-i -o 能不能是同一个接口呢?
测试了命令是可以这么配置成功,能不能有什么作用就不知道了.
一般的场景,NAT就是用于这个网口转发到那个网口.如果同一个网口有不同的网段,应该也是允许的.猜的.
</code></pre>
<h1><a class="header" href="#persistent-config" id="persistent-config">Persistent config</a></h1>
<p>ubuntu</p>
<p>install <code>iptables-persistent</code>, then <code>netfilter-persistent save</code></p>
<p>others use <code>iptables-save</code></p>
<p>archlinux </p>
<p>systemd automatically load <code>/etc/iptables/iptables.rules</code></p>
<p>rhel6 and rhel7</p>
<p>automatically load <code>/etc/sysconfig/iptables</code></p>
<h1><a class="header" href="#iptables-basis" id="iptables-basis">iptables basis</a></h1>
<pre><code>// save and restore
iptables-save &gt; /etc/iptables/iptables.rules
iptables-restore &lt;  /etc/iptables/iptables.rules

// show current config
iptables -nvL --line-numbers
</code></pre>
<h1><a class="header" href="#simple-stateful-firewall" id="simple-stateful-firewall">Simple stateful firewall</a></h1>
<ul>
<li>reset iptables</li>
</ul>
<pre><code>iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X
iptables -t raw -F
iptables -t raw -X
iptables -t security -F
iptables -t security -X
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
</code></pre>
<ul>
<li>begin</li>
</ul>
<pre><code># 这条命令避免已经建立的ssh被中断
iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
# accept all from lo
iptables -A INPUT -i lo -j ACCEPT
# accept another interface
iptables -A INPUT -i wg1 -j ACCEPT
# drop all INVALID
iptables -A INPUT -m conntrack --ctstate INVALID -j DROP
# if you want pings
# iptables -A INPUT -p icmp --icmp-type 8 -m conntrack --ctstate NEW -j ACCEPT
</code></pre>
<ul>
<li>create two chains</li>
</ul>
<pre><code>iptables -N TCP
iptables -N UDP
iptables -A INPUT -p udp -m conntrack --ctstate NEW -j UDP
iptables -A INPUT -p tcp --syn -m conntrack --ctstate NEW -j TCP
iptables -A INPUT -p udp -j REJECT --reject-with icmp-port-unreachable
iptables -A INPUT -p tcp -j REJECT --reject-with tcp-reset
iptables -A INPUT -j REJECT --reject-with icmp-proto-unreachable
</code></pre>
<ul>
<li>accept basic services</li>
</ul>
<pre><code>iptables -A TCP -p tcp --dport 22 -j ACCEPT
iptables -A TCP -p tcp --dport 26462 -j ACCEPT
iptables -A TCP -p tcp --dport 53 -j ACCEPT
iptables -A UDP -p udp --dport 53 -j ACCEPT
iptables -A TCP -p tcp -m multiport --dports 80,443 -j ACCEPT
iptables -A TCP -p tcp -m multiport --dports 8080,65000:65009 -j ACCEPT
iptables -A UDP -p udp -m multiport --dports 8080,48570:48579 -j ACCEPT
</code></pre>
<ul>
<li>default policy</li>
</ul>
<pre><code>iptables -P INPUT DROP
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
</code></pre>
<h1><a class="header" href="#log" id="log">LOG</a></h1>
<ul>
<li><a href="https://websistent.com/linux-iptables-log-everything/">Linux iptables LOG everything - Jesin's Blog</a></li>
</ul>
<pre><code>iptables -I INPUT 1 -j LOG
iptables -I FORWARD 1 -j LOG
iptables -I OUTPUT 1 -j LOG

iptables -t nat -I PREROUTING 1 -j LOG
iptables -t nat -I POSTROUTING 1 -j LOG
iptables -t nat -I OUTPUT 1 -j LOG
</code></pre>
<h1><a class="header" href="#firewalld" id="firewalld">Firewalld</a></h1>
<h1><a class="header" href="#links-30" id="links-30">Links</a></h1>
<ul>
<li><a href="https://www.tecmint.com/install-configure-firewalld-in-centos-ubuntu/">How to Install, Configure and Use Firewalld in CentOS and Ubuntu</a></li>
</ul>
<h1><a class="header" href="#install-9" id="install-9">Install</a></h1>
<pre><code>// Ubuntu 18.04
sudo apt install firewalld
sudo systemctl enable firewalld
sudo systemctl start firewalld

ufw disable
</code></pre>
<h1><a class="header" href="#basic" id="basic">Basic</a></h1>
<ul>
<li>First. We must set <code>Zone</code>.</li>
<li>Then, we add port or service to the zone.</li>
</ul>
<p>Check</p>
<pre><code class="language-sh">firewall-cmd --state
firewall-cmd --get-zones
firewall-cmd --get-default-zone
firewall-cmd --get-active-zones
firewall-cmd --get-services
firewall-cmd --list-services
firewall-cmd --list-services --permanent
# find rules associated with the current zone
firewall-cmd --list-all
firewall-cmd --list-ports
firewall-cmd --list-all-zones | less
firewall-cmd --info-zone external
// or 
firewall-cmd --zone=external --list-all

</code></pre>
<p>Set</p>
<pre><code class="language-sh">firewall-cmd --reload
</code></pre>
<p>Zone Config</p>
<pre><code class="language-sh">firewall-cmd --set-default-zone=external
firewall-cmd --zone=external --add-interface=ens4
firewall-cmd --zone=internal --add-interface=wg0
// --{change,remove}-interface
</code></pre>
<p>Add</p>
<pre><code class="language-sh">firewall-cmd --zone=external --add-service={http,https} --permanent
firewall-cmd --zone=external --add-port={465,8080,8443,12345}/tcp --permanent
firewall-cmd --zone=external --add-port={465,8080,8443,12345}/udp --permanent
// --remove-{service,port}
</code></pre>
<h1><a class="header" href="#zones" id="zones">Zones</a></h1>
<p>predefined zones:</p>
<ul>
<li><strong>drop</strong>:		The lowest level of trust. All incoming connections are dropped without reply.</li>
<li><strong>block</strong>:	incomming requests are rejected with an <code>icmp-host-prohibited</code> or <code>icmp6-adm-prohibited</code></li>
<li><strong>public</strong>:	Represents public, untrusted networks. </li>
<li><strong>external</strong>:	when using the firewall as your gateway. It is configured for NAT masquerading.</li>
<li><strong>internal</strong>:	The other side of the external zone.</li>
<li><strong>dmz</strong>:		DMZ</li>
<li><strong>work</strong>:		trust most of the computers in the network.</li>
<li><strong>home</strong>:		ditto.</li>
<li><strong>trusted</strong>:	Trust all of the machines in the network.</li>
</ul>
<h1><a class="header" href="#nftables" id="nftables">nftables</a></h1>
<h1><a class="header" href="#links-31" id="links-31">Links</a></h1>
<ul>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Performing_Network_Address_Translation_(NAT)">Performing Network Address Translation (NAT) - nftables wiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/nftables">nftables - ArchWiki</a></li>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Simple_rule_management">Simple rule management - nftables wiki</a></li>
<li><a href="https://linux-audit.com/differences-between-iptables-and-nftables-explained/">Differences between iptables and nftables explained - Linux Audit</a></li>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-nftables_in_10_minutes">Quick reference-nftables in 10 minutes - nftables wiki</a></li>
</ul>
<h1><a class="header" href="#install-10" id="install-10">Install</a></h1>
<pre><code>// Ubuntu 18.04
apt remove ufw firewalld

apt install nftables
</code></pre>
<h1><a class="header" href="#enough-for-a-router" id="enough-for-a-router">Enough for a Router</a></h1>
<pre><code>nft add table nat
nft add chain nat prerouting { type nat hook prerouting priority 0 \;  }
nft add chain nat postrouting { type nat hook postrouting priority 100 \;  }

nft add rule nat postrouting oif ens4 masquerade


// nft list ruleset

table ip nat {
        chain prerouting {
                type nat hook prerouting priority 0; policy accept;
        }

        chain postrouting {
                type nat hook postrouting priority 100; policy accept;
                oif &quot;enp0s8&quot; masquerade
        }
}
</code></pre>
<h1><a class="header" href="#tcp-redirecter" id="tcp-redirecter">TCP Redirecter</a></h1>
<ul>
<li><a href="https://serverfault.com/questions/895611/nftables-dnat-forwarding-doesnt-work-properly/899152#899152">iptables - nftables dnat forwarding doesn't work properly - Server Fault</a></li>
</ul>
<ol>
<li>Type nat hook prerouting priority 0; &lt;-Should be <strong>-100</strong> (minus hundred) according to <code>NF_IP_PRI_NAT_DST</code> netfilter constant</li>
<li>Use <code>meta nftrace set 1</code> in prerouting and <code>nft monitor</code> for debug you packet flow</li>
<li>Simplest ruleset to isolate problem and make example</li>
</ol>
<pre><code>table ip nat {
        chain prerouting {
                type nat hook prerouting priority -100; policy accept;
                ip daddr { 0.0.0.0/8, 10.0.0.0/8, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16, 224.0.0.0/4, 240.0.0.0/4, 172.16.39.0/24} return
                ip daddr &lt;remote_server&gt; return
                # By using redirect, packets will be forwarded to local machine. 
                # Is a special case of DNAT where the destination is the current machine. 
                # tcp sport {32768-61000} redirect to 12345     # /proc/sys/net/ipv4/ip_local_port_range
                ip protocol tcp redirect to 12345  


        }

        chain input {
                type nat hook input priority 0; policy accept;
        }


        # this is for local packages generated from &quot;lo&quot;
        chain output {
                type nat hook output priority 0; policy accept;
                ip daddr { 0.0.0.0/8, 10.0.0.0/8, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16, 224.0.0.0/4, 240.0.0.0/4, 172.16.39.0/24} return 
                ip daddr &lt;remote_server&gt; return 
                ip protocol tcp redirect to 12345  
        }

        chain postrouting {
                type nat hook postrouting priority 0; policy accept;
        }

}
</code></pre>
<h1><a class="header" href="#dnat" id="dnat">DNAT</a></h1>
<p>This redirects the incoming traffic for TCP ports 80 and 443 to 192.168.1.120. </p>
<pre><code>nft add table nat
nft add chain nat prerouting { type nat hook prerouting priority -100 \; }
nft add chain nat postrouting { type nat hook postrouting priority 100 \; }

nft add rule nat prerouting iif eth0 tcp dport { 80, 443 } dnat 192.168.1.120

nft add rule ip nat prerouting iif eth0 tcp dport 12345 counter dnat to 1.2.3.4:8388
nft add rule nat postrouting ip daddr 1.2.3.4 tcp dport 8388  oif wg0 masquerade
</code></pre>
<p><a href="https://www.netfilter.org/documentation/HOWTO/NAT-HOWTO-10.html">Linux 2.4 NAT HOWTO: Destination NAT Onto the Same Network</a></p>
<p><strong>the Destination server may have no route to the true client, so we still do
a SNAT or masquerade.</strong></p>
<h1><a class="header" href="#redirect" id="redirect">Redirect</a></h1>
<p>By using redirect, packets will be forwarded to local machine. Is a special
case of DNAT where the destination is the current machine. </p>
<pre><code>nft add rule nat prerouting redirect
nft add rule nat prerouting tcp dport 22 redirect to 2222
</code></pre>
<h1><a class="header" href="#snat" id="snat">SNAT</a></h1>
<p>This matches for all traffic from the 192.168.1.0/24 network to the interface
eth0. The IPv4 address 1.2.3.4 is used as source for the packets that match
this rule. </p>
<pre><code>nft add table nat
nft add chain nat prerouting { type nat hook prerouting priority 0 \; }
nft add chain nat postrouting { type nat hook postrouting priority 100 \; }

nft add rule nat postrouting ip saddr 192.168.1.0/24 oif eth0 snat 1.2.3.4

nft add rule ip nat postrouting daddr 10.0.7.2 tcp dport 8388 counter snat to 10.0.7.1

</code></pre>
<h1><a class="header" href="#masquerading" id="masquerading">Masquerading</a></h1>
<p>Masquerade is a special case of SNAT, where the source address is automagically
set to the address of the output interface.</p>
<pre><code>nft add table nat
nft add chain nat prerouting { type nat hook prerouting priority 0 \; }
nft add chain nat postrouting { type nat hook postrouting priority 100 \; }

nft add rule nat postrouting oif ens4 masquerade
</code></pre>
<h1><a class="header" href="#basic-1" id="basic-1">Basic</a></h1>
<pre><code>nft list tables
nft list table nat [-a]
nft list ruleset [-a]

// Tables
% nft list tables [&lt;family&gt;]
% nft list table [&lt;family&gt;] &lt;name&gt; [-n] [-a]
% nft (add | delete | flush) table [&lt;family&gt;] &lt;name&gt;

// Chains
% nft (add | create) chain [&lt;family&gt;] &lt;table&gt; &lt;name&gt; [ { type &lt;type&gt; hook &lt;hook&gt; [device &lt;device&gt;] priority &lt;priority&gt; \; [policy &lt;policy&gt; \;] } ]
% nft (delete | list | flush) chain [&lt;family&gt;] &lt;table&gt; &lt;name&gt;
% nft rename chain [&lt;family&gt;] &lt;table&gt; &lt;name&gt; &lt;newname&gt;

// Rules
% nft add rule [&lt;family&gt;] &lt;table&gt; &lt;chain&gt; &lt;matches&gt; &lt;statements&gt;
% nft insert rule [&lt;family&gt;] &lt;table&gt; &lt;chain&gt; [position &lt;position&gt;] &lt;matches&gt; &lt;statements&gt;
% nft replace rule [&lt;family&gt;] &lt;table&gt; &lt;chain&gt; [handle &lt;handle&gt;] &lt;matches&gt; &lt;statements&gt;
% nft delete rule [&lt;family&gt;] &lt;table&gt; &lt;chain&gt; [handle &lt;handle&gt;]
</code></pre>
<h1><a class="header" href="#interactive-mode" id="interactive-mode">interactive mode</a></h1>
<pre><code>nft -i
</code></pre>
<h1><a class="header" href="#save-and-reload-configuration" id="save-and-reload-configuration">Save and Reload Configuration</a></h1>
<pre><code>// save
nft list ruleset &gt; /etc/nftables.conf
// load
nft -f filename
</code></pre>
<h1><a class="header" href="#iptables-restore-translate" id="iptables-restore-translate">iptables-restore-translate</a></h1>
<p><a href="https://wiki.nftables.org/wiki-nftables/index.php/Moving_from_iptables_to_nftables">Moving from iptables to nftables - nftables wiki</a></p>
<pre><code>apt install iptables-nftables-compat

iptables-save &gt; save.txt
iptables-restore-translate -f save.txt
// or
iptables-restore-translate -f save.txt &gt; ruleset.nft
nft -f ruleset.nft
</code></pre>
<h1><a class="header" href="#removing-rules" id="removing-rules">Removing rules</a></h1>
<pre><code>nft list table nat -a
       -a, --handle
              Show rule handles in output.

// nft delete rule &lt;family&gt; &lt;table_name&gt; &lt;chain_name&gt; handle &lt;number&gt;
nft delete rule ip nat prerouting handle 7
</code></pre>
<h1><a class="header" href="#incompatibilities" id="incompatibilities">Incompatibilities</a></h1>
<p>You cannot use iptables and nft to perform NAT at the same time. So make sure
that the iptable_nat module is unloaded: </p>
<pre><code>rmmod iptable_nat
modprobe nft_nat
</code></pre>
<h1><a class="header" href="#netfilter-hooks" id="netfilter-hooks">Netfilter hooks</a></h1>
<ul>
<li><a href="https://wiki.nftables.org/wiki-nftables/index.php/Netfilter_hooks">Netfilter hooks - nftables wiki</a></li>
</ul>
<h1><a class="header" href="#networking" id="networking">Networking</a></h1>
<p><code>systemctl start|stop|restart|status network</code></p>
<h1><a class="header" href="#links-32" id="links-32">Links</a></h1>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/ch-configuring_ip_networking">Chapter 3. Configuring IP Networking - Red Hat Customer Portal</a></li>
</ul>
<h1><a class="header" href="#configuring-ip-networking-with-nmcli" id="configuring-ip-networking-with-nmcli">Configuring IP Networking with nmcli</a></h1>
<p><code>nmcli [OPTIONS] OBJECT { COMMAND | help }</code></p>
<p>where OBJECT can be one of the following options: <code>general</code>, <code>networking</code>,
<code>radio</code>, <code>connection</code>, <code>device</code>, <code>agent</code>, and <code>monitor</code>. </p>
<pre><code>nmcli connection modify eth0 ipv4.address 192.168.122.88/24

// reload config file
nmcli connection reload
nmcli con load /etc/sysconfig/network-scripts/ifcfg-ifname

// down and up
nmcli dev disconnect interface-name
nmcli con up interface-name
</code></pre>
<h1><a class="header" href="#network-optimization" id="network-optimization">Network Optimization</a></h1>
<h1><a class="header" href="#bbr" id="bbr">BBR</a></h1>
<ul>
<li>show<br />
<code>sysctl net.ipv4.tcp_congestion_control</code></li>
<li>check if available<br />
<code>sysctl net.ipv4.tcp_available_congestion_control</code><br />
if output has no bbr, run <code>modprobe tcp_bbr</code></li>
<li>TCP algorithm
高延迟使用hybla<br />
低延迟使用htcp,或者bbr.</li>
</ul>
<h1><a class="header" href="#sysctlconf" id="sysctlconf">sysctl.conf</a></h1>
<p>Config File <code>/etc/sysctl.conf</code>:</p>
<p>After edited, run <code>sysctl -p</code> to apply.</p>
<pre><code># max open files
fs.file-max = 1024000
# max read buffer
net.core.rmem_max = 67108864
# max write buffer
net.core.wmem_max = 67108864
# default read buffer
net.core.rmem_default = 65536
# default write buffer
net.core.wmem_default = 65536
# max processor input queue
net.core.netdev_max_backlog = 4096
# max backlog
net.core.somaxconn = 4096

# resist SYN flood attacks
net.ipv4.tcp_syncookies = 1
# reuse timewait sockets when safe
net.ipv4.tcp_tw_reuse = 1
# turn off fast timewait sockets recycling
net.ipv4.tcp_tw_recycle = 0
# short FIN timeout
net.ipv4.tcp_fin_timeout = 30
# short keepalive time
net.ipv4.tcp_keepalive_time = 1200
# outbound port range
net.ipv4.ip_local_port_range = 10000 65000
# max SYN backlog
net.ipv4.tcp_max_syn_backlog = 4096
# max timewait sockets held by system simultaneously
net.ipv4.tcp_max_tw_buckets = 5000
# TCP receive buffer
net.ipv4.tcp_rmem = 4096 87380 67108864
# TCP write buffer
net.ipv4.tcp_wmem = 4096 65536 67108864
# turn on path MTU discovery
net.ipv4.tcp_mtu_probing = 1

# for high-latency network
net.ipv4.tcp_congestion_control = bbr
# forward ipv4
net.ipv4.ip_forward = 1

# turn on TCP Fast Open on both client and server side
net.ipv4.tcp_fastopen = 3
</code></pre>
<h1><a class="header" href="#limitsconf" id="limitsconf">limits.conf</a></h1>
<p>Config File <code>/etc/security/limits.conf</code>:</p>
<pre><code>*               soft    nofile          512000
*               hard    nofile          1024000
*               hard    noproc          64000
*               soft    noproc          64000
</code></pre>
<p>relogin into shell to apply, doesn't need to reboot server.</p>
<p>To show:</p>
<p><code>ulimit -n</code></p>
<h1><a class="header" href="#linux-virtual-interfaces-tunnels" id="linux-virtual-interfaces-tunnels">Linux virtual interfaces: Tunnels</a></h1>
<h1><a class="header" href="#links-33" id="links-33">Links</a></h1>
<ul>
<li><a href="https://developers.redhat.com/blog/2019/05/17/an-introduction-to-linux-virtual-interfaces-tunnels/">An introduction to Linux virtual interfaces: Tunnels - Red Hat Developer Blog</a></li>
</ul>
<h1><a class="header" href="#linux-interfaces-for-virtual-networking" id="linux-interfaces-for-virtual-networking">Linux interfaces for virtual networking</a></h1>
<h1><a class="header" href="#links-34" id="links-34">Links</a></h1>
<ul>
<li><a href="https://developers.redhat.com/blog/2018/10/22/introduction-to-linux-interfaces-for-virtual-networking/">Introduction to Linux interfaces for virtual networking - Red Hat Developer Blog</a></li>
</ul>
<h1><a class="header" href="#bridge" id="bridge">Bridge</a></h1>
<p>A Linux bridge behaves like a network switch. </p>
<p>Here’s how to create a bridge:</p>
<pre><code># ip link add br0 type bridge
# ip link set eth0 master br0
# ip link set tap1 master br0
# ip link set tap2 master br0
# ip link set veth1 master br0
</code></pre>
<p>This creates a bridge device named br0 and sets two TAP devices (tap1, tap2),
a VETH device (veth1), and a physical device (eth0) as its slaves, as shown in
the diagram above.</p>
<p><img src="inet/network/img/bridge.png" alt="bridge" /></p>
<h1><a class="header" href="#bonded-interface" id="bonded-interface">Bonded interface</a></h1>
<p><a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">Linux Ethernet Bonding Driver HOWTO</a></p>
<p>The Linux bonding driver provides a method for aggregating multiple network
interfaces into a single logical “bonded” interface. </p>
<p>Here’s how to create a bonded interface:</p>
<pre><code>ip link add bond1 type bond miimon 100 mode active-backup
ip link set eth0 master bond1
ip link set eth1 master bond1
</code></pre>
<p><img src="inet/network/img/bond.png" alt="bond" /></p>
<h1><a class="header" href="#team-device" id="team-device">Team device</a></h1>
<p><a href="https://github.com/jpirko/libteam/wiki/Bonding-vs.-Team-features">Bonding vs. Team features · jpirko/libteam Wiki · GitHub</a></p>
<p>Similar a bonded interface</p>
<p>But there are also some functional differences between a bonded interface and
a team. For example, a team supports LACP load-balancing, NS/NA (IPV6) link
monitoring, D-Bus interface, etc., which are absent in bonding. </p>
<p>Here’s how to create a team:</p>
<pre><code># teamd -o -n -U -d -t team0 -c '{&quot;runner&quot;: {&quot;name&quot;: &quot;activebackup&quot;},&quot;link_watch&quot;: {&quot;name&quot;: &quot;ethtool&quot;}}'
# ip link set eth0 down
# ip link set eth1 down
# teamdctl team0 port add eth0
# teamdctl team0 port add eth1
</code></pre>
<h1><a class="header" href="#vlan" id="vlan">VLAN</a></h1>
<p>Use a VLAN when you want to separate subnet in VMs, namespaces, or hosts.</p>
<p>Here’s how to create a VLAN:</p>
<pre><code># ip link add link eth0 name eth0.2 type vlan id 2
# ip link add link eth0 name eth0.3 type vlan id 3
</code></pre>
<p>The VLAN header looks like:</p>
<p><img src="inet/network/img/vlan_01.png" alt="vlan" /></p>
<h1><a class="header" href="#vxlan" id="vxlan">VXLAN</a></h1>
<p>VXLAN (Virtual eXtensible Local Area Network) is a tunneling protocol designed
to solve the problem of limited VLAN IDs (4,096) in IEEE 802.1q.</p>
<p>With a 24-bit segment ID, aka VXLAN Network Identifier (VNI), VXLAN allows up
to 2^24 (16,777,216) virtual LANs, which is 4,096 times the VLAN capacity.</p>
<p>VXLAN encapsulates Layer 2 frames with a VXLAN header into a UDP-IP packet,
which looks like this:</p>
<p><img src="inet/network/img/vxlan_01.png" alt="vxlan" /></p>
<p>Here’s how to use VXLAN:</p>
<pre><code># ip link add vx0 type vxlan id 100 local 1.1.1.1 remote 2.2.2.2 dev eth0 dstport 4789
</code></pre>
<h1><a class="header" href="#macvlan" id="macvlan">MACVLAN</a></h1>
<p>With VLAN, you can create multiple interfaces on top of a single one and filter
packages based on a VLAN tag. With MACVLAN, you can create multiple interfaces
with different Layer 2 (that is, Ethernet MAC) addresses on top of a single
one.</p>
<p>Use a MACVLAN when you want to connect directly to a physical network from
containers.</p>
<h1><a class="header" href="#ipvlan" id="ipvlan">IPVLAN</a></h1>
<p>IPVLAN is similar to MACVLAN with the difference being that the endpoints have
the same MAC address.</p>
<p>IPVLAN supports L2 and L3 mode.</p>
<p><img src="inet/network/img/ipvlan.png" alt="ipvlan" /></p>
<h1><a class="header" href="#macvtapipvtap" id="macvtapipvtap">MACVTAP/IPVTAP</a></h1>
<p><img src="inet/network/img/macvtap.png" alt="macvtap" /></p>
<p>Typically, MACVLAN/IPVLAN is used to make both the guest and the host show up
directly on the switch to which the host is connected. The difference between
MACVTAP and IPVTAP is same as with MACVLAN/IPVLAN.</p>
<p>Here’s how to create a MACVTAP instance:</p>
<pre><code># ip link add link eth0 name macvtap0 type macvtap
</code></pre>
<h1><a class="header" href="#macsec" id="macsec">MACsec</a></h1>
<p>The main use case for MACsec is to secure all messages on a standard LAN
including ARP, NS, and DHCP messages.</p>
<h1><a class="header" href="#veth" id="veth">VETH</a></h1>
<p>The VETH (virtual Ethernet) device is a local Ethernet tunnel. Devices are
created in pairs.</p>
<p>Packets transmitted on one device in the pair are immediately received on the
other device. When either device is down, the link state of the pair is down.</p>
<p><img src="inet/network/img/veth.png" alt="veth" /></p>
<p>Use a VETH configuration when namespaces need to communicate to the main host
namespace or between each other.</p>
<p>Here’s how to set up a VETH configuration:</p>
<pre><code># ip netns add net1
# ip netns add net2
# ip link add veth1 netns net1 type veth peer name veth2 netns net2
</code></pre>
<h1><a class="header" href="#vcan" id="vcan">VCAN</a></h1>
<p>CAN (Controller Area Network) </p>
<p>Here’s how to create a VCAN:</p>
<pre><code># ip link add dev vcan1 type vcan
</code></pre>
<h1><a class="header" href="#vxcan" id="vxcan">VXCAN</a></h1>
<p>Similar to the VETH driver, a VXCAN (Virtual CAN tunnel) implements a local CAN
traffic tunnel between two VCAN network devices.</p>
<p>Here’s how to set up a VXCAN instance:</p>
<pre><code># ip netns add net1
# ip netns add net2
# ip link add vxcan1 netns net1 type vxcan peer name vxcan2 netns net2
</code></pre>
<h1><a class="header" href="#ipoib" id="ipoib">IPOIB</a></h1>
<p>An IPOIB device supports the IP-over-InfiniBand protocol. </p>
<p>Use an IPOIB device when you have an IB device and want to communicate with
a remote host via IP.</p>
<p>Here’s how to create an IPOIB device:</p>
<pre><code># ip link add ipoib0 type ipoib mode connected
</code></pre>
<h1><a class="header" href="#nlmon" id="nlmon">NLMON</a></h1>
<p>NLMON is a Netlink monitor device.</p>
<p>Here’s how to create an NLMON device:</p>
<pre><code># ip link add nlmon0 type nlmon
# ip link set nlmon0 up
# tcpdump -i nlmon0 -w nlmsg.pcap
</code></pre>
<h1><a class="header" href="#dummy-interface" id="dummy-interface">Dummy interface</a></h1>
<p>Here’s how to create a dummy interface:</p>
<pre><code># ip link add dummy1 type dummy
# ip addr add 1.1.1.1/24 dev dummy1
# ip link set dummy1 up
</code></pre>
<h1><a class="header" href="#ifb" id="ifb">IFB</a></h1>
<h1><a class="header" href="#netdevsim-interface" id="netdevsim-interface">netdevsim interface</a></h1>
<h1><a class="header" href="#iproute2" id="iproute2">iproute2</a></h1>
<h1><a class="header" href="#links-35" id="links-35">Links</a></h1>
<ul>
<li><a href="https://lartc.org/howto/index.html">Linux Advanced Routing &amp; Traffic Control HOWTO</a></li>
</ul>
<h1><a class="header" href="#gre-tunneling" id="gre-tunneling">GRE tunneling</a></h1>
<h1><a class="header" href="#links-36" id="links-36">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Generic_Routing_Encapsulation">Generic Routing Encapsulation - Wikipedia</a></li>
</ul>
<h1><a class="header" href="#" id=""></a></h1>
<p>a</p>
<h1><a class="header" href="#vxlan-1" id="vxlan-1">VXLAN</a></h1>
<h1><a class="header" href="#links-37" id="links-37">Links</a></h1>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/networking/vxlan.txt">kernel.org/doc/Documentation/networking/vxlan.txt</a></li>
<li><a href="https://vincent.bernat.ch/en/blog/2017-vxlan-linux">VXLAN &amp; Linux | Vincent Bernat</a></li>
<li><a href="https://vincent.bernat.ch/en/blog/2017-vxlan-linux">VXLAN &amp; Linux | Vincent Bernat</a></li>
</ul>
<h1><a class="header" href="#udp-port-4789" id="udp-port-4789">UDP Port 4789</a></h1>
<h1><a class="header" href="#ip-rule" id="ip-rule">ip rule</a></h1>
<h1><a class="header" href="#links-38" id="links-38">Links</a></h1>
<ul>
<li><a href="https://blog.scottlowe.org/2013/05/29/a-quick-introduction-to-linux-policy-routing/">A Quick Introduction to Linux Policy Routing - Scott's Weblog - The weblog of an IT pro focusing on cloud computing, Kubernetes, Linux, containers, and networking</a></li>
<li><a href="https://lartc.org/howto/index.html">Linux Advanced Routing &amp; Traffic Control HOWTO</a></li>
</ul>
<h1><a class="header" href="#notes-1" id="notes-1">Notes</a></h1>
<ul>
<li>
<p>table <code>main</code> is really the default table, and table <code>default</code> is the last
table, which after talbe <code>main</code>, generally never used.</p>
<pre><code>0:      from all lookup local
32766:  from all lookup main
32767:  from all lookup default
</code></pre>
</li>
</ul>
<h1><a class="header" href="#add-a-new-rule" id="add-a-new-rule">Add a new rule</a></h1>
<pre><code># echo 200 John &gt;&gt; /etc/iproute2/rt_tables
# ip rule add from 10.0.0.10 table John
# ip rule ls
0: from all lookup local
32765: from 10.0.0.10 lookup John
32766: from all lookup main
32767: from all lookup default

// generate John’s table
# ip route add default via 195.96.98.253 dev ppp2 table John
# ip route flush cache
</code></pre>
<p>Every table need a default gateway.</p>
<p><strong>routing table is just a routing table, route is decided by rule.</strong></p>
<h1><a class="header" href="#vps" id="vps">vps</a></h1>
<h1><a class="header" href="#links-39" id="links-39">Links</a></h1>
<h1><a class="header" href="#hongkong" id="hongkong">HongKong</a></h1>
<p>a</p>
<h1><a class="header" href="#rsync" id="rsync">rsync</a></h1>
<h1><a class="header" href="#links-40" id="links-40">Links</a></h1>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories-on-a-vps">How To Use Rsync to Sync Local and Remote Directories on a VPS | DigitalOcean</a></li>
</ul>
<h1><a class="header" href="#basic-2" id="basic-2">Basic</a></h1>
<p>sync the content of dir1 to dir2</p>
<pre><code>rsync -av dir1/ dir2
rsync -avhW --progress /src/ /dst/
</code></pre>
<pre><code>-a is for archive, which preserves ownership, permissions etc.
-v is for verbose, so I can see what's happening (optional)
-h is for human-readable, so the transfer rate and file sizes are easier to read (optional)
-W is for copying whole files only, without delta-xfer algorithm which should reduce CPU load
--progress so I can see the progress of large files (optional)
</code></pre>
<p>By default, rsync does not delete anything from the destination directory.</p>
<p>We can change this behavior with the <code>--delete</code> option. Before using this
option, use the <code>--dry-run</code> option and do testing to prevent data loss:</p>
<pre><code>rsync -a --delete source destination
</code></pre>
<h1><a class="header" href="#exclude-files" id="exclude-files">Exclude Files</a></h1>
<p><a href="https://www.thegeekstuff.com/2011/01/rsync-exclude-files-and-folders/?utm_source=feedburner">6 rsync Examples to Exclude Multiple Files and Directories using exclude-from</a></p>
<ul>
<li>Exclude path is always relative</li>
</ul>
<pre><code>rsync -avz --exclude 'dir1' --exclude '*.foo' source/ destination/
// or
rsync -avz --exclude-from 'exclude-list.txt' source/ destination/

cat exclude-list.txt
dir1
*.foo

     --exclude=PATTERN       exclude files matching PATTERN
     --exclude-from=FILE     read exclude patterns from FILE
     --include=PATTERN       don't exclude files matching PATTERN
     --include-from=FILE     read include patterns from FILE
     --files-from=FILE       read list of source-file names from FILE
</code></pre>
<h1><a class="header" href="#music" id="music">Music</a></h1>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Ariana_Grande">Ariana Grande - Wikipedia</a></p>
</li>
<li>
<p>做个真的我</p>
</li>
<li>
<p>道 - 黄沾</p>
</li>
<li>
<p>人间道 - 张学友</p>
</li>
</ul>
<h1><a class="header" href="#choral-music" id="choral-music">choral music</a></h1>
<h1><a class="header" href="#links-41" id="links-41">Links</a></h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=VBEwP95zNGk">Palestrina Choral Music Beautiful Choral - YouTube</a></li>
</ul>
<h1><a class="header" href="#freedom---anthony-hamilton" id="freedom---anthony-hamilton">Freedom - Anthony Hamilton</a></h1>
<h1><a class="header" href="#links-42" id="links-42">Links</a></h1>
<ul>
<li><a href="https://genius.com/Anthony-hamilton-freedom-lyrics">Anthony Hamilton – Freedom Lyrics | Genius Lyrics</a></li>
</ul>
<pre><code>[Verse 1: Elayna Boynton]
Felt like the weight of the world was on my shoulders
Pressure to break or retreat at every turn
Facing the fear that the truth, I discovered
No telling how, all these will work out
But I've come to far to go back now

[Chorus: Elayna Boynton]
I am looking for freedom, looking for freedom
And to find it cost me everything I have
Well I am looking for freedom, looking for freedom
And to find it, may take everything I have

[Verse 2: Anthony Hamilton]
I know all too well it don’t come easy
The chains of the world they seem to moving tight
I try to walk around if I’m stumbling so come..
Trying to get up but the doubt is so strong
There’s gotta be a winning in my bones

[Chorus: Anthony Hamilton &amp; Elayna Boynton]
I am looking for freedom, looking for freedom
And to find it cost me everything I have
Well I am looking for freedom, looking for freedom
And to find it, may take everything I have

[Verse 3: Elayna Boynton &amp; Anthony Hamilton]
Oh not giving up there’s always been hard, so hard
But if I do the things the easy way I won’t get far
Mhm, life hasn't been very kind to me lately, (Well)
But I suppose it’s a push for moving on (Oh yeah)
In time the sun’s gonna shine on me nicely (On me yeah)
Something tells me good things are coming and I ain’t gonna not believe

[Chorus: Elayna Boynton &amp; Anthony Hamilton]
I am looking for freedom, looking for freedom
And to find it cost me everything I have
Well I am looking for freedom, looking for freedom
And to find it, may take everything I have
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgeniuscomariana-grande-imagine-lyricsariana-grande--imagine-lyrics--genius-lyricsa" id="a-hrefhttpsgeniuscomariana-grande-imagine-lyricsariana-grande--imagine-lyrics--genius-lyricsa"><a href="https://genius.com/Ariana-grande-imagine-lyrics">Ariana Grande – imagine Lyrics | Genius Lyrics</a></a></h1>
<h1><a class="header" href="#links-43" id="links-43">Links</a></h1>
<ul>
<li><a href="https://genius.com/Ariana-grande-imagine-lyrics">Ariana Grande – imagine Lyrics | Genius Lyrics</a></li>
</ul>
<pre><code>[Verse 1]
Step up, the two of us, nobody knows us
Get in the car like, &quot;Skrrt&quot;
Staying up all night, order me pad thai
Then we gon' sleep 'til noon
Me with no makeup, you in the bathtub
Bubbles and bubbly, ooh
This is a pleasure, feel like we never act this regular

[Pre-Chorus]
Click, click, click and post
Drip-drip-dripped in gold
Quick, quick, quick, let's go
Kiss me and take off your clothes

[Chorus]
Imagine a world like that
Imagine a world like that
We go like up 'til I'm 'sleep on your chest
Love how my face fits so good in your neck
Why can't you imagine a world like that?
Imagine a world

[Verse 2]
Knew you were perfect after the first kiss
Took a deep breath like, &quot;Ooh&quot;
Feels like forever, baby, I never thought that it would be you
Tell me your secrets, all of the creep shit
That's how I know it's true
Baby, direct it, name in the credits
Like the movies do

[Pre-Chorus]
Click, click, click and post
Drip-drip-dripped in gold
Quick, quick, quick, let's go
Kiss me and take off your clothes

[Chorus]
Imagine a world like that
Imagine a world like that
We go like up 'til I'm 'sleep on your chest
Love how my face fits so good in your neck
Why can't you imagine a world like that?
Imagine a world

[Outro]
Can you imagine it?
Can you imagine it?
Can you imagine it?
Can you imagine it?
Can you imagine it? (Can you imagine?)
Can you imagine it? (Can you imagine?)
Can you imagine it? (Can you imagine?)
Ooh, imagine it (Can you imagine?)
Imagine it, imagine it
Imagine it, imagine it
Imagine, imagine
Imagine, imagine
Imagine, imagine
</code></pre>
<h1><a class="header" href="#皇后大道东" id="皇后大道东">皇后大道东</a></h1>
<h1><a class="header" href="#links-44" id="links-44">Links</a></h1>
<ul>
<li><a href="https://www.feitsui.com/lyrics_s/%E7%9A%87%E5%90%8E%E5%A4%A7%E9%81%93%E4%B8%9C-776.html">罗大佑 蒋志光 《皇后大道东》粤语发音 歌词拼音注音 - 翡翠粤语歌词</a></li>
</ul>
<p>歌手 罗大佑 蒋志光</p>
<p>词 <a href="https://www.feitsui.com/tag_s/1.html">林夕</a></p>
<pre><code>皇后大道西又皇后大道东
wong4 hau6 daai6 dou6 sai1 jau6 wong4 hau6 daai6 dou6 dung1
皇后大道东转皇后大道中
wong4 hau6 daai6 dou6 dung1 zyun2/zyun3 wong4 hau6 daai6 dou6 zung1
皇后大道东上为何无皇宫
wong4 hau6 daai6 dou6 dung1 soeng56 wai46 ho4 mou4 wong4 gung1
皇后大道中人民如潮涌
wong4 hau6 daai6 dou6 zung1 jan4 man4 jyu4 ciu4 jung2

有个贵族朋友在硬币背后
jau5 go3 gwai3 zuk6 pang4 jau5 zoi6 ngaang6 bai6 bui6 hau6
青春不变名字叫做皇后
cing1/ceng1 ceon1 bat1 bin3 ming4 zi6 giu3 zou6 wong4 hau6
每次买卖随我到处去奔走
mui5 ci3 maai5 maai6 ceoi4 ngo5 dou3 cyu35 heoi3 ban1 zau2
面上没有表情却汇聚成就
min6 soeng56 mut6 jau5 biu2 cing4 koek3 wui6 zeoi6 sing4 zau6

知己一声拜拜远去这都市
zi1 gei2 jat1 sing1/seng1 baai3 baai3 jyun5 heoi3 ze5 dou1 si5
要靠伟大同志搞搞新意思
jiu3 kaau3 wai5 daai6 tung4 zi3 gaau2 gaau2 san1 ji3 si1
照买照卖楼花处处有单位
ziu3 maai5 ziu3 maai6 lau4 faa1 cyu35 cyu35 jau5 daan1 wai6
但是旺角可能要换换名字
daan6 si6 wong6 gok3 ho2 nang4 jiu3 wun6 wun6 ming4 zi6

&lt;副歌&gt;

这个正义朋友面善又友善
ze5 go3 zing3 ji6 pang4 jau5 min6 sin6 jau6 jau5 sin6
因此批准马匹一周跑两天
jan1 ci2 pai1 zeon2 maa5 pat1 jat1 zau1 paau2 loeng5 tin1
百姓也自然要斗快过终点
baak3 sing3 jaa5 zi6 jin4 jiu3 dau3 faai3 gwo3 zung1 dim2
若做大国公民只须身有钱
joek6 zou6 daai6 gwok3 gung1 man4 zi2 seoi1 san1 jau5 cin4

知己一声拜拜远去这都市
zi1 gei2 jat1 sing1/seng1 baai3 baai3 jyun5 heoi3 ze5 dou1 si5
要靠伟大同志搞搞新意思
jiu3 kaau3 wai5 daai6 tung4 zi3 gaau2 gaau2 san1 ji3 si1
冷暖气候同样影响这都市
laang5 nyun5 hei3 hau6 tung4 joeng6 jing2 hoeng2 ze5 dou1 si5
但是换季可能靠特异人士
daan6 si6 wun6 gwai3 ho2 nang4 kaau3 dak6 ji6 jan4 si6

空即是色 色即是空
hung1 zik1 si6 sik1 sik1 zik1 si6 hung1
空即是色即是色即是空
hung1 zik1 si6 sik1 zik1 si6 sik1 zik1 si6 hung1

x3

&lt;副歌&gt;

这个漂亮朋友道别亦漂亮
ze5 go3 piu1/piu3 loeng6 pang4 jau5 dou6 bit6 jik6 piu1/piu3 loeng6
夜夜电视荧幕继续旧形象
je6 je6 din6 si6 jing4 mok6 gai3 zuk6 gau6 jing4 zoeng6
到了那日同庆个个要鼓掌
dou3 liu5 naa5 jat6 tung4 hing3 go3 go3 jiu3 gu2 zoeng2
硬币上那尊容变烈士铜像
ngaang6 bai6 soeng56 naa5 zyun1 jung4 bin3 lit6 si6 tung4 zoeng6

知己一声拜拜远去这都市
zi1 gei2 jat1 sing1/seng1 baai3 baai3 jyun5 heoi3 ze5 dou1 si5
要靠伟大同志搞搞新意思
jiu3 kaau3 wai5 daai6 tung4 zi3 gaau2 gaau2 san1 ji3 si1
会有铁路城巴也会有的士
wui jau5 tit3 lou6 sing4 baa1 jaa5 wui jau5 dik1 si6
但是路线可能要问问何事
daan6 si6 lou6 sin3 ho2 nang4 jiu3 man6 man6 ho4 si6

&lt;副歌&gt;

&lt;副歌&gt;

&lt;副歌&gt;

&lt;副歌&gt;
</code></pre>
<h1><a class="header" href="#movies" id="movies">Movies</a></h1>
<h1><a class="header" href="#links-45" id="links-45">Links</a></h1>
<ul>
<li><a href="https://www.imdb.com/name/nm0102873/?ref_=tt_ov_dr">Harry Bradbeer - IMDb</a></li>
</ul>
<h1><a class="header" href="#2019-1" id="2019-1">2019</a></h1>
<h1><a class="header" href="#december" id="december">December</a></h1>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt4786824/episodes?season=2&amp;ref_=tt_eps_sn_2">The Crown - Season 2 - IMDb</a></p>
<p>Sat Dec 07 22:49:03 CST 2019</p>
<p>Can I say it's impressive.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6751668/?ref_=fn_al_tt_1">Parasite (2019) - IMDb</a></p>
<p>Sun Dec 01 19:47:41 CST 2019</p>
<p>I'm cold. I may have accepted my fate.</p>
</li>
</ul>
<h1><a class="header" href="#november" id="november">November</a></h1>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt4786824/episodes?season=1&amp;ref_=tt_eps_sn_1">The Crown - Season 1 - IMDb</a></p>
<p>Thu Nov 28 22:48:16 CST 2019</p>
<p>I just don't understand what's the problem with you.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt4520988/">Frozen II (2019) - IMDb</a></p>
<p>Sat Nov 23 21:03:41 CST 2019</p>
<p>Of cause scence on the screen is beautiful. but I'm not get the point very
much.  Seems about nature protect. Not very into this theme. I don't think
human can protect the Sun. Or maybe one day human will, who knows.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0489974/?ref_=fn_al_tt_1">Carnival Row (TV Series 2019– ) - IMDb</a></p>
<p>Sat Nov 16 23:40:47 CST 2019</p>
<p>So. it's a love drama ?</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0102926/?ref_=fn_al_tt_1">The Silence of the Lambs (1991) - IMDb</a></p>
<p>Sat Nov 09 00:25:08 CST 2019</p>
<p>Old fashioned. </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7137906/?ref_=fn_al_tt_1">When They See Us (TV Mini-Series 2019) - IMDb</a></p>
<p>Fri Nov 08 22:05:18 CST 2019</p>
<p>Life...</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8363040/episodes?season=1&amp;ref_=tt_eps_sn_1">Defending the Guilty - Season 1 - IMDb</a></p>
<p>Mon Nov 04 20:41:47 CST 2019</p>
<p>Can't get the point.</p>
</li>
</ul>
<h1><a class="header" href="#october" id="october">October</a></h1>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt8526872/?ref_=fn_al_tt_1">Dolemite Is My Name (2019) - IMDb</a></p>
<p>Tue Oct 29 20:05:35 CST 2019</p>
<p>it just likely being successful is so easy.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1478839/?ref_=fn_al_tt_1">The Art of Racing in the Rain (2019) - IMDb</a></p>
<p>Mon Oct 28 22:12:00 CST 2019</p>
<p>A tough story. a happy ending story. I like it.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2294629/?ref_=fn_al_tt_1">Frozen (2013) - IMDb</a></p>
<p>Sat Oct 26 23:52:06 CST 2019</p>
<p>It's just perfect.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1190634/?ref_=fn_al_tt_1">The Boys (TV Series 2019– ) - IMDb</a></p>
<p>Sat Oct 26 18:44:29 CST 2019</p>
<p>funny and dark.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7909970/episodes?season=1&amp;ref_=tt_eps_sn_1">Unbelievable - Season 1 - IMDb</a></p>
<p>Thu Oct 24 23:59:49 CST 2019</p>
<p>But I still feel hopeless.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8614426/?ref_=ttep_ep3">&quot;Unbelievable&quot; Episode #1.3 (TV Episode 2019) - IMDb</a></p>
<p>Wed Oct 23 00:04:48 CST 2019</p>
<p>Good Job. They find a match.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8614422/?ref_=ttep_ep1">&quot;Unbelievable&quot; Episode #1.1 (TV Episode 2019) - IMDb</a></p>
<p>Sun Oct 20 21:14:40 CST 2019</p>
<p>WTF. Why ? why things leads to such stituation.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6905542/?ref_=fn_al_tt_2">The Dark Crystal: Age of Resistance (TV Series 2019– ) - IMDb</a></p>
<p>Sat Oct 19 20:41:39 CST 2019<br />
All roles in this drama are ugly and funny. and impressive. and hyperbole.
and I like it.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8201186/episodes?season=1&amp;ref_=tt_eps_sn_1">The Capture - Season 1 - IMDb</a></p>
<p>Mon Oct 14 20:41:58 CST 2019<br />
When you watch someone else, don't pretend there's no one watch you.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3567288/?ref_=fn_al_tt_1">The Visit (2015) - IMDb</a></p>
<p>Sun Oct 13 18:14:18 CST 2019<br />
An one week trip to grand parents's home, which finally found they are
murders. </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7472896/episodes?season=1&amp;ref_=tt_eps_sn_1">Mr Inbetween - Season 1 - IMDb</a></p>
<p>Sat Oct 05 21:43:29 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7016936/episodes?season=2&amp;ref_=tt_eps_sn_2">Killing Eve - Season 2 - IMDb</a></p>
<p>Tue Oct 01 14:36:20 CST 2019</p>
</li>
</ul>
<h1><a class="header" href="#september" id="september">September</a></h1>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt7016936/episodes?season=1&amp;ref_=tt_eps_sn_1">Killing Eve - Season 1 - IMDb</a></p>
<p>Sat Sep 28 20:37:42 CST 2019<br />
Good drama as always.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6229670/?ref_=ttep_ep4">&quot;Peaky Blinders&quot; The Loop (TV Episode 2019) - IMDb</a></p>
<p>Tue Sep 24 00:08:44 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6320628/?ref_=fn_al_tt_1">Spider-Man: Far from Home (2019) - IMDb</a></p>
<p>Sat Sep 21 14:18:28 CST 2019<br />
Spider boy killed some bad guy on his summer vacation. bad script.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8201452/?ref_=ttep_ep3">&quot;The Capture&quot; Truffle Hog (TV Episode 2019) - IMDb</a></p>
<p>Sat Sep 21 02:00:19 CST 2019<br />
Good design.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2442560/episodes?season=4&amp;ref_=tt_eps_sn_4">Peaky Blinders - Season 4 - IMDb</a></p>
<p>Tue Sep 17 23:12:20 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2442560/episodes?season=3&amp;ref_=tt_eps_sn_3">Peaky Blinders - Season 3 - IMDb</a></p>
<p>Sat Sep 14 23:02:37 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2442560/episodes?season=2&amp;ref_=tt_eps_sn_2">Peaky Blinders - Season 2 - IMDb</a></p>
<p>Very good drama. Good storyline.<br />
Fri Sep 13 19:11:41 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2461632/?ref_=ttep_ep5">&quot;Peaky Blinders&quot; Episode #1.5 (TV Episode 2013) - IMDb</a></p>
<p>Tue Sep 10 00:17:54 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2471502/?ref_=ttep_ep2">&quot;Peaky Blinders&quot; Episode #1.2 (TV Episode 2013) - IMDb</a></p>
<p>Mon Sep 09 00:48:14 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5761478/episodes?season=3&amp;ref_=tt_eps_sn_3">Harlots - Season 3 - IMDb</a></p>
<p>Sat Sep 07 23:16:04 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5761478/episodes?season=2&amp;ref_=tt_eps_sn_2">Harlots - Season 2 - IMDb</a></p>
<p>Love the girls. sometimes story line is just nonsense.<br />
Mon Sep 02 22:07:53 CST 2019</p>
</li>
</ul>
<h2><a class="header" href="#august" id="august">August</a></h2>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt6139732/?ref_=fn_al_tt_1">Aladdin (2019) - IMDb</a></p>
<p>Sat Aug 31 20:19:38 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8708280/?ref_=fn_al_tt_1">State of the Union (TV Series 2019– ) - IMDb</a></p>
<p>Tue Aug 20 21:26:43 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5707984/?ref_=ttep_ep4">&quot;Fleabag&quot; Episode #1.4 (TV Episode 2016) - IMDb</a></p>
<p>Sun Aug 18 01:25:57 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7211618/?ref_=fn_al_tt_1">Gentleman Jack (TV Series 2019– ) - IMDb</a></p>
<p>always like happy ending drama.<br />
Fri Aug 16 22:44:18 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8772296/?ref_=ttep_ep_tt">Euphoria (TV Series 2019– ) - IMDb</a></p>
<p>Kid's life are weird.<br />
Sat Aug 10 21:34:43 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5761478/episodes?season=1&amp;ref_=tt_eps_sn_1">Harlots - Season 1 - IMDb</a></p>
<p>It has a tense and rich storyline. Very good drama.<br />
Fri Aug 09 00:02:54 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2380307/?ref_=fn_al_tt_1">Coco (2017) - IMDb</a></p>
<p>Very good movie, very good story line.<br />
Sun Aug 04 23:19:24 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0111161/?ref_=fn_al_tt_3">The Shawshank Redemption (1994) - IMDb</a></p>
<p>Hope is the best thing of all things. I hope I can have hope of my life.<br />
Thu Aug 01 23:08:36 CST 2019</p>
</li>
</ul>
<h2><a class="header" href="#july" id="july">July</a></h2>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt1853728/?ref_=fn_al_tt_1">Django Unchained (2012) - IMDb</a></p>
<p>I want FREEDOM.<br />
Tue Jul 30 22:03:12 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1869454/?ref_=fn_al_tt_1">Good Omens (TV Mini-Series 2019) - IMDb</a></p>
<p>Angel ? Daemon ? Humanity ? Angel + Daemon = Humanity ?<br />
I think being funny is a very important charactor of humanity.<br />
Who create this world ? How it could be just come from nothing ? where does
this <strong>NOTHING</strong> come from ? This reality is just so rediculous. What if that
everything is just not real ?<br />
Sun Jul 28 20:41:18 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0103639/?ref_=fn_al_tt_2">Aladdin (1992) - IMDb</a></p>
<p>Beautiful story. Beautiful songs.<br />
Wed Jul 24 20:19:32 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2386490/?ref_=fn_al_tt_4">How to Train Your Dragon: The Hidden World (2019) - IMDb</a></p>
<p>Getting better and better.<br />
Mon Jul 22 00:30:48 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6105098/?ref_=fn_al_tt_1">The Lion King (2019) - IMDb</a></p>
<p>Beautiful music, beautiful memories. But, it seams that these alive animals
not as alive as those in animation version.<br />
Sun Jul 21 17:57:42 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8664276/?ref_=ttep_ep2">&quot;After Life&quot; Episode #1.2 (TV Episode 2019) - IMDb</a></p>
<p>Sun Jul 14 21:31:33 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8664264/?ref_=ttep_ep1">&quot;After Life&quot; Episode #1.1 (TV Episode 2019) - IMDb</a></p>
<p>It feels like that my life is just left darkness. So what's the difference if
I passed away now, or some more years later soon. That is, what is the
meaning of life. I always didn't get it. Also we can way, life is just life,
life doen't need a meaning. Should I just enjoy it, do my best ?<br />
But it still make nonsense.<br />
Sun Jul 14 21:02:39 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0437086/?ref_=fn_al_tt_2">Alita: Battle Angel (2019) - IMDb</a></p>
<p>Just a movie. but I like Alita. Very prety.<br />
Sun Jul 14 17:04:35 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7948996/episodes?season=1&amp;ref_=tt_eps_sn_1">Chimerica - Season 1 - IMDb</a></p>
<p>I just don't understand, everything.<br />
Sun Jul 14 00:00:39 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8211552/?ref_=ttep_ep1">&quot;Chimerica&quot; Kodak Ergo Sum (TV Episode 2019) - IMDb</a></p>
<p>Sad.<br />
Tue Jul 09 22:09:54 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8750256/?ref_=ttep_ep5">&quot;Years and Years&quot; Episode #1.5 (TV Episode 2019) - IMDb</a></p>
<p>Tue Jul 09 20:32:15 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8750264/?ref_=ttep_ep6">&quot;Years and Years&quot; Episode #1.6 (TV Episode 2019) - IMDb</a></p>
<p>Tue Jul 09 21:30:11 CST 2019</p>
</li>
</ul>
<h2><a class="header" href="#june" id="june">June</a></h2>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/episodes?season=2&amp;ref_=tt_eps_sn_2">Fleabag - Season 2 - IMDb</a> </p>
<p>Love is painful.<br />
Sun Jun 30 16:52:47 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8806264/?ref_=ttep_ep2">&quot;Euphoria&quot; Stuntin' Like My Daddy (TV Episode 2019) - IMDb</a></p>
<p>Thu Jun 27 23:13:06 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9104566/?ref_=ttep_ep7">&quot;Ramy&quot; Ne Me Quitte Pas (TV Episode 2019) - IMDb</a><br />
Make me feel sad. make me think of a song, &quot;portati via&quot;. Make me think
about, Have you found yourself yet ?<br />
Mon Jun 24 21:23:08 CST 2019</p>
<ul>
<li><a href="https://www.imdb.com/title/tt9104568/?ref_=ttep_ep8">&quot;Ramy&quot; Saving Mikaela (TV Episode 2019) - IMDb</a><br />
Mon Jun 24 21:56:45 CST 2019</li>
<li><a href="https://www.imdb.com/title/tt9371986/?ref_=ttep_ep9">&quot;Ramy&quot; Dude, Where's My Country? (TV Episode 2019) - IMDb</a><br />
Mon Jun 24 22:23:42 CST 2019</li>
<li><a href="https://www.imdb.com/title/tt9371994/?ref_=ttep_ep10">&quot;Ramy&quot; Cairo Cowboy (TV Episode 2019) - IMDb</a><br />
Mon Jun 24 22:48:12 CST 2019</li>
</ul>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9748850/?ref_=ttep_ep1">&quot;Ramy&quot; Between the Toes (TV Episode 2019) - IMDb</a><br />
Sun Jun 23 19:42:13 CST 2019</p>
<ul>
<li><a href="https://www.imdb.com/title/tt9174974/?ref_=ttep_ep2">&quot;Ramy&quot; Princess Diana (TV Episode 2019) - IMDb</a><br />
Sun Jun 23 20:04:34 CST 2019</li>
<li><a href="https://www.imdb.com/title/tt9174972/?ref_=ttep_ep3">&quot;Ramy&quot; A Black Spot on the Heart (TV Episode 2019) - IMDb</a><br />
Sun Jun 23 22:23:33 CST 2019</li>
<li><a href="https://www.imdb.com/title/tt9169374/?ref_=ttep_ep4">&quot;Ramy&quot; Strawberries (TV Episode 2019) - IMDb</a><br />
Sun Jun 23 23:16:26 CST 2019</li>
<li><a href="https://www.imdb.com/title/tt9082310/?ref_=ttep_ep5">&quot;Ramy&quot; Do the Ramadan (TV Episode 2019) - IMDb</a><br />
Hahahahah<br />
Sun Jun 23 23:43:13 CST 2019</li>
<li><a href="https://www.imdb.com/title/tt9104564/?ref_=ttep_ep6">&quot;Ramy&quot; Refugees (TV Episode 2019) - IMDb</a><br />
Mon Jun 24 00:18:43 CST 2019</li>
</ul>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5908780/?ref_=ttep_ep5">&quot;Fleabag&quot; Episode #1.5 (TV Episode 2016) - IMDb</a></p>
<p>Sun Jun 23 02:07:30 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8398600/episodes?season=1&amp;ref_=tt_eps_sn_1">After Life - Season 1 - IMDb</a></p>
<p>What is life.<br />
Wed Jun 05 23:32:19 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8664264/?ref_=ttep_ep1">&quot;After Life&quot; Episode #1.1 (TV Episode 2019) - IMDb</a></p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8664276/?ref_=ttep_ep2">&quot;After Life&quot; Episode #1.2 (TV Episode 2019) - IMDb</a></p>
<p>I'm sad too.<br />
Mon Jun 03 01:30:41 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5908782/?ref_=ttep_ep6">&quot;Fleabag&quot; Episode #1.6 (TV Episode 2016) - IMDb</a></p>
<p>Best drama ever.<br />
Mon Jun 03 00:19:27 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5707984/?ref_=ttep_ep4">&quot;Fleabag&quot; Episode #1.4 (TV Episode 2016) - IMDb</a></p>
<p>I just wanna cry, all the time.<br />
This little slice always makes me feel moving.<br />
Sun Jun 02 22:12:42 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9166672/?ref_=ttep_ep3">&quot;Chernobyl&quot; Open Wide, O Earth (TV Episode 2019) - IMDb</a></p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9166678/?ref_=ttep_ep4">&quot;Chernobyl&quot; The Happiness of All Mankind (TV Episode 2019) - IMDb</a></p>
<p>Sat Jun 01 19:01:49 CST 2019</p>
</li>
</ul>
<h2><a class="header" href="#may" id="may">May</a></h2>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/episodes?season=1&amp;ref_=tt_eps_sn_1">Fleabag - Season 1 - IMDb</a></p>
<p>Just want to know after how many times I will feel boring.<br />
Sun May 26 17:37:24 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8750242/?ref_=ttep_ep1">&quot;Years and Years&quot; Episode #1.1 (TV Episode 2019) - IMDb</a></p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8750250/?ref_=ttep_ep2">&quot;Years and Years&quot; Episode #1.2 (TV Episode 2019) - IMDb</a></p>
<p>A drama which sells anxiety.<br />
Fri May 24 00:52:49 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9679522/?ref_=ttep_ep3">&quot;Fleabag&quot; Episode #2.3 (TV Episode 2019) - IMDb</a></p>
<p>Does God watch me through a window.<br />
Wed May 22 01:07:59 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9679520/?ref_=ttep_ep2">&quot;Fleabag&quot; Episode #2.2 (TV Episode 2019) - IMDb</a></p>
<p>Arm touch.<br />
Tue May 21 23:11:51 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6027920/?ref_=ttep_ep6">&quot;Game of Thrones&quot; The Iron Throne (TV Episode 2019) - IMDb</a></p>
<p>Oops, time wasted.<br />
Mon May 20 22:59:23 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0383574/?ref_=fn_al_tt_6">Pirates of the Caribbean: Dead Man's Chest (2006) - IMDb</a></p>
<p>All those days have gone.<br />
Sun May 19 22:42:43 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0398286/?ref_=fn_al_tt_1">Tangled (2010) - IMDb</a></p>
<p>A story about a mother could be the most dangerous person to you.<br />
Sat May 18 23:51:52 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8162428/?ref_=ttep_ep1">&quot;Chernobyl&quot; 1:23:45 (TV Episode 2019) - IMDb</a></p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8482972/?ref_=ttep_ep2">&quot;Chernobyl&quot; Please Remain Calm (TV Episode 2019) - IMDb</a></p>
<p>Man made mistakes, Does God ?<br />
Sat May 18 19:38:41 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/episodes?season=1&amp;ref_=tt_eps_sn_1">Fleabag - Season 1 - IMDb</a></p>
<p>Yeah, again.<br />
I wonder when will I die.<br />
Sat May 18 17:19:06 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5707984/?ref_=ttep_ep4">&quot;Fleabag&quot; Episode #1.4 (TV Episode 2016) - IMDb</a></p>
<p>I just wanna cry, all the time.<br />
Mon May 13 00:02:58 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6733140/?ref_=ttep_ep6">&quot;Fleabag&quot; Episode #2.6 (TV Episode 2019) - IMDb</a></p>
<p>I love you.<br />
It'll pass.<br />
Sat May 11 16:02:32 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9679524/?ref_=ttep_ep4">&quot;Fleabag&quot; Episode #2.4 (TV Episode 2019) - IMDb</a></p>
<p>Almost.<br />
I like the Choral Music.<br />
Thu May 09 01:11:24 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9679522/?ref_=ttep_ep3">&quot;Fleabag&quot; Episode #2.3 (TV Episode 2019) - IMDb</a></p>
<p>They'll last a week.<br />
Wed May 08 01:48:27 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6027914/?ref_=ttep_ep4">&quot;Game of Thrones&quot; The Last Of The Starks (TV Episode 2019) - IMDb</a></p>
<p>So the dragon died on his vacation.<br />
Tue May 07 23:46:34 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/episodes?season=2&amp;ref_=tt_eps_sn_2">Fleabag - Season 2 - IMDb</a></p>
<p>Wonderful work. Love it very much.<br />
Sun May 05 00:31:09 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1130884/?ref_=fn_al_tt_1">Shutter Island (2010) - IMDb</a></p>
<p>weird.<br />
Sat May 04 19:41:35 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0361748/?ref_=fn_al_tt_1">Inglourious Basterds (2009) - IMDb</a></p>
<p>Maybe I'm old enough, that I don't like to see people die. But I think it's
a good movie, from some film master, though I don't understand it.<br />
Sat May 04 00:48:36 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/?ref_=fn_al_tt_1">Fleabag (TV Series 2016– ) - IMDb</a></p>
<p>Still love it.<br />
Fri May 03 19:40:37 CST 2019</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5707984/?ref_=ttep_ep4">&quot;Fleabag&quot; Episode #1.4 (TV Episode 2016) - IMDb</a></p>
<p>I just wanna cry, all the time.<br />
[Fri May 03 18:21:22 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/episodes?season=1&amp;ref_=tt_eps_sn_1">Fleabag - Season 1 - IMDb</a></p>
<p>Still like it. Still feel happy to see them.<br />
[Fri May 03 16:39:46 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt4227538/?ref_=ttep_ep1">&quot;Westworld&quot; The Original (TV Episode 2016) - IMDb</a></p>
<p>Are we REAL ?<br />
[Thu May 02 20:41:46 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8398600/?ref_=fn_al_tt_1">After Life (TV Series 2019– ) - IMDb</a></p>
<p>A story about &quot;why didn't I suicide&quot;. and I still don't find the answer.<br />
[Thu May 02 03:43:21 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0209144/?ref_=fn_al_tt_1">Memento (2000) - IMDb</a></p>
<p>weird and complicated. I don't even know what really happened.<br />
[Wed May  1 22:21:54 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1987680/?ref_=fn_al_tt_1">The Upside (2017) - IMDb</a></p>
<p>Simple and good story. fun and impressive.<br />
[Wed May  1 02:50:43 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/episodes?season=2&amp;ref_=tt_eps_sn_2">Fleabag - Season 2 - IMDb</a></p>
<p>hahahahaha<br />
[Wed May  1 00:13:21 CST 2019]</p>
</li>
</ul>
<h2><a class="header" href="#april" id="april">April</a></h2>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt6027912/?ref_=ttep_ep3">&quot;Game of Thrones&quot; The Long Night (TV Episode 2019) - IMDb</a></p>
<p>A boring episode. Life and Death, their fighting is not at the same level,
we all know it will end by a surprise. And we see it. This feel is just same
as waiting. And I don't like waiting.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5687612/episodes?season=1&amp;ref_=tt_eps_sn_1">Fleabag - Season 1 - IMDb</a></p>
<p>I like it. It makes me feel happy.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt4154796/?ref_=nv_sr_1?ref_=nv_sr_1">Avengers: Endgame (2019) - IMDb</a></p>
<p>It's too long. and boring, and too noisy. I don't like this movie, is just
because I don't like war. War is, No matter what you do, people die. either
your people, or their people. you people don't deserve to die, 灭霸's
soldiers don't deserve too. So why kill all of them ? and, if you can travel
freely in the so called time space, then time means nothing.  And, the part
I like in this movie, is the value behind the scenes( I can't distinct this
word with sense), which about family, about life.<br />
[Sat Apr 27 21:27:22 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0944947/episodes?season=4">Game of Thrones - Season 4 - IMDb</a></p>
<p>A sad season. [Sun Apr 14 20:50:29 CST 2019]</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0110912/?ref_=fn_al_tt_1">Pulp Fiction (1994) - IMDb</a></p>
<p>Can't understand why the score of this movie is so high.去了解了一下评论，我
无法认同也无法理解这些人的想法。我要的只是一个精彩或感人的故事，我要的不是什
么高超的讲故事的方法。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0944947/episodes?season=3">Game of Thrones - Season 3 - IMDb</a></p>
<p>Not that interesting.<br />
[Fri Apr  5 21:16:14 CST 2019] </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1853728/?ref_=fn_al_tt_1">Django Unchained (2012) - IMDb</a></p>
<p>I love this movie very much. and the soundtrack in the movie is very
beautiful.<br />
[Mon Apr  1 20:48:38 CST 2019]</p>
</li>
</ul>
<h2><a class="header" href="#before-april" id="before-april">Before April</a></h2>
<pre><code>Memento, fight club, the prestige, the visit(这是恐怕电影哈哈), Inception,
Slevin 
有很多
</code></pre>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt0848228/?ref_=fn_al_tt_1">The Avengers (2012) - IMDb</a></p>
<p>Of course, They won. Loki wanted to get the energy source, to obtain the
power for being a king, But heros won't let him take it easy. so they fight.
then they won, definitely.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3896198/?ref_=fn_al_tt_2">Guardians of the Galaxy Vol. 2 (2017) - IMDb</a></p>
<p>Peter's father, the God, wanted Peter to eternity the galaxy with him
together, but when Peter knows that his father kill his mother, so Perter
decide to kill his father. Then his friends help him kill his father
together. Then the God dead.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0383574/?ref_=fn_al_tt_5">Pirates of the Caribbean: Dead Man's Chest (2006) - IMDb</a></p>
<p>Jack Sparrow wanted to get Davy Jones's chest, but his compass can't work on
his hand, so he let Will Turner to get the key and Elizabeth Swann to help
find the chest. Then Jack Sparrow dead.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0944947/episodes?season=2">Game of Thrones - Season 2 - IMDb</a></p>
<p>This season is not interesting. can't rember what happened.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0266543/?ref_=nv_sr_1">Finding Nemo (2003) - IMDb</a></p>
<p>Always like simple movies. </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5013056/">Dunkirk (2017) - IMDb</a></p>
<p>不是所有的片都适合这种一会儿这里一会儿那里的叙述方式的。什么片都用这种方式来
讲，就会让人反感。这让人感觉你的故事没什么内容，所有要用这种方式做点迷惑。好
的故事，都是一口气讲完，整个过程没有尿点的。在我看来，这种讲故事的方式，只适
合需要制造迷底的场景。这里用，真的是用错了。</p>
<p>不过，不管他的叙事方式，让我思考的是，Why they war ? </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0092067/?ref_=fn_al_tt_1">Castle in the Sky (1986) - IMDb</a></p>
<p>Hayao Miyazaki's work，pure and cute。use the simple key thought, there's
castle behind the clould. 但这个作品不是上乘的作品，没有强烈的表达出一个主题
。当然你可以认为不是所有作品都要表达一个主题，那一个作品的目的是什么呢？很多
人喜欢拿他的作品有许多隐喻来说事，藏着表达自然也是一种手法，但你怎么知道不是
你自己想多了呢？人盲目了，就变成了信仰。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0944947/episodes?season=1&amp;ref_=tt_eps_sn_1">Game of Thrones - Season 1 - IMDb</a></p>
<ul>
<li>Bran see them F-word.</li>
<li>Stark discover the golden hair.Stark dead.</li>
</ul>
<p>几个我喜欢的片断：</p>
<ul>
<li>Stark被砍头时无声的时间，表达了一个人在即要死的时候的感觉。</li>
<li>Then you will see exactly what life is worth... when all the rest has gone.</li>
</ul>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0482571/?ref_=fn_al_tt_1">The Prestige (2006) - IMDb</a></p>
<p>Wow 原来这样 他们都太疯狂了</p>
<p>电影很好 但对我来说 谜底藏的太久了 我整个过程都很迷惑 觉得好累</p>
<p>我发现了这个电影的导演也是Christopher Nolan , 还有inception, interstellar也是
他的作品，他的作品都设计的很复杂，很厉害。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1375666/?ref_=nv_sr_1">Inception (2010) - IMDb</a></p>
<p>How you really know this world is real ? they share dream, the deep level
dream, the time concept in dream is composed, the lost gravity, all of these
designs are awesome. The writer and director Christopher Nolan is awesome.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5463162/?ref_=fn_al_tt_1">Deadpool 2 (2018) - IMDb</a></p>
<p>救Russell. 没有上一部好看。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3152624/?ref_=fn_al_tt_1">Trainwreck (2015) - IMDb</a></p>
<p>我喜欢这个电影。They fall in love, they done, they fall in love again.
classic drama. Some slice are realy funny.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1431045/?ref_=nv_sr_2">Deadpool (2016) - IMDb</a></p>
<p>好看的。绝望之后的新生，我也很向往。许多人的向往吧。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2015381/?ref_=fn_al_tt_1">Guardians of the Galaxy (2014) - IMDb</a></p>
<p>抢石头大战. 偷球，被抓，越狱。球被夺，组团去抢，大Boss得搞破坏计划。靠个奇迹
掉丝打败大Boss.比较传统的戏码。好看，但不精彩。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0137523/?ref_=fn_al_tt_1">Fight Club (1999) - IMDb</a></p>
<p>A Excellent movie. Very different and amazing and a lot of fun.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0468569/?ref_=fn_al_tt_1">The Dark Knight (2008) - IMDb</a></p>
<p>Batman的本事让我失望，可能是我期待错罢。其声音都让人很烦。反而Joker的本事让我
感觉厉害的出奇，像是个没什么事他做不到的，简直逆天。垃圾设计。这个片子的主角明显
是Joker。 放狗，然后在那里手打脚踢也太搞笑了，这TM是超级英雄片吗？</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0993846/?ref_=fn_al_tt_1">The Wolf of Wall Street (2013) - IMDb</a></p>
<p>Excellent movie.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0816692/?ref_=fn_al_tt_1">Interstellar (2014) - IMDb</a></p>
<p>人类有限的想像力下，也就只能拍出这样的东西了。但作为一部写Family, Dad and
Daughter的片，还是很棒的片。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0467406/?ref_=fn_al_tt_1">Juno (2007) - IMDb</a></p>
<p>年轻人的电影，既美好，于你来讲，又透着伤感。The girl named Juno. A story
after she pregnant.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3385524/?ref_=fn_al_tt_2">Stan &amp; Ollie (2018) - IMDb</a></p>
<p>让我想起了于谦和郭德纲。不知道这两人以后的情况是什么样？</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/4864908/">影 (豆瓣)</a></p>
<p>喜欢东方古代味道的人可能会喜欢这个片。但是因为片里处处都透着奴性的味道，人性
恶的权斗的正面的描写，使我不舒服。而且很没意思的结尾，抱出来就猜到了。而我总
是猜到他们的算计，让我恶心自己。</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/26796664/">叶问外传：张天志 (豆瓣)</a></p>
<p>东方的片子，节奏总是要慢些，即使是这样的传统的武打片。这是典型的霍元甲戏码，
弱小的Chinese打败强大的Westerner. 9012年还玩这样的东西，很无品，很无意思。</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/4840388/">新喜剧之王 (豆瓣)</a></p>
<p>毒鸡汤，太支。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5028340/?ref_=tt_rec_tt">Mary Poppins Returns (2018) - IMDb</a></p>
<p>这个年代，拿堆动画和人在一起已经不算什么Imagination了. 不过比上一部好。总算能
看懂你到底想说啥： Never explains anything, Everything is possible.可能它想表
达的东西是好的，但是作为电影，这部电影真的不是好看的电影。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0058331/?ref_=fn_al_tt_1">Mary Poppins (1964) - IMDb</a></p>
<p>说实在的，看完了一肚子火，这是什么垃圾啊. 整场都在瞎jb闹,特别是男一那满满小丑
风，也蹦得让人非常烦躁。这些还能给高评分的 是不是有病。西文区高评分我理解，
方块字区诚实点不行吗？</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/3726072/">东邪西毒：终极版 (豆瓣)</a></p>
<p>她的手很暖，就跟我大嫂的手一样。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0120737/?ref_=nv_sr_1">The Lord of the Rings: The Fellowship of the Ring (2001) - IMDb</a></p>
<p>Exactly, I don't like it. When they fight, the camera shakes too much.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7349662/?ref_=fn_al_tt_1">BlacKkKlansman (2018) - IMDb</a></p>
<p>Black in America is not easy.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0371746/?ref_=nv_sr_1">Iron Man (2008) - IMDb</a></p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1228705/?ref_=tt_rec_tti">Iron Man 2 (2010) - IMDb</a></p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1300854/?ref_=tt_rec_tti">Iron Man 3 (2013) - IMDb</a></p>
<p>都很好看的。好像都是第二次看。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1646971/?ref_=tt_rec_tt">How to Train Your Dragon 2 (2014) - IMDb</a></p>
<p>Better than last episode.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0892769/?ref_=fn_al_tt_1">How to Train Your Dragon (2010) - IMDb</a></p>
<p>Doesn't he transfrom this world too easy ?</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0114369/?ref_=fn_al_tt_1">Se7en (1995) - IMDb</a></p>
<p>We All Sin</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1979388/?ref_=nv_sr_1">The Good Dinosaur (2015) - IMDb</a></p>
<p>a movie about go though fear.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0770802/?ref_=nv_sr_1">Samsara (2011) - IMDb</a></p>
<p>人生的意义是什么。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3722234/?ref_=fn_al_tt_1">Gosnell: The Trial of America's Biggest Serial Killer (2018) - IMDb</a></p>
<p>简单的Case of Murder，因为牵扯到abortion的问题，变得这样复杂。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3750872/?ref_=fn_al_tt_1">The Wife (2017) - IMDb</a></p>
<p>这份成就是他俩一起达成的，当然他老公是后勤。太多太多事情无法评述是非，这件事
情同样。作为女性在这个世界，相对于男人其实更难。作为妻子也很难。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0118799/?ref_=nv_sr_1">Life Is Beautiful (1997) - IMDb</a></p>
<p>一个很浪漫的电影。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0817177/?ref_=nv_sr_1">Flipped (2010) - IMDb</a></p>
<p>年轻人的故事。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0093389/?ref_=fn_al_tt_1">The Last Emperor (1987) - IMDb</a></p>
<p>一声叹息。有人说溥仪的一生是传奇的一生，对普通人来说，说传奇是不过份。但对一
个皇帝来曰，实在是很差的一生，完全不传奇可言。其生不如死的感觉，比我作为一个
普通人的生不如死的感觉好有一比，未必其更痛苦。革命无罪，造反有理，革命无罪，
造反有理...那些人，仿佛是一堆机器。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7401588/?ref_=fn_al_tt_1">Instant Family (2018) - IMDb</a></p>
<p>我还是比较喜欢这种情感戏的。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt4595882/?ref_=fn_al_tt_1">Can You Ever Forgive Me? (2018) - IMDb</a></p>
<p>还不知道主题到底是什么。这个片子的背景音乐比较有味道。看了50分钟仍然不知道这
个片子的主题是什么。看到最后也不知道要说什么。就是一部电影吧。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8075192/?ref_=nv_sr_1">Shoplifters (2018) - IMDb</a></p>
<p>实在谈不上是几多精彩的电影。乏味，节奏慢，大家喜欢的点不过是因为政治正确？</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8951058/?ref_=fn_al_tt_1">The Panama Papers (2018) - IMDb</a></p>
<p>英语水平太差，看不太懂。这个文件跟东方的关系非常大，但是东方的人群并不关心。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0120815/?ref_=fn_al_tt_1">Saving Private Ryan (1998) - IMDb</a></p>
<p>War movies always let you to think about something, about life, about war it
self.  abot courage, about human or animal.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0454921/?ref_=fn_al_tt_1">The Pursuit of Happyness (2006) - IMDb</a></p>
<p>这碗鸡汤跟第一次喝的时候一样浓。You gotta a dream... You gotta to protect it.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0075148/?ref_=fn_al_tt_1">Rocky (1976) - IMDb</a></p>
<p>Very America. </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1119646/?ref_=nv_sr_1">The Hangover (2009) - IMDb</a></p>
<p>很早以前看过的。一直印象不错，所以就又看了一遍。算不错的电影，再看喜感就没那
么足。可能这种电影不适合剧透。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5083738/?ref_=fn_al_tt_1">The Favourite (2018) - IMDb</a></p>
<p>西方宫斗剧。味道跟东方宫斗剧很相似。人类之恶统都差不多。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2380307/?ref_=fn_al_tt_1">Coco (2017) - IMDb</a></p>
<p>A perfect movie about family, and some thinking about life. A concept of the
final death.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6966692/?ref_=fn_al_tt_1">Green Book (2018) - IMDb</a></p>
<p>这个世界为什么这么多的麻烦。似乎麻烦是人活着的基础。电影很好，奇怪曰不出来为
什么好，但是就是感觉好。可能是自己的境界达不到这个高度。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0109830/?ref_=fn_al_tt_1">Forrest Gump (1994) - IMDb</a></p>
<p>很棒的电影。电影就像一个说书的，稳稳的讲完他要讲的故事，讲得很有吸引力。故事
本身感觉都就是平平淡淡的故事，但是故事讲得是真的好。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0097165/?ref_=nv_sr_1">Dead Poets Society (1989) - IMDb</a></p>
<p>岁月啊。Seize the day! Have you ?</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0268978/?ref_=fn_al_tt_1">A Beautiful Mind (2001) - IMDb</a></p>
<p>很感人的故事。我希望我是男主。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0120762/?ref_=fn_al_tt_1">Mulan (1998) - IMDb</a></p>
<p>肯定是因为沾上了China元素，这个片子的创造力都无掉了。Mulan是真是丑，不然哪样
在军营里混呢。另外，我觉得美化这个题材，对儿童具有毒害作用。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0245429/?ref_=fn_al_tt_1">Spirited Away (2001) - IMDb</a></p>
<p>大师作品。一些评论在装逼，说作品反应了这个，反应了那个。我觉得这种事情，不是
一个大师做的事情。真实不过是手段，不是大师真正要表达的东西。大师表达的，就如
你所点题的，不要迷失自我，与爱。真理一定是简单的。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2488496/?ref_=nv_sr_5">Star Wars: Episode VII - The Force Awakens (2015) - IMDb</a></p>
<p>经典的争夺藏宝图的戏码。欣赏不来这种风格的电影。可能是我想像力不够发达。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0398286/?ref_=fn_al_tt_1">Tangled (2010) - IMDb</a></p>
<p>Definitely a good story. Life can't be without a dream after a new dream, but
not just only chinese dream.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1049413/?ref_=fn_al_tt_1">Up (2009) - IMDb</a></p>
<p>开局和结尾有些脱节。开局是一种关于人生的电影。到后面就有么不知道主题是什么了
，大概是关于保护野生动物的主题。众多Disney的电影当中，这部相对是差的。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0325980/?ref_=nv_sr_2">Pirates of the Caribbean: The Curse of the Black Pearl (2003) - IMDb</a></p>
<p>Miss Swann是这样美，是我所见过的最美的女人。如果讨论生命的价值，我认为作为
pirate 其生命的价值高于作为没有作为的普通人的生命。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt4925292/?ref_=fn_al_tt_1">Lady Bird (2017) - IMDb</a></p>
<p>Being Honest, I can't understand what this movie saying.不过女主很
impressive.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1661199/?ref_=fn_al_tt_1">Cinderella (2015) - IMDb</a></p>
<p>王子给公主穿鞋子，经典戏码。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2771200/?ref_=fn_al_tt_1">Beauty and the Beast (2017) - IMDb</a></p>
<p>完美的作品。一切的一切都呈现的那么完美。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2948356/?ref_=nv_sr_1">Zootopia (2016) - IMDb</a></p>
<p>Judy好励志啊。sloth那里是最精彩的 ，有法瞅一日。这个电影的很多点都太有意
罢，sloth的flash, Mr Big is a mice and is 教父，剧情的安排都很完美。实在是近
年的片子里面最好的片子。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5848272/?ref_=fn_al_tt_1">Ralph Breaks the Internet (2018) - IMDb</a></p>
<p>哈哈哈，真有意思。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1772341/?ref_=fn_al_tt_1">Wreck-It Ralph (2012) - IMDb</a></p>
<p>很棒的片子。Ralph在自己的世界的不让人欢迎，于是逃离到另外一个世界，一个很有意
思的游戏世界里面的故事。有一天你会再也看不到这些美好的东西，想到这个真让人难
过。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt4633694/?ref_=nv_sr_2">Spider-Man: Into the Spider-Verse (2018) - IMDb</a></p>
<p>这画的啥哦 画面老一秒五切 让人烦躁死了 人物斗 跑路还有画片卡滞感 这感觉是把漫
画补充了一些张数 直接变成电影了 太高端了 我欣赏不来</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3521164/?ref_=nv_sr_2">Moana (2016) - IMDb</a></p>
<p>Moana没有Elsa好看。主题上，我更爱Moana。我爱自由。回想一下，我想不起Frozen的
主题是什么。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0103639/?ref_=nv_sr_2">Aladdin (1992) - IMDb</a></p>
<p>我喜欢这样的动画片。有种韩剧的感觉。吊丝逆袭，轻松撩妹，开着飞毯带女神看世界
，简直就是精神鸦片。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0317705/?ref_=nv_sr_3">The Incredibles (2004) - IMDb</a></p>
<p>很多年前的片子，现在瞅还是这样好瞅。当然，这种曰法是有问题的。在这种金钱至上
，文化不被重视的年代，老片更是好瞅是明显要发生的事情。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1790809/?ref_=fn_al_tt_2">Pirates of the Caribbean: Dead Men Tell No Tales (2017) - IMDb</a></p>
<p>应该是当年出来的时候就瞅过罢，但是已经完全想不起罢。不知道是片的质量就是下降
了，还是自己变罢，片瞅以无以前有感觉。大爱Elizabeth Swann都已经没出场，舞台交
给了年轻的一代。瞅电影的，也已经变成了年轻的一代。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt8020896/?ref_=nv_sr_1">An Elephant Sitting Still (2018) - IMDb</a></p>
<p>整个片的基调跟我很能产生共鸣，片里的人物的状态，我感觉我就是生活在一个这种的
状态。活着很难受。不知道活着干什么，也不知道为什么不去死。<br />
几日之后，我头脑里还是经常想起这部片子。想那头一直坐着的大象，有人打它，它就
是一直在那里坐着。我也想死。人生真的太无趣，太苦，太不像一个人，称为人该有的
样子，该有的生活。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5095030/?ref_=nv_sr_1">Ant-Man and the Wasp (2018) - IMDb</a></p>
<p>对大小的表现很好。只不过很多想像力的东西能感觉到无办法超越这个世界的经验。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt9130692/?ref_=fn_al_tt_1">Dynasties (TV Series 2018– ) - IMDb</a></p>
<p>和<strong>Planet Earth II</strong>无法比的。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt5491994/?ref_=nv_sr_2">Planet Earth II (TV Mini-Series 2016) - IMDb</a></p>
<p>非常壮观，很美很美很美，观得一瞅的好片。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0234215/?ref_=tt_rec_tt">The Matrix Reloaded (2003) - IMDb</a></p>
<p>影片流进一种宿命论的东西，无法曰对错，从观影的角度，就变得无什么意思。导演肯
定是一个武术爱好者了，动不动就武打场面其实都蛮乏味的。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0133093/?ref_=fn_al_tt_1">The Matrix (1999) - IMDb</a></p>
<p>绝对的非常精彩的电影，虽然有些时候主角光环实在太夸张。我都希望女主fall in love
with me.</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2709692/?ref_=fn_al_tt_1">The Grinch (2018) - IMDb</a></p>
<p>让人反感的开场，水准不高的画，故事性都一般。一个孤独的老人，因为讨厌Christmas,
偷走全村的Christmas,最终被一个小女孩感化。我不推荐。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2294629/?ref_=fn_al_tt_1">Frozen (2013) - IMDb</a></p>
<p>好美啊</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1477834/?ref_=nv_sr_1">Aquaman (2018) - IMDb</a></p>
<p>好像是又一个私生子成王的故事。电影里出现很多王国，很多地方，所以最大的感受就是
视觉上面很享受。Amber Heard 很美。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt4701182/?ref_=fn_al_tt_1">Bumblebee (2018) - IMDb</a></p>
<p>大砍刀，激光炮，没有魔法的科幻片，再酷炫都只能做到机械化的炫目层面。所以，变形
金钢的设定，注定瞅点只有一末变形而已，就算你注入幽默，情感，天花板在那里。</p>
</li>
</ul>
<h1><a class="header" href="#2018" id="2018">2018</a></h1>
<ul>
<li>
<p><a href="https://www.imdb.com/title/tt9495224/?ref_=nv_sr_2">Black Mirror: Bandersnatch (2018) - IMDb</a></p>
<p>不浪费时间罢, 事实我是气愤的，被这样的东西浪费时间</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt0051776/?ref_=nv_sr_1">The Inn of the Sixth Happiness (1958) - IMDb</a></p>
<p>很有功底的电影。很有感染力。讲的是一个英国姑娘在支国羊城，帮助人的故事。按支国
的语言来曰，是一个活菩萨的故事。老电影的山水景，每每都使我感动。那时候的自然山
水，现在再都瞅不得罢，不免伤感。有历史的事物，都容易触发人去思考生命跟生命的意
义。电影里有几个东西是瞅光我还是会有印象的。一个是省长（瞅的是英文字幕，不确定
不是这个意思）曰的，计划好的人生是死的。另外一个，这时已经忘记罢。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7040874/?ref_=nv_sr_1">A Simple Favor (2018) - IMDb</a></p>
<p>不是怎么感兴趣的题材，如果不是女主漂亮，瞅都瞅不光。</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2388771/">Mowgli: Legend of the Jungle (2018) - IMDb</a></p>
<p>讲的是一个被狼养大的娃娃，最终成王为森林带来和平的故事, 也算垃圾电影，但是比国
产电影已经好的不知道到哪里去罢</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/1293351/">食神 (豆瓣)</a></p>
<p>怀旧 以前读书的时候真的欢喜周星驰 这时罢 周星驰老罢 我都老罢 </p>
<p>是一个关于食神 实力反杀的故事 是典型的大圆满结尾的电影： 恶人陷害 奇迹发生 打
得坏人满地找牙 穿插么搞笑 爱情 观众不要太欢喜 </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt2277860/">Finding Dory (2016) - IMDb</a></p>
<p>蛮可爱的动画片 推荐大人瞅的 但是对于这种完全否真实的动画片给儿童瞅 对儿童是好
啊坏呢</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/1422283/">高山下的花环 (豆瓣)</a></p>
<p>好片当然是好片 只不过我这样的肤浅的人看不进去 1个钟头40分钟前我都弗知道瞅么东
西 都想弗瞅罢 有法曰 从这个时间才会开始正题 都就是曰 铺垫太多时 对我来曰 导演
想反映个东西 都否是什么深刻的东西 不过还是有法瞅瞅</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt6257174/?ref_=nv_sr_1">The Miseducation of Cameron Post (2018) - IMDb</a></p>
<p>一个文艺片 片的风格是我喜欢的 讲的是一个要把弯的教直起的故事 女主角很美 文艺片
有一个共同的特点 东拉西扯 瞅光都弗知道到底曰么东西 不过你还是愿意瞅着瞅光</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt1270797/?ref_=fn_al_tt_1">Venom (2018) - IMDb</a></p>
<p>垃圾电影。是一部典型的英雄打坏蛋的故事。英雄的出现太假。英雄的渲染失败 故事情
节设计太单薄 坏人的设计也就是一句是组织头目囤么很多武器 而你瞅得的武器也就是两
把斧头 很轻松的就被打败罢 整个电影里向都否瞅得有什么情感 不知道要曰么东西 </p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3104988/?ref_=nv_sr_1">Crazy Rich Asians (2018) - IMDb</a></p>
<p>王子跟灰姑娘的故事 遇得么小困难 最末尾在一堆 么什么瞅头</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3606756/?ref_=fn_al_tt_1">Incredibles 2 (2018) - IMDb</a></p>
<p>Make Superheroes legal again! 非常精彩！比什么碟中碟好看多了</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/1297880/">芙蓉镇 (豆瓣)</a></p>
<p>“活下去，像牲口一样的活下去〞</p>
<p>其实才发生不久的事情，人们却觉得这些很遥远</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt7668870/?ref_=fn_al_tt_1">Searching (2018) - IMDb</a></p>
<p>很棒的电影 非常独特的方式讲述一个爸爸通过在网络里寻找线索 寻找失踪女儿 并最终
找到了的故事 情节跌宕起伏 感情也很饱满</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/26425063/?from=showing">无双</a></p>
<p>运用了一点反转的手法 讲述了一个轻松做假钞的故事 太多元素杂烩在一起 就是一个消
磨时间的故事片</p>
</li>
<li>
<p><a href="https://www.imdb.com/title/tt3208026/">Black '47 (2018) - IMDb</a></p>
<p>他们杀人是审判 凭什么我们杀人是谋杀</p>
<p>讲述一个走到哪里 杀到哪里的故事</p>
</li>
</ul>
<p>a</p>
<h1><a class="header" href="#eulers-totient-function" id="eulers-totient-function">Euler's totient function</a></h1>
<h1><a class="header" href="#links-46" id="links-46">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Euler&#x27;s_totient_function">Euler's totient function - Wikipedia</a></li>
</ul>
<h1><a class="header" href="#eulers-product-formula" id="eulers-product-formula">Euler's product formula</a></h1>
<p><img src="math/img/euler_product_formula.svg" alt="euler_product_formula" /></p>
<p><img src="math/img/epf.svg" alt="epf" /></p>
<p>where the product is over the distinct prime numbers dividing n.</p>
<p>The proof of Euler's product formula depends on two important facts. </p>
<p><strong>The function is multiplicative</strong></p>
<p>This means that if gcd(m, n) = 1, then φ(mn) = φ(m) φ(n). </p>
<p><strong>Value for a prime power argument</strong></p>
<p>If p is prime and k ≥ 1, then </p>
<p><img src="math/img/value_for_a_prime_power_argument.svg" alt="value" /></p>
<p>Proof: since p is a prime number the only possible values of gcd(p^k, m) are 1,
p, p^2, ..., p^k, and the only way for gcd(p^k, m) to not equal 1 is for m to be
a multiple of p. The multiples of p that are less than or equal to p^k are p,
2p, 3p, ..., p^(k − 1)p = p^k, and there are p^(k − 1) of them. Therefore, the other
p^k − p^(k − 1) numbers are all relatively prime to p^k. </p>
<p>上面这个很有意思，为了找得gcd(p^k,m)=1，m的个数。转换成去找gcd(p^k,m) != 1,m的个数
，这时m MUST= x * p，这个个数有p^(k-1)个, p^k - p^(k-1)就是俺要的gcd(p^k,m)=1的
m的个数</p>
<p><strong>Example</strong></p>
<p><img src="math/img/epf.eg.svg" alt="alt" /></p>
<p>In words, this says that the distinct prime factors of 36 are 2 and 3; half of
the thirty-six integers from 1 to 36 are divisible by 2, leaving eighteen;
a third of those are divisible by 3, leaving twelve numbers that are coprime to 36.
And indeed there are twelve positive integers that are coprime with 36 and
lower than 36: 1, 5, 7, 11, 13, 17, 19, 23, 25, 29, 31, and 35. </p>
<h1><a class="header" href="#vim" id="vim">VIM</a></h1>
<h1><a class="header" href="#block-insert-and-change-text" id="block-insert-and-change-text">Block Insert and Change text</a></h1>
<p>Insert/Change/Replace: </p>
<pre><code>CTRL-V -&gt; {motion} -&gt; I/c/r -&gt; Ctrl-[
</code></pre>
<h1><a class="header" href="#multiple-change" id="multiple-change">Multiple Change</a></h1>
<ul>
<li>Search it with '/' or '*' or any search method</li>
<li>Change word with gn motion. e.g. cgnfoo<esc></li>
<li>Repeat via . command</li>
</ul>
<h1><a class="header" href="#vim-takes-a-very-long-time-to-start-up" id="vim-takes-a-very-long-time-to-start-up">vim takes a very long time to start up</a></h1>
<p>First, try running Vim with the following command: <code>vim -X</code></p>
<p>If <code>-X</code> helps, you can get the same effect by adding the following line to your
vimrc file:</p>
<p><code>set clipboard=exclude:.*</code></p>
<h1><a class="header" href="#turning-off-auto-indent-when-pasting-text-into-vim" id="turning-off-auto-indent-when-pasting-text-into-vim">Turning off auto indent when pasting text into vim</a></h1>
<p><code>set paste</code></p>
<ul>
<li><a href="https://stackoverflow.com/questions/2514445/turning-off-auto-indent-when-pasting-text-into-vim">configuration - Turning off auto indent when pasting text into vim - Stack
Overflow</a></li>
</ul>
<pre><code class="language-vim">Mac users can avoid auto formatting by reading directly from the pasteboard
with:

:r !pbpaste

// linux
:r !xsel -p
</code></pre>
<h1><a class="header" href="#vim-1" id="vim-1">vim</a></h1>
<h1><a class="header" href="#helptxt" id="helptxt">help.txt</a></h1>
<pre><code>gO: to see the table of contets

ctrl-]/ctrl-t|ctrl-o 		jump to a subject 
:help word then hit ctrl-d = :helpgrep word
</code></pre>
<h1><a class="header" href="#what-default-key-bind-i-never-used" id="what-default-key-bind-i-never-used">what default key bind I never used</a></h1>
<ul>
<li>
<p>Insert mode</p>
</li>
<li>
<p>Normal mode</p>
</li>
</ul>
<pre><code>ctrl-h same as h
ctrl-j same as j
ctrl-n same as j
ctrl-p same as k
space same as l
</code></pre>
<h1><a class="header" href="#windowstxt" id="windowstxt">windows.txt</a></h1>
<h1><a class="header" href="#tabpagetxt" id="tabpagetxt">tabpage.txt</a></h1>
<pre><code>:tabe : tabedit :tabnew 
	Open a new tab page with an empty window, after the current tab page.

:tabf :tabfind
	OPen a new tab page and edit {file} in 'path'

ctrl-w gf	Open a new tab page and edit the file name under the cursor.

:tabc :tabclose		&quot; close the current tab page	
:tabo :tabonly		&quot; close all tab pages except the current one
:tabn :tabnext gt	&quot; Go to the next tab page.
:tabp :tabN gT		&quot; Go to the previous tab page.
:tabr :tabrewind :tabfir :tabfirst	&quot; Go to the first tab page.
:tabl :tablast				&quot; Go to the last tab page.
:tabs		&quot; List the tab pages and the windows they contain.
:tabm
:tabd :tabdo	&quot; Execute {cmd} in each tab page
</code></pre>
<h1><a class="header" href="#tagsrchtxt" id="tagsrchtxt">tagsrch.txt</a></h1>
<pre><code>ctrl-t		Jump to older entry in the tag stack
:po :pop	Jump to older entry in tag stack
:ta :tag	Jump to newer entry in tag stack
:tags		Show the contents of th etag stack
:ts :tselect [name]	List the tags that match [name], using the information in the tags file.
sts :stselect		Does :tselect and splits the window for the selected tag.
</code></pre>
<h1><a class="header" href="#startingtxt" id="startingtxt">starting.txt</a></h1>
<pre><code>-R	Readonly mode.

2. Initialization

	The Nvim config file is named &quot;init.vim&quot;, located at:
		Unix		~/.config/nvim/init.vim
		Windows		~/AppData/Local/nvim/init.vim
	Or if |$XDG_CONFIG_HOME| is defined:
				$XDG_CONFIG_HOME/nvim/init.vim

The $XDG_CONFIG_HOME and $XDG_DATA_HOME environment variables are used if they
exist, otherwise default values (listed below) are used.

CONFIG DIRECTORY (DEFAULT) ~
                  *$XDG_CONFIG_HOME*            Nvim: stdpath(&quot;config&quot;)
    Unix:         ~/.config                   ~/.config/nvim
    Windows:      ~/AppData/Local             ~/AppData/Local/nvim

DATA DIRECTORY (DEFAULT) ~
                  *$XDG_DATA_HOME*              Nvim: stdpath(&quot;data&quot;)
    Unix:         ~/.local/share              ~/.local/share/nvim
    Windows:      ~/AppData/Local             ~/AppData/Local/nvim-data

Note: Throughout the user manual these defaults are used as placeholders, e.g.
&quot;~/.config&quot; is understood to mean &quot;$XDG_CONFIG_HOME or ~/.config&quot;.
</code></pre>
<h1><a class="header" href="#editingtxt" id="editingtxt">editing.txt</a></h1>
<pre><code>ctrl-g		Prints the current file name
g ctrl-g	Prints the current position of the cursor in file ways
:f {name}	Sets the current file name to {name}.
:0f		Remove the name of the current buffer.
:ls 		List all the currently known file names.
:e		Eedit the current file.
:e!		Edit the current file always.
:e {file} :e #[count]
:fin {file}	Find {file} in 'path' and then :edit it.

fileformat: unix, mac, dos

change file format:

:e file
:set fileformat=unix
:w

:n 		Edit next file.
:N :prev	Edit previous file
:rew :fir	Start editing the first file in the argument list.
:la :last	Start editing the last file in the argument list.
:wn	Write current file and start editing the next file.
:wN
:wp
:wa :wall	Write all changed buffers.
ZZ		Write current file, if modified and quit. ( same as &quot;:x&quot; ).
ZQ		Quit without checking for changes ( same as &quot;:q!&quot; ).

:cd		Change the current directory to the home directory
:pwd		Print the current directory on all systems.
:cd -		Change to the previous current directory.
</code></pre>
<h1><a class="header" href="#motiontxt" id="motiontxt">motion.txt</a></h1>
<pre><code>c	change
d	delete
y	yank
~ g~	swap case
gu	lowercase
gU	uppercase
gq	text formatting
g?	ROT13 encoding
&gt;	shift right
&lt;	shift left
zf	define a fold	多行会重叠起的

f/F{char}	To occurrence of {char} to the right/left.
t{char}	Till before [count]'th occurrence of {char} to the right.
T{char}	Till after [count]'th occurrence of {char} to the left.

; Repeat latest f, t, F or T
, Repeat latest f, t, F or T in opposite direction [count] times.

%	Go to {count percentage in the file.

(	[count] sentences backward.
)	[count] sentences forward.
{	[count] paragraphs backward.
}	[count] paragraphs forward.
]]	[count] sections forward or to the next '{' in the first column.
][	[count] sections forward or to the next '}' in the first column.
[[	[count] sections backward or to the previous '{' in the first column.
[]	[count] sections backward or to the previous '}' in the first column.

7. Marks

Jumping to a mark can be done in two ways:
1. With ` (backtick):	  The cursor is positioned at the specified location
			  and the motion is |exclusive|.
2. With ' (single quote): The cursor is positioned on the first non-blank
			  character in the line of the specified location and
			  the motion is linewise.

m{a-zA-Z}		Set mark at cursor position
m' or m`		Set the previous context mark.
m[ or m]		Set the '[ or ']mark. Useful when an operator is to be 
			simulated by multiple commands.
m&lt; or m&gt;		Set the '&lt; or '&gt; mark. Useful to change what the
			gv command selects.  做这2个标记后，gv就有法选中这块
:marks			List all the current marks.

8. Jumps

ctrl-o			Go to [count] Older cursor position in jump list
ctrl-i &lt;Tab&gt;		Go to [count] newer cursor position in jump list
:ju			Print the jump list
:cle			Clear the jump list of the current window.

g;			Go to [count] older position in change list
g,			Go to [count] newer cursor position in change list
:changes		Print the change list

9. Various motions

%			Find the next item in this line after or under the cursor and jump to its match.
</code></pre>
<h1><a class="header" href="#inserttxt" id="inserttxt">insert.txt</a></h1>
<pre><code>ctrl-a			Insert previously inserted text and stop insert.
ctrl-h &lt;BS&gt;		Delete the character before the cursor.
ctrl-w			Delete the word before the cursor
ctrl-u			Delete all entered characters before the cursor in the current line.
ctrl-i &lt;Tab&gt;		Insert a tab.
ctrl-j &lt;NL&gt;		Begin new line.
ctrl-m &lt;CR&gt;		Begin new line.
ctrl-n			Find next keyword
ctrp-p			Find previous keyword
ctrl-r			Intesert the contents of a register
ctrl-t			Insert one shiftwidth of indent at the start of the current line.
ctrl-d			Delete on shiftwidth of indent at the start of the current line.
0 ctrl-d		Delete all indent in the current line.
^ ctrl-d		Delete all indent in the current line. The indent is restored in the next line.
ctrl-v			Insert next non-digit literally.
ctrl-e			Insert the character which is below the cursor.
ctrl-y			Insert the character which is ablove the cursor.
ctrl-]			Trigger abbreviation.

7. Insert mode completion

ctr-x ctrl-l		Whole lines
ctr-x ctrl-n		Keywords in the current file
...
</code></pre>
<h1><a class="header" href="#plugins" id="plugins">Plugins</a></h1>
<h1><a class="header" href="#links-47" id="links-47">Links</a></h1>
<h1><a class="header" href="#vim-easy-align" id="vim-easy-align">vim-easy-align</a></h1>
<p><a href="https://github.com/junegunn/vim-easy-align">junegunn/vim-easy-align: A Vim alignment plugin</a></p>
<h1><a class="header" href="#automatic-input-method-switching-for-vim" id="automatic-input-method-switching-for-vim">Automatic input method switching for vim</a></h1>
<ul>
<li><a href="https://github.com/lyokha/vim-xkbswitch">lyokha/vim-xkbswitch: vim plugin for automatic keyboard layout switching in insert mode</a><br />
// Mac</li>
<li><a href="https://github.com/vovkasm/input-source-switcher">vovkasm/input-source-switcher: Command line input source switcher for Mac.</a><br />
// linux</li>
<li><a href="https://github.com/ierton/xkb-switch">GitHub - ierton/xkb-switch: Switch your X keyboard layouts from the command line</a></li>
</ul>
<h1><a class="header" href="#color" id="color">Color</a></h1>
<ul>
<li><a href="http://colorswat.ch/vim/list?o=updated_at">colorwat.sh</a></li>
<li><a href="https://github.com/cocopon/iceberg.vim">cocopon/iceberg.vim: Dark blue color scheme for Vim and Neovim</a></li>
<li><a href="https://terminal.sexy/">terminal.sexy - Terminal Color Scheme Designer</a></li>
</ul>
<h1><a class="header" href="#test-python-support" id="test-python-support">Test Python Support</a></h1>
<p>If <code>:echo has(&quot;python3&quot;)</code> returns <code>1</code>, then you have python 3 support; </p>
<h1><a class="header" href="#find" id="find">Find</a></h1>
<ul>
<li><a href="https://github.com/junegunn/fzf">junegunn/fzf: A command-line fuzzy finder</a></li>
</ul>
<p>同类的还有LeaderF, skim</p>
<p>deprecated: ctrip</p>
<h1><a class="header" href="#regexp" id="regexp">Regexp</a></h1>
<ul>
<li><a href="https://github.com/BurntSushi/ripgrep">BurntSushi/ripgrep: ripgrep recursively searches directories for a regex pattern</a></li>
</ul>
<pre><code class="language-sh">brew install ripgrep

$ sudo yum-config-manager --add-repo=https://copr.fedorainfracloud.org/coprs/carlwgeorge/ripgrep/repo/epel-7/carlwgeorge-ripgrep-epel-7.repo
$ sudo yum install ripgrep

$ sudo apt-get install ripgrep
</code></pre>
<p>deprecated: ack</p>
<h1><a class="header" href="#miscellany" id="miscellany">Miscellany</a></h1>
<ul>
<li>
<p><a href="https://github.com/vim-airline/vim-airline">vim-airline/vim-airline: lean &amp; mean status/tabline for vim that's light as air</a></p>
</li>
<li>
<p><a href="https://github.com/majutsushi/tagbar">majutsushi/tagbar: Vim plugin that displays tags in a window, ordered by scope</a></p>
</li>
<li>
<p><a href="https://github.com/plasticboy/vim-markdown">vim-markdown</a> </p>
<ul>
<li>zr: reduces fold level throughout the buffer</li>
<li>zR: opens all folds</li>
</ul>
<p>vim-markdown automatically insert the indent. By default, the number of spaces of indent is 4. If you'd like to change the number as 0, just write:</p>
<p><code>let g:vim_markdown_new_list_item_indent = 0</code></p>
</li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgithubcomjunegunnvim-pluggithub---junegunnvim-plug-minimalist-vim-plugin-managera" id="a-hrefhttpsgithubcomjunegunnvim-pluggithub---junegunnvim-plug-minimalist-vim-plugin-managera"><a href="https://github.com/junegunn/vim-plug">GitHub - junegunn/vim-plug: Minimalist Vim Plugin Manager</a></a></h1>
<h1><a class="header" href="#links-48" id="links-48">Links</a></h1>
<h1><a class="header" href="#basis" id="basis">Basis</a></h1>
<pre><code>PlugUpdate 
PlugClean
</code></pre>
<h1><a class="header" href="#tables" id="tables">Tables</a></h1>
<h1><a class="header" href="#links-49" id="links-49">Links</a></h1>
<h1><a class="header" href="#align-markdown-tables" id="align-markdown-tables">Align Markdown Tables</a></h1>
<ul>
<li><a href="https://github.com/junegunn/vim-easy-align#aligning-table-cells">GitHub - junegunn/vim-easy-align: A Vim alignment plugin</a></li>
</ul>
<h1><a class="header" href="#rfc-tables" id="rfc-tables">RFC Tables</a></h1>
<ul>
<li><a href="https://github.com/dhruvasagar/vim-table-mode">GitHub - dhruvasagar/vim-table-mode: VIM Table Mode for instant table creation.</a></li>
</ul>
<h1><a class="header" href="#automatic-pair-insertion" id="automatic-pair-insertion">Automatic pair insertion</a></h1>
<h1><a class="header" href="#links-50" id="links-50">Links</a></h1>
<ul>
<li><a href="https://www.reddit.com/r/vim/comments/3wggs8/workflow_question_automatic_pair_insertion/">Workflow question: automatic pair insertion : vim</a> </li>
</ul>
<h1><a class="header" href="#overview-2" id="overview-2">Overview</a></h1>
<ul>
<li>
<p><a href="https://github.com/jiangmiao/auto-pairs">GitHub - jiangmiao/auto-pairs: Vim plugin, insert or delete brackets, parens, quotes in pair</a></p>
<p>Don't like this one, the readme is awful.</p>
</li>
<li>
<p><a href="https://github.com/cohama/lexima.vim">GitHub - cohama/lexima.vim: Auto close parentheses and repeat by dot dot dot...</a></p>
<p>Not good. a little stupid. It always input the pairs.</p>
</li>
<li>
<p><a href="https://github.com/Raimondi/delimitMate">GitHub - Raimondi/delimitMate: Vim plugin, provides insert mode auto-completion for quotes, parens, brackets, etc.</a></p>
<p>I choose this one.</p>
</li>
</ul>
<h1><a class="header" href="#others" id="others">Others</a></h1>
<p>From <a href="https://www.reddit.com/r/vim/comments/3wggs8/workflow_question_automatic_pair_insertion/cy04nk2?utm_source=share&amp;utm_medium=web2x">Workflow question: automatic pair insertion : vim</a></p>
<pre><code class="language-zsh"> % cat ~/.config/nvim/UltiSnips/autopair.snippets
snippet ((
      (${1:inner_text})${0}
snippet )) Parens with leader
      ${1}(${2:inner_text})${0}
</code></pre>
<p>Doesn't how to make this work. </p>
<h1><a class="header" href="#a-hrefhttpsgithubcomsirverultisnipsultisnipsa" id="a-hrefhttpsgithubcomsirverultisnipsultisnipsa"><a href="https://github.com/SirVer/ultisnips">Ultisnips</a></a></h1>
<h1><a class="header" href="#links-51" id="links-51">Links</a></h1>
<ul>
<li><a href="https://github.com/honza/vim-snippets/tree/master/UltiSnips">vim-snippets/UltiSnips at master · honza/vim-snippets · GitHub</a> </li>
</ul>
<h1><a class="header" href="#basis-1" id="basis-1">Basis</a></h1>
<p>A snippet looks like the following:</p>
<pre><code>snippet KEYWORD &quot;some description&quot;

snippet body...

endsnippet
</code></pre>
<h1><a class="header" href="#fzf" id="fzf">fzf</a></h1>
<h1><a class="header" href="#links-52" id="links-52">Links</a></h1>
<ul>
<li><a href="https://github.com/junegunn/fzf.vim">junegunn/fzf.vim: fzf vim</a></li>
<li><a href="https://github.com/junegunn/fzf.vim#commands">Commands</a></li>
<li><a href="https://github.com/BurntSushi/ripgrep">BurntSushi/ripgrep: ripgrep recursively searches directories for a regex pattern</a></li>
</ul>
<h1><a class="header" href="#search-and-jump" id="search-and-jump">Search and Jump</a></h1>
<ul>
<li><a href="https://www.freecodecamp.org/news/fzf-a-command-line-fuzzy-finder-missing-demo-a7de312403ff/">Why you should be using fzf, the command line fuzzy finder</a></li>
</ul>
<h1><a class="header" href="#asynchronous-lint-engine" id="asynchronous-lint-engine">Asynchronous Lint Engine</a></h1>
<h1><a class="header" href="#links-53" id="links-53">Links</a></h1>
<ul>
<li><a href="https://github.com/dense-analysis/ale">GitHub - dense-analysis/ale</a></li>
</ul>
<h1><a class="header" href="#golang" id="golang">golang</a></h1>
<p>must config this, default doesn't use <code>gopls</code>:</p>
<pre><code>let g:ale_linters_explicit = 1
let g:ale_linters = {
\   'go': ['gopls'],
\}
</code></pre>
<p>terminal</p>
<h1><a class="header" href="#tmux" id="tmux">tmux</a></h1>
<h1><a class="header" href="#links-54" id="links-54">Links</a></h1>
<ul>
<li><a href="https://hackernoon.com/a-gentle-introduction-to-tmux-8d784c404340">A Gentle Introduction to tmux – Hacker Noon</a></li>
<li><a href="https://github.com/tmux/tmux/wiki">Home · tmux/tmux Wiki</a></li>
<li><a href="https://thoughtbot.com/upcase/tmux">Learn tmux | Terminal Multiplexer Tutorials by thoughtbot</a></li>
<li><a href="https://www.reddit.com/r/tmux/comments/4a1694/whats_your_prefix_key/">What's your prefix key? : tmux</a></li>
</ul>
<h1><a class="header" href="#install-11" id="install-11">Install</a></h1>
<pre><code>// MacOS
brew install tmux
</code></pre>
<h1><a class="header" href="#basic-3" id="basic-3">Basic</a></h1>
<pre><code>Prefix: ctrl-b

tmux new
prefix d		detach tmux
prefix ?		help


tmux ls		list sessions
tmux attach-session -t 3
tmux a #	attach the last session

// panes

tmux new -s {name}	start a new session with a specific name
tmux a -t {name}	attach a session by using the name

prefix &quot;		split a pane horizontally
prefix %		split a pane vertically
prefix o		Cycle through panes
prefix ;		Cycle between previous and current
prefix x		Kill current pane
prefix z		make a pane full screen, hit again to shrink it back to it's previous size

prefix :resize-pane -U/D/L/R {count} 	resize-pane up/down/left/right {count} lines

// windows

prefix c		create a new window
prefix {num}		Switch to window {num}
prefix ,		rename current window

tmux kill-server	kill tmux server, along with all sessions.
</code></pre>
<h1><a class="header" href="#configuration-1" id="configuration-1">Configuration</a></h1>
<p>file: <code>.tmux.conf</code></p>
<p>load config: <code>prefix :source-file .config/tmux/tmux.conf</code></p>
<pre><code># remap prefix from 'C-b' to 'C-a'
unbind C-b
set-option -g prefix C-g
bind-key C-g send-prefix

# Start window numbering at 1
set -g base-index 1
</code></pre>
<h1><a class="header" href="#tpm" id="tpm">TPM</a></h1>
<p><a href="https://github.com/tmux-plugins/tpm">GitHub - tmux-plugins/tpm: Tmux Plugin Manager</a></p>
<p>Install</p>
<pre><code>git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

prefix + I 		// Install plugin
prefix + U 		// Update plugin

# type this in terminal if tmux is already running
tmux source ~/.tmux.conf
</code></pre>
<h1><a class="header" href="#reorder-tmux-window" id="reorder-tmux-window">reorder tmux window</a></h1>
<ul>
<li><a href="https://superuser.com/questions/343572/how-do-i-reorder-tmux-windows">How do I reorder tmux windows? - Super User</a></li>
</ul>
<p>to let window number 3 and window number 1 swap their positions:</p>
<pre><code class="language-go">swap-window -s 3 -t 1
</code></pre>
<p>`</p>
<h1><a class="header" href="#iterm2" id="iterm2">iTerm2</a></h1>
<h1><a class="header" href="#links-55" id="links-55">Links</a></h1>
<ul>
<li><a href="https://github.com/mbadolato/iTerm2-Color-Schemes">mbadolato/iTerm2-Color-Schemes: Over 200 terminal color schemes/themes for iTerm/iTerm2. Includes ports to Terminal, Konsole, PuTTY, Xresources, XRDB, Remina, Termite, XFCE, Tilda, FreeBSD VT, Terminator, Kitty, MobaXterm, LXTerminal, compatible with Microsoft's terminal</a></li>
</ul>
<h1><a class="header" href="#color-1" id="color-1">Color</a></h1>
<ul>
<li>https://raw.githubusercontent.com/mbadolato/iTerm2-Color-Schemes/master/schemes/BlulocoDark.itermcolors</li>
</ul>
<h1><a class="header" href="#字体" id="字体">字体</a></h1>
<p>分辩率允许的情况,锋体字是我的首选.低分辩率的情况,就只好选择黑体.</p>
<h2><a class="header" href="#字体选择" id="字体选择">字体选择</a></h2>
<p>目前来看,方正博雅宋是我最喜欢的中文字体.<br />
monaco是我最喜欢的終端显示字体.</p>
<p>使用字符串<code>Illegal1 = O0</code>观察字体是否适合用作终端字体.</p>
<h3><a class="header" href="#西文字体" id="西文字体">西文字体</a></h3>
<p>mono:monaco<br />
sans-serif:Helvetica Neue LT Std<br />
Serif:Swift</p>
<h3><a class="header" href="#中文字体" id="中文字体">中文字体</a></h3>
<p>等宽字体:X<br />
无锋字体:汉仪旗黑<br />
有锋字体:方正博雅宋</p>
<h2><a class="header" href="#字体介绍" id="字体介绍">字体介绍</a></h2>
<h3><a class="header" href="#宋体" id="宋体">宋体</a></h3>
<p><a href="https://zh.wikipedia.org/wiki/%E6%8A%A5%E5%AE%8B">维基</a>上介绍:</p>
<p>报宋是中国大陆报纸正文普遍采用的宋体。第一代报宋于1964年设计完成，1997年、2004年北大方正又相继推出了第二代“新报宋”，第三代“兰亭宋”与“博雅宋”。</p>
<p>2004年，北大方正开发了第三代报宋字体，分为“兰亭宋”、“博雅宋”两款，由朱志伟等设计完成。[7]其中“兰亭宋”基于传统字体设计理念，笔型柔和舒畅，融入了传统楷书韵味，腰身紧而重心略偏高，追求秀丽的文字效果。[8]“博雅宋”的特点则包括中宫放松，字形略扁以利视线流动，同时笔画适当加粗，加强视觉张力。</p>
<h1><a class="header" href="#firacode" id="firacode">firacode</a></h1>
<h1><a class="header" href="#links-56" id="links-56">Links</a></h1>
<ul>
<li><a href="https://github.com/tonsky/FiraCode/">GitHub - tonsky/FiraCode: Monospaced font with programming ligatures</a></li>
</ul>
<h1><a class="header" href="#install-12" id="install-12">Install</a></h1>
<ul>
<li><a href="https://github.com/tonsky/FiraCode/releases">Releases · tonsky/FiraCode · GitHub</a></li>
</ul>
<pre><code>brew cask install font-fira-code
</code></pre>
<h1><a class="header" href="#getting-apples-sf-mono-font" id="getting-apples-sf-mono-font">Getting Apple’s SF Mono Font</a></h1>
<h1><a class="header" href="#links-57" id="links-57">Links</a></h1>
<ul>
<li><a href="https://medium.com/@shashikant.jagtap/getting-apples-sf-mono-font-in-macos-1de5183add84">Getting Apple’s SF Mono Font in macOS – Shashikant Jagtap – Medium</a></li>
</ul>
<pre><code class="language-sh">cd /Applications/Utilities/Terminal.app/Contents/Resources/Fonts/
cp *.otf ~/Library/Fonts/
</code></pre>
<h1><a class="header" href="#fontconfig" id="fontconfig">fontconfig</a></h1>
<h2><a class="header" href="#字体安装" id="字体安装">字体安装</a></h2>
<p>全局目录<code>/usr/share/fonts/</code>用户目录<code>~/.local/share/fonts/</code><br />
字体文件的权限至少要对所有用户可读.<br />
使用命令<code>fc-cache</code>更新字体缓存.</p>
<h2><a class="header" href="#疑问" id="疑问">疑问</a></h2>
<ol>
<li>如果默认字体不支持中文，字体怎么匹配？<br />
就会匹配另一个支持中文的字体，如果匹配不到，就显示乱码了。</li>
<li>如果默认字体支持中文，那么自然也支持英文，怎么使英文用更好看的英文字体匹配？<br />
让英文字体的模式在前面。</li>
</ol>
<h2><a class="header" href="#字体调试" id="字体调试">字体调试</a></h2>
<p>在浏览器地址栏里输入这个测试:</p>
<pre><code>data:text/html,&lt;meta charset=&quot;utf8&quot;&gt;&lt;p style=&quot;font-family: monospace;&quot;&gt;☺&lt;/p&gt;
</code></pre>
<pre><code>&lt;match target=&quot;目标&quot;&gt;
    &lt;match&gt;必须首先包含一系列&lt;test&gt;组成的列表(可以为空)，然后再包含一系列&lt;edit&gt;组成的列表(可以为空)，
    也就是&lt;test&gt;列表必须位于&lt;edit&gt;列表之前。注意：虽然两个列表都可以为空，但是不可以同时为空。
    如果&quot;目标&quot;满足&lt;test&gt;列表的所有测试条件，那么将被按照&lt;edit&gt;列表中的指令序列进行修改。
    &quot;目标&quot;的默认值是&quot;pattern&quot;，表示此&lt;match&gt;单元针对的是用于匹配的字体模板(第一次修改)。
    如果&quot;目标&quot;的值是&quot;font&quot;，那么就表示此&lt;match&gt;单元针对的是已被选定的字体(第二次修改)。
    如果&quot;目标&quot;的值是&quot;scan&quot;，那么就表示此&lt;match&gt;单元针对的是扫描字体以创建内部配置数据的初始化阶段(FcConfigParse)。

为了帮助诊断字体和应用的各种问题，fontconfig 内置了许多调试功能。这些调试功能可以通过 FC_DEBUG 环境变量进行控制。
这个环境变量是个整数值，它的每个位都对应着一类调试信息。具体如下：

  Name         Value    Meaning
  ---------------------------------------------------------
  MATCH            1    显示字体匹配的简要信息
  MATCHV           2    显示字体匹配的扩展信息
  EDIT             4    监视 match/test/edit 的执行
  FONTSET          8    在启动时跟踪字体信息的加载
  CACHE           16    显示字体缓存变化的简要信息
  CACHEV          32    显示字体缓存变化的扩展信息
  PARSE           64    (已废弃)
  SCAN           128    显示扫描字体文件并创建缓存的过程
  SCANV          256    显示扫描字体文件的详细信息
  MEMORY         512    监视 fontconfig 的内存使用量
  CONFIG        1024    监视加载了哪些配置文件
  LANGSET       2048    显示用来创建 lang 的字符集
  OBJTYPES      4096    显示值类型检查失败的消息

将你期望看到的调试信息类别所对应的 Value 值相加，然后赋给 FC_DEBUG 环境变量，再运行应用程序就可以在 stdout 上看到调试信息了。
[例子]假如你想查看'Courier,mono'的匹配过程，可以在命令行上运行： FC_DEBUG=5 fc-match -s 'Courier,mono'
</code></pre>
<ul>
<li>FC_DEBUG=3<br />
可以用来观察每个待选字体的得分情况.这在分析为什么你想用A字体却得到了B字体的时候很有用.<br />
分数越接近0,越优.</li>
<li>FC_DEBUG=4<br />
用来观察字体模式的匹配过程.</li>
</ul>
<p>测试当前默认字体</p>
<pre><code># fc-match
LiberationMono-Regular.ttf: &quot;Liberation Mono&quot; &quot;Regular&quot;
</code></pre>
<p>测试当前默认等宽字体</p>
<pre><code>$ fc-match monospace
DejaVuSansMono.ttf: &quot;DejaVu Sans Mono&quot; &quot;Book&quot;
</code></pre>
<p>随意的一个例子</p>
<pre><code># fc-match 'Noto Sans CJK TC','Noto Sans CJK SC':lang=zh-cn:weight=bold
NotoSansCJK-Bold.ttc: &quot;Noto Sans CJK TC&quot; &quot;Bold&quot;
</code></pre>
<h2><a class="header" href="#字体配置" id="字体配置">字体配置</a></h2>
<p>如果默认字体是英文字体，那么中文会用其它字体显示。如果默认字体是中文，那么就会直接用这个字体显示英文，因为字符集包含英文。</p>
<p>我觉得字体配置的基本要求是：</p>
<ul>
<li>应用程序要求使用字体A，就要提供字体A，如果没有该字体，就提供一种相近字体。</li>
<li>应用程序对字体没要求，就提供默认字体。</li>
</ul>
<p>那些覆盖应用的字体要求的配置文件，在我看来简直是胡闹。</p>
<p>因为中文字体会包含英文字符集，为了让英文可以用更好看的英文字体显示，可以在在中文字体前面插入英文字体模式。</p>
<p>/etc/fonts/conf.d/里面默认的配置，有几个使用了<strong>prepend</strong>，我觉得是很有毒的。其中一个例子，这个匹配结果是由60-latin.conf，65-nonlatin.conf引起.<br />
所以我把它们删了.基本上默认配置文件中使用了<strong>prepend</strong>的我都給删了.不删不行.</p>
<pre><code>FcConfigSubstitute test pattern any family Equal(ignore blanks) &quot;sans-serif&quot;
Substitute Edit family Prepend &quot;Nachlieli&quot; Comma &quot;Lucida Sans Unicode&quot; Comma &quot;Yudit Unicode&quot; Comma &quot;Kerkis&quot; Comma &quot;ArmNet Helvetica&quot; Comma &quot;Artsounk&quot; Comma &quot;BPG UTF8 M&quot; Comma &quot;Waree&quot; Comma &quot;Loma&quot; Comma &quot;Garuda&quot; Comma &quot;Umpush&quot; Comma &quot;Saysettha Unicode&quot; Comma &quot;JG Lao Old Arial&quot; Comma &quot;GF Zemen Unicode&quot; Comma &quot;Pigiarniq&quot; Comma &quot;B Davat&quot; Comma &quot;B Compset&quot; Comma &quot;Kacst-Qr&quot; Comma &quot;Urdu Nastaliq Unicode&quot; Comma &quot;Raghindi&quot; Comma &quot;Mukti Narrow&quot; Comma &quot;malayalam&quot; Comma &quot;Sampige&quot; Comma &quot;padmaa&quot; Comma &quot;Hapax Berbère&quot; Comma &quot;MS Gothic&quot; Comma &quot;UmePlus P Gothic&quot; Comma &quot;Microsoft YaHei&quot; Comma &quot;Microsoft JhengHei&quot; Comma &quot;WenQuanYi Zen Hei&quot; Comma &quot;WenQuanYi Bitmap Song&quot; Comma &quot;AR PL ShanHeiSun Uni&quot; Comma &quot;AR PL New Sung&quot; Comma &quot;MgOpen Modata&quot; Comma &quot;VL Gothic&quot; Comma &quot;IPAMonaGothic&quot; Comma &quot;IPAGothic&quot; Comma &quot;Sazanami Gothic&quot; Comma &quot;Kochi Gothic&quot; Comma &quot;AR PL KaitiM GB&quot; Comma &quot;AR PL KaitiM Big5&quot; Comma &quot;AR PL ShanHeiSun Uni&quot; Comma &quot;AR PL SungtiL GB&quot; Comma &quot;AR PL Mingti2L Big5&quot; Comma &quot;ＭＳ ゴシック&quot; Comma &quot;ZYSong18030&quot; Comma &quot;TSCu_Paranar&quot; Comma &quot;NanumGothic&quot; Comma &quot;UnDotum&quot; Comma &quot;Baekmuk Dotum&quot; Comma &quot;Baekmuk Gulim&quot; Comma &quot;KacstQura&quot; Comma &quot;Lohit Bengali&quot; Comma &quot;Lohit Gujarati&quot; Comma &quot;Lohit Hindi&quot; Comma &quot;Lohit Marathi&quot; Comma &quot;Lohit Maithili&quot; Comma &quot;Lohit Kashmiri&quot; Comma &quot;Lohit Konkani&quot; Comma &quot;Lohit Nepali&quot; Comma &quot;Lohit Sindhi&quot; Comma &quot;Lohit Punjabi&quot; Comma &quot;Lohit Tamil&quot; Comma &quot;Meera&quot; Comma &quot;Lohit Malayalam&quot; Comma &quot;Lohit Kannada&quot; Comma &quot;Lohit Telugu&quot; Comma &quot;Lohit Oriya&quot; Comma &quot;LKLUG&quot;

Prepend list before  &quot;Bitstream Vera Sans&quot;(w) &quot;DejaVu Sans&quot;(w) &quot;Verdana&quot;(w) &quot;Arial&quot;(w) &quot;Albany AMT&quot;(w) &quot;Luxi Sans&quot;(w) &quot;Nimbus Sans L&quot;(w) &quot;Nimbus Sans&quot;(w) &quot;Helvetica&quot;(w) &quot;Lucida Sans Unicode&quot;(w) &quot;BPG Glaho International&quot;(w) &quot;Tahoma&quot;(w) [marker] **&quot;sans-serif&quot;(s)** &quot;Roya&quot;(w) &quot;Koodak&quot;(w) &quot;Terafik&quot;(w)
Prepend list after  &quot;Bitstream Vera Sans&quot;(w) &quot;DejaVu Sans&quot;(w) &quot;Verdana&quot;(w) &quot;Arial&quot;(w) &quot;Albany AMT&quot;(w) &quot;Luxi Sans&quot;(w) &quot;Nimbus Sans L&quot;(w) &quot;Nimbus Sans&quot;(w) &quot;Helvetica&quot;(w) &quot;Lucida Sans Unicode&quot;(w) &quot;BPG Glaho International&quot;(w) &quot;Tahoma&quot;(w) **&quot;Nachlieli&quot;(w)** &quot;Lucida Sans Unicode&quot;(w) &quot;Yudit Unicode&quot;(w) &quot;Kerkis&quot;(w) &quot;ArmNet Helvetica&quot;(w) &quot;Artsounk&quot;(w) &quot;BPG UTF8 M&quot;(w) &quot;Waree&quot;(w) &quot;Loma&quot;(w) &quot;Garuda&quot;(w) &quot;Umpush&quot;(w) &quot;Saysettha Unicode&quot;(w) &quot;JG Lao Old Arial&quot;(w) &quot;GF Zemen Unicode&quot;(w) &quot;Pigiarniq&quot;(w) &quot;B Davat&quot;(w) &quot;B Compset&quot;(w) &quot;Kacst-Qr&quot;(w) &quot;Urdu Nastaliq Unicode&quot;(w) &quot;Raghindi&quot;(w) &quot;Mukti Narrow&quot;(w) &quot;malayalam&quot;(w) &quot;Sampige&quot;(w) &quot;padmaa&quot;(w) &quot;Hapax Berbère&quot;(w) &quot;MS Gothic&quot;(w) &quot;UmePlus P Gothic&quot;(w) &quot;Microsoft YaHei&quot;(w) &quot;Microsoft JhengHei&quot;(w) &quot;WenQuanYi Zen Hei&quot;(w) &quot;WenQuanYi Bitmap Song&quot;(w) &quot;AR PL ShanHeiSun Uni&quot;(w) &quot;AR PL New Sung&quot;(w) &quot;MgOpen Modata&quot;(w) &quot;VL Gothic&quot;(w) &quot;IPAMonaGothic&quot;(w) &quot;IPAGothic&quot;(w) &quot;Sazanami Gothic&quot;(w) &quot;Kochi Gothic&quot;(w) &quot;AR PL KaitiM GB&quot;(w) &quot;AR PL KaitiM Big5&quot;(w) &quot;AR PL ShanHeiSun Uni&quot;(w) &quot;AR PL SungtiL GB&quot;(w) &quot;AR PL Mingti2L Big5&quot;(w) &quot;ＭＳ ゴシック&quot;(w) &quot;ZYSong18030&quot;(w) &quot;TSCu_Paranar&quot;(w) &quot;NanumGothic&quot;(w) &quot;UnDotum&quot;(w) &quot;Baekmuk Dotum&quot;(w) &quot;Baekmuk Gulim&quot;(w) &quot;KacstQura&quot;(w) &quot;Lohit Bengali&quot;(w) &quot;Lohit Gujarati&quot;(w) &quot;Lohit Hindi&quot;(w) &quot;Lohit Marathi&quot;(w) &quot;Lohit Maithili&quot;(w) &quot;Lohit Kashmiri&quot;(w) &quot;Lohit Konkani&quot;(w) &quot;Lohit Nepali&quot;(w) &quot;Lohit Sindhi&quot;(w) &quot;Lohit Punjabi&quot;(w) &quot;Lohit Tamil&quot;(w) &quot;Meera&quot;(w) &quot;Lohit Malayalam&quot;(w) &quot;Lohit Kannada&quot;(w) &quot;Lohit Telugu&quot;(w) &quot;Lohit Oriya&quot;(w) &quot;LKLUG&quot;(w) **&quot;sans-serif&quot;(s)** &quot;Roya&quot;(w) &quot;Koodak&quot;(w) &quot;Terafik&quot;(w)
</code></pre>
<p>**注：**结果可以看出来，prepend的作用，不是前置在整个模式最前面的，而只前置在参与匹配值的前面。</p>
<h2><a class="header" href="#字体配置的逻辑" id="字体配置的逻辑">字体配置的逻辑</a></h2>
<pre><code> Files begining with:   Contain:
 
 00 through 09          Font directories
 10 through 19          system rendering defaults (AA, etc)
 20 through 29          font rendering options
 30 through 39          family substitution
 40 through 49          generic identification, map family-&gt;generic
 50 through 59          alternate config file loading
 60 through 69          generic aliases, map generic-&gt;family
 70 through 79          select font (adjust which fonts are available)
 80 through 89          match target=&quot;scan&quot; (modify scanned patterns)
 90 through 99          font synthesis
</code></pre>
<p>正确的玩法就是按照编号的这个思路来.</p>
<ul>
<li>
<p>30-39:对同类型的字体做一个字体替换.<br />
我们希望这些字体中的每一个字体都可以回滚到它们中的任意一个,
但是相似的字体优先.我们用三步来实现:</p>
<ol>
<li>别名每个特殊到它的一般字族<br />
例. Liberation Sans 至 Arial</li>
</ol>
</li>
</ul>
<pre><code class="language-xml">        &lt;alias binding=&quot;same&quot;&gt;
          &lt;family&gt;Liberation Sans&lt;/family&gt;
          &lt;default&gt;
          &lt;family&gt;Arial&lt;/family&gt;
          &lt;/default&gt;
        &lt;/alias&gt;
</code></pre>
<ol>
<li>弱别名每个一般字族到其它一般字族<br />
例. Arial to Helvetica</li>
</ol>
<pre><code class="language-xml">        &lt;alias&gt;
          &lt;family&gt;Arial&lt;/family&gt;
          &lt;default&gt;
          &lt;family&gt;Helvetica&lt;/family&gt;
          &lt;/default&gt;
        &lt;/alias&gt;
</code></pre>
<ol>
<li>别名每个一般到它的特殊<br />
例. Arial to Liberation Sans, Arimo, Albany, and Albany AMT</li>
</ol>
<pre><code class="language-xml">        &lt;alias binding=&quot;same&quot;&gt;
          &lt;family&gt;Arial&lt;/family&gt;
          &lt;accept&gt;
            &lt;family&gt;Arimo&lt;/family&gt;
            &lt;family&gt;Liberation Sans&lt;/family&gt;
            &lt;family&gt;Albany&lt;/family&gt;
            &lt;family&gt;Albany AMT&lt;/family&gt;
          &lt;/accept&gt;
        &lt;/alias&gt;
</code></pre>
<p>我自己准备添加一个:32-metric-aliases.conf(純想法,懒得弄)</p>
<ol>
<li>对中文字体做相同的配置.列出一张字体表</li>
<li>对于不想用的字体,我会用alias binding=&quot;same&quot; prefer 想用的字体覆盖.</li>
</ol>
<ul>
<li>40-49:映射字体类型,就是定义字体的类别:monospace,sans-serif,serif.</li>
</ul>
<pre><code class="language-xml">        &lt;alias&gt;
                &lt;family&gt;ＭＳ 明朝&lt;/family&gt;
                &lt;default&gt;&lt;family&gt;serif&lt;/family&gt;&lt;/default&gt;
        &lt;/alias&gt;
</code></pre>
<h2><a class="header" href="#配置默认字体" id="配置默认字体">配置默认字体</a></h2>
<p><a href="https://raw.githubusercontent.com/iofxl/config/master/etc/fonts/local.conf">我的配置文件</a></p>
<h2><a class="header" href="#参考资料" id="参考资料">参考资料</a></h2>
<p>https://wiki.archlinux.org/index.php/fonts<br />
https://wiki.archlinux.org/index.php/Font_configuration<br />
http://www.jinbuguo.com/gui/fonts.conf.html<br />
https://eev.ee/blog/2015/05/20/i-stared-into-the-fontconfig-and-the-fontconfig-stared-back-at-me/<br />
https://stackoverflow.com/questions/17508/how-to-modify-the-style-property-of-a-font-on-windows</p>
<h1><a class="header" href="#汉仪旗黑存在的问题" id="汉仪旗黑存在的问题">汉仪旗黑存在的问题</a></h1>
<h2><a class="header" href="#问题" id="问题">问题</a></h2>
<ol>
<li>旗黑只支持zh-cn,如果lang=zh-tw的情况,默认字体就匹配不到该字体.我的办法是在zh-tw后面加上zh-cn,并且弱绑定.</li>
</ol>
<pre><code class="language-xml">      &lt;match target=&quot;pattern&quot;&gt;
              &lt;test qual=&quot;any&quot; name=&quot;lang&quot;&gt;&lt;string&gt;zh-tw&lt;/string&gt;&lt;/test&gt;
              &lt;edit name=&quot;lang&quot; mode=&quot;assign&quot; binding=&quot;weak&quot;&gt;&lt;string&gt;zh-tw&lt;/string&gt;&lt;/edit&gt;
              &lt;edit name=&quot;lang&quot; mode=&quot;assign&quot; binding=&quot;weak&quot;&gt;&lt;string&gt;zh-cn&lt;/string&gt;&lt;/edit&gt;
      &lt;/match&gt;
</code></pre>
<ol start="2">
<li>汉仪旗黑所有字重的字体,在用HYQiHei匹配的时候,得分都是一样的.所以就得到了下面这样的结果,因为它第一个匹配.<br />
采用的办法是为每个字号配置指定字号的字体.</li>
</ol>
<pre><code>$ fc-match  :lang=zh-cn
HYQiHei-105JF.ttf: &quot;HYQiHei&quot; &quot;105JF&quot;

$ fc-list :lang=zh-cn | grep -i hyqihei[^xy]
/usr/share/fonts/hanyi/HYQiHei-80S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-80S,汉仪旗黑\-80S:style=80S,ExtraBold
/usr/share/fonts/hanyi/HYQiHei-25S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-25S,汉仪旗黑\-25S:style=25S,Hairline
/usr/share/fonts/hanyi/HYQiHei-75S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-75S,汉仪旗黑\-75S:style=75S,Bold
/usr/share/fonts/hanyi/HYQiHei-85S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-85S,汉仪旗黑\-85S:style=85S,Heavy
/usr/share/fonts/hanyi/HYQiHei-105JF.ttf: HYQiHei,汉仪旗黑,HYQiHei\-105JF,汉仪旗黑\-105简繁:style=105JF,105简繁,UltraBlack
/usr/share/fonts/hanyi/HYQiHei-55S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-55S,汉仪旗黑\-55S:style=55S,Book
/usr/share/fonts/hanyi/HYQiHei-70S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-70S,汉仪旗黑\-70S:style=70S,DemiBold
/usr/share/fonts/hanyi/HYQiHei-60S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-60S,汉仪旗黑\-60S:style=60S,Regular
/usr/share/fonts/hanyi/HYQiHei-35S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-35S,汉仪旗黑\-35S:style=35S,Thin
/usr/share/fonts/hanyi/HYQiHei-95S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-95S,汉仪旗黑\-95S:style=95S,ExtraBlack
/usr/share/fonts/hanyi/HYQiHei-30S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-30S,汉仪旗黑\-30S:style=30S,ExtraThin
/usr/share/fonts/hanyi/HYQiHei-65S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-65S,汉仪旗黑\-65S:style=65S,Medium
/usr/share/fonts/hanyi/HYQiHei-50S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-50S,汉仪旗黑\-50S:style=50S,Light
/usr/share/fonts/hanyi/HYQiHei-45S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-45S,汉仪旗黑\-45S:style=45S,ExtraLight
/usr/share/fonts/hanyi/HYQiHei-40S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-40S,汉仪旗黑\-40S:style=40S,UltraLight
</code></pre>
<h2><a class="header" href="#字体的weigh属性" id="字体的weigh属性">字体的weigh属性</a></h2>
<p>extralight - 40
Thin - 45
light - 50
Demilight - 55
regular - 80
medium - 100
semibold - 180
bold - 200
black - 210</p>
<p>字号的对应关系
https://stackoverflow.com/questions/5912528/font-size-translating-to-actual-point-size</p>
<p>摘录:</p>
<pre><code>It may vary by browser slightly but for the most part this should work:

Large is 18 px which is around 13.5 pt

Larger is 19 px which is around 14 pt

Medium is 16 px which is around 12 pt

Small is 13 px which is around 10 pt

Smaller is 13 px which is around 10 pt

X-large is 24 px which is around 18 pt

X-small is 10 px which is around 7.5 pt

XX-large is 32 px which is around 24 pt

XX-small is 9 px which is around 7 pt

This is based off of seeing the computed font-size style in pixels and converting from this chart. This link might also be helpful.
</code></pre>
<p>http://style.cleverchimp.com/font_size_intervals/altintervals.html#st</p>
<p>配置文件中,字体名的-不需要用\转义.</p>
<pre><code class="language-xml">&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;90&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;60&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-105JF&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;60&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;40&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-95S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;40&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;30&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-85S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;30&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;24&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-80S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;24&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;18&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-75S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;



&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;18&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;16&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-70S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;

&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;16&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;14&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-65S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;


&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;14&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;13&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-60S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;

&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;13&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;12&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-55S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;12&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;11&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-50S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;11&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;10&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-45S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;

&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;10&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;9&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-40S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;9&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;8&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-35S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;8&lt;/double&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;more&quot;&gt;&lt;double&gt;7&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-30S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;test qual=&quot;any&quot; name=&quot;pixelsize&quot; compare=&quot;less_eq&quot;&gt;&lt;double&gt;7&lt;/double&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-25S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;

&lt;!-- HYQiHei fallback--&gt;
&lt;match target=&quot;pattern&quot;&gt;
        &lt;test qual=&quot;any&quot; name=&quot;family&quot;&gt;&lt;string&gt;HYQiHei&lt;/string&gt;&lt;/test&gt;
        &lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&gt;&lt;string&gt;HYQiHei-65S&lt;/string&gt;&lt;/edit&gt;
&lt;/match&gt;
</code></pre>
<p>很遗憾,chromium传出来的模式,不含pixelsize.所以永远只能fallback到HYQiHei-65S.还不知道怎么办?</p>
<p>在Telegram上了解到,chromium使用skia作为底层渲染引擎,它和fontconfig目前没有很好对接.像語言,字重可能都没有传給fontconfig的.</p>
<p>所以,就这样吧!</p>
<p>唉,遗憾.</p>
<p>测试了firefox,也是存在问题.</p>
<p>终于找到原因了,发现汉仪好几个字体文件字重没有设置正确</p>
<pre><code>$ fc-list HYQiHei:regular
/usr/share/fonts/hanyi/HYQiHei-80S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-80S,汉仪旗黑\-80S:style=80S,ExtraBold
/usr/share/fonts/hanyi/HYQiHei-25S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-25S,汉仪旗黑\-25S:style=25S,Hairline
/usr/share/fonts/hanyi/HYQiHei-105JF.ttf: HYQiHei,汉仪旗黑,HYQiHei\-105JF,汉仪旗黑\-105简繁:style=105JF,105简繁,UltraBlack
/usr/share/fonts/hanyi/HYQiHei-55S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-55S,汉仪旗黑\-55S:style=55S,Book
/usr/share/fonts/hanyi/HYQiHei-60S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-60S,汉仪旗黑\-60S:style=60S,Regular
/usr/share/fonts/hanyi/HYQiHei-95S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-95S,汉仪旗黑\-95S:style=95S,ExtraBlack
/usr/share/fonts/hanyi/HYQiHei-30S.ttf: HYQiHei,汉仪旗黑,HYQiHei\-30S,汉仪旗黑\-30S:style=30S,ExtraThin
</code></pre>
<p>这些都被当然regular字重去匹配了.使用fontforge修改为相应字重后,正常.</p>
<pre><code>HYQiHei-25S.ttf
	style: &quot;25S&quot;(s) &quot;Hairline&quot;(s) 10
HYQiHei-30S.ttf
	style: &quot;30S&quot;(s) &quot;ExtraThin&quot;(s) 75
HYQiHei-35S.ttf
	style: &quot;35S&quot;(s) &quot;Thin&quot;(s) 100 不用改
HYQiHei-40S.ttf
	style: &quot;40S&quot;(s) &quot;UltraLight&quot;(s) 200 不用改
HYQiHei-45S.ttf
	style: &quot;45S&quot;(s) &quot;ExtraLight&quot;(s) 200 不用改
HYQiHei-50S.ttf
	style: &quot;50S&quot;(s) &quot;Light&quot;(s)  300 不用改
HYQiHei-55S.ttf
	style: &quot;55S&quot;(s) &quot;Book&quot;(s)  375 
HYQiHei-60S.ttf
	style: &quot;60S&quot;(s) &quot;Regular&quot;(s) 400 不用改
HYQiHei-65S.ttf
	style: &quot;65S&quot;(s) &quot;Medium&quot;(s) 500 不用改
HYQiHei-70S.ttf
	style: &quot;70S&quot;(s) &quot;DemiBold&quot;(s) 600 不用改
HYQiHei-75S.ttf
	style: &quot;75S&quot;(s) &quot;Bold&quot;(s) 700 不用改
HYQiHei-80S.ttf
	style: &quot;80S&quot;(s) &quot;ExtraBold&quot;(s) 800
HYQiHei-85S.ttf
	style: &quot;85S&quot;(s) &quot;Heavy&quot;(s) 900 不用改
HYQiHei-95S.ttf
	style: &quot;95S&quot;(s) &quot;ExtraBlack&quot;(s) 1000
HYQiHei-105JF.ttf
	style: &quot;105JF&quot;(s) &quot;105简繁&quot;(s) &quot;UltraBlack&quot;(s)  to:1100

</code></pre>
<h2><a class="header" href="#参考资料-1" id="参考资料-1">参考资料</a></h2>
<p>https://stackoverflow.com/questions/17508/how-to-modify-the-style-property-of-a-font-on-windows</p>
<h1><a class="header" href="#color-2" id="color-2">Color</a></h1>
<h1><a class="header" href="#links-58" id="links-58">Links</a></h1>
<ul>
<li><a href="https://github.com/topics/dark-theme">Topic: dark-theme · GitHub</a></li>
<li><a href="https://github.com/vim-airline/vim-airline/wiki/Screenshots">Screenshots · vim-airline/vim-airline Wiki · GitHub</a></li>
</ul>
<h1><a class="header" href="#theme" id="theme">Theme</a></h1>
<ul>
<li><a href="https://github.com/JonathanSpeek/palenight-iterm2">JonathanSpeek/palenight-iterm2: An iTerm2 color scheme based on the Material Palenight theme 🔥🔥</a></li>
<li><a href="https://github.com/drewtempelmeyer/palenight.vim">drewtempelmeyer/palenight.vim: Soothing color scheme for your favorite [best] text editor</a></li>
</ul>
<h1><a class="header" href="#vim-2" id="vim-2">Vim</a></h1>
<ul>
<li><a href="https://github.com/cocopon/iceberg.vim">cocopon/iceberg.vim: Dark blue color scheme for Vim and Neovim</a></li>
<li><a href="https://vimcolors.org/">Vim colors | Generate your custom colorscheme</a></li>
<li><a href="https://flatuicolors.com/palette/defo">🎨 Flat UI Palette v1 | Flat UI Colors 🎨 280 handpicked colors ready for COPY &amp; PASTE</a></li>
</ul>
<h1><a class="header" href="#terminal" id="terminal">Terminal</a></h1>
<ul>
<li><a href="https://gist.github.com/XVilka/8346728">True Colour (16 million colours) support in various terminal applications and terminals</a></li>
<li><a href="https://github.com/Swordfish90/cool-retro-term">Swordfish90/cool-retro-term: A good looking terminal emulator which mimics the old cathode display...</a></li>
</ul>
<h1><a class="header" href="#macos" id="macos">macOS</a></h1>
<p>Mac's default Terminal doesn't support true color.</p>
<h1><a class="header" href="#win" id="win">Win</a></h1>
<p>putty is just awesome. It supports true color.</p>
<h1><a class="header" href="#go" id="go">Go</a></h1>
<h1><a class="header" href="#tutorial" id="tutorial">Tutorial</a></h1>
<ul>
<li><a href="https://commandcenter.blogspot.com/2012/06/less-is-exponentially-more.html">Less is exponentially more</a><br />
<code>If C++ and Java are about type hierarchies and the taxonomy of types, Go is about composition.</code></li>
<li><a href="https://blog.golang.org/errors-are-values">Errors are values - The Go Blog</a></li>
<li><a href="https://github.com/uber-go/guide/blob/master/style.md">guide/style.md at master · uber-go/guide · GitHub</a></li>
<li><a href="https://www.brianstorti.com/the-actor-model/">The actor model in 10 minutes</a></li>
<li><a href="https://www.youtube.com/watch?v=LHe1Cb_Ud_M&amp;t=15m45s">Ways To Do Things - Peter Bourgon - Release Party #GoSF - YouTube</a></li>
<li><a href="https://peter.bourgon.org/go-in-production/#formatting-and-style">Peter Bourgon Â· Go: Best Practices for Production Environments</a></li>
<li><a href="https://github.com/golang/go/wiki/CodeReviewComments">CodeReviewComments Â· golang/go Wiki</a></li>
<li><a href="https://www.nicolasmerouze.com/build-web-framework-golang">Build You Own Web Framework In Go | Nicolas Merouze</a>(<strong>Recommendation</strong>)</li>
<li><a href="https://divan.dev/posts/visual_programming_go/">Rethinking Visual Programming with Go · divan's blog</a></li>
<li><a href="https://go-proverbs.github.io/">Go Proverbs</a></li>
<li><a href="https://tour.golang.org/welcome/1">A Tour of Go</a></li>
<li><a href="https://gobyexample.com/">Go by Example</a></li>
<li><a href="https://learnxinyminutes.com/docs/go/">Learn Go in Y Minutes</a></li>
<li><a href="https://github.com/enocom/gopher-reading-list">enocom/gopher-reading-list: A curated selection of blog posts on Go</a></li>
<li><a href="https://github.com/golang/go/wiki">golang/go Wiki</a></li>
<li><a href="https://github.com/golang/go/wiki/Learn">Learn · golang/go Wiki · GitHub</a></li>
<li><a href="http://www.cnblogs.com/golove/">GoLove的博客</a></li>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/index.html">Network Programming with Go (golang)</a></li>
<li>The <a href="https://blog.golang.org/">Go Blog</a> has a large archive of informative Go articles. </li>
<li>Once you have Go installed, the <a href="https://golang.org/doc/">Go Documentation</a> is a great place to continue. It contains references, tutorials, videos, and more. </li>
<li>If you need help with the standard library, see the <a href="https://golang.org/pkg/">package reference</a>. For help with the language itself, you might be surprised to find the <a href="https://golang.org/ref/spec">Language Spec</a> is quite readable. </li>
<li>The <a href="https://golang.org/doc/codewalk/functions/">First Class Functions in Go</a> codewalk gives an interesting perspective on Go's function types.</li>
<li><a href="https://golang.org/doc/articles/wiki/">Writing Web Applications</a></li>
<li><a href="https://medium.com/golangspec/introduction-to-bufio-package-in-golang-ad7d1877f762">“Introduction to bufio package in Golang” @mlowicki</a></li>
<li><a href="https://medium.com/golangspec/in-depth-introduction-to-bufio-scanner-in-golang-55483bb689b4">“In-depth introduction to bufio.Scanner in Golang” @mlowicki</a></li>
<li><a href="https://blog.golang.org/slices">Arrays, slices (and strings): The mechanics of 'append'</a></li>
<li><a href="https://blog.golang.org/go-slices-usage-and-internals">Go Slices: usage and internals</a></li>
<li><a href="https://research.swtch.com/godata">Go Data Structures</a></li>
<li><a href="https://golang.org/wiki/SliceTricks">&quot;Slice Tricks&quot; Wiki page </a></li>
<li><a href="https://blog.golang.org/strings">Strings, bytes, runes and characters in Go</a></li>
<li><a href="https://blog.golang.org/normalization">Text normalization in Go</a></li>
<li><a href="http://www.joelonsoftware.com/articles/Unicode.html">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!).</a> </li>
<li><a href="http://mars.netanya.ac.il/%7Eunesco/cdrom/booklet/HTML/index.html">Establishing and Running Large Scale Internet Based (TCP/IP) Services</a></li>
</ul>
<h1><a class="header" href="#install-go" id="install-go">Install Go</a></h1>
<p><a href="https://golang.org/dl/">Download Go</a></p>
<pre><code>sudo tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz

export GOPATH=~/go
export GOBIN=${GOPATH}/bin
export PATH=${GOBIN}:/usr/local/go/bin:${PATH}
</code></pre>
<h1><a class="header" href="#install-gotip" id="install-gotip">Install gotip</a></h1>
<pre><code>go get -u -v golang.org/dl/gotip
gotip download
</code></pre>
<h1><a class="header" href="#editor-neovim-and-vim-go" id="editor-neovim-and-vim-go">Editor: neovim and vim-go</a></h1>
<ul>
<li><a href="https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins">IDEsAndTextEditorPlugins · golang/go Wiki</a></li>
<li><a href="https://github.com/neovim/neovim">neovim/neovim</a><br />
<a href="https://github.com/neovim/neovim/releases/">Releases · neovim/neovim · GitHub</a></li>
</ul>
<h2><a class="header" href="#install-13" id="install-13">Install</a></h2>
<p>macOS</p>
<pre><code>tar xzvf nvim-macos.tar.gz
export PATH=~/nvim-osx64/bin/nvim:$PATH
nvim -version
</code></pre>
<h2><a class="header" href="#install-python3-and-pynvim" id="install-python3-and-pynvim">Install python3 and pynvim</a></h2>
<pre><code>// centos7
yum install python3

// archlinux
pacman -S python python-pip gcc tmux zsh rsync neovim go

// must use --user, or it will warn PermissionError
// the destination dir is .local/
pip3 install --user --upgrade pynvim
</code></pre>
<h2><a class="header" href="#install-vim-plug" id="install-vim-plug">Install vim-plug</a></h2>
<pre><code>// Neovim
curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

// then run in nvim
:PlugInstall
:GoInstallBinaries
</code></pre>
<h2><a class="header" href="#vim-go" id="vim-go">vim-go</a></h2>
<ul>
<li>
<p><a href="https://github.com/fatih/vim-go">fatih/vim-go</a></p>
</li>
<li>
<p><a href="https://github.com/fatih/vim-go-tutorial">fatih/vim-go-tutorial: Tutorial for vim-go</a></p>
</li>
<li>
<p><a href="https://github.com/fatih/dotfiles/blob/master/vimrc">dotfiles/vimrc at master · fatih/dotfiles · GitHub</a></p>
</li>
<li>
<p><a href="https://hackernoon.com/my-neovim-setup-for-go-7f7b6e805876">My neovim setup for Go - By</a></p>
</li>
</ul>
<h2><a class="header" href="#plugins-1" id="plugins-1">Plugins</a></h2>
<ul>
<li><a href="https://github.com/Shougo/deoplete.nvim">Shougo/deoplete.nvim: Dark powered asynchronous completion framework for neovim/Vim8</a></li>
<li><a href="https://github.com/dense-analysis/ale">dense-analysis/ale</a></li>
<li><a href="https://github.com/sebdah/vim-delve">sebdah/vim-delve: Neovim / Vim integration for Delve</a></li>
</ul>
<p>deprecated</p>
<ul>
<li><a href="https://github.com/zchee/deoplete-go">zchee/deoplete-go: Asynchronous Go completion for Neovim. deoplete source for Go.</a></li>
<li><a href="https://github.com/ncm2/ncm2">ncm2/ncm2: Completion Framework for Neovim</a><br />
Slim, Fast and Hackable Completion Framework for Neovim.<strong>Really</strong> fast.<br />
doesn't work for some packages, so I change to use <a href="https://github.com/Shougo/deoplete.nvim">Shougo/deoplete.nvim</a> now.<br />
Fri Nov 15 20:15:48 CST 2019</li>
</ul>
<p>more about completion:</p>
<ul>
<li><a href="https://www.reddit.com/r/vim/comments/9a8c3m/best_vim_completion_manager/">Best vim completion manager? : vim</a></li>
</ul>
<h1><a class="header" href="#misc-1" id="misc-1">Misc</a></h1>
<p>If <code>:echo has(&quot;python3&quot;)</code> returns 1, then you have python 3 support; </p>
<h1><a class="header" href="#xcrun-error" id="xcrun-error">xcrun error</a></h1>
<pre><code>xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun 

(1 of 1): xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun
</code></pre>
<p>Answer:</p>
<p>Install CommandLineTools:</p>
<pre><code>xcode-select --install
</code></pre>
<h1><a class="header" href="#note" id="note">Note</a></h1>
<h1><a class="header" href="#links-59" id="links-59">Links</a></h1>
<h1><a class="header" href="#how-to-read-code" id="how-to-read-code">How to read code</a></h1>
<ul>
<li>Overview First.</li>
</ul>
<h1><a class="header" href="#notes-2" id="notes-2">Notes</a></h1>
<ol>
<li>
<p>package level only have: <code>const</code> <code>var</code> <code>func</code>;
<code>expression</code> MUST put in <code>func</code>, so <code>expression</code> can put in <code>func init</code>.</p>
</li>
<li>
<p>always test a slice's <code>len</code>, don't test it's <code>s[x]</code>'s value, may out of
index.</p>
</li>
<li>
<p>slice and map should <code>make</code> before use. or it'll <code>panic: assignment to entry in nil map</code>.</p>
</li>
</ol>
<p>algorithm</p>
<h1><a class="header" href="#knuthmorrispratt-algorithm" id="knuthmorrispratt-algorithm">Knuth–Morris–Pratt algorithm</a></h1>
<h1><a class="header" href="#links-60" id="links-60">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm">Knuth–Morris–Pratt algorithm - Wikipedia</a> </li>
</ul>
<h1><a class="header" href="#overview-3" id="overview-3">Overview</a></h1>
<h1><a class="header" href="#read-until-strings-in-stream" id="read-until-strings-in-stream">read until strings in stream</a></h1>
<h1><a class="header" href="#links-61" id="links-61">Links</a></h1>
<h1><a class="header" href="#overview-4" id="overview-4">Overview</a></h1>
<h1><a class="header" href="#code" id="code">Code</a></h1>
<ul>
<li><a href="https://github.com/ziutek/telnet/blob/master/conn.go#L376">telnet/conn.go#L376 · ziutek/telnet</a></li>
</ul>
<pre><code class="language-go">func (c *Conn) readUntil(read bool, delims ...string) ([]byte, int, error) {
	if len(delims) == 0 {
		return nil, 0, nil
	}
	p := make([]string, len(delims))
	for i, s := range delims {
		if len(s) == 0 {
			return nil, 0, nil
		}
		p[i] = s
	}
	var line []byte
	for {
		b, err := c.ReadByte()
		if err != nil {
			return nil, 0, err
		}
		if read {
			line = append(line, b)
		}
		for i, s := range p {
			if s[0] == b {
				if len(s) == 1 {
					return line, i, nil
				}
				p[i] = s[1:]
			} else {
				p[i] = delims[i]
			}
		}
	}
	panic(nil)
}
</code></pre>
<p>What makes me confusion is this code: </p>
<p>How it works ?</p>
<pre><code class="language-go">for i, s := range p {
	if s[0] == b {
		if len(s) == 1 {
			return line, i, nil
		}
		p[i] = s[1:]
	} else {
		p[i] = delims[i]
	}
}
</code></pre>
<h1><a class="header" href="#find-out" id="find-out">Find out</a></h1>
<p>It looks like a state machine. Even though I don't really understand what is
state machine.</p>
<h1><a class="header" href="#basis-2" id="basis-2">Basis</a></h1>
<h1><a class="header" href="#a-hrefhttpsgolangorgcmdgocommand-goa" id="a-hrefhttpsgolangorgcmdgocommand-goa"><a href="https://golang.org/cmd/go/">Command go</a></a></h1>
<h1><a class="header" href="#links-62" id="links-62">Links</a></h1>
<h1><a class="header" href="#go-get--u-update-all" id="go-get--u-update-all">go get -u update all</a></h1>
<p>You can also use <code>go get -u all</code> to update all packages in your <code>GOPATH</code></p>
<h1><a class="header" href="#command-objdump" id="command-objdump">Command objdump</a></h1>
<p><a href="https://golang.org/cmd/objdump/">objdump - The Go Programming Language</a></p>
<pre><code>go tool objdump [-s symregexp] binary
go tool objdump binary start end
</code></pre>
<h1><a class="header" href="#build" id="build">Build</a></h1>
<p>build for raspberry</p>
<p><code>env GOOS=linux GOARCH=arm GOARM=7 go build -o guochan.raspberry</code></p>
<h1><a class="header" href="#character-sets-and-encodings" id="character-sets-and-encodings">Character Sets and Encodings</a></h1>
<h1><a class="header" href="#links-63" id="links-63">Links</a></h1>
<ul>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/encoding/definitions.html">Definitions | Network Programming with Go (golang)</a></li>
<li><a href="https://www.cnblogs.com/golove/p/3222096.html">基础知识 - 字符编码简介 - GoLove - 博客园</a></li>
</ul>
<h1><a class="header" href="#definitions" id="definitions">Definitions</a></h1>
<p><strong>Character</strong></p>
<p>A character is a “unit of information that roughly corresponds to a grapheme
(written symbol) of a natural language, such as a letter, numeral, or
punctuation mark” (Wikipedia). A character is “the smallest component of
written language that has a semantic value” (Unicode). </p>
<p>A character is some sort of abstraction of any actual symbol: the character “a”
is to any written “a” as a Platonic circle is to any actual circle. The concept
of character also includes control characters, which do not correspond to
natural language symbols but to other bits of information used to process texts
of the language.</p>
<p>A character does not have any particular appearance, although we use the
appearance to help recognize the character. </p>
<p><strong>Character Repertoire/Character Set</strong></p>
<p>A character repertoire is a set of distinct characters, such as the Latin
alphabet. </p>
<p><strong>Character Code</strong></p>
<p>A character code is a mapping from characters to integers. The mapping for a
character set is also called a coded character set or code set. The value of
each character in this mapping is often called a code point. ASCII is a code
set. The code point for “a” is 97 and for “A” is 65 (decimal).</p>
<p>The character code is still an abstraction. It isn’t yet what we will see in
text files, or in TCP packets. However, it is getting close, as it supplies the
mapping from human-oriented concepts into numerical ones.</p>
<p><strong>Character Encoding</strong></p>
<p>To communicate or store a character, you need to encode it in some way. To
transmit a string, you need to encode all characters in the string. </p>
<p><strong>Transport Encoding</strong></p>
<p>An encoding can be based on space- and hence bandwidth-saving techniques such
as zipping the text. Or it could be reduced to a 7-bit format to allow a parity
checking bit, such as base64.</p>
<p><strong>Unicode</strong></p>
<h1><a class="header" href="#utf-8-go-and-runes" id="utf-8-go-and-runes">UTF-8, Go, and Runes</a></h1>
<p>Go uses UTF-8 encoded characters in its strings. Each character is of type
rune. This is an alias for int32. A Unicode character can be up to 4 bytes in
UTF-8 encoding so that 4 bytes are needed to represent all characters. In terms
of characters, a string is an array of runes using 1, 2, or 4 bytes per rune.</p>
<h1><a class="header" href="#ucs-and-unicode" id="ucs-and-unicode">UCS and Unicode</a></h1>
<p>UCS（Universal Character Set，通用字符集）使用 4 个字节来表示一个字符，其中最高
字节的最高二进制位始终为 0，这样能够表示的字符数量就达到了约 20 亿个，足以容纳
全世界所有的字符。在 UCS 字符集中，0～255 这些数值的定义与 Latin1 一样，只不过
是用 4 个字节表示 1 个字符，除最低位字节外，其它 3 个字节全部用 0 填充。这样就
保证了与 Latin1 字符集的兼容。</p>
<p>UCS 将最高字节定义为 2^7=128 个组（group），每个组再根据次高字节分为 256 个平面
（plane），每个平面再根据次低字节分为 256 行（row），每行再根据最低字节分为 256
个码位（cell）。UCS 中第 0 组的第 0 平面被称为“基本多文种平面”，里面存放了包含
世界各国的常用字符。除了第 0 平面，UCS 还定义了 16 个辅助平面，用来存放更多的字
符。</p>
<p>Unicode 字符集是 UCS 字符集的子集，只包含 0x0～0x10FFFF 范围的字符。</p>
<p>UTF: Unicode/UCS Transformation Format</p>
<p>utf32, utf16:</p>
<p>linux, win:	Little-Endian
Mac:		Big-Endian</p>
<h1><a class="header" href="#unicode-gotchas" id="unicode-gotchas">Unicode Gotchas</a></h1>
<ul>
<li><a href="https://godoc.org/golang.org/x/text/unicode/norm">norm - GoDoc</a></li>
</ul>
<h1><a class="header" href="#struct" id="struct">struct</a></h1>
<p><strong>Everything is a Number.</strong></p>
<ul>
<li>給同样结构的结构体变量取一个名字,就创建了一种<em>结构体类型</em>.</li>
</ul>
<h2><a class="header" href="#slice-map-struct-类型比较" id="slice-map-struct-类型比较">slice, map, struct 类型比较</a></h2>
<pre><code class="language-go">var i []int //这是int类型的slice类型
var s []string //这是string类型的slice类型
  
var ii map[int]int //这是索引是int类型,值是int类型的map类型
var is map[int]string //这是索引是int类型,值是string类型的map类型
var si map[string]int //这是索引是string类型,值是int类型的map类型
var ss map[string]string //这是索引是string类型,值是string类型的map类型
  
var a struct {    
    name string  
    age int  
    ssn string  
}   //这是一个结构体类型
  
type Person struct {    
    name string  
    age int  
    ssn string  
}   //这是一个结构体类型,取名Person,之后就可以创建Person类型的变量
  
var p Person //这是一个Person类型
var p []Person //这是一个Person类型的slice
  

</code></pre>
<h1><a class="header" href="#closure" id="closure">Closure</a></h1>
<h1><a class="header" href="#links-64" id="links-64">Links</a></h1>
<ul>
<li></li>
</ul>
<h1><a class="header" href="#overview-5" id="overview-5">Overview</a></h1>
<p>Regardless of what you do with a closure it will always be able to access the
variables that are local to the scope it was created in — which in this case
means that fn will always have access to the <code>next</code> variable.</p>
<pre><code class="language-go">func myMiddleware(next http.Handler) http.Handler {
    fn := func(w http.ResponseWriter, r *http.Request) {
        // TODO: Execute our middleware logic here...
        next.ServeHTTP(w, r)
    }

    return http.HandlerFunc(fn)
}
</code></pre>
<h1><a class="header" href="#interfaces" id="interfaces">interfaces</a></h1>
<ul>
<li>WHW</li>
</ul>
<h4><a class="header" href="#links-65" id="links-65">Links</a></h4>
<p>你知道接口是接口，但你还是很难去理解接口。</p>
<p>https://golang.org/pkg/io/<br />
https://golang.org/pkg/io/ioutil/<br />
https://github.com/polaris1119/The-Golang-Standard-Library-by-Example/blob/master/chapter01/01.1.md 很一般的介绍IO包的文章 例子比较差 但仍然值得学习 中文文档整体质量太差<br />
https://www.cnblogs.com/golove/p/3276678.html<br />
https://gobyexample.com/interfaces 这个页面帮助理解什么是接口<br />
http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go<br />
https://golangtutorials.blogspot.com/2011/06/interfaces-in-go.html?m=1 解释类型与接口的关系<br />
https://research.swtch.com/interfaces 解释接口在内存中的本质<br />
https://blog.golang.org/laws-of-reflection 可以进一步理解接口的本质<br />
https://golang.org/doc/effective_go.html#interfaces<br />
http://golangtutorials.blogspot.com/2011/05/table-of-contents.html<br />
http://www.laktek.com/2012/02/13/learning-go-interfaces-reflections/</p>
<p>接口是函数的抽象或集合 接口可以作为参数传递给函数</p>
<p>接口也是一种类型 一类这样的东西或者概念 就像情感 函数 文学 这些东西一样</p>
<p>通常的类型是面向属性的类型 接口可以认为是面向行为的类型 面向函数的类型</p>
<p>例子</p>
<p>求长方形 圆形的面积
四种动物的叫 狗 猫 牛 Java程序员</p>
<p>形状是 正方形 长方形 圆形 各种形状的抽象 那它就可以成为接口？抽象的概念就可以是接口？</p>
<p>列车时刻查询也是接口 用英语 法语 手语查询都可以查询到结果</p>
<p>某种接口包含某种函数 某种类型也支持这种函数 那么 这种类型就实现了这个接口 可以调用接口以这个类型的实例为参数</p>
<p>普通类型传值给接口类型可以看成是类型转换
为什么Read这些接口不是这样的用法 因为这些接口类型的函数是带参数的</p>
<p>像ByteReader等接口实现了又有什么意义 只是产生了有这个接口这样的概念 并没有任何价值 因为IO包并没有提供相关的操作函数，类似io.Copy 如果也有ByteCopy这样的函数在 那么所谓的实现了这个接口就有价值了 接口必须得有相应对接才有价值 普通类型也是一样的道理 也就是得有地方去用</p>
<p>但是实现了这个接口，就可以等着被用了。用不用得到另说。</p>
<p><a href="https://golang.org/doc/effective_go.html#interfaces">Effective Go#interfaces</a>中的定义：</p>
<blockquote>
<p>Interfaces in Go provide a way to specify the behavior of an object: if something can do this, then it can be used here.</p>
</blockquote>
<h1><a class="header" href="#concurrency" id="concurrency">Concurrency</a></h1>
<h1><a class="header" href="#links-66" id="links-66">Links</a></h1>
<ul>
<li><a href="http://divan.github.io/posts/go_concurrency_visualize/">Visualizing Concurrency in Go</a></li>
<li><a href="https://www.youtube.com/watch?v=KyuFeiG3Y60">GopherCon 2016: Ivan Danyliuk - Visualizing Concurrency in Go - YouTube</a></li>
<li><a href="https://talks.golang.org/2012/waza.slide#1">Concurrency is not Parallelism</a></li>
<li><a href="https://www.youtube.com/watch?v=cN_DpYBzKso">Rob Pike - 'Concurrency Is Not Parallelism' - YouTube</a></li>
<li><a href="https://www.youtube.com/watch?v=jgVhBThJdXc">Google I/O 2010 - Go Programming - YouTube</a> (21:16)</li>
<li><a href="https://talks.golang.org/2012/concurrency.slide#1">Go Concurrency Patterns</a></li>
<li><a href="https://www.youtube.com/watch?v=f6kdp27TYZs">Google I/O 2012 - Go Concurrency Patterns - YouTube</a></li>
<li><a href="https://talks.golang.org/2013/advconc.slide#1">Advanced Go Concurrency Patterns</a></li>
<li><a href="https://www.youtube.com/watch?v=QDDwwePbDtw">Google I/O 2013 - Advanced Go Concurrency Patterns - YouTube</a></li>
<li><a href="https://talks.golang.org/2012/chat.slide#1">Go: code that grows with grace</a></li>
<li><a href="https://www.ardanlabs.com/blog/2018/12/scheduling-in-go-part3.html">Scheduling In Go : Part III - Concurrency</a></li>
<li><a href="https://www.youtube.com/watch?v=rDRa23k70CU">Golang UK Conference 2017 | Arne Claus - Concurrency Patterns in Go - YouTube</a></li>
</ul>
<h1><a class="header" href="#concurrency-is-not-parallelism" id="concurrency-is-not-parallelism">Concurrency Is Not Parallelism</a></h1>
<table><thead><tr><th>Concurrency</th><th>Parallelism</th></tr></thead><tbody>
<tr><td>compositon of <strong>independently</strong> executing things</td><td><strong>simultaneous</strong> execution of multiple things</td></tr>
<tr><td><strong>dealing</strong> with lots of things at once</td><td><strong>doing</strong> lots of things at once</td></tr>
<tr><td>about <strong>structure</strong></td><td>about execution</td></tr>
</tbody></table>
<h1><a class="header" href="#a-little-background-about-go" id="a-little-background-about-go">A little background about Go</a></h1>
<ul>
<li>Goroutines<br />
A goroutine is a function running independently in the same address space as other goroutines<br />
Like launching a function with shell's &amp; notation.
<pre><code class="language-go">f(&quot;hello&quot;, &quot;world&quot;) // f runs; we wait

go f(&quot;hello&quot;, &quot;world&quot;) // f starts running
g() // does not wait for f to return
</code></pre>
</li>
<li>Channels<br />
Channels are typed values that allow goroutines to synchronize and exchange information.<br />
A sender and receiver must both be ready to play their part in the communication. Otherwise we wait until they are.
<pre><code class="language-go">timerChan := make(chan time.Time)
go func() {
    time.Sleep(deltaT)
    timerChan &lt;- time.Now() // send time on timerChan
}()
// Do something else; when ready, receive.
// Receive will block until timerChan delivers.
// Value sent is other goroutine's completion time.
completedAt := &lt;-timerChan
</code></pre>
</li>
<li>Select<br />
The select statement is like a switch, but the decision is based on ability to <strong>communicate</strong> rather than equal values. 
<pre><code class="language-go">select {
case v := &lt;-ch1:
    fmt.Println(&quot;channel 1 sends&quot;, v)
case v := &lt;-ch2:
    fmt.Println(&quot;channel 2 sends&quot;, v)
default: // optional
    fmt.Println(&quot;neither channel was ready&quot;)
}
</code></pre>
</li>
<li>Closures are also part of the story<br />
Make some concurrent calculations easier to express. </li>
</ul>
<h1><a class="header" href="#launching-daemons" id="launching-daemons">Launching daemons</a></h1>
<p>Use a closure to wrap a background operation.
This copies items from the input channel to the output channel:</p>
<pre><code class="language-go">go func() { // copy input to output
    for val := range input {
        output &lt;- val
    }
}()
</code></pre>
<p>The for range operation runs until channel is drained. </p>
<h1><a class="header" href="#a-simple-load-balancer" id="a-simple-load-balancer">A simple load balancer</a></h1>
<pre><code class="language-go">// A unit of work:
type Work struct {
    x, y, z int
}

// A worker task 
// Must make sure other workers can run when one blocks. 
func worker(in &lt;-chan *Work, out chan&lt;- *Work) {
   for w := range in {
      w.z = w.x * w.y
      Sleep(w.z)
      out &lt;- w
   }
}

// The runner 
func Run() {
   in, out := make(chan *Work), make(chan *Work)
   for i := 0; i &lt; NumWorkers; i++ {
       go worker(in, out)
   }
   go sendLotsOfWork(in)
   receiveLotsOfResults(out)
}
</code></pre>
<h2><a class="header" href="#a-hrefgobasiscodelbgoa-more-realistic-load-balancera" id="a-hrefgobasiscodelbgoa-more-realistic-load-balancera"><a href="go/basis/code/lb.go">a more realistic load balancer</a></a></h2>
<p><img src="go/basis/img/gopherchart.jpg" alt="gopherchart" /></p>
<h1><a class="header" href="#patterns" id="patterns">Patterns</a></h1>
<p><a href="https://divan.github.io/demos/pingpong/">Ping-pong</a></p>
<pre><code class="language-go">package main

import &quot;time&quot;

func main() {
    var Ball int
    table := make(chan int)
    go player(table)
    go player(table)

    table &lt;- Ball
    time.Sleep(1 * time.Second)
    &lt;-table
}

func player(table chan int) {
    for {
        ball := &lt;-table
        ball++
        time.Sleep(100 * time.Millisecond)
        table &lt;- ball
    }
}
</code></pre>
<p>这种模式的一个明显特征是<code>FIFO</code>,起了100个<code>go player(table)</code>的<a href="https://divan.github.io/demos/pingpong100/">样子</a>:</p>
<pre><code class="language-go">for i := 0; i &lt; 100; i++ {
    go player(table)
}
</code></pre>
<h2><a class="header" href="#generator-functiongoroutine-inside-that-returns-a-channel" id="generator-functiongoroutine-inside-that-returns-a-channel">Generator: function(goroutine inside) that returns a channel</a></h2>
<pre><code class="language-go">func main() {
    c := boring(&quot;boring!&quot;) // Function returning a channel.
    for i := 0; i &lt; 5; i++ {
        fmt.Printf(&quot;You say: %q\n&quot;, &lt;-c)
    }
    fmt.Println(&quot;You're boring; I'm leaving.&quot;)
}

func boring(msg string) &lt;-chan string { // Returns receive-only channel of strings.
    c := make(chan string)
    go func() { // We launch the goroutine from inside the function.
        for i := 0; ; i++ {
            c &lt;- fmt.Sprintf(&quot;%s %d&quot;, msg, i)
            time.Sleep(time.Duration(rand.Intn(1e3)) * time.Millisecond)
        }
    }()
    return c // Return the channel to the caller.
}
</code></pre>
<h2><a class="header" href="#waitgroup-with-chdone" id="waitgroup-with-chdone">WaitGroup with chDone</a></h2>
<p>use with <code>go for select cases</code></p>
<ul>
<li><a href="https://github.com/google/goexpect/blob/master/expect.go#L1051">goexpect/expect.go at master · google/goexpect · GitHub</a></li>
</ul>
<pre><code class="language-go">	chDone := make(chan struct{})
	var wg sync.WaitGroup
	wg.Add(1)
	go func() {
		defer wg.Done()
		for {
			select {
			case &lt;-chDone:
				return
			case sstr, ok := &lt;-e.snd:
				if !ok {
					log.Printf(&quot;Send channel closed&quot;)
					return
				}
				if _, err := sIn.Write([]byte(sstr)); err != nil || !e.check() {
					log.Printf(&quot;Write failed: %v&quot;, err)
					return
				}
			}
		}
	}()
	rdr := func(out io.Reader) {
		defer wg.Done()
		buf := make([]byte, bufferSize)
		for {
			nr, err := out.Read(buf)
			if err != nil || !e.check() {
				if e.teeWriter != nil {
					e.teeWriter.Close()
				}
				if err == io.EOF {
					if e.verbose {
						log.Printf(&quot;read closing down: %v&quot;, err)
					}
					return
				}
				return
			}
			// Tee output to writer
			if e.teeWriter != nil {
				e.teeWriter.Write(buf[:nr])
			}
			// Add to buffer
			e.mu.Lock()
			e.out.Write(buf[:nr])
			e.mu.Unlock()
			// Inform Expect (if it's currently running) that there's some new data to look through.
			select {
			case e.rcv &lt;- struct{}{}:
			default:
			}
		}
	}
	wg.Add(1)
	go rdr(sOut)
	if sErr != nil {
		wg.Add(1)
		go rdr(sErr)
	}
	err := wait()
	close(chDone)
	wg.Wait()
	r &lt;- err
}
</code></pre>
<h1><a class="header" href="#channels" id="channels">Channels</a></h1>
<p><strong>Do not communicate by sharing memory; instead, share memory by communicating.</strong></p>
<h1><a class="header" href="#links-67" id="links-67">Links</a></h1>
<ul>
<li><a href="https://www.ardanlabs.com/blog/2014/02/the-nature-of-channels-in-go.html">The Nature Of Channels In Go Go, (Golang) Programming - Blog - Ardan Labs</a>(<strong>Great</strong>)</li>
<li><a href="https://blog.mergermarket.it/now-youre-thinking-with-channels/">(Now You're) Thinking With Channels</a>(<strong>Great</strong>) </li>
<li><a href="http://guzalexander.com/2013/12/06/golang-channels-tutorial.html">Golang channels tutorial | Alexander Guz's blog</a>(<strong>Great</strong>)</li>
<li><a href="https://dave.cheney.net/2014/03/19/channel-axioms">Channel Axioms | Dave Cheney</a></li>
<li><a href="https://dave.cheney.net/2013/04/30/curious-channels">Curious Channels | Dave Cheney</a></li>
<li><a href="https://blog.golang.org/pipelines">Go Concurrency Patterns: Pipelines and cancellation - The Go Blog</a></li>
<li><a href="https://blog.golang.org/share-memory-by-communicating">Share Memory By Communicating - The Go Blog</a></li>
<li><a href="https://golang.org/doc/codewalk/sharemem/">Codewalk: Share Memory By Communicating</a></li>
<li><a href="https://dave.cheney.net/2016/12/22/never-start-a-goroutine-without-knowing-how-it-will-stop">Never start a goroutine without knowing how it will stop – Dave Cheney</a></li>
</ul>
<h1><a class="header" href="#builtin" id="builtin">Builtin</a></h1>
<ul>
<li><code>ch := make(chan int, 100)</code> | <code>ch := make(chan int)</code></li>
<li><code>close(ch)</code></li>
<li>The <code>for ... range</code> on a channel loops over values received from a channel, until the channel is closed.</li>
<li>The <code>select</code> statement can be used to list multiple channel operations such as send on a channel and receive from a channel, and the one that can proceed without blocking will be selected (randomly if there are multiple ones that can proceed; and will block if none is ready).</li>
<li>There is a special form of the receive operator which allows you to check if the channel was closed (besides receiving a value): <code>v, ok := &lt;-ch</code></li>
<li>The builtin <code>len()</code> function tells the number of elements queued (unread); the builting <code>cap()</code> function returns the channel buffer capacity.</li>
</ul>
<h1><a class="header" href="#goroutines" id="goroutines">Goroutines</a></h1>
<p>A goroutine has a simple model: it is a function executing concurrently with other goroutines in the same address space.
Prefix a function or method call with the go keyword to run the call in a new goroutine. When the call completes, the goroutine exits, silently. (The effect is similar to the Unix shell's &amp; notation for running a command in the background.)</p>
<h1><a class="header" href="#channels-basics" id="channels-basics">Channels basics</a></h1>
<h2><a class="header" href="#unbuffered-channels" id="unbuffered-channels">Unbuffered Channels</a></h2>
<p>Unbuffered channels have no capacity and therefore require both goroutines to be ready to make any exchange. When a goroutine attempts to send a resource to an unbuffered channel and there is no goroutine waiting to receive the resource, the channel will lock the sending goroutine and make it wait. When a goroutine attempts to receive from an unbuffered channel, and there is no goroutine waiting to send a resource, the channel will lock the receiving goroutine and make it wait.</p>
<p><strong>Synchronization</strong> is inherent in the interaction between the send and the receive. <strong>One can not happen without the other</strong>. The nature of an unbuffered channel is guaranteed synchronization.</p>
<p><img src="go/basis/img/channels0.png" alt="channels0" /></p>
<pre><code class="language-go">func main() {
    message := make(chan string) // no buffer
    count := 3

    go func() {
        for i := 1; i &lt;= count; i++ {
            fmt.Printf(&quot;send message %d\n&quot;, i)
            message &lt;- fmt.Sprintf(&quot;message %d&quot;, i)
        }
    }()

    time.Sleep(time.Second * 1)
    fmt.Println(&quot;Sleep(1s)&quot;)

    for i := 1; i &lt;= count; i++ {
        fmt.Println(&lt;-message)
    }
}

/*
send message 1
Sleep(1s)
message 1
send message 2
send message 3
message 2
message 3
*/
</code></pre>
<h2><a class="header" href="#buffered-channels" id="buffered-channels">Buffered Channels</a></h2>
<p>Buffered channels have capacity and therefore can behave a bit differently. When a goroutine attempts to send a resource to a buffered channel and the channel is full, the channel will lock the goroutine and make it wait until a buffer becomes available. If there is room in the channel, the send can take place immediately and the goroutine can move on. When a goroutine attempts to receive from a buffered channel and the buffered channel is empty, the channel will lock the goroutine and make it wait until a resource has been sent.</p>
<p>Synchronization still occurs within the interactions of receives and sends, however when the queue has buffer availability, the sends will not lock. Receives will not lock when there is something to receive from the channel. Consequently, if the buffer is full or if there is nothing to receive, a buffered channel will behave very much like an unbuffered channel.</p>
<p><img src="go/basis/img/channels1.png" alt="channels1" /></p>
<pre><code class="language-go">func main() {
    message := make(chan string, 2) 
    count := 3

    // as can see, block send when buffer full. blocked when send message 3
    go func() {
        for i := 1; i &lt;= count; i++ {
            fmt.Printf(&quot;send message %d\n&quot;, i)
            message &lt;- fmt.Sprintf(&quot;message %d&quot;, i)
        }
    }()

    time.Sleep(time.Second * 1)
    fmt.Println(&quot;Sleep(1s)&quot;)

    for i := 1; i &lt;= count; i++ {
        fmt.Println(&lt;-message)
    }
}

/*
send message 1
send message 2
send message 3
Sleep(1s)
message 1
message 2
message 3
*/
</code></pre>
<h1><a class="header" href="#when-channel-will-deadlock" id="when-channel-will-deadlock">When channel will deadlock</a></h1>
<ol>
<li>
<p>Only sender or only receiver will deadlock, <strong>One can not happen without the other.</strong></p>
<pre><code class="language-go">func main() {
    // fatal error: all goroutines are asleep - deadlock!
    ch := make(chan int)
    ch &lt;- 78
}

func main() {
    // fatal error: all goroutines are asleep - deadlock!
    ch := make(chan int)
    &lt;-ch
}
</code></pre>
</li>
<li>
<p>Send to or receive from a nil channel blocks forever</p>
<p>If the channel is nil then the sender and receiver have no reference to each other; they are both blocked waiting on independent channels and will never unblock.</p>
<pre><code class="language-go">func main() {
    // fatal error: all goroutines are asleep - deadlock!
    var c chan int
    c &lt;- 78
}

func main() {
    // fatal error: all goroutines are asleep - deadlock!
    var c chan int
    &lt;-c
}
</code></pre>
</li>
<li>
<p>Read more than Sent will deadlock </p>
<pre><code class="language-go">func main() {

    ch := make(chan int)
    count := 3

    go func() {
        for i := 1; i &lt;= count; i++ {
            ch &lt;- i
        }
    }()

    for i := 1; i &lt;= count+1; i++ {
        fmt.Println(&lt;-ch)
    }
}
/*
1
2
3
fatal error: all goroutines are asleep - deadlock!
*/
</code></pre>
</li>
<li>
<p><code>for v:= range ch</code> will iterate through channels until the channel is closed. <strong>But</strong> the sender didn't close the channel. will deadlock</p>
<pre><code class="language-go">func main() {

    ch := make(chan int)
    count := 3

    go func() {
        for i := 1; i &lt;= count; i++ {
            ch &lt;- i
        }
        // comment out close(ch) will deadlock
        close(ch)
    }()

    for v := range ch {
        fmt.Println(v)
    }
}
</code></pre>
</li>
</ol>
<h1><a class="header" href="#when-a-channel-will-panic" id="when-a-channel-will-panic">When a channel will panic</a></h1>
<ol>
<li>
<p>A send to a closed channel panics</p>
<pre><code class="language-go">// A Fan-in pattern
func main() {
    var c = make(chan int, 100)
    for i := 0; i &lt; 10; i++ {
        go func() {
            for j := 0; j &lt; 10; j++ {
                c &lt;- j
            }
            close(c)
        }()
    }
    for i := range c {
        fmt.Println(i)
    }
}
// panic: send on closed channel
</code></pre>
</li>
</ol>
<h1><a class="header" href="#channel-axioms" id="channel-axioms">Channel Axioms</a></h1>
<ul>
<li>A send to a nil channel blocks forever</li>
<li>A receive from a nil channel blocks forever</li>
<li>A send to a closed channel panics</li>
<li>A receive from a closed channel returns the zero value immediately</li>
</ul>
<h1><a class="header" href="#interesting-closing-a-channel" id="interesting-closing-a-channel">Interesting Closing a channel</a></h1>
<p><strong>A closed channel never blocks</strong></p>
<p><strong>a closed channel is always ready to receive.</strong></p>
<p>Once a channel has been closed, you cannot send a value on this channel, but you can still receive from the channel.</p>
<pre><code class="language-go">func main() {

    ch := make(chan bool)
    close(ch)

    for i := 0; i &lt; 3; i++ {
        fmt.Println(&lt;-ch)
    }

}

/*
false
false
false
*/
</code></pre>
<p><strong>Use as synchronization tool</strong></p>
<pre><code class="language-go">func main() {

    done := make(chan struct{})

    go func() {
        fmt.Println(&quot;goroutine message&quot;)
        close(done)
    }()

    fmt.Println(&quot;main message&quot;)
    &lt;-done
}

/*
main message
goroutine message
*/
</code></pre>
<p><strong>really comes into its own when combined with select.</strong></p>
<p>declaring <code>done</code> to be of type <strong>chan struct{}</strong> says that the channel contains no value; we’re only interested in its closed property.</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;sync&quot;
    &quot;time&quot;
)

func main() {

    done := make(chan struct{})
    var wg sync.WaitGroup

    for i := 0; i &lt; 100; i++ {
        wg.Add(1)
        go func() {
            defer wg.Done()
            select {
            case &lt;-time.After(time.Second * 3):
            case &lt;-done:
            }
        }()
    }

    t0 := time.Now()
    // with close(done) comment out, will print:
    // Waited 3.000704702s for 100 goroutine to stop
    close(done)
    wg.Wait()
    fmt.Printf(&quot;Waited %v for 100 goroutine to stop\n&quot;, time.Since(t0))
    // Waited 55.656µs for 100 goroutine to stop
}
</code></pre>
<h1><a class="header" href="#a-nil-channel-always-blocks" id="a-nil-channel-always-blocks">A nil channel always blocks</a></h1>
<p>wait for multiple channels to close</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;time&quot;
)

func WaitMany(a, b chan bool) {
    for a != nil || b != nil {
        select {
        case &lt;-a:
            a = nil
        case &lt;-b:
            b = nil
        }
    }
    /* wrong way, channel a is closed first can enter an infinite loop
    var aclosed, bclosed bool
    for !aclosed || !bclosed {
            select {
            case &lt;-a:
                    aclosed = true
            case &lt;-b:
                    bclosed = true
            }
    }
    */
}

func main() {
    a, b := make(chan bool), make(chan bool)
    t0 := time.Now()
    go func() {
        close(a)
        close(b)
    }()
    WaitMany(a, b)
    fmt.Printf(&quot;waited %v for WaitMany\n&quot;, time.Since(t0))
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsbloggolangorgpipelinesgo-concurrency-patterns-pipelines-and-cancellationa" id="a-hrefhttpsbloggolangorgpipelinesgo-concurrency-patterns-pipelines-and-cancellationa"><a href="https://blog.golang.org/pipelines">Go Concurrency Patterns: Pipelines and cancellation</a></a></h1>
<h1><a class="header" href="#guidelines" id="guidelines">Guidelines</a></h1>
<p><strong>There is a pattern to our pipeline functions:</strong></p>
<ul>
<li><strong>stages close their outbound channels when all the send operations are done.</strong></li>
<li><strong>stages keep receiving values from inbound channels until those channels are closed or the senders are unblocked.</strong></li>
</ul>
<p>This pattern allows each receiving stage to be written as a range loop and ensures that all goroutines exit once all values have been successfully sent downstream.<br />
Pipelines unblock senders either by ensuring there's enough buffer for all the values that are sent or by explicitly signalling senders when the receiver may abandon the channel. </p>
<h1><a class="header" href="#fan-in-and-explicit-cancellation" id="fan-in-and-explicit-cancellation">Fan-in and Explicit cancellation</a></h1>
<p>因为是要确保所有发送方都完成才能关闭通道,所以只有 Fan-In 有这种问题.</p>
<p>正常都执行完的场景,就是等到等待组都完成再关闭通道就可以了.</p>
<p>如果需要手动取消, 就使用哨子触发等待组完成.</p>
<ol>
<li>make and return output &lt;-chan</li>
<li>wg.Add(1) out gr and wg.Done() in gr</li>
<li>wg.Wait() and close(output) in another gr</li>
</ol>
<ul>
<li>Explicit cancellation
<ol>
<li>make( chan struct{})</li>
<li>select &lt;-done in gr</li>
<li>close (done) when needed</li>
</ol>
</li>
</ul>
<h1><a class="header" href="#pipeline" id="pipeline">pipeline</a></h1>
<p>Informally, a pipeline is a series of stages connected by channels, where each stage is a group of goroutines running the same function. In each stage, the goroutines</p>
<ul>
<li>receive values from upstream via inbound channels</li>
<li>perform some function on that data, usually producing new values</li>
<li>send values downstream via outbound channels</li>
</ul>
<p>Each stage has any number of inbound and outbound channels, except the first and last stages, which have only outbound or inbound channels, respectively. The first stage is sometimes called the source or producer; the last stage, the sink or consumer. </p>
<h2><a class="header" href="#squaring-numbers" id="squaring-numbers">Squaring numbers</a></h2>
<ul>
<li>first stage: 
producer: 
<code>func gen(nums ...int) &lt;-chan int</code></li>
<li>second stage: 
can has many this stage
<code>func sq(in &lt;-chan int) &lt;-chan int</code></li>
<li>final stage:
consumer</li>
</ul>
<pre><code class="language-go">package main

import (
        &quot;fmt&quot;
)

func gen(nums ...int) &lt;-chan int {
        out := make(chan int)
        go func() {
                for _, n := range nums {
                        out &lt;- n
                }
                close(out)
        }()
        return out
}

func sq(in &lt;-chan int) &lt;-chan int {
        out := make(chan int)
        go func() {
                for n := range in {
                        out &lt;- n * n
                }
                close(out)
        }()
        return out
}

func main() {
        // Set up the pipeline and consume the output.
        for n := range sq(sq(gen(2, 3))) {
                fmt.Println(n) // 16 then 81
        }

}
</code></pre>
<h2><a class="header" href="#fan-out-fan-in" id="fan-out-fan-in">Fan-out, Fan-in</a></h2>
<p>Multiple functions can read from the same channel until that channel is closed; this is called fan-out. This provides a way to distribute work amongst a group of workers to parallelize CPU use and I/O.</p>
<p>A function can read from multiple inputs and proceed until all are closed by multiplexing the input channels onto a single channel that's closed when all the inputs are closed. This is called fan-in. </p>
<p><strong>Sends on a closed channel panic, so it's important to ensure all sends are done before calling close.</strong> The sync.WaitGroup type provides a simple way to arrange this synchronization</p>
<p>因为是要确保所有发送方都完成才能关闭通道,所以只有 Fan-In 有这种问题.</p>
<p>正常都执行完的场景,就是等到等待组都完成再关闭通道就可以了.</p>
<p>如果需要手动取消, 就使用哨子触发等待组完成.</p>
<pre><code class="language-go">func merge(cs ...&lt;-chan int) &lt;-chan int {
    var wg sync.WaitGroup
    out := make(chan int)

    // Start an output goroutine for each input channel in cs.  output
    // copies values from c to out until c is closed, then calls wg.Done.
    output := func(c &lt;-chan int) {
        for n := range c {
            out &lt;- n
        }
        wg.Done()
    }
    wg.Add(len(cs))
    for _, c := range cs {
        go output(c)
    }

    // Start a goroutine to close out once all the output goroutines are
    // done.  This must start after the wg.Add call.
    go func() {
        wg.Wait()
        close(out)
    }()
    return out
}

func main() {
    in := gen(2, 3)

    // Distribute the sq work across two goroutines that both read from in.
    c1 := sq(in)
    c2 := sq(in)

    // Consume the merged output from c1 and c2.
    for n := range merge(c1, c2) {
        fmt.Println(n) // 4 then 9, or 9 then 4
    }
}
</code></pre>
<h2><a class="header" href="#explicit-cancellation" id="explicit-cancellation">Explicit cancellation</a></h2>
<pre><code class="language-go">func main() {
    // Set up a done channel that's shared by the whole pipeline,
    // and close that channel when this pipeline exits, as a signal
    // for all the goroutines we started to exit.
    done := make(chan struct{})
    defer close(done)

    in := gen(done, 2, 3)

    // Distribute the sq work across two goroutines that both read from in.
    c1 := sq(done, in)
    c2 := sq(done, in)

    // Consume the first value from output.
    out := merge(done, c1, c2)
    fmt.Println(&lt;-out) // 4 or 9

    // done will be closed by the deferred call.
}

func merge(done &lt;-chan struct{}, cs ...&lt;-chan int) &lt;-chan int {
    var wg sync.WaitGroup
    out := make(chan int)

    // Start an output goroutine for each input channel in cs.  output
    // copies values from c to out until c or done is closed, then calls
    // wg.Done.
    output := func(c &lt;-chan int) {
        defer wg.Done()
        for n := range c {
            select {
            case out &lt;- n:
            case &lt;-done:
                return
            }
        }
    }
    // ... the rest is unchanged ...

func sq(done &lt;-chan struct{}, in &lt;-chan int) &lt;-chan int {
    out := make(chan int)
    go func() {
        defer close(out)
        for n := range in {
            select {
            case out &lt;- n * n:
            case &lt;-done:
                return
            }
        }
    }()
    return out
}
</code></pre>
<h1><a class="header" href="#slices" id="slices">slices</a></h1>
<h4><a class="header" href="#links-68" id="links-68">Links</a></h4>
<ul>
<li><a href="https://blog.golang.org/slices">Arrays, slices (and strings): The mechanics of 'append'</a></li>
<li><a href="https://blog.golang.org/go-slices-usage-and-internals">Go Slices: usage and internals</a></li>
<li><a href="https://research.swtch.com/godata">Go Data Structures</a></li>
<li><a href="https://golang.org/wiki/SliceTricks">&quot;Slice Tricks&quot; Wiki page </a></li>
</ul>
<h4><a class="header" href="#questions-that-must-be-answered" id="questions-that-must-be-answered">questions that must be answered</a></h4>
<ul>
<li>fixed-size or variable-size?</li>
<li>is the size part of the type?</li>
<li>what do multidimensional arrays look like?</li>
<li>does the empty array have meaning?</li>
</ul>
<h4><a class="header" href="#整理" id="整理">整理</a></h4>
<h5><a class="header" href="#基本类型在内存中的结构" id="基本类型在内存中的结构">基本类型在内存中的结构</a></h5>
<p><img src="go/basis/img/godata1.png" alt="" /></p>
<h5><a class="header" href="#结构和指針" id="结构和指針">结构和指針</a></h5>
<p>结构的字段(fields)在内存中也是连续的.如果字段是指针,那么它就是指针.</p>
<pre><code class="language-go">type Rect1 struct { Min, Max Point }
type Rect2 struct { Min, Max *Point }
</code></pre>
<p><img src="go/basis/img/godata1b.png" alt="" /></p>
<h5><a class="header" href="#arrays-数组" id="arrays-数组">Arrays 数组</a></h5>
<p>数组是定长的,长度是类型的一部分. 不同的长度就是不同的类型.比如,[256]byte [512]byte是不同的类型.</p>
<p>数组在内存中就是固定长度的连续的块.</p>
<h5><a class="header" href="#切片-和-切片头-slices-the-slice-header" id="切片-和-切片头-slices-the-slice-header">切片 和 切片头 Slices: The slice header</a></h5>
<p>直觉上切片就是变长数组的样子.本质上不是,本质上切片一种描述数组片段的数据结构<br />
它的数据结构本身完全不是数组的样子,完完全全是另一种东西.<br />
它的数据结构包含字段: 长度, 容量, 0元素指针</p>
<p>这是它的类型定义:</p>
<pre><code class="language-go">type sliceHeader struct {
    Length        int
    Capacity      int
    ZerothElement *byte
}
</code></pre>
<p>它在内存中的样子:</p>
<p><img src="go/basis/img/godata3.png" alt="" /></p>
<p>另一组图:</p>
<p><img src="go/basis/img/go-slices-usage-and-internals_slice-struct.png" alt="" /></p>
<p><code>make([]byte, 5)</code>后:</p>
<p><img src="go/basis/img/go-slices-usage-and-internals_slice-1.png" alt="" /></p>
<p><code>s = s[2:4]</code>后:</p>
<p><img src="go/basis/img/go-slices-usage-and-internals_slice-2.png" alt="" /></p>
<p><code>s = s[:cap(s)]</code>后:</p>
<p><img src="go/basis/img/go-slices-usage-and-internals_slice-3.png" alt="" /></p>
<p><strong>需要知道的是,0元素指针往前移了,就不能回头了</strong><br />
那么为什么不设计成可以回头呢?</p>
<h5><a class="header" href="#传值还是传指针給函数" id="传值还是传指针給函数">传值还是传指针給函数</a></h5>
<p>基本思想就是,对于以传值方式来工作的语言,在函数内部对值本身所作的修改,出了函数就不作数的,因为它是值的一个副本.但可以把这个值通过<code>return</code>返回.<br />
但在函数内,传入指针后,对指针所指向的内容作修改,是会影响到函数外的世界的.<br />
对于切片来説,传值給函数后,修改元素的值马上生效,修改切片本身需要<code>return</code>.</p>
<h4><a class="header" href="#new-and-make" id="new-and-make">new and make</a></h4>
<p>new(T) returns a *T,  make(T, args) returns an ordinary T.</p>
<p><img src="go/basis/img/godata4.png" alt="" /></p>
<h4><a class="header" href="#strings" id="strings">strings</a></h4>
<p>字符串就是只读切片,就是切片没有了容量字段.</p>
<p><img src="go/basis/img/godata2.png" alt="" /></p>
<h4><a class="header" href="#扩容切片-copy-and-append" id="扩容切片-copy-and-append">扩容切片 copy and append</a></h4>
<p>直觉上会觉得容量等于底层数组的长度,但其实容量是等于底层数组的长度减去切片0元素在数组上的索引.(我总是纠结算这种加减法到底要不要减一或加一的问题,完全没有办法弄清楚)</p>
<p>普世的扩容思路都一样,创建一个新的大的切片,然后把旧的复制过来.再賦值給旧的变量名,这个时候底层数组已经是另外一条了.成本还是很高的.</p>
<p>利用内建函数<code>copy</code>扩容:</p>
<pre><code class="language-go">t := make([]byte, len(s), (cap(s)+1)*2)  // +1 in case cap(s) == 0
copy(t, s)
s = t
</code></pre>
<p>利用内建函数<code>append</code>扩容:</p>
<ul>
<li>b... means &quot;expand b&quot;</li>
<li>...T means &quot;0+ of T&quot;</li>
</ul>
<pre><code class="language-go">func append(s []T, x ...T) []T  

a := []string{&quot;John&quot;, &quot;Paul&quot;}
b := []string{&quot;George&quot;, &quot;Ringo&quot;, &quot;Pete&quot;}
a = append(a, b...) // equivalent to &quot;append(a, b[0], b[1], b[2])&quot;
// a == []string{&quot;John&quot;, &quot;Paul&quot;, &quot;George&quot;, &quot;Ringo&quot;, &quot;Pete&quot;}
</code></pre>
<h4><a class="header" href="#要注意的gotcha" id="要注意的gotcha">要注意的gotcha</a></h4>
<p>切片的好处就是不用经常分配新内存,那么潜在的问题就是当你切完之后只需要很小的一部分数据,内存里的仍然是原来的大块的所有数据.
解决办法就像扩容那样,创建一个新的小的切片,把旧的数据复制过来,再返回结果.</p>
<h4><a class="header" href="#nil" id="nil">Nil</a></h4>
<p>理解不了哦:</p>
<pre><code>sliceHeader{
    Length:        0,
    Capacity:      0,
    ZerothElement: nil,
}
</code></pre>
<p>or just</p>
<p><code>sliceHeader{}</code></p>
<p>The key detail is that the element pointer is nil too. The slice created by</p>
<p><code>array[0:0]</code></p>
<p>has length zero (and maybe even capacity zero) but its pointer is not nil, so it is not a nil slice. </p>
<p>//这句話是想説啥?<br />
<strong>As should be clear, an empty slice can grow (assuming it has non-zero capacity), but a nil slice has no array to put values in and can never grow to hold even one element.</strong></p>
<p>That said, a nil slice is functionally equivalent to a zero-length slice, even though it points to nothing. It has length zero and can be appended to, with allocation.</p>
<h4><a class="header" href="#conclusion" id="conclusion">Conclusion</a></h4>
<p>切片头变来变去,底层数组恒久远.</p>
<h4><a class="header" href="#深入了解-copy-和-append" id="深入了解-copy-和-append">深入了解 copy 和 append</a></h4>
<pre><code class="language-go">
// append
a = append(a, b...)

// copy
b = make([]T, len(a))
copy(b, a)
// or
b = append([]T(nil), a...)

// cut
// 意外不意外,用append实现了cut
// 更让我意外的是,这个cut掉的是a[i:j-1]这一段,而不是a[i-1:j-1]这一段
// 因为a[i:j]是左闭右开的,意思是from i til j, 也就是x &gt;= i &amp;&amp; x &lt; j
// 所以a[0:0]是不包含a[0]的
a = append(a[:i], a[j:]...)

// delete
a = append(a[:i], a[i+1:]...)
// or
a = a[:i+copy(a[i:], a[i+1:])]

// Delete without preserving order
a[i] = a[len(a)-1] 
a = a[:len(a)-1]


// NOTE If the type of the element is a pointer or a struct with pointer fields, which need to be garbage collected, the above implementations of Cut and Delete have a potential memory leak problem: some elements with values are still referenced by slice a and thus can not be collected. The following code can fix this problem:

// Cut
copy(a[i:], a[j:])
for k, n := len(a)-j+i, len(a); k &lt; n; k++ {
    a[k] = nil // or the zero value of T
}
a = a[:len(a)-j+i]

// Delete
copy(a[i:], a[i+1:])
a[len(a)-1] = nil // or the zero value of T
a = a[:len(a)-1]

// Delete without preserving order
a[i] = a[len(a)-1]
a[len(a)-1] = nil
a = a[:len(a)-1]


// Expand
a = append(a[:i], append(make([]T, j), a[i:]...)...)

// Extend
a = append(a, make([]T, j)...)

// Insert
s = append(s, 0)
copy(s[i+1:], s[i:])
s[i] = x


// Pop/Shift
x, a = a[0], a[1:]

// Pop Back
x, a = a[len(a)-1], a[:len(a)-1]

// Push
a = append(a, x)

// Push Front/Unshift
a = append([]T{x}, a...)

// Filtering without allocating
// This trick uses the fact that a slice shares the same backing array and capacity as the original, so the storage is reused for the filtered slice. Of course, the original contents are modified.
b := a[:0]
for _, x := range a {
    if f(x) {
        b = append(b, x)
    }
}

// Reversing
// To replace the contents of a slice with the same elements but in reverse order:
for i := len(a)/2-1; i &gt;= 0; i-- {
    opp := len(a)-1-i
    a[i], a[opp] = a[opp], a[i]
}

// The same thing, except with two indices:
for left, right := 0, len(a)-1; left &lt; right; left, right = left+1, right-1 {
    a[left], a[right] = a[right], a[left]
}

// Shuffling
// Fisher–Yates algorithm:
for i := len(a) - 1; i &gt; 0; i-- {
    j := rand.Intn(i + 1)
    a[i], a[j] = a[j], a[i]
}

</code></pre>
<h1><a class="header" href="#strings-1" id="strings-1">strings</a></h1>
<h4><a class="header" href="#links-69" id="links-69">Links</a></h4>
<ul>
<li><a href="https://blog.golang.org/strings">Strings, bytes, runes and characters in Go</a></li>
<li><a href="https://blog.golang.org/normalization">Text normalization in Go</a></li>
<li><a href="http://www.joelonsoftware.com/articles/Unicode.html">The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!).</a></li>
<li><a href="http://unicode.org/reports/tr15/">Annex 15 of the Unicode Standard</a></li>
<li><a href="https://en.wikipedia.org/wiki/Unicode_equivalence">Unicode equivalence - Wikipedia</a></li>
</ul>
<h1><a class="header" href="#socket" id="socket">Socket</a></h1>
<h1><a class="header" href="#links-70" id="links-70">Links</a></h1>
<ul>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/index.html">Network Programming with Go (golang)</a></li>
<li><a href="http://www.zytrax.com/tech/protocols/tcp.html">Tech Stuff - TCP/IP Message (TCP, UDP, ICMP and IP) Formats</a></li>
<li><a href="https://blog.csdn.net/ce123_zhouwei/article/details/8976006">面向报文（UDP）和面向字节流（TCP）的区别 - CSDN博客</a></li>
</ul>
<h1><a class="header" href="#iso-osi-protocol" id="iso-osi-protocol">ISO OSI Protocol</a></h1>
<p><img src="go/basis/img/iso.gif" alt="alt text" /></p>
<h1><a class="header" href="#tcpip-protocol" id="tcpip-protocol">TCP/IP Protocol</a></h1>
<p><img src="go/basis/img/tcp_stack.gif" alt="alt text" /></p>
<h1><a class="header" href="#some-alternative-protocols" id="some-alternative-protocols">Some Alternative Protocols</a></h1>
<p>Firewire USB Bluetooth WiFi</p>
<h1><a class="header" href="#packet-encapsulation" id="packet-encapsulation">Packet encapsulation</a></h1>
<p><img src="go/basis/img/packets.gif" alt="alt text" /></p>
<h1><a class="header" href="#connection-models" id="connection-models">Connection Models</a></h1>
<p>There are two major models for this:</p>
<ul>
<li>Connection oriented</li>
<li>Connectionless</li>
</ul>
<h2><a class="header" href="#connection-oriented" id="connection-oriented">Connection oriented</a></h2>
<p>A single connection is established for the session. Two-way communications flow along the connection. 
When the session is over, the connection is broken. 
The analogy is to a phone conversation. An example is TCP</p>
<h2><a class="header" href="#connectionless" id="connectionless">Connectionless</a></h2>
<p>In a connectionless system, messages are sent independent of each other. 
Ordinary mail is the analogy. 
Connectionless messages may arrive out of order. An example is the IP protocol.</p>
<p>Connection oriented transports may be established on top of connectionless ones - TCP over IP. 
Connectionless transports my be established on top of connection oriented ones - HTTP over TCP.</p>
<h1><a class="header" href="#communications-models" id="communications-models">Communications Models</a></h1>
<h2><a class="header" href="#message-passing" id="message-passing">Message passing</a></h2>
<p>Some non-procedural languages are built on the principle of message passing. Concurrent languages often use such a mechanism</p>
<p><img src="go/basis/img/msg.gif" alt="alt text" /></p>
<h2><a class="header" href="#remote-procedure-call" id="remote-procedure-call">Remote procedure call</a></h2>
<p>In any system, there is a transfer of information and <strong>flow control</strong> from one part of the system to another.</p>
<p><img src="go/basis/img/rpc.gif" alt="alt text" /></p>
<h1><a class="header" href="#distributed-computing-models" id="distributed-computing-models">Distributed Computing Models</a></h1>
<p><img src="go/basis/img/peer.gif" alt="alt text" /></p>
<h2><a class="header" href="#server-distribution" id="server-distribution">Server Distribution</a></h2>
<p>multiple clients, single server </p>
<p><img src="go/basis/img/many-one.gif" alt="alt text" /></p>
<p>single client, multiple servers , occurs frequently when a server needs to act as a client to other servers</p>
<p><img src="go/basis/img/one-many.gif" alt="alt text" /></p>
<h2><a class="header" href="#component-distribution" id="component-distribution">Component Distribution</a></h2>
<ul>
<li>Presentation component</li>
<li>Application logic</li>
<li>Data access</li>
</ul>
<h1><a class="header" href="#gartner-classification" id="gartner-classification">Gartner Classification</a></h1>
<h2><a class="header" href="#five-models" id="five-models">five models</a></h2>
<p><img src="go/basis/img/gartner.gif" alt="alt text" /></p>
<ul>
<li>model 1: Google maps</li>
<li>model 2: NFS</li>
<li>model 3: Web{html, java, cgi, httpd}</li>
<li>model 4: terminal emulation</li>
<li>model 5: X Window System </li>
</ul>
<h2><a class="header" href="#three-tier-models" id="three-tier-models">Three Tier Models</a></h2>
<p>Of course, if you have two tiers, then you can have three, four, or more.</p>
<p><img src="go/basis/img/threetier.gif" alt="alt text" /></p>
<h2><a class="header" href="#middleware-model" id="middleware-model">Middleware model</a></h2>
<p><img src="go/basis/img/middleware.gif" alt="alt text" /></p>
<h1><a class="header" href="#continuum-of-processing" id="continuum-of-processing">Continuum of Processing</a></h1>
<p><img src="go/basis/img/continuum.gif" alt="alt text" /></p>
<h1><a class="header" href="#points-of-failure" id="points-of-failure">Points of Failure</a></h1>
<ul>
<li>The client side of the application could crash</li>
<li>The client system may have h/w problems</li>
<li>The client's network card could fail</li>
<li>Network contention could cause timeouts</li>
<li>There may be network address conflicts</li>
<li>Network elements such as routers could fail</li>
<li>Transmission errors may lose messages</li>
<li>The client and server versions may be incompatible</li>
<li>The server's network card could fail</li>
<li>The server system may have h/w problems</li>
<li>The server s/w may crash</li>
<li>The server's database may become corrupted</li>
</ul>
<h1><a class="header" href="#acceptance-factors" id="acceptance-factors">Acceptance Factors</a></h1>
<ul>
<li>Reliability</li>
<li>Performance</li>
<li>Responsiveness</li>
<li>Scalability</li>
<li>Capacity</li>
<li>Security</li>
</ul>
<h1><a class="header" href="#transparency" id="transparency">Transparency</a></h1>
<ul>
<li>access transparency</li>
<li>location transparency</li>
<li>migration transparency</li>
<li>replication transparency</li>
<li>concurrency transparency</li>
<li>scalability transparency</li>
<li>performance transparency</li>
<li>failure transparency</li>
</ul>
<h1><a class="header" href="#eight-fallacies-of-distributed-computing" id="eight-fallacies-of-distributed-computing">Eight fallacies of distributed computing</a></h1>
<ul>
<li>The network is reliable.</li>
<li>Latency is zero.</li>
<li>Bandwidth is infinite.</li>
<li>The network is secure.</li>
<li>Topology doesn't change.</li>
<li>There is one administrator.</li>
<li>Transport cost is zero.</li>
<li>The network is homogeneous.</li>
</ul>
<h1><a class="header" href="#init-functions-in-go" id="init-functions-in-go">init functions in Go</a></h1>
<h1><a class="header" href="#links-71" id="links-71">Links</a></h1>
<ul>
<li><a href="https://medium.com/golangspec/init-functions-in-go-eac191b3860a">init functions in Go – golangspec – Medium</a></li>
<li><a href="https://medium.com/golangspec/initialization-dependencies-in-go-51ae7b53f24c">Initialization dependencies in Go – golangspec – Medium</a></li>
<li><a href="https://golang.org/doc/effective_go.html#init">The init function ¶</a></li>
<li><a href="https://stackoverflow.com/questions/24790175/when-is-the-init-function-run/49831018#49831018">go - When is the init() function run? - Stack Overflow</a></li>
</ul>
<p><img src="go/basis/img/init.png" alt="init.png" /></p>
<p>init functions are defined in package block and are used for:</p>
<ul>
<li>variables initialization if cannot be done in initialization expression,</li>
<li>checking / fixing program’s state,</li>
<li>registering,</li>
<li>running one-time computations,</li>
<li>and many more.</li>
</ul>
<p>init function doesn’t take arguments neither returns any value. In contrast to main, identifier init is not declared so cannot be referenced:</p>
<pre><code class="language-go">package main

import &quot;fmt&quot;

func init() {
    fmt.Println(&quot;init&quot;)
}

func main() {
    init()
}
</code></pre>
<p>and it gives “undefined: init” error while compilation.</p>
<pre><code>Formally speaking init identifier doesn’t introduce binding. In the same way works blank identifier represented by underscore character.
</code></pre>
<p>===</p>
<p>The most common use case of init function is to assign a value which cannot be calculated as a part of initialization expression:</p>
<pre><code class="language-go">var precomputed = [20]float64{}

func init() {
    var current float64 = 1
    precomputed[0] = current
    for i := 1; i &lt; len(precomputed); i++ {
        precomputed[i] = precomputed[i-1] * 1.2
    }
}
</code></pre>
<p>It’s not possible to use for loop as an expression (it’s a statement in Go) so putting it into init function solves the problem.</p>
<p>这个的意思是for loop只有法在函数里面，而这时候又需要precomputed，所以放在init()里</p>
<h1><a class="header" href="#garbage-collector" id="garbage-collector">Garbage Collector</a></h1>
<h1><a class="header" href="#links-72" id="links-72">Links</a></h1>
<ul>
<li><a href="https://blog.golang.org/ismmkeynote">Getting to Go: The Journey of Go's Garbage Collector - The Go Blog</a></li>
<li><a href="https://github.com/golang/proposal/blob/master/design/14951-soft-heap-limit.md">proposal/14951-soft-heap-limit.md at master · golang/proposal · GitHub</a></li>
<li><a href="https://github.com/golang/go/issues/14045">runtime: reclaim memory used by huge array that is no longer referenced · Issue #14045 · golang/go · GitHub</a></li>
<li><a href="https://golangcode.com/print-the-current-memory-usage/">Print The Current Memory Usage · GolangCode</a></li>
<li><a href="https://golang.org/pkg/runtime/">runtime - The Go Programming Language</a></li>
<li><a href="https://golang.org/pkg/runtime/debug/">debug - The Go Programming Language</a></li>
<li><a href="https://engineering.linecorp.com/en/blog/go-gc/">Go GC - LINE ENGINEERING</a></li>
<li><a href="https://dougrichardson.org/2016/01/23/go-memory-allocations.html">Memory Management in Go</a></li>
</ul>
<h1><a class="header" href="#func-freeosmemory" id="func-freeosmemory">func FreeOSMemory</a></h1>
<p>FreeOSMemory forces a garbage collection followed by an attempt to return as much memory to the operating system as possible. (Even if this is not called, the runtime gradually returns memory to the operating system in a background task.) </p>
<pre><code class="language-go">func debug.FreeOSMemory()
</code></pre>
<h1><a class="header" href="#print-the-current-memory-usage" id="print-the-current-memory-usage">Print The Current Memory Usage</a></h1>
<pre><code class="language-go">m := &amp;runtime.MemStats{}

runtime.ReadMemStats(m)

fmt.Printf(&quot;Alloc = %v MiB&quot;, m.Alloc)
fmt.Printf(&quot;\tTotalAlloc = %v MiB&quot;, m.TotalAlloc)
fmt.Printf(&quot;\tSys = %v MiB&quot;, m.Sys)
fmt.Printf(&quot;\tNumGC = %v\n&quot;, m.NumGC)
</code></pre>
<h1><a class="header" href="#mark-mem-as-res" id="mark-mem-as-res">Mark Mem As RES</a></h1>
<pre><code class="language-go">func allocate(n int) []byte {

	b := make([]byte, n)

	for i := 0; i &lt; n; i += os.Getpagesize() {
		b[i] = 1
	}

	return b
}
</code></pre>
<h1><a class="header" href="#type-variable-value-的关系" id="type-variable-value-的关系">type variable value 的关系</a></h1>
<h4><a class="header" href="#类型-变量-值" id="类型-变量-值">类型 变量 值</a></h4>
<p>类型代表一个种类</p>
<p>变量是这个种类中的其中之一, 还是值是这个种类中的其中之一呢?</p>
<p>变量可以被赋予不同的值, 类型下也可以创建出不同的变量名, 就如同人的名字一样</p>
<p>那么 值 才是真正表达出他与其它员的区别, 而不是变量, 但一旦变量被赋予某个值之后, 也可以説变量因值的存在而存在, 所以变量就是这个区别的表达</p>
<p>所以,类型下可以有很多变量, 变量可以被赋予许多值, 但同一时间, 变量的值唯一, 但是其它变量名也可以等于这个值, 这个时候是相同的值在不同的位置, </p>
<p>所以, 值并不唯一. 也可以理解. 但相同的值, 体现出了不唯一, 是因为位置, 也就是因为变量.这里所説的变量 似乎又和变量名不是一个概念, 然而也不是在説值</p>
<p>自然语言里,总是将变量本身,和变量名混为一談,才有这样的混乱</p>
<p>我们説到变量本身的时候, 就是指变量的值. 但也可以不是. 不知道是东方語言的垃圾, 还是語言本身的垃圾.</p>
<p>所以説, <strong>变量的本质是地址, 值才是类型中的一员</strong>, 但值无法摆脱变量.</p>
<p>类型其实也就是名字, 那么类型是什么的名字?</p>
<p>uint是类型, Hash也是类型, Hash类型实现的函数, 并不属于属于unit类型</p>
<p>变量可以做相等, 大小判断, 类型是否也可以? 本质上可以, 但这没有意义, 所以不会做这样的设计</p>
<p>所以, 我想真实的世界, 本质上也都是可以, 只是没有设计.</p>
<h1><a class="header" href="#loop" id="loop">Loop</a></h1>
<pre><code>for i := 0; i &lt; l; i++ {
	do sth. 
}
</code></pre>
<ul>
<li>从0开始数的, 循环体执行的次数是l次,若从1开始,循环体执行的次数就是l-1次<br />
怎么理解这种东西呢, 不管从几开始数, i == l的那一次是不执行循环体的<br />
所以循环体执行的次数就是从0或1到l-1次</li>
<li>不管从几开始数,i的最終状态等于l</li>
</ul>
<p>循环体执行的次数和i发生的变化次数是相等的吗?</p>
<p>是的.</p>
<p>而所谓变化次数,其实就是间距.</p>
<p>我总是理解不了 间距 距离 相差 相减 89年生到98年是多少岁 </p>
<p>大于46小于64的数有几个? 为什么不是就是64-46呢?而是64-46,再减1,其实我直觉以为64-46,再减2</p>
<h1><a class="header" href="#modules" id="modules">Modules</a></h1>
<h1><a class="header" href="#links-73" id="links-73">Links</a></h1>
<ul>
<li><a href="https://github.com/golang/go/wiki/Modules">Modules · golang/go Wiki · GitHub</a></li>
</ul>
<h1><a class="header" href="#quick-start-2" id="quick-start-2">Quick Start</a></h1>
<pre><code class="language-sh">go mod init github.com/you/hello

// or

go mod init .

go build 
</code></pre>
<h1><a class="header" href="#asynchronous-vs-synchronous" id="asynchronous-vs-synchronous">Asynchronous vs synchronous</a></h1>
<h1><a class="header" href="#links-74" id="links-74">Links</a></h1>
<ul>
<li><a href="https://stackoverflow.com/a/748235">Asynchronous vs synchronous execution, what does it really mean? - Stack Overflow</a></li>
</ul>
<p>Synchronous/Asynchronous <strong>HAS NOTHING TO DO WITH MULTI-THREADING.</strong></p>
<p>Synchronous, or Synchronized means &quot;connected&quot;, or &quot;dependent&quot; in some way. In
other words, two synchronous tasks must be aware of one another, and one task
must execute in some way that is dependent on the other, such as wait to start
until the other task has completed.</p>
<p>Asynchronous means they are totally independent and neither one must consider
the other in any way, either in initiation or in execution. </p>
<h1><a class="header" href="#monitor-goroutines" id="monitor-goroutines">Monitor goroutines</a></h1>
<h1><a class="header" href="#links-75" id="links-75">Links</a></h1>
<ul>
<li><a href="https://medium.com/dm03514-tech-blog/golang-monitors-and-mutexes-a-light-survey-84f04f9b7c09">Golang: Concurrency: Monitors and Mutexes, A (light) Survey</a></li>
</ul>
<pre><code class="language-go">func NewCounterMonitor(ctx context.Context) chan &lt;- int {
   ch := make(chan int)

   go func() {
      counter := 0
	  for {
         select {
            case i, ok := &lt;-ch:
               if !ok {
                   return
               }
               counter += i
            case &lt;-ctx.Done():
               fmt.Printf(&quot;final_count: %d\n&quot;, counter)
               return
         }
      }
   }()

   return ch
}
</code></pre>
<p>From <a href="https://medium.com/dm03514-tech-blog/golang-monitors-and-mutexes-a-light-survey-84f04f9b7c09">Golang: Concurrency: Monitors and Mutexes, A (light) Survey</a>:</p>
<p><img src="go/basis/img/monitor_goroutine.png" alt="monitor_goroutine" /></p>
<h1><a class="header" href="#how-to-check-if-a-file-exists-" id="how-to-check-if-a-file-exists-">How to check if a file exists ?</a></h1>
<h1><a class="header" href="#links-76" id="links-76">Links</a></h1>
<ul>
<li><a href="https://stackoverflow.com/a/22483001">How to check if a file exists in Go? - Stack Overflow</a></li>
</ul>
<pre><code>Answer by Caleb Spare posted in gonuts mailing list.

    [...] It's not actually needed very often and [...] using os.Stat is easy enough for the cases where it is required.

    [...] For instance: if you are going to open the file, there's no reason to check whether it exists first. The file could disappear in between checking and opening, and anyway you'll need to check the os.Open error regardless. So you simply call os.IsNotExist(err) after you try to open the file, and deal with its non-existence there (if that requires special handling).

    [...] You don't need to check for the paths existing at all (and you shouldn't).

        os.MkdirAll works whether or not the paths already exist. (Also you need to check the error from that call.)

        Instead of using os.Create, you should use os.OpenFile(path, os.O_RDWR|os.O_CREATE|os.O_EXCL, 0666) . That way you'll get an error if the file already exists. Also this doesn't have a race condition with something else making the file, unlike your version which checks for existence beforehand.

Taken from: https://groups.google.com/forum/#!msg/golang-nuts/Ayx-BMNdMFo/4rL8FFHr8v4J
</code></pre>
<h1><a class="header" href="#a-hrefhttpsstackoverflowcomquestions22751035golang-distinguish-ipv4-ipv6go---golang-distinguish-ipv4-ipv6---stack-overflowa" id="a-hrefhttpsstackoverflowcomquestions22751035golang-distinguish-ipv4-ipv6go---golang-distinguish-ipv4-ipv6---stack-overflowa"><a href="https://stackoverflow.com/questions/22751035/golang-distinguish-ipv4-ipv6">go - golang distinguish IPv4 IPv6 - Stack Overflow</a></a></h1>
<h1><a class="header" href="#links-77" id="links-77">Links</a></h1>
<p><a href="https://stackoverflow.com/questions/22751035/golang-distinguish-ipv4-ipv6/22752227#22752227">go - golang distinguish IPv4 IPv6 - Stack Overflow</a></p>
<pre><code> simply check ip.To4() != nil. Since the documentation says &quot;if ip is not an IPv4 address, To4 returns nil&quot; this condition should return true if and only if the address is an IPv4 address.
</code></pre>
<h1><a class="header" href="#gorutine_and_cwd" id="gorutine_and_cwd">gorutine_and_cwd</a></h1>
<h1><a class="header" href="#links-78" id="links-78">Links</a></h1>
<ul>
<li><a href="https://stackoverflow.com/questions/33001411/changing-directories-in-go-routines">Changing directories in go routines - Stack Overflow</a></li>
</ul>
<p>it's a property of the thread on unix systems, and since goroutines can be run on multiple different threads you can find the CWD changed out from under you if your goroutine gets moved. </p>
<h1><a class="header" href="#client-and-server" id="client-and-server">Client and Server</a></h1>
<ol>
<li>Need a struct called Client or Server hold Options</li>
<li>Need a <code>func NewClient(conn net.Conn) ( *Client, error)</code> and a <code>func Dial(address string) (*Client, error)</code></li>
<li>Need a <code>func Close() error</code></li>
<li>cmd func</li>
<li>Server struct need <code>func Serve(l net.Listener) error</code> and <code>func ListenAndServe() error</code></li>
<li>Server need type Session struct</li>
</ol>
<pre><code class="language-go">type Server struct {
	Addr string
	Hostname string
}

func (s *Server) Serve(l net.Listener) error {

	defer l.Close()

	for {
		c, err := l.Accept()
		if err != nil {
			return err
		}

		ss := s.newSession(c)
		go ss.Serve()

	}
}


func (s *Server) ListenAndServe() error {
	addr := s.Addr
	if addr == &quot;&quot; {
		addr = &quot;:1080&quot;
	}

	l, err := net.Listen(&quot;tcp&quot;, addr)
	if err != nil {
		return err
	}
	return s.Serve(l)

}

func ListenAndServe(addr string) error {
	s := &amp;Server{Addr: addr}
	return s.ListenAndServe()
}

type Session struct {
	s *Server
	conn net.Conn
}

func (s *Server) newSession(conn net.Conn) *Session {
	return &amp;Session{
		s:    s,
		conn: conn,
	}
}

func( ss *Session) Serve()  error {
	initSession()
	for {
		switch c {
		    case x: handleCmd()
		    default:
		}
	}
}
</code></pre>
<h1><a class="header" href="#how-to-signal-to-a-execcmd" id="how-to-signal-to-a-execcmd">How to signal to a exec.Cmd</a></h1>
<p>We can:</p>
<pre><code>cmd := exec.Command(name, args...)
err := cmd.Start()

// balabala

err = cmd.Process(os.Interrupt)
</code></pre>
<h1><a class="header" href="#material" id="material">Material</a></h1>
<p>From <code>go doc exec.Cmd</code>:</p>
<pre><code>type Cmd struct {

		...

        // Process is the underlying process, once started.
        Process *os.Process

        // ProcessState contains information about an exited process,
        // available after a call to Wait or Run.
        ProcessState *os.ProcessState

        // Has unexported fields.

		...
}
</code></pre>
<p>From <code>go doc os.Process</code>:</p>
<pre><code>type Process struct {
        Pid int

        // Has unexported fields.
}
    Process stores the information about a process created by StartProcess.

func (p *Process) Signal(sig Signal) error
</code></pre>
<p>From <code>go doc os.Signal</code>:</p>
<pre><code>type Signal interface {
        String() string
        Signal() // to distinguish from other Stringers
}
    A Signal represents an operating system signal. The usual underlying
    implementation is operating system-dependent: on Unix it is syscall.Signal.


var Interrupt Signal = syscall.SIGINT ...
</code></pre>
<h1><a class="header" href="#pipe-ioreadwritecloser" id="pipe-ioreadwritecloser">Pipe io.ReadWriteCloser</a></h1>
<h1><a class="header" href="#links-79" id="links-79">Links</a></h1>
<ul>
<li><a href="https://github.com/jpillora/chisel/blob/master/share/pipe.go#L8">chisel/pipe.go at master · jpillora/chisel · GitHub</a></li>
</ul>
<h1><a class="header" href="#code-1" id="code-1">Code</a></h1>
<pre><code class="language-go">func Pipe(src io.ReadWriteCloser, dst io.ReadWriteCloser) (int64, int64) {
	var sent, received int64
	var wg sync.WaitGroup
	var once sync.Once
	close := func() {
		src.Close()
		dst.Close()
	}
	wg.Add(2)
	go func() {
		received, _ = io.Copy(src, dst)
		once.Do(close)
		wg.Done()
	}()
	go func() {
		sent, _ = io.Copy(dst, src)
		once.Do(close)
		wg.Done()
	}()
	wg.Wait()
	return sent, received
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgpackagesa" id="a-hrefhttpsgolangorgpkgpackagesa"><a href="https://golang.org/pkg/">Packages</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgiopackage-ioa" id="a-hrefhttpsgolangorgpkgiopackage-ioa"><a href="https://golang.org/pkg/io/">Package io</a></a></h1>
<h1><a class="header" href="#links-80" id="links-80">Links</a></h1>
<ul>
<li><a href="http://www.cnblogs.com/golove/p/3276678.html">Golang学习 - io 包</a></li>
</ul>
<h1><a class="header" href="#4个最基本的接口" id="4个最基本的接口">4个最基本的接口</a></h1>
<pre><code class="language-go">type Reader interface {
    Read(p []byte) (n int, err error)
}

type Writer interface {
    Write(p []byte) (n int, err error)
}

type Closer interface {
    Close() error
}

type Seeker interface {
    Seek(offset int64, whence int) (int64, error)
}
</code></pre>
<h1><a class="header" href="#7个基本接口的组合接口" id="7个基本接口的组合接口">7个基本接口的组合接口</a></h1>
<pre><code class="language-go">type ReadWriter interface {
    Reader
    Writer
}

type ReadCloser interface {
    Reader
    Closer
}

type WriteCloser interface {
    Writer
    Closer
}

type ReadWriteCloser interface {
    Reader
    Writer
    Closer
}

type ReadSeeker interface {
    Reader
    Seeker
}

type WriteSeeker interface {
    Writer
    Seeker
}

type ReadWriteSeeker interface {
    Reader
    Writer
    Seeker
}
</code></pre>
<h1><a class="header" href="#2个操作读写接口的接口" id="2个操作读写接口的接口">2个操作读写接口的接口</a></h1>
<p>以读写接口作为参数的2个接口</p>
<p>读从接口,写到接口</p>
<p>既然是接口就一定要某种类型实现了才有效,然后由那种类型的东西来调用.而不能由io包来调用.</p>
<p>而下面的6个操作读写接口的函数则由io包来调用.</p>
<p>也就是，一个包里的接口，需要东西去实现了才能用 函数不是 函数可以用包名直接调用 </p>
<pre><code class="language-go">type ReaderFrom interface {
    ReadFrom(r Reader) (n int64, err error)
}

type WriterTo interface {
    WriteTo(w Writer) (n int64, err error)
}
</code></pre>
<h1><a class="header" href="#2个偏移读写接口" id="2个偏移读写接口">2个偏移读写接口</a></h1>
<p>这两个接口和前面的读写接口没有关系，是另一种接口，和基本的读写接口比，多了一个偏移参数 </p>
<pre><code class="language-go">type ReaderAt interface {
    ReadAt(p []byte, off int64) (n int, err error)
}

type WriterAt interface {
    WriteAt(p []byte, off int64) (n int, err error)
}
</code></pre>
<h1><a class="header" href="#5个字节符文相关的读写接口" id="5个字节符文相关的读写接口">5个字节,符文相关的读写接口</a></h1>
<pre><code class="language-go">type ByteReader interface {
    ReadByte() (byte, error)
}

type ByteScanner interface {
    ByteReader
    UnreadByte() error
}

type ByteWriter interface {
    WriteByte(c byte) error
}

type RuneReader interface {
    ReadRune() (r rune, size int, err error)
}

type RuneScanner interface {
    RuneReader
    UnreadRune() error
}
</code></pre>
<h1><a class="header" href="#6个操作读写接口的函数" id="6个操作读写接口的函数">6个操作读写接口的函数</a></h1>
<p>ReadAtLeast reads from r into buf until it has read at least min bytes. It returns the number of bytes copied and an error if fewer bytes were read. The error is EOF only if no bytes were read. If an EOF happens after reading fewer than min bytes, ReadAtLeast returns ErrUnexpectedEOF. If min is greater than the length of buf, ReadAtLeast returns ErrShortBuffer. On return, n &gt;= min if and only if err == nil.</p>
<pre><code class="language-go">func WriteString(w Writer, s string) (n int, err error) 

func ReadAtLeast(r Reader, buf []byte, min int) (n int, err error) 
func ReadFull(r Reader, buf []byte) (n int, err error) {
    return ReadAtLeast(r, buf, len(buf))
}

func Copy(dst Writer, src Reader) (written int64, err error)  
func CopyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error)
func CopyN(dst Writer, src Reader, n int64) (written int64, err error) {
    written, err = Copy(dst, LimitReader(src, n))
    if written == n {
        return n, nil
    }
    if written &lt; n &amp;&amp; err == nil {
        // src stopped early; must have been EOF.
        err = EOF
    }
    return
}
</code></pre>
<h1><a class="header" href="#4个包内实现了基本接口的类型" id="4个包内实现了基本接口的类型">4个包内实现了基本接口的类型</a></h1>
<p>限制读类型、部分读类型、管道读类型、管道写类型</p>
<p>限制读类型是对读接口包装,部分读类型是对偏移读接口的包装.</p>
<p>也就是説,只要某种类型实现了读接口就可以转换为限制读类型,实现了偏移读接口就可以转换为部分读类型.</p>
<p>SectionReader implements Read, Seek, and ReadAt on a section of an underlying ReaderAt.</p>
<p>Pipe creates a synchronous in-memory pipe. It can be used to connect code expecting an io.Reader with code expecting an io.Writer.</p>
<p>Reads and Writes on the pipe are matched one to one except when multiple Reads are needed to consume a single Write. That is, each Write to the PipeWriter blocks until it has satisfied one or more Reads from the PipeReader that fully consume the written data. The data is copied directly from the Write to the corresponding Read (or Reads); there is no internal buffering.</p>
<p>It is safe to call Read and Write in parallel with each other or with Close. Parallel calls to Read and parallel calls to Write are also safe: the individual calls will be gated sequentially.</p>
<pre><code class="language-go">type LimitedReader struct {
    R Reader // underlying reader
    N int64  // max bytes remaining
}

func LimitReader(r Reader, n int64) Reader

func (l *LimitedReader) Read(p []byte) (n int, err error)


type SectionReader struct {
    r     ReaderAt
    base  int64
    off   int64
    limit int64
}

func NewSectionReader(r ReaderAt, off int64, n int64) *SectionReader

func (s *SectionReader) Read(p []byte) (n int, err error)
func (s *SectionReader) ReadAt(p []byte, off int64) (n int, err error)
func (s *SectionReader) Seek(offset int64, whence int) (int64, error)
func (s *SectionReader) Size() int64


type PipeReader struct {
    p *pipe
}

type PipeWriter struct {
    p *pipe
}

func Pipe() (*PipeReader, *PipeWriter)

func (r *PipeReader) Read(data []byte) (n int, err error)
func (r *PipeReader) Close() error
func (r *PipeReader) CloseWithError(err error) error

func (w *PipeWriter) Write(data []byte) (n int, err error)
func (w *PipeWriter) Close() error
func (w *PipeWriter) CloseWithError(err error) error
</code></pre>
<h1><a class="header" href="#4个生成特殊功能读写接口的函数" id="4个生成特殊功能读写接口的函数">4个生成特殊功能读写接口的函数</a></h1>
<p>LimitReader returns a Reader that reads from r but stops with EOF after n bytes. The underlying implementation is a *LimitedReader.</p>
<p>TeeReader returns a Reader that writes to w what it reads from r. All reads from r performed through it are matched with corresponding writes to w. There is no internal buffering - the write must complete before the read completes. Any error encountered while writing is reported as a read error.</p>
<p>MultiReader returns a Reader that's the logical concatenation of the provided input readers. They're read sequentially. Once all inputs have returned EOF, Read will return EOF. If any of the readers return a non-nil, non-EOF error, Read will return that error.</p>
<p>MultiWriter creates a writer that duplicates its writes to all the provided writers, similar to the Unix tee(1) command.</p>
<p>Each write is written to each listed writer, one at a time. If a listed writer returns an error, that overall write operation stops and returns the error; it does not continue down the list.</p>
<pre><code class="language-go">func LimitReader(r Reader, n int64) Reader
func TeeReader(r Reader, w Writer) Reader
func MultiReader(readers ...Reader) Reader
func MultiWriter(writers ...Writer) Writer
</code></pre>
<p><a href="https://golang.org/pkg/bytes/#pkg-index">Package bytes</a>中的Buffer类型实现IO接口
<a href="https://golang.org/pkg/os/#pkg-index">Package os</a>中的File类型实现IO接口</p>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgioioutilpackage-ioutila" id="a-hrefhttpsgolangorgpkgioioutilpackage-ioutila"><a href="https://golang.org/pkg/io/ioutil/">Package ioutil</a></a></h1>
<h1><a class="header" href="#links-81" id="links-81">Links</a></h1>
<ul>
<li><a href="https://www.cnblogs.com/golove/p/3278444.html">Golang学习 - io/ioutil 包</a></li>
</ul>
<h1><a class="header" href="#discard" id="discard">Discard</a></h1>
<p><code>var Discard io.Writer = devNull(0)</code></p>
<h1><a class="header" href="#func" id="func">Func</a></h1>
<pre><code class="language-go">func NopCloser(r io.Reader) io.ReadCloser
func ReadAll(r io.Reader) ([]byte, error)

func TempFile(dir, pattern string) (f *os.File, err error)
func ReadFile(filename string) ([]byte, error)
func WriteFile(filename string, data []byte, perm os.FileMode) error

func TempDir(dir, prefix string) (name string, err error)
func ReadDir(dirname string) ([]os.FileInfo, error)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgerrorspackage-errorsa" id="a-hrefhttpsgolangorgpkgerrorspackage-errorsa"><a href="https://golang.org/pkg/errors/">Package errors</a></a></h1>
<h1><a class="header" href="#links-82" id="links-82">Links</a></h1>
<ul>
<li><a href="https://blog.golang.org/errors-are-values">Errors are values - The Go Blog</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgbufiopackage-bufioa" id="a-hrefhttpsgolangorgpkgbufiopackage-bufioa"><a href="https://golang.org/pkg/bufio/">Package bufio</a></a></h1>
<h1><a class="header" href="#links-83" id="links-83">Links</a></h1>
<ul>
<li><a href="https://www.cnblogs.com/golove/p/3282667.html">Golang学习 - bufio 包</a></li>
<li><a href="https://medium.com/golangspec/introduction-to-bufio-package-in-golang-ad7d1877f762">“Introduction to bufio package in Golang” @mlowicki</a></li>
<li><a href="https://medium.com/golangspec/in-depth-introduction-to-bufio-scanner-in-golang-55483bb689b4">“In-depth introduction to bufio.Scanner in Golang” @mlowicki</a></li>
</ul>
<h1><a class="header" href="#overview-6" id="overview-6">Overview</a></h1>
<p>Package bufio implements buffered I/O. It wraps an io.Reader or io.Writer object, creating another object (Reader or Writer) that also implements the interface but provides buffering and some help for textual I/O. </p>
<h1><a class="header" href="#type-reader-struct" id="type-reader-struct">type Reader struct</a></h1>
<pre><code class="language-go">const (
    defaultBufSize = 4096
)

type Reader struct {
    buf          []byte
    rd           io.Reader // reader provided by the client
    r, w         int       // buf read and write positions
    err          error
    lastByte     int
    lastRuneSize int
}

func NewReaderSize(rd io.Reader, size int) *Reader
func NewReader(rd io.Reader) *Reader {
    return NewReaderSize(rd, defaultBufSize)
}
//只要缓存有数据就只从缓存读
//要读的比缓存还大就不用缓存直接读底层
func (b *Reader) Read(p []byte) (n int, err error)
func (b *Reader) WriteTo(w io.Writer) (n int64, err error)
func (b *Reader) ReadByte() (byte, error)
func (b *Reader) UnreadByte() error
func (b *Reader) ReadRune() (r rune, size int, err error) 
func (b *Reader) UnreadRune() error

//缓存满了也没有找到delim就报错io.ErrBufferFull，也就是说这个函数每次调用最多处理到缓存满
//遇到EOF了没有找到delim就报错io.EOF
func (b *Reader) ReadSlice(delim byte) (line []byte, err error)
//如果一行的长度超过缓存的长度会截断返回
func (b *Reader) ReadLine() (line []byte, isPrefix bool, err error)
//ReadBytes会多次调用ReadSlice积累数据直到找到delim,所以这个函数不受缓存大小限制
func (b *Reader) ReadBytes(delim byte) ([]byte, error) 
func (b *Reader) ReadString(delim byte) (string, error) {
    bytes, err := b.ReadBytes(delim)
    return string(bytes), err
}

func (r *Reader) Size() int { return len(r.buf) }
func (b *Reader) Reset(r io.Reader) { b.reset(b.buf, r) }
//要看的没看够就拉东西进缓存
//最多看缓存大小那么多，如果想看的比缓存大小还多就报错ErrBufferFull
//到最后还要看的没看够会报错
func (b *Reader) Peek(n int) ([]byte, error)
//实际discarded小于n就报错
//如果缓存里数据不够就会去读底层
func (b *Reader) Discard(n int) (discarded int, err error) 
func (b *Reader) Buffered() int { return b.w - b.r }
</code></pre>
<h1><a class="header" href="#type-writer-struct" id="type-writer-struct">type Writer struct</a></h1>
<pre><code class="language-go">type Writer struct {
    err error
    buf []byte
    n   int
    wr  io.Writer
}

func NewWriterSize(w io.Writer, size int) *Writer 
func NewWriter(w io.Writer) *Writer {
    return NewWriterSize(w, defaultBufSize)
}
//只要报错了就不再写了
//要写的比缓存还大就不用缓存直接读写底层
func (b *Writer) Write(p []byte) (nn int, err error)
func (b *Writer) ReadFrom(r io.Reader) (n int64, err error)
func (b *Writer) WriteByte(c byte) error
func (b *Writer) WriteRune(r rune) (size int, err error)
func (b *Writer) WriteString(s string) (int, error)

func (b *Writer) Size() int { return len(b.buf) }
//重置可以换底层，就不用重新分配内存
func (b *Writer) Reset(w io.Writer) 
func (b *Writer) Available() int { return len(b.buf) - b.n }
func (b *Writer) Flush() error 
func (b *Writer) Buffered() int { return b.n }
</code></pre>
<h1><a class="header" href="#type-readwriter-struct" id="type-readwriter-struct">type ReadWriter struct</a></h1>
<pre><code class="language-go">type ReadWriter struct {
    *Reader
    *Writer
}

func NewReadWriter(r *Reader, w *Writer) *ReadWriter {
    return &amp;ReadWriter{r, w}
}
</code></pre>
<h1><a class="header" href="#type-scanner-struct" id="type-scanner-struct">type Scanner struct</a></h1>
<pre><code class="language-go">type Scanner struct {
    r            io.Reader // The reader provided by the client.
    split        SplitFunc // The function to split the tokens.
    maxTokenSize int       // Maximum size of a token; modified by tests.
    token        []byte    // Last token returned by split.
    buf          []byte    // Buffer used as argument to split.
    start        int       // First non-processed byte in buf.
    end          int       // End of data in buf.
    err          error     // Sticky error.
    empties      int       // Count of successive empty tokens.
    scanCalled   bool      // Scan has been called; buffer is in use.
    done         bool      // Scan has finished.
}

func NewScanner(r io.Reader) *Scanner {
    return &amp;Scanner{
        r:            r,
        split:        ScanLines,
        maxTokenSize: MaxScanTokenSize,
    }
}

func (s *Scanner) Buffer(buf []byte, max int)
func (s *Scanner) Split(split SplitFunc)
//不允许Token长度超过缓存，会报错ErrTooLong
//缓存不空或者EOF了就会调用SplitFunc
func (s *Scanner) Scan() bool
func (s *Scanner) Bytes() []byte {
    return s.token
}
func (s *Scanner) Text() string {
    return string(s.token)
}
// Err returns the first non-EOF error that was encountered by the Scanner.
func (s *Scanner) Err() error {
    if s.err == io.EOF {
        return nil
    }
    return s.err
}
</code></pre>
<h1><a class="header" href="#splitfunc" id="splitfunc">SplitFunc</a></h1>
<p>**SplitFunc's three behavior **</p>
<ul>
<li>return <code>0，nil, nil</code> means want more data</li>
<li>Token Found</li>
<li>Once Error Scanner stop
<ul>
<li>有一个特别的报错是ErrFinalToken，报这个错本次Scan返回正确，下次调用Scan直接停止。io.EOF和ErrFinalToken这两个报错都不被当作真正的错误处理的，也就是Err处理会返回nil.</li>
</ul>
</li>
</ul>
<pre><code class="language-go">type SplitFunc func(data []byte, atEOF bool) (advance int, token []byte, err error)

func ScanBytes(data []byte, atEOF bool) (advance int, token []byte, err error)
func ScanRunes(data []byte, atEOF bool) (advance int, token []byte, err error)
func ScanLines(data []byte, atEOF bool) (advance int, token []byte, err error)
func ScanWords(data []byte, atEOF bool) (advance int, token []byte, err error)
</code></pre>
<h1><a class="header" href="#readbytesn-readline-scanner-比较" id="readbytesn-readline-scanner-比较">ReadBytes('\n') ReadLine Scanner 比较</a></h1>
<ul>
<li><code>ReadBytes</code>不自动处理<code>\r\n</code>，并且和<code>\n</code>一起返回</li>
<li>行长度限制
<ul>
<li><code>ReadLine</code>如果一行长度超过缓存长度需要再次调用读取剩下的</li>
<li><code>Scanner</code>如果行长度超过缓存长度就不会做任何处理直接报错<code>token too long</code></li>
<li><code>ReadBytes</code>没有任何限制</li>
</ul>
</li>
<li><code>Scanner</code>最简单 <code>ReadBytes</code>最牛逼 <code>ReadLine</code>有点假</li>
</ul>
<h1><a class="header" href="#使用bufio包的标准库" id="使用bufio包的标准库">使用bufio包的标准库</a></h1>
<ul>
<li>archive/zip</li>
<li>compress/*</li>
<li>encoding/*</li>
<li>image/*</li>
<li>net/http</li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgunicodepackage-unicodea" id="a-hrefhttpsgolangorgpkgunicodepackage-unicodea"><a href="https://golang.org/pkg/unicode/">Package unicode</a></a></h1>
<h1><a class="header" href="#links-84" id="links-84">Links</a></h1>
<ul>
<li><a href="http://www.cnblogs.com/golove/p/3273585.html">Golang学习 - unicode 包</a></li>
</ul>
<h1><a class="header" href="#unicode-in-regexp" id="unicode-in-regexp">Unicode in Regexp</a></h1>
<pre><code class="language-go">\pN            Unicode character class (one-letter name)
\p{Greek}      Unicode character class
\PN            negated Unicode character class (one-letter name)
\P{Greek}      negated Unicode character class
</code></pre>
<h1><a class="header" href="#constants" id="constants">Constants</a></h1>
<pre><code class="language-go">const (
        MaxRune         = '\U0010FFFF' // Maximum valid Unicode code point.
        ReplacementChar = '\uFFFD'     // Represents invalid code points.
        MaxASCII        = '\u007F'     // maximum ASCII value.
        MaxLatin1       = '\u00FF'     // maximum Latin-1 value.
)

const (
        UpperCase = iota
        LowerCase
        TitleCase
        MaxCase
)
</code></pre>
<h1><a class="header" href="#variables" id="variables">Variables</a></h1>
<pre><code class="language-go">var Categories = map[string]*RangeTable{
        &quot;C&quot;:  C,
        &quot;Cc&quot;: Cc,
        &quot;Cf&quot;: Cf,
        &quot;Co&quot;: Co,
        &quot;Cs&quot;: Cs,
	...
}

// Letter, Mark, Number, punctuation, Symbol, Space separator

var GraphicRanges = []*RangeTable{
        L, M, N, P, S, Zs,
}

var PrintRanges = []*RangeTable{
        L, M, N, P, S,
}

var Scripts = map[string]*RangeTable{
        &quot;Adlam&quot;:                  Adlam,
        &quot;Ahom&quot;:                   Ahom,
	...
}
</code></pre>
<h1><a class="header" href="#func-1" id="func-1">Func</a></h1>
<pre><code class="language-go">func Is(rangeTab *RangeTable, r rune) bool

func In(r rune, ranges ...*RangeTable) bool
func IsOneOf(ranges []*RangeTable, r rune) bool

func IsControl(r rune) bool
func IsLetter(r rune) bool
func IsMark(r rune) bool
func IsNumber(r rune) bool
func IsPunct(r rune) bool
func IsSymbol(r rune) bool
func IsSpace(r rune) bool

func IsGraphic(r rune) bool
func IsPrint(r rune) bool
func IsDigit(r rune) bool

func IsTitle(r rune) bool
func IsUpper(r rune) bool
func IsLower(r rune) bool

func SimpleFold(r rune) rune
func To(_case int, r rune) rune
func ToLower(r rune) rune
func ToTitle(r rune) rune
func ToUpper(r rune) rune
</code></pre>
<p>E.G:</p>
<pre><code class="language-go">fmt.Println(unicode.Is(unicode.L, '的'))    // true
fmt.Println(unicode.Is(unicode.M, '的'))    // false
fmt.Println(unicode.Is(unicode.N, '的'))    // false
fmt.Println(unicode.Is(unicode.P, '的'))    // false
fmt.Println(unicode.Is(unicode.S, '的'))    // false
fmt.Println(unicode.Is(unicode.Zs, '的'))   // false
fmt.Println(unicode.Is(unicode.Han, '的'))  // true
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgunicodeutf8package-utf8a" id="a-hrefhttpsgolangorgpkgunicodeutf8package-utf8a"><a href="https://golang.org/pkg/unicode/utf8/">Package utf8</a></a></h1>
<h1><a class="header" href="#links-85" id="links-85">Links</a></h1>
<ul>
<li><a href="https://www.cnblogs.com/golove/p/3271597.html">Golang学习 - unicode/utf8 包</a></li>
<li><a href="http://www.cnblogs.com/golove/p/5889790.html">标准库 - unicode/utf8/utf8.go 解读</a></li>
<li><a href="https://www.cnblogs.com/golove/p/3222096.html">基础知识 - 字符编码简介 - GoLove - 博客园</a></li>
<li><a href="https://godoc.org/golang.org/x/text/encoding">encoding - GoDoc</a></li>
</ul>
<h1><a class="header" href="#utf8-encoding" id="utf8-encoding">UTF8 Encoding</a></h1>
<ol>
<li>对于单字节的符号，字节的第一位设为0，后面7位为这个符号的unicode码。因此对于
英语字母，UTF-8编码和ASCII码是相同的。</li>
<li>对于n字节的符号（n&gt;1），第一个字节的前n位都设为1，第n+1位设为0，后面字节的前
两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的unicode码。</li>
</ol>
<p>如表：</p>
<p><strong>utf8 encoded char's first byte MUST NOT begin with 10xxxxxx(bit)</strong></p>
<pre><code>1字节 0xxxxxxx
2字节 110xxxxx 10xxxxxx
3字节 1110xxxx 10xxxxxx 10xxxxxx
4字节 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
5字节 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
6字节 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
</code></pre>
<p>因此UTF-8中可以用来表示字符编码的实际位数最多有31位，即上表中x所表示的位。除去
那些控制位（每字节开头的10等），这些x表示的位与UNICODE编码是一一对应的，位高低
顺序也相同。</p>
<h1><a class="header" href="#constants-1" id="constants-1">Constants</a></h1>
<pre><code class="language-go">const (
        RuneError = '\uFFFD'     // the &quot;error&quot; Rune or &quot;Unicode replacement character&quot;
        RuneSelf  = 0x80         // characters below Runeself are represented as themselves in a single byte.
        MaxRune   = '\U0010FFFF' // Maximum valid Unicode code point.
        UTFMax    = 4            // maximum number of bytes of a UTF-8 encoded Unicode character.
)

const (                                                                                                                                                                                
        t1 = 0x00 // 0000 0000                                                                                                                                                         
        tx = 0x80 // 1000 0000                                                                                                                                                         
        t2 = 0xC0 // 1100 0000                                                                                                                                                         
        t3 = 0xE0 // 1110 0000                                                                                                                                                         
        t4 = 0xF0 // 1111 0000                                                                                                                                                         
        t5 = 0xF8 // 1111 1000                                                                                                                                                         
                                                                                                                                                                                       
        maskx = 0x3F // 0011 1111                                                                                                                                                      
        mask2 = 0x1F // 0001 1111                                                                                                                                                      
        mask3 = 0x0F // 0000 1111                                                                                                                                                      
        mask4 = 0x07 // 0000 0111                                                                                                                                                      
                                                                                                                                                                                       
        rune1Max = 1&lt;&lt;7 - 1                                                                                                                                                            
        rune2Max = 1&lt;&lt;11 - 1                                                                                                                                                           
        rune3Max = 1&lt;&lt;16 - 1                                                                                                                                                           
                                                                                                                                                                                       
        // The default lowest and highest continuation byte.                                                                                                                           
        locb = 0x80 // 1000 0000                                                                                                                                                       
        hicb = 0xBF // 1011 1111                                                                                                                                                       
                                                                                                                                                                                       
        // These names of these constants are chosen to give nice alignment in the                                                                                                     
        // table below. The first nibble is an index into acceptRanges or F for                                                                                                        
        // special one-byte cases. The second nibble is the Rune length or the                                                                                                         
        // Status for the special one-byte case.                                                                                                                                       
        xx = 0xF1 // invalid: size 1                                                                                                                                                   
        as = 0xF0 // ASCII: size 1                                                                                                                                                     
        s1 = 0x02 // accept 0, size 2                                                                                                                                                  
        s2 = 0x13 // accept 1, size 3                                                                                                                                                  
        s3 = 0x03 // accept 0, size 3                                                                                                                                                  
        s4 = 0x23 // accept 2, size 3                                                                                                                                                  
        s5 = 0x34 // accept 3, size 4                                                                                                                                                  
        s6 = 0x04 // accept 0, size 4                                                                                                                                                  
        s7 = 0x44 // accept 4, size 4                                                                                                                                                  
) 
</code></pre>
<h1><a class="header" href="#var" id="var">Var</a></h1>
<pre><code class="language-go">// first is information about the first byte in a UTF-8 sequence.                                                                                                                      
var first = [256]uint8{                                                                                                                                                                
        //   1   2   3   4   5   6   7   8   9   A   B   C   D   E   F                                                                                                                 
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x00-0x0F                                                                                                   
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x10-0x1F                                                                                                   
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x20-0x2F                                                                                                   
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x30-0x3F                                                                                                   
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x40-0x4F                                                                                                   
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x50-0x5F                                                                                                   
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x60-0x6F                                                                                                   
        as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, as, // 0x70-0x7F                                                                                                   
        //   1   2   3   4   5   6   7   8   9   A   B   C   D   E   F                                                                                                                 
        xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, // 0x80-0x8F                                                                                                   
        xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, // 0x90-0x9F                                                                                                   
        xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, // 0xA0-0xAF                                                                                                   
        xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, // 0xB0-0xBF                                                                                                   
        xx, xx, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, // 0xC0-0xCF                                                                                                   
        s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, s1, // 0xD0-0xDF                                                                                                   
        s2, s3, s3, s3, s3, s3, s3, s3, s3, s3, s3, s3, s3, s4, s3, s3, // 0xE0-0xEF                                                                                                   
        s5, s6, s6, s6, s7, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, xx, // 0xF0-0xFF                                                                                                   
}                                                                                                                                                                                      
                                                                                                                                                                                       
// acceptRange gives the range of valid values for the second byte in a UTF-8                                                                                                          
// sequence.                                                                                                                                                                           
type acceptRange struct {                                                                                                                                                              
        lo uint8 // lowest value for second byte.                                                                                                                                      
        hi uint8 // highest value for second byte.                                                                                                                                     
}                                                                                                                                                                                      
                                                                                                                                                                                       
var acceptRanges = [...]acceptRange{                                                                                                                                                   
        0: {locb, hicb},                                                                                                                                                               
        1: {0xA0, hicb},                                                                                                                                                               
        2: {locb, 0x9F},                                                                                                                                                               
        3: {0x90, hicb},                                                                                                                                                               
        4: {locb, 0x8F},                                                                                                                                                               
}
</code></pre>
<p>16进制的1位相当于2进制的4位{0xF=1111(2)=15(10)},16进制1位可以表达16个值,2进制要
4位来表达 16个值.</p>
<p>2进制是每8位一个字节,所以16进制是每2位一字节.2进制的8位可表达的值,在16进制下用2
位就可以表达完 8位的值:0-255,最大值是255</p>
<p>假如第一个字节的值是127,对应二进制 0111 1111, 对应16进制7F(把2进制换算到16进制,
感觉上还是像换到10进制一样), 对应 first表里值是最后一个as,就是最大的那个ascii码</p>
<p>假如0xfb = 128 = 1000 0000 = 0x80 --&gt; first[128] == xx,表明不是合法的utf8編码该
有的值.</p>
<p>根据上面的算法,一直到1011 1111 = 0xbf = 191 (下一个1100 0000 就合法了)都是不合
法的,但first表里一直到0xc0,0xc1也都是不合法的. 1100 0000, 11000001这两个为什么
不合法呢?</p>
<p>然后, 0xfb = 1110 0000 = 0xe0(8421 - &gt; 14 -9 =5 -&gt;e (11100000,e0,224), 作为
first 的索引得到值 s2 = 0x13,作为acceptRanges的索引,得到第二字节的值范围
{0xA0,hicb}, 开始3字节的編码</p>
<h1><a class="header" href="#func-2" id="func-2">Func</a></h1>
<pre><code class="language-go">func DecodeRune(p []byte) (r rune, size int)
func DecodeRuneInString(s string) (r rune, size int)
func DecodeLastRune(p []byte) (r rune, size int)
func DecodeLastRuneInString(s string) (r rune, size int)

// EncodeRune writes into p (which must be large enough) the UTF-8 encoding of the rune.
// It returns the number of bytes written.
func EncodeRune(p []byte, r rune) int
func RuneLen(r rune) int
func RuneCount(p []byte) int
func RuneCountInString(s string) (n int)

func FullRune(p []byte) bool
func FullRuneInString(s string) bool
func RuneStart(b byte) bool
func Valid(p []byte) bool
func ValidRune(r rune) bool
func ValidString(s string) bool
</code></pre>
<pre><code class="language-go">func FullRune(p []byte) bool {
	n := len(p)
	if n == 0 {
		return false
	}
	x := first[p[0]]
	// x&amp;7 means x&amp;0111(2) get x's little-ending 4 bits.
	if n &gt;= int(x&amp;7) {
		return true // ASCII, invalid or valid.
	}
	// Must be short or invalid.
	accept := acceptRanges[x&gt;&gt;4]
	// invalid is true
	if n &gt; 1 &amp;&amp; (p[1] &lt; accept.lo || accept.hi &lt; p[1]) {
		return true
	// invalid is true
	} else if n &gt; 2 &amp;&amp; (p[2] &lt; locb || hicb &lt; p[2]) {
		return true
	}
	// now must be short
	return false
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgunicodeutf16package-utf16a" id="a-hrefhttpsgolangorgpkgunicodeutf16package-utf16a"><a href="https://golang.org/pkg/unicode/utf16/">Package utf16</a></a></h1>
<pre><code class="language-go">func Encode(s []rune) []uint16
func EncodeRune(r rune) (r1, r2 rune)
func Decode(s []uint16) []rune
func DecodeRune(r1, r2 rune) rune
func IsSurrogate(r rune) bool
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgregexppackage-regexpa" id="a-hrefhttpsgolangorgpkgregexppackage-regexpa"><a href="https://golang.org/pkg/regexp/">Package regexp</a></a></h1>
<h1><a class="header" href="#links-86" id="links-86">Links</a></h1>
<ul>
<li><a href="https://github.com/google/re2/wiki/Syntax">Syntax · google/re2 Wiki · GitHub</a></li>
<li><a href="https://swtch.com/%7Ersc/regexp/regexp1.html">Regular Expression Matching Can Be Simple And Fast</a></li>
<li><a href="https://www.cnblogs.com/golove/p/3269099.html">基础知识 - Golang 中的正则表达式 - GoLove - 博客园</a></li>
<li><a href="https://www.cnblogs.com/golove/p/3270918.html">Golang学习 - regexp 包 - GoLove - 博客园</a></li>
</ul>
<p>For an overview of the syntax, run</p>
<p><code>go doc regexp/syntax</code></p>
<p><code>Find(All)?(String)?(Submatch)?(Index)?</code></p>
<h1><a class="header" href="#type-regexp-struct" id="type-regexp-struct">type Regexp struct</a></h1>
<pre><code class="language-go">type Regexp struct {
    // read-only after Compile
    regexpRO
    // cache of machines for running regexp
    mu      sync.Mutex
    machine []*machine
}

func Compile(expr string) (*Regexp, error)
func CompilePOSIX(expr string) (*Regexp, error)
func MustCompile(str string) *Regexp
func MustCompilePOSIX(str string) *Regexp

func (re *Regexp) Find(b []byte) []byte
func (re *Regexp) FindAll(b []byte, n int) [][]byte
func (re *Regexp) FindSubmatch(b []byte) [][]byte
func (re *Regexp) FindAllSubmatch(b []byte, n int) [][][]byte
func (re *Regexp) FindIndex(b []byte) (loc []int)
func (re *Regexp) FindAllIndex(b []byte, n int) [][]int
func (re *Regexp) FindSubmatchIndex(b []byte) []int 
func (re *Regexp) FindAllSubmatchIndex(b []byte, n int) [][]int 

func (re *Regexp) FindString(s string) string
func (re *Regexp) FindAllString(s string, n int) []string
func (re *Regexp) FindStringSubmatch(s string) []string
func (re *Regexp) FindAllStringSubmatch(s string, n int) [][]string
func (re *Regexp) FindStringIndex(s string) (loc []int)
func (re *Regexp) FindAllStringIndex(s string, n int) [][]int
func (re *Regexp) FindStringSubmatchIndex(s string) []int
func (re *Regexp) FindAllStringSubmatchIndex(s string, n int) [][]int

func (re *Regexp) FindReaderIndex(r io.RuneReader) (loc []int) 
func (re *Regexp) FindReaderSubmatchIndex(r io.RuneReader) []int 

func (re *Regexp) Match(b []byte) bool
func (re *Regexp) MatchString(s string) bool
func (re *Regexp) MatchReader(r io.RuneReader) bool

func (re *Regexp) Expand(dst []byte, template []byte, src []byte, match []int) []byte
func (re *Regexp) ExpandString(dst []byte, template string, src string, match []int) []byte

func (re *Regexp) ReplaceAll(src, repl []byte) []byte
func (re *Regexp) ReplaceAllLiteral(src, repl []byte) []byte 
func (re *Regexp) ReplaceAllFunc(src []byte, repl func([]byte) []byte) []byte 
func (re *Regexp) ReplaceAllString(src, repl string) string 
func (re *Regexp) ReplaceAllLiteralString(src, repl string) string
func (re *Regexp) ReplaceAllStringFunc(src string, repl func(string) string) string

func (re *Regexp) Split(s string, n int) []string 

func (re *Regexp) String() string 
func (re *Regexp) Copy() *Regexp
func (re *Regexp) Longest() 
func (re *Regexp) NumSubexp() int 
func (re *Regexp) SubexpNames() []string
func (re *Regexp) LiteralPrefix() (prefix string, complete bool)

func Match(pattern string, b []byte) (matched bool, err error)
func MatchString(pattern string, s string) (matched bool, err error)
func MatchReader(pattern string, r io.RuneReader) (matched bool, err error) 
func QuoteMeta(s string) string
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgospackage-osa" id="a-hrefhttpsgolangorgpkgospackage-osa"><a href="https://golang.org/pkg/os/">Package os</a></a></h1>
<h1><a class="header" href="#constants-2" id="constants-2">Constants</a></h1>
<p>Flags</p>
<pre><code class="language-go">const (
        // Exactly one of O_RDONLY, O_WRONLY, or O_RDWR must be specified.
        O_RDONLY int = syscall.O_RDONLY // open the file read-only.
        O_WRONLY int = syscall.O_WRONLY // open the file write-only.
        O_RDWR   int = syscall.O_RDWR   // open the file read-write.
        // The remaining values may be or'ed in to control behavior.
        O_APPEND int = syscall.O_APPEND // append data to the file when writing.
        O_CREATE int = syscall.O_CREAT  // create a new file if none exists.
        O_EXCL   int = syscall.O_EXCL   // used with O_CREATE, file must not exist.
        O_SYNC   int = syscall.O_SYNC   // open for synchronous I/O.
        O_TRUNC  int = syscall.O_TRUNC  // if possible, truncate file when opened.
)
</code></pre>
<p>DevNull</p>
<p><code>const DevNull = &quot;/dev/null&quot;</code></p>
<h1><a class="header" href="#dir-and-file" id="dir-and-file">Dir and File</a></h1>
<pre><code class="language-go">func Getwd() (dir string, err error)
func Chdir(dir string) error
func Mkdir(name string, perm FileMode) error
func MkdirAll(path string, perm FileMode) error
func Remove(name string) error
func RemoveAll(path string) error

// Rename renames (moves) oldpath to newpath. If newpath already exists and is not a directory, Rename replaces it.
func Rename(oldpath, newpath string) error
func Remove(name string) error
func RemoveAll(path string) error
func Truncate(name string, size int64) error
func IsPathSeparator(c uint8) bool

func TempDir() string
func UserCacheDir() (string, error)

func (f *File) Chdir() error
func (f *File) Readdir(n int) ([]FileInfo, error)
func (f *File) Readdirnames(n int) (names []string, err error)

func ioutil.ReadFile(filename string) ([]byte, error)
// WriteFile writes data to a file named by filename. 
// If the file does not exist, WriteFile creates it with permissions perm; otherwise WriteFile truncates it before writing. 
func ioutil.WriteFile(filename string, data []byte, perm os.FileMode) error
func ioutil.ReadDir(dirname string) ([]os.FileInfo, error)
func ioutil.TempDir(dir, prefix string) (name string, err error)
func ioutil.TempFile(dir, pattern string) (f *os.File, err error)
</code></pre>
<h1><a class="header" href="#type-file-struct" id="type-file-struct">type File struct</a></h1>
<pre><code class="language-go">type File struct {
        // contains filtered or unexported fields
}

// Create creates the named file with mode 0666 (before umask), truncating it if it already exists. 
func Create(name string) (*File, error)
func NewFile(fd uintptr, name string) *File
func Open(name string) (*File, error)
func OpenFile(name string, flag int, perm FileMode) (*File, error)
func Pipe() (r *File, w *File, err error)

func (f *File) Name() string

func ioutil.TempFile(dir, pattern string) (f *os.File, err error)
</code></pre>
<h1><a class="header" href="#fileinfo" id="fileinfo">FileInfo</a></h1>
<pre><code class="language-go">type FileInfo interface {
        Name() string       // base name of the file
        Size() int64        // length in bytes for regular files; system-dependent for others
        Mode() FileMode     // file mode bits
        ModTime() time.Time // modification time
        IsDir() bool        // abbreviation for Mode().IsDir()
        Sys() interface{}   // underlying data source (can return nil)
}
func Stat(name string) (FileInfo, error)
func Lstat(name string) (FileInfo, error)
func SameFile(fi1, fi2 FileInfo) bool

func (f *File) Stat() (FileInfo, error)
func (f *File) Readdir(n int) ([]FileInfo, error)

func ioutil.ReadDir(dirname string) ([]os.FileInfo, error)
</code></pre>
<h1><a class="header" href="#filemode" id="filemode">FileMode</a></h1>
<p>A FileMode represents a file's mode and permission bits.</p>
<pre><code class="language-go">type FileMode uint32

const (
        // The single letters are the abbreviations
        // used by the String method's formatting.
        ModeDir        FileMode = 1 &lt;&lt; (32 - 1 - iota) // d: is a directory
        ModeAppend                                     // a: append-only
        ModeExclusive                                  // l: exclusive use
        ModeTemporary                                  // T: temporary file; Plan 9 only
        ModeSymlink                                    // L: symbolic link
        ModeDevice                                     // D: device file
        ModeNamedPipe                                  // p: named pipe (FIFO)
        ModeSocket                                     // S: Unix domain socket
        ModeSetuid                                     // u: setuid
        ModeSetgid                                     // g: setgid
        ModeCharDevice                                 // c: Unix character device, when ModeDevice is set
        ModeSticky                                     // t: sticky
        ModeIrregular                                  // ?: non-regular file; nothing else is known about this file

        // Mask for the type bits. For regular files, none will be set.
        ModeType = ModeDir | ModeSymlink | ModeNamedPipe | ModeSocket | ModeDevice | ModeIrregular

        ModePerm FileMode = 0777 // Unix permission bits
)

func FileInfo.Mode() FileMode 

func Chmod(name string, mode FileMode) error
func OpenFile(name string, flag int, perm FileMode) (*File, error)
func Mkdir(name string, perm FileMode) error
func MkdirAll(path string, perm FileMode) error

func (m FileMode) IsDir() bool
func (m FileMode) IsRegular() bool
// Perm returns the Unix permission bits in m.
func (m FileMode) Perm() FileMode
func (m FileMode) String() string

func (f *File) Chmod(mode FileMode) error
</code></pre>
<h1><a class="header" href="#uid-gid" id="uid-gid">uid gid</a></h1>
<pre><code class="language-go">func Chown(name string, uid, gid int) error
func Lchown(name string, uid, gid int) error
func Getuid() int
func Getgid() int
func Geteuid() int
func Getegid() int
func Getgroups() ([]int, error)

func (f *File) Chown(uid, gid int) error
</code></pre>
<h1><a class="header" href="#times" id="times">times</a></h1>
<pre><code class="language-go">func Chtimes(name string, atime time.Time, mtime time.Time) error
</code></pre>
<h1><a class="header" href="#link" id="link">Link</a></h1>
<pre><code class="language-go">func Link(oldname, newname string) error
func Symlink(oldname, newname string) error
func Readlink(name string) (string, error)
</code></pre>
<h1><a class="header" href="#env" id="env">Env</a></h1>
<pre><code class="language-go">func Expand(s string, mapping func(string) string) string
func ExpandEnv(s string) string
func Setenv(key, value string) error
func Unsetenv(key string) error
func Getenv(key string) string
func LookupEnv(key string) (string, bool)
func Environ() []string
func Clearenv()
</code></pre>
<h1><a class="header" href="#os" id="os">os</a></h1>
<pre><code class="language-go">func Hostname() (name string, err error)
func Getpagesize() int
func Exit(code int)
</code></pre>
<h1><a class="header" href="#iserror" id="iserror">Is(error)</a></h1>
<pre><code class="language-go">func IsExist(err error) bool
func IsNotExist(err error) bool
func IsPermission(err error) bool
func IsTimeout(err error) bool
</code></pre>
<h1><a class="header" href="#process" id="process">Process</a></h1>
<pre><code class="language-go">func Executable() (string, error)
func Getpid() int
func Getppid() int
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgosexecpackage-execa" id="a-hrefhttpsgolangorgpkgosexecpackage-execa"><a href="https://golang.org/pkg/os/exec/">Package exec</a></a></h1>
<h1><a class="header" href="#overview-7" id="overview-7">Overview</a></h1>
<p>Package exec runs external commands. It wraps os.StartProcess to make it easier to remap stdin and stdout, connect I/O with pipes, and do other adjustments.</p>
<p>Unlike the &quot;system&quot; library call from C and other languages, the os/exec package intentionally does not invoke the system shell and does not expand any glob patterns or handle other expansions, pipelines, or redirections typically done by shells. The package behaves more like C's &quot;exec&quot; family of functions. To expand glob patterns, either call the shell directly, taking care to escape any dangerous input, or use the path/filepath package's Glob function. To expand environment variables, use package os's ExpandEnv.</p>
<pre><code class="language-go">func LookPath(file string) (string, error)
</code></pre>
<h1><a class="header" href="#type-cmd-struct" id="type-cmd-struct">type Cmd struct</a></h1>
<pre><code class="language-go">func Command(name string, arg ...string) *Cmd
func CommandContext(ctx context.Context, name string, arg ...string) *Cmd

func (c *Cmd) CombinedOutput() ([]byte, error)
func (c *Cmd) Output() ([]byte, error)
func (c *Cmd) Run() error
func (c *Cmd) Start() error
func (c *Cmd) Wait() error
func (c *Cmd) StderrPipe() (io.ReadCloser, error)
func (c *Cmd) StdinPipe() (io.WriteCloser, error)
func (c *Cmd) StdoutPipe() (io.ReadCloser, error)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgossignalpackage-signala" id="a-hrefhttpsgolangorgpkgossignalpackage-signala"><a href="https://golang.org/pkg/os/signal/">Package signal</a></a></h1>
<pre><code class="language-go">func Ignore(sig ...os.Signal)
func Ignored(sig os.Signal) bool
func Notify(c chan&lt;- os.Signal, sig ...os.Signal)
func Reset(sig ...os.Signal)
func Stop(c chan&lt;- os.Signal)
</code></pre>
<h1><a class="header" href="#func-notify" id="func-notify">func Notify</a></h1>
<p>Notify causes package signal to relay incoming signals to c. If no signals are provided, all incoming signals will be relayed to c. Otherwise, just the provided signals will.</p>
<p>Package signal will not block sending to c: the caller must ensure that c has sufficient buffer space to keep up with the expected signal rate. For a channel used for notification of just one signal value, a buffer of size 1 is sufficient. </p>
<p>Ex:</p>
<pre><code class="language-go">c := make(chan os.Signal, 1)
signal.Notify(c, os.Interrupt)

// Block until a signal is received.
s := &lt;-c
fmt.Println(&quot;Got signal:&quot;, s)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgpathpackage-patha" id="a-hrefhttpsgolangorgpkgpathpackage-patha"><a href="https://golang.org/pkg/path/">Package path</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgpathfilepathpackage-filepatha" id="a-hrefhttpsgolangorgpkgpathfilepathpackage-filepatha"><a href="https://golang.org/pkg/path/filepath/">Package filepath</a></a></h1>
<h1><a class="header" href="#links-87" id="links-87">Links</a></h1>
<ul>
<li><a href="https://www.cnblogs.com/golove/p/5903579.html">Golang学习 - path/filepath 包</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgsyncpackage-synca" id="a-hrefhttpsgolangorgpkgsyncpackage-synca"><a href="https://golang.org/pkg/sync/">Package sync</a></a></h1>
<h1><a class="header" href="#links-88" id="links-88">Links</a></h1>
<ul>
<li><a href="https://www.cnblogs.com/golove/p/5918082.html">Golang学习 - sync 包 - GoLove - 博客园</a></li>
</ul>
<h1><a class="header" href="#type-waitgroup-struct" id="type-waitgroup-struct">type WaitGroup struct</a></h1>
<p>A WaitGroup waits for a collection of goroutines to finish. The main goroutine calls Add to set the number of goroutines to wait for. Then each of the goroutines runs and calls Done when finished. At the same time, Wait can be used to block until all goroutines have finished.</p>
<p>A WaitGroup must not be copied after first use. </p>
<pre><code class="language-go">func (wg *WaitGroup) Add(delta int)
func (wg *WaitGroup) Done()
func (wg *WaitGroup) Wait()
</code></pre>
<h1><a class="header" href="#type-once" id="type-once">type Once</a></h1>
<pre><code class="language-go">type Once struct {
        // contains filtered or unexported fields
}

func (o *Once) Do(f func())
</code></pre>
<pre><code class="language-go">package main

import (
        &quot;fmt&quot;
        &quot;sync&quot;
)

func main() {
        var once sync.Once

        onceBody := func() {
                fmt.Println(&quot;Only once&quot;)
        }

        done := make(chan bool)

        N := 10
        for i := 0; i &lt; N; i++ {
                go func() {
                        once.Do(onceBody)
                        done &lt;- true
                }()
        }

        for i := 0; i &lt; N; i++ {
                &lt;-done
        }
}
</code></pre>
<h1><a class="header" href="#type-pool-struct" id="type-pool-struct">type Pool struct</a></h1>
<p>Pool's purpose is to cache allocated but unused items for later reuse, relieving pressure on the garbage collector. That is, it makes it easy to build efficient, thread-safe free lists. However, it is not suitable for all free lists. </p>
<pre><code class="language-go">type Pool struct {

        // New optionally specifies a function to generate
        // a value when Get would otherwise return nil.
        // It may not be changed concurrently with calls to Get.
        New func() interface{}
        // contains filtered or unexported fields
}

func (p *Pool) Get() interface{}
func (p *Pool) Put(x interface{})
</code></pre>
<h1><a class="header" href="#type-locker-interface" id="type-locker-interface">type Locker interface</a></h1>
<p>A Locker represents an object that can be locked and unlocked.</p>
<pre><code class="language-go">type Locker interface {
        Lock()
        Unlock()
}
</code></pre>
<h1><a class="header" href="#type-mutex-struct" id="type-mutex-struct">type Mutex struct</a></h1>
<p><strong>Mutex == mutual exclusion</strong></p>
<p>A Mutex is a mutual exclusion lock. The zero value for a Mutex is an unlocked mutex.</p>
<p>A Mutex must not be copied after first use. </p>
<p>Lock locks m. If the lock is already in use, the calling goroutine blocks until the mutex is available. </p>
<p>Unlock unlocks m. It is a run-time error if m is not locked on entry to Unlock.</p>
<p>A locked Mutex is not associated with a particular goroutine. It is allowed for one goroutine to lock a Mutex and then arrange for another goroutine to unlock it. </p>
<pre><code class="language-go">func (m *Mutex) Lock()
func (m *Mutex) Unlock()
</code></pre>
<p>Example:</p>
<pre><code class="language-go">func main() {
	var mu sync.Mutex
	var count int
	done := make(chan bool)
	for i := 0; i &lt; 10; i++ {

		go func(i int) {
			mu.Lock()
			// 注意这里是 count += i, 不是count++
			count += i
			fmt.Print(count, &quot; &quot;)
			mu.Unlock()
			done &lt;- true
		}(i)
	}
	for i := 0; i &lt; 10; i++ {
	&lt;-done
	}
	fmt.Println()
}
// result: (mutative)
// 1 10 12 15 19 24 30 37 45 45 or
// 9 16 20 20 21 23 26 32 37 45 or ...
</code></pre>
<h1><a class="header" href="#type-rwmutex-struct" id="type-rwmutex-struct">type RWMutex struct</a></h1>
<p>Lock locks rw for writing.</p>
<p>RLock locks rw for reading. </p>
<pre><code class="language-go">func (rw *RWMutex) Lock()
func (rw *RWMutex) Unlock()
func (rw *RWMutex) RLock()
func (rw *RWMutex) RUnlock()
func (rw *RWMutex) RLocker() Locker
</code></pre>
<h1><a class="header" href="#type-cond-struct" id="type-cond-struct">type Cond struct</a></h1>
<p>Cond implements a condition variable, a rendezvous point for goroutines waiting for or announcing the occurrence of an event.</p>
<p>Each Cond has an associated Locker L (often a *Mutex or *RWMutex), which must be held when changing the condition and when calling the Wait method.</p>
<p>A Cond must not be copied after first use. </p>
<pre><code class="language-go">type Cond struct {
	// L is held while observing or changing the condition
	L Locker
	// contains filtered or unexported fields
}

func NewCond(l Locker) *Cond
func (c *Cond) Broadcast()
func (c *Cond) Signal()
func (c *Cond) Wait()
</code></pre>
<p>Because c.L is not locked when Wait first resumes, the caller typically cannot assume that the condition is true when Wait returns. Instead, the caller should Wait in a loop: </p>
<pre><code>c.L.Lock()
for !condition() {
    c.Wait()
}
... make use of condition ...
c.L.Unlock()
</code></pre>
<h1><a class="header" href="#type-map-struct" id="type-map-struct">type Map struct</a></h1>
<p>Map is like a Go map[interface{}]interface{} but is safe for concurrent use by multiple goroutines without additional locking or coordination. Loads, stores, and deletes run in amortized constant time.</p>
<p>The Map type is specialized. Most code should use a plain Go map instead, with separate locking or coordination, for better type safety and to make it easier to maintain other invariants along with the map content.</p>
<p>The Map type is optimized for two common use cases: (1) when the entry for a given key is only ever written once but read many times, as in caches that only grow, or (2) when multiple goroutines read, write, and overwrite entries for disjoint sets of keys. In these two cases, use of a Map may significantly reduce lock contention compared to a Go map paired with a separate Mutex or RWMutex.</p>
<p>The zero Map is empty and ready for use. A Map must not be copied after first use. </p>
<pre><code class="language-go">func (m *Map) Store(key, value interface{})
func (m *Map) Load(key interface{}) (value interface{}, ok bool)
func (m *Map) LoadOrStore(key, value interface{}) (actual interface{}, loaded bool)
func (m *Map) Delete(key interface{})
func (m *Map) Range(f func(key, value interface{}) bool)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcontextpackage-contexta" id="a-hrefhttpsgolangorgpkgcontextpackage-contexta"><a href="https://golang.org/pkg/context/">Package context</a></a></h1>
<h1><a class="header" href="#links-89" id="links-89">Links</a></h1>
<ul>
<li><a href="https://blog.golang.org/context">Go Concurrency Patterns: Context - The Go Blog</a></li>
</ul>
<h1><a class="header" href="#type-context-interface" id="type-context-interface">type Context interface</a></h1>
<p>Background returns a non-nil, empty Context. It is never canceled, has no
values, and has no deadline. It is typically used by the main function,
initialization, and tests, and as the top-level Context for incoming requests. </p>
<p>The context package provides functions to derive new Context values from
existing ones. These values form a tree: when a Context is canceled, all
Contexts derived from it are also canceled.</p>
<p>Background is the root of any Context tree; it is never canceled</p>
<pre><code class="language-go">type Context interface {
    Deadline() (deadline time.Time, ok bool)
    Done() &lt;-chan struct{}
    Err() error
    Value(key interface{}) interface{}
}

// An emptyCtx is never canceled, has no values, and has no deadline. It is not
// struct{}, since vars of this type must have distinct addresses.
type emptyCtx int

func (*emptyCtx) Deadline() (deadline time.Time, ok bool) {
	return
}
func (*emptyCtx) Done() &lt;-chan struct{} {
	return nil
}
func (*emptyCtx) Err() error {
	return nil
}
func (*emptyCtx) Value(key interface{}) interface{} {
	return nil
}

var (
    background = new(emptyCtx)
    todo       = new(emptyCtx)
)

func Background() Context {
    return background
}
func TODO() Context {
    return todo
}
func WithValue(parent Context, key, val interface{}) Context 

type CancelFunc func()

func WithCancel(parent Context) (ctx Context, cancel CancelFunc)
func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)
func WithDeadline(parent Context, d time.Time) (Context, CancelFunc)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkglogpackage-loga" id="a-hrefhttpsgolangorgpkglogpackage-loga"><a href="https://golang.org/pkg/log/">Package log</a></a></h1>
<p>A Logger represents an active logging object that generates lines of output to an io.Writer. Each logging operation makes a single call to the Writer's Write method. A Logger can be used simultaneously from multiple goroutines; it guarantees to serialize access to the Writer. </p>
<h1><a class="header" href="#constants-3" id="constants-3">Constants</a></h1>
<pre><code class="language-go">const (
        Ldate         = 1 &lt;&lt; iota     // the date in the local time zone: 2009/01/23
        Ltime                         // the time in the local time zone: 01:23:23
        Lmicroseconds                 // microsecond resolution: 01:23:23.123123.  assumes Ltime.
        Llongfile                     // full file name and line number: /a/b/c/d.go:23
        Lshortfile                    // final file name element and line number: d.go:23. overrides Llongfile
        LUTC                          // if Ldate or Ltime is set, use UTC rather than the local time zone
        LstdFlags     = Ldate | Ltime // initial values for the standard logger
)
</code></pre>
<pre><code class="language-go">var std = New(os.Stderr, &quot;&quot;, LstdFlags)

func Print(v ...interface{})
func Printf(format string, v ...interface{})
func Println(v ...interface{})

func Fatal(v ...interface{})
func Fatalf(format string, v ...interface{})
func Fatalln(v ...interface{})

func Panic(v ...interface{})
func Panicf(format string, v ...interface{})
func Panicln(v ...interface{})

func SetFlags(flag int)
func Flags() int

func SetPrefix(prefix string)
func Prefix() string

func SetOutput(w io.Writer)
func Output(calldepth int, s string) error
</code></pre>
<h1><a class="header" href="#type-loger-struct" id="type-loger-struct">type Loger struct</a></h1>
<pre><code class="language-go">func New(out io.Writer, prefix string, flag int) *Logger
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgnetpackage-neta" id="a-hrefhttpsgolangorgpkgnetpackage-neta"><a href="https://golang.org/pkg/net/">Package net</a></a></h1>
<!-- ToC start -->
<h1><a class="header" href="#table-of-contents" id="table-of-contents">Table of Contents</a></h1>
<ol>
<li><a href="go/pkg/net/net.html#links">Links</a></li>
<li><a href="go/pkg/net/net.html#package-files">Package files</a></li>
<li><a href="go/pkg/net/net.html#overview">Overview</a></li>
<li><a href="go/pkg/net/net.html#5%E4%B8%AA%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3:-conn-listener-packetconn-addr-error">5个基础网络接口: Conn, Listener, PacketConn, Addr, Error</a>
<ol>
<li><a href="go/pkg/net/net.html#conn%E6%8E%A5%E5%8F%A3">Conn接口</a></li>
<li><a href="go/pkg/net/net.html#listener%E6%8E%A5%E5%8F%A3">Listener接口</a></li>
<li><a href="go/pkg/net/net.html#packetconn%E6%8E%A5%E5%8F%A3">PacketConn接口</a></li>
<li><a href="go/pkg/net/net.html#addr%E6%8E%A5%E5%8F%A3">Addr接口</a></li>
<li><a href="go/pkg/net/net.html#%E5%85%B3%E4%BA%8E%E7%BD%91%E7%BB%9C%E7%B1%BB%E5%9E%8B">关于网络类型</a></li>
<li><a href="go/pkg/net/net.html#error%E6%8E%A5%E5%8F%A3">Error接口</a></li>
</ol>
</li>
<li><a href="go/pkg/net/net.html#4%E4%B8%AA%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84:-interface-hardwareaddr-ip-ipmask">4个基础网络结构: Interface, HardwareAddr, IP, IPMask</a>
<ol>
<li><a href="go/pkg/net/net.html#interface%E7%BB%93%E6%9E%84">Interface结构</a></li>
<li><a href="go/pkg/net/net.html#hardwareaddr%E7%BB%93%E6%9E%84">HardwareAddr结构</a></li>
<li><a href="go/pkg/net/net.html#ip%E7%BB%93%E6%9E%84">IP结构</a></li>
<li><a href="go/pkg/net/net.html#ipmask%E7%BB%93%E6%9E%84">IPMask结构</a></li>
</ol>
</li>
<li><a href="go/pkg/net/net.html#tcp%E5%8D%8F%E8%AE%AE%E9%87%8C3%E4%B8%AA%E7%BB%93%E6%9E%84%EF%BC%9Atcpaddr-tcpconn-tcplistener">TCP协议里3个结构：TCPAddr, TCPConn, TCPListener</a>
<ol>
<li><a href="go/pkg/net/net.html#tcpaddr%E7%BB%93%E6%9E%84">TCPAddr结构</a></li>
<li><a href="go/pkg/net/net.html#tcpconn%E7%BB%93%E6%9E%84">TCPConn结构</a></li>
<li><a href="go/pkg/net/net.html#tcplistener%E7%BB%93%E6%9E%84">TCPListener结构</a></li>
</ol>
</li>
<li><a href="go/pkg/net/net.html#udp%E5%8D%8F%E8%AE%AE%E9%87%8C2%E4%B8%AA%E7%BB%93%E6%9E%84%EF%BC%9Audpaddr-udpconn">UDP协议里2个结构：UDPAddr, UDPConn</a>
<ol>
<li><a href="go/pkg/net/net.html#udpaddr%E7%BB%93%E6%9E%84">UDPAddr结构</a></li>
<li><a href="go/pkg/net/net.html#udpconn%E7%BB%93%E6%9E%84">UDPConn结构</a></li>
</ol>
</li>
<li><a href="go/pkg/net/net.html#%E5%BC%95%E5%87%BAconn-packetconn-listener%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%B0%8F%E6%80%BB%E7%BB%93">引出Conn, PacketConn, Listener接口的小总结</a>
<ol>
<li><a href="go/pkg/net/net.html#%E9%87%8D%E5%86%99%E5%89%8D%E5%A4%B4%E7%9A%84%E4%BE%8B%E5%AD%90">重写前头的例子</a></li>
</ol>
</li>
<li><a href="go/pkg/net/net.html#ip%E5%8D%8F%E8%AE%AE%E9%87%8C3%E4%B8%AA%E7%BB%93%E6%9E%84%EF%BC%9Aipnet-ipaddr-ipconn">IP协议里3个结构：IPNet, IPAddr, IPConn</a>
<ol>
<li><a href="go/pkg/net/net.html#ipnet%E7%BB%93%E6%9E%84">IPNet结构</a></li>
<li><a href="go/pkg/net/net.html#ipaddr%E7%BB%93%E6%9E%84">IPAddr结构</a></li>
<li><a href="go/pkg/net/net.html#ipconn%E7%BB%93%E6%9E%84">IPConn结构</a></li>
</ol>
</li>
<li><a href="go/pkg/net/net.html#unix%E5%8D%8F%E8%AE%AE%E9%87%8C3%E4%B8%AA%E7%BB%93%E6%9E%84%EF%BC%9Aunixaddr-unixconn-unixlistener">Unix协议里3个结构：UnixAddr, UnixConn, UnixListener</a>
<ol>
<li><a href="go/pkg/net/net.html#unixaddr%E7%BB%93%E6%9E%84">UnixAddr结构</a></li>
<li><a href="go/pkg/net/net.html#unixconn%E7%BB%93%E6%9E%84">UnixConn结构</a></li>
<li><a href="go/pkg/net/net.html#unixlistener%E7%BB%93%E6%9E%84">UnixListener结构</a></li>
</ol>
</li>
<li><a href="go/pkg/net/net.html#dialer%E7%BB%93%E6%9E%84">Dialer结构</a></li>
<li><a href="go/pkg/net/net.html#listenconfig%E7%BB%93%E6%9E%84">ListenConfig结构</a></li>
<li><a href="go/pkg/net/net.html#dns%E7%9A%843%E4%B8%AA%E8%AE%B0%E5%BD%95%E7%BB%93%E6%9E%84%EF%BC%9Asrv-mx-ns">DNS的3个记录结构：SRV, MX, NS</a></li>
<li><a href="go/pkg/net/net.html#resolver%E7%BB%93%E6%9E%84">Resolver结构</a></li>
<li><a href="go/pkg/net/net.html#dns%E7%9A%849%E4%B8%AA%E6%9F%A5%E6%89%BE%E5%87%BD%E6%95%B0">DNS的9个查找函数</a></li>
<li><a href="go/pkg/net/net.html#6%E7%A7%8D%E7%BD%91%E7%BB%9C%E9%94%99%E8%AF%AF%E7%BB%93%E6%9E%84">6种网络错误结构</a></li>
<li><a href="go/pkg/net/net.html#buffers%E7%BB%93%E6%9E%84">Buffers结构</a></li>
<li><a href="go/pkg/net/net.html#2%E4%B8%AA%E6%8B%86%E5%90%88%E4%B8%BB%E6%9C%BA%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%87%BD%E6%95%B0">2个拆合主机端口的函数</a></li>
</ol>
<!-- ToC end -->
<h1><a class="header" href="#links-90" id="links-90">Links</a></h1>
<ul>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/socket/index.html">Socket-level Programming | Network Programming with Go (golang)</a></li>
<li><a href="http://www.minaandrawos.com/2016/05/14/udp-vs-tcp-in-golang/">Implementing UDP vs TCP in Golang - Mina Andrawos</a></li>
<li><a href="https://stackoverflow.com/questions/1099672/when-is-it-appropriate-to-use-udp-instead-of-tcp/1099734#1099734">networking - When is it appropriate to use UDP instead of TCP? - Stack Overflow</a></li>
<li><a href="https://www.darkcoding.net/uncategorized/raw-sockets-in-go-ip-layer/">Graham King » Raw sockets in Go: IP layer</a></li>
<li><a href="https://github.com/grahamking/latency/blob/master/tcp.go">TCP header </a></li>
</ul>
<h1><a class="header" href="#package-files" id="package-files">Package files</a></h1>
<ul>
<li>
<p>定义接口和錯誤类型</p>
<p><a href="https://golang.org/src/net/net.go">net.go</a> </p>
</li>
<li>
<p>基础类型</p>
<p><a href="https://golang.org/src/net/interface.go">interface.go</a> <a href="https://golang.org/src/net/mac.go">mac.go</a> <a href="https://golang.org/src/net/ip.go">ip.go</a>  <a href="https://golang.org/src/net/dial.go">dial.go</a> <a href="https://golang.org/src/net/lookup.go">lookup.go</a> </p>
</li>
<li>
<p>实现Conn, PacketConn, Listener </p>
<p><a href="https://golang.org/src/net/iprawsock.go">iprawsock.go</a> <a href="https://golang.org/src/net/tcpsock.go">tcpsock.go</a>  <a href="https://golang.org/src/net/udpsock.go">udpsock.go</a> <a href="https://golang.org/src/net/unixsock.go">unixsock.go </a> </p>
</li>
</ul>
<h1><a class="header" href="#overview-8" id="overview-8">Overview</a></h1>
<p><a href="https://golang.org/pkg/net/#pkg-overview">Overview</a></p>
<h1><a class="header" href="#5个基础网络接口-conn-listener-packetconn-addr-error" id="5个基础网络接口-conn-listener-packetconn-addr-error">5个基础网络接口: Conn, Listener, PacketConn, Addr, Error</a></h1>
<h2><a class="header" href="#conn接口" id="conn接口">Conn接口</a></h2>
<p>Conn接口是这个包的核心</p>
<p>Conn接口包含8个函数，实现了Conn接口也就实现了&quot;读写关&quot;接口</p>
<p>这8个函数返回Conn接口: Dial, DialTimeout, FileConn, Pipe, *Dialer.Dial, *Dialer.DialContext, *TCPListener.Accept, *UnixListener.Accept</p>
<p>包内有一个conn类型实现了Conn接口, 还实现了2个设置缓存函数和1个File函数</p>
<pre><code class="language-go">type Conn interface {
        Read(b []byte) (n int, err error)
        Write(b []byte) (n int, err error)
        Close() error

        LocalAddr() Addr
        RemoteAddr() Addr

        // A deadline is an absolute time after which I/O operations
        // fail with a timeout (see type Error) instead of
        // blocking.
        SetDeadline(t time.Time) error
        SetReadDeadline(t time.Time) error
        SetWriteDeadline(t time.Time) error
}

func Dial(network, address string) (Conn, error)
func DialTimeout(network, address string, timeout time.Duration) (Conn, error)
func FileConn(f *os.File) (c Conn, err error)

func Pipe() (Conn, Conn)

func (d *Dialer) Dial(network, address string) (Conn, error)
func (d *Dialer) DialContext(ctx context.Context, network, address string) (Conn, error)

func (l *TCPListener) Accept() (Conn, error)
func (l *UnixListener) Accept() (Conn, error)

type conn struct {
    fd *netFD
}

func (c *conn) SetReadBuffer(bytes int) error
func (c *conn) SetWriteBuffer(bytes int) error
// On Unix systems this will cause the SetDeadline methods to stop working.
func (c *conn) File() (f *os.File, err error)
</code></pre>
<h2><a class="header" href="#listener接口" id="listener接口">Listener接口</a></h2>
<pre><code class="language-go">type Listener interface {
    // Accept waits for and returns the next connection to the listener.
    Accept() (Conn, error)
    // Close closes the listener.
    // Any blocked Accept operations will be unblocked and return errors.
    Close() error
    // Addr returns the listener's network address.
    Addr() Addr
}

func Listen(network, address string) (Listener, error)
func FileListener(f *os.File) (ln Listener, err error)

func (lc *ListenConfig) Listen(ctx context.Context, network, address string) (Listener, error)
</code></pre>
<h2><a class="header" href="#packetconn接口" id="packetconn接口">PacketConn接口</a></h2>
<p>包含7个函数,区别于Conn接口, 其中的读写接口换成了另一种读写函数,没有了RemoteAddr函数</p>
<pre><code class="language-go">type PacketConn interface {
    // ReadFrom reads a packet from the connection,
    // copying the payload into b. It returns the number of
    // bytes copied into b and the return address that
    // was on the packet.
    ReadFrom(b []byte) (n int, addr Addr, err error)
    // WriteTo writes a packet with payload b to addr.
    WriteTo(b []byte, addr Addr) (n int, err error)
    Close() error

    LocalAddr() Addr

    SetDeadline(t time.Time) error
    SetReadDeadline(t time.Time) error
    SetWriteDeadline(t time.Time) error
}

func ListenPacket(network, address string) (PacketConn, error)
func FilePacketConn(f *os.File) (c PacketConn, err error)

func (lc *ListenConfig) ListenPacket(ctx context.Context, network, address string) (PacketConn, error)
</code></pre>
<h2><a class="header" href="#addr接口" id="addr接口">Addr接口</a></h2>
<pre><code class="language-go">// Addr represents a network end point address.
//
// The two methods Network and String conventionally return strings
// that can be passed as the arguments to Dial, but the exact form
// and meaning of the strings is up to the implementation.
type Addr interface {
    Network() string // name of the network (for example, &quot;tcp&quot;, &quot;udp&quot;)
    String() string  // string form of address (for example, &quot;192.0.2.1:25&quot;, &quot;[2001:db8::1]:80&quot;)
}

func (ifi *Interface) Addrs() ([]Addr, error)
func (ifi *Interface) MulticastAddrs() ([]Addr, error)
func InterfaceAddrs() ([]Addr, error)

func (n *IPNet) Network() string
func (n *IPNet) String() string

func (a *IPAddr) Network() string
func (a *IPAddr) String() string

func (c *IPConn) LocalAddr() Addr
func (c *IPConn) RemoteAddr() Addr
func (c *IPConn) ReadFrom(b []byte) (int, Addr, error)
func (c *IPConn) WriteTo(b []byte, addr Addr) (int, error)

func (a *TCPAddr) Network() string
func (a *TCPAddr) String() string

func (c *TCPConn) LocalAddr() Addr
func (c *TCPConn) RemoteAddr() Addr

func (l *TCPListener) Addr() Addr

func (a *UDPAddr) Network() string
func (a *UDPAddr) String() string

func (c *UDPConn) LocalAddr() Addr
func (c *UDPConn) RemoteAddr() Addr
func (c *UDPConn) ReadFrom(b []byte) (int, Addr, error)
func (c *UDPConn) WriteTo(b []byte, addr Addr) (int, error)

func (a *UnixAddr) Network() string
func (a *UnixAddr) String() string

func (c *UnixConn) LocalAddr() Addr
func (c *UnixConn) RemoteAddr() Addr
func (c *UnixConn) ReadFrom(b []byte) (int, Addr, error)
func (c *UnixConn) WriteTo(b []byte, addr Addr) (int, error)

func (l *UnixListener) Addr() Addr
</code></pre>
<h2><a class="header" href="#关于网络类型" id="关于网络类型">关于网络类型</a></h2>
<pre><code class="language-go">func Dial(network, address string) (Conn, error)
func DialTimeout(network, address string, timeout time.Duration) (Conn, error)
func (d *Dialer) Dial(network, address string) (Conn, error)
func (d *Dialer) DialContext(ctx context.Context, network, address string) (Conn, error)


func (lc *ListenConfig) Listen(ctx context.Context, network, address string) (Listener, error)
func (lc *ListenConfig) ListenPacket(ctx context.Context, network, address string) (PacketConn, error)

func Listen(network, address string) (Listener, error)
func ListenPacket(network, address string) (PacketConn, error)

func ResolveIPAddr(network, address string) (*IPAddr, error)
func DialIP(network string, laddr, raddr *IPAddr) (*IPConn, error)
func ListenIP(network string, laddr *IPAddr) (*IPConn, error)

func ResolveTCPAddr(network, address string) (*TCPAddr, error)
func DialTCP(network string, laddr, raddr *TCPAddr) (*TCPConn, error)
func ListenTCP(network string, laddr *TCPAddr) (*TCPListener, error)

func ResolveUDPAddr(network, address string) (*UDPAddr, error)
func DialUDP(network string, laddr, raddr *UDPAddr) (*UDPConn, error)
func ListenUDP(network string, laddr *UDPAddr) (*UDPConn, error)
func ListenMulticastUDP(network string, ifi *Interface, gaddr *UDPAddr) (*UDPConn, error)

func ResolveUnixAddr(network, address string) (*UnixAddr, error)
func DialUnix(network string, laddr, raddr *UnixAddr) (*UnixConn, error)
func ListenUnixgram(network string, laddr *UnixAddr) (*UnixConn, error)
func ListenUnix(network string, laddr *UnixAddr) (*UnixListener, error)

func LookupPort(network, service string) (port int, err error)
func (r *Resolver) LookupPort(ctx context.Context, network, service string) (port int, err error)
</code></pre>
<p>Known networks are:</p>
<ul>
<li>&quot;tcp&quot;, &quot;tcp4&quot; (IPv4-only), &quot;tcp6&quot; (IPv6-only) </li>
<li>&quot;udp&quot;, &quot;udp4&quot; (IPv4-only), &quot;udp6&quot; (IPv6-only)</li>
<li>&quot;ip&quot;, &quot;ip4&quot; (IPv4-only), &quot;ip6&quot; (IPv6-only)</li>
<li>&quot;unix&quot;, &quot;unixgram&quot; and &quot;unixpacket&quot;. </li>
</ul>
<p>对于IP协议,参数network是要带上协议名,或协议号的.例:</p>
<pre><code>Dial(&quot;ip4:1&quot;, &quot;192.0.2.1&quot;)
Dial(&quot;ip6:ipv6-icmp&quot;, &quot;2001:db8::1&quot;)
Dial(&quot;ip6:58&quot;, &quot;fe80::1%lo0&quot;)
</code></pre>
<p>Resovle用正确的网络名生成各协议地址结构</p>
<p>IPNet, IPAddr, TCPAddr, UDPAddr, UnixAddr 5种地址结构都实现了Addr接口,可以通过Addr接口得到网络类型</p>
<h2><a class="header" href="#error接口" id="error接口">Error接口</a></h2>
<pre><code class="language-go">// An Error represents a network error.
type Error interface {
    error
    Timeout() bool   // Is the error a timeout?
    Temporary() bool // Is the error temporary?
}
</code></pre>
<h1><a class="header" href="#4个基础网络结构-interface-hardwareaddr-ip-ipmask" id="4个基础网络结构-interface-hardwareaddr-ip-ipmask">4个基础网络结构: Interface, HardwareAddr, IP, IPMask</a></h1>
<p>HardwareAddr, IP, IPMask all are []byte</p>
<h2><a class="header" href="#interface结构" id="interface结构">Interface结构</a></h2>
<pre><code class="language-go">type Interface struct {
    Index        int          // positive integer that starts at one, zero is never used
    MTU          int          // maximum transmission unit
    Name         string       // e.g., &quot;en0&quot;, &quot;lo0&quot;, &quot;eth0.100&quot;
    HardwareAddr HardwareAddr // IEEE MAC-48, EUI-48 and EUI-64 form
    Flags        Flags        // e.g., FlagUp, FlagLoopback, FlagMulticast
}

func (ifi *Interface) Addrs() ([]Addr, error) 
func (ifi *Interface) MulticastAddrs() ([]Addr, error)

func InterfaceByIndex(index int) (*Interface, error) 
func InterfaceByName(name string) (*Interface, error) 
func Interfaces() ([]Interface, error)
func InterfaceAddrs() ([]Addr, error)

type Flags uint
func (f Flags) String() string 
</code></pre>
<h2><a class="header" href="#hardwareaddr结构" id="hardwareaddr结构">HardwareAddr结构</a></h2>
<pre><code class="language-go">type HardwareAddr []byte

func (a HardwareAddr) String() string
func ParseMAC(s string) (hw HardwareAddr, err error)
</code></pre>
<h2><a class="header" href="#ip结构" id="ip结构">IP结构</a></h2>
<p>这些函数返回IP结构:</p>
<p>ParseIP, ParseCIDR, IPv4, LookupIP, IP.To4, IP.To16, ip.Mask</p>
<pre><code class="language-go">type IP []byte

func ParseIP(s string) IP 
func ParseCIDR(s string) (IP, *IPNet, error) 
func IPv4(a, b, c, d byte) IP
func LookupIP(host string) ([]IP, error)

func (ip IP) Equal(x IP) bool
func (ip IP) IsUnspecified() bool {
    return ip.Equal(IPv4zero) || ip.Equal(IPv6unspecified)
}
func (ip IP) IsLoopback() bool 

func (ip IP) IsMulticast() bool
func (ip IP) IsInterfaceLocalMulticast() bool
func (ip IP) IsLinkLocalMulticast() bool 
func (ip IP) IsLinkLocalUnicast() bool 
func (ip IP) IsGlobalUnicast() bool 

func (ip IP) To4() IP 
func (ip IP) To16() IP 

func (ip IP) DefaultMask() IPMask
func (ip IP) Mask(mask IPMask) IP

func (ip IP) String() string 
func (ip IP) MarshalText() ([]byte, error)
func (ip *IP) UnmarshalText(text []byte) error 
</code></pre>
<h2><a class="header" href="#ipmask结构" id="ipmask结构">IPMask结构</a></h2>
<pre><code class="language-go">// An IP mask is an IP address.
type IPMask []byte

func IPv4Mask(a, b, c, d byte) IPMask
func CIDRMask(ones, bits int) IPMask 

func (m IPMask) Size() (ones, bits int) 
func (m IPMask) String() string

func (ip IP) DefaultMask() IPMask
</code></pre>
<h1><a class="header" href="#tcp协议里3个结构tcpaddr-tcpconn-tcplistener" id="tcp协议里3个结构tcpaddr-tcpconn-tcplistener">TCP协议里3个结构：TCPAddr, TCPConn, TCPListener</a></h1>
<h2><a class="header" href="#tcpaddr结构" id="tcpaddr结构">TCPAddr结构</a></h2>
<p>TCPAddr结构实现了Addr接口</p>
<pre><code class="language-go">type TCPAddr struct {
    IP   IP
    Port int
    Zone string // IPv6 scoped addressing zone
}

func (a *TCPAddr) Network() string { return &quot;tcp&quot; }
func (a *TCPAddr) String() string

func ResolveTCPAddr(network, address string) (*TCPAddr, error)
</code></pre>
<h2><a class="header" href="#tcpconn结构" id="tcpconn结构">TCPConn结构</a></h2>
<p>TCPConn is an implementation of the Conn interface for TCP network connections.</p>
<p>TCPConn内部就是一个conn结构，所以自然它实现了Conn接口</p>
<pre><code class="language-go">type TCPConn struct {
    conn
}

func (c *TCPConn) ReadFrom(r io.Reader) (int64, error)

// SyscallConn returns a raw network connection.
// This implements the syscall.Conn interface.
func (c *TCPConn) SyscallConn() (syscall.RawConn, error)

func (c *TCPConn) CloseRead() error
func (c *TCPConn) CloseWrite() error 

// 也是conn结构实现的
func (c *TCPConn) File() (f *os.File, err error)

func (c *TCPConn) SetKeepAlive(keepalive bool) error 
func (c *TCPConn) SetKeepAlivePeriod(d time.Duration) error
func (c *TCPConn) SetLinger(sec int) error
func (c *TCPConn) SetNoDelay(noDelay bool) error

// DialTCP acts like Dial for TCP networks.
//
// The network must be a TCP network name; see func Dial for details.
//
// If laddr is nil, a local address is automatically chosen.
// If the IP field of raddr is nil or an unspecified IP address, the
// local system is assumed.// DialTCP acts like Dial for TCP networks.
//
// The network must be a TCP network name; see func Dial for details.
//
// If laddr is nil, a local address is automatically chosen.
// If the IP field of raddr is nil or an unspecified IP address, the
// local system is assumed.
func DialTCP(network string, laddr, raddr *TCPAddr) (*TCPConn, error) 
func (l *TCPListener) AcceptTCP() (*TCPConn, error)
</code></pre>
<p>客户端的基本流程就是Dial建立连接，再么写，再么读。</p>
<p><a href="https://github.com/iofxl/gogogo/blob/master/tcpc.go">tcpc.go</a></p>
<h2><a class="header" href="#tcplistener结构" id="tcplistener结构">TCPListener结构</a></h2>
<p>实现Listener接口</p>
<pre><code class="language-go">type TCPListener struct {
    fd *netFD
}

// Accept implements the Accept method in the Listener interface; it
// waits for the next call and returns a generic Conn.
func (l *TCPListener) Accept() (Conn, error)
func (l *TCPListener) Close() error
func (l *TCPListener) Addr() Addr { return l.fd.laddr }

// AcceptTCP accepts the next incoming call and returns the new
// connection.
func (l *TCPListener) AcceptTCP() (*TCPConn, error)
func (l *TCPListener) File() (f *os.File, err error)
func (l *TCPListener) SetDeadline(t time.Time) error
func (l *TCPListener) SyscallConn() (syscall.RawConn, error) 

func ListenTCP(network string, laddr *TCPAddr) (*TCPListener, error)
</code></pre>
<p><a href="https://github.com/iofxl/practisego/blob/master/daytimes.go">Daytime Server</a></p>
<p><a href="https://github.com/iofxl/practisego/blob/master/echos.go">Echo Server</a></p>
<p>困扰我的是，怎样知道把客户端发过来的东西读光罢呢？: 不需要知道读光否读光的，使一个固定长的字节串 只要读的过程否碰的错误 一直读一直写转就可以罢</p>
<h1><a class="header" href="#udp协议里2个结构udpaddr-udpconn" id="udp协议里2个结构udpaddr-udpconn">UDP协议里2个结构：UDPAddr, UDPConn</a></h1>
<h2><a class="header" href="#udpaddr结构" id="udpaddr结构">UDPAddr结构</a></h2>
<p>UDPAddr结构实现了地址接口</p>
<pre><code class="language-go">type UDPAddr struct {
    IP   IP
    Port int
    Zone string // IPv6 scoped addressing zone
}

func (a *UDPAddr) Network() string { return &quot;udp&quot; }
func (a *UDPAddr) String() string

func ResolveUDPAddr(network, address string) (*UDPAddr, error)
</code></pre>
<h2><a class="header" href="#udpconn结构" id="udpconn结构">UDPConn结构</a></h2>
<p>IPConn, TCPConn, UDPConn, UnixConn 本质上都一样, 结构内部都是一模一样的一个conn结构.只是实现的差别</p>
<p>除了conn结构实现的,UDPConn结构自己实现了包连接接口,系统调用.连接接口,还有另外4个读写函数</p>
<p>UDPConn实现的4个读写函数: 读从UDP, 写到UDP, 读消息UDP, 写消息UDP. 和IPConn结构如出一辙</p>
<pre><code class="language-go">type UDPConn struct {
    conn
}

func (c *UDPConn) ReadFrom(b []byte) (int, Addr, error) 
func (c *UDPConn) WriteTo(b []byte, addr Addr) (int, error)

func (c *UDPConn) SyscallConn() (syscall.RawConn, error) 

func (c *UDPConn) ReadFromUDP(b []byte) (int, *UDPAddr, error) 
func (c *UDPConn) WriteToUDP(b []byte, addr *UDPAddr) (int, error)

func (c *UDPConn) ReadMsgUDP(b, oob []byte) (n, oobn, flags int, addr *UDPAddr, err error) 
func (c *UDPConn) WriteMsgUDP(b, oob []byte, addr *UDPAddr) (n, oobn int, err error) 

func DialUDP(network string, laddr, raddr *UDPAddr) (*UDPConn, error)
func ListenUDP(network string, laddr *UDPAddr) (*UDPConn, error)
func ListenMulticastUDP(network string, ifi *Interface, gaddr *UDPAddr) (*UDPConn, error)

</code></pre>
<p>UDP协议里的核心的函数是这几个：</p>
<pre><code class="language-go">func ResolveUDPAddr(network, address string) (*UDPAddr, error)
func DialUDP(network string, laddr, raddr *UDPAddr) (*UDPConn, error)
func ListenUDP(network string, laddr *UDPAddr) (*UDPConn, error)
func (c *UDPConn) ReadFromUDP(b []byte) (int, *UDPAddr, error)
func (c *UDPConn) WriteToUDP(b []byte, addr *UDPAddr) (int, error)
</code></pre>
<p><a href="https://github.com/iofxl/practisego/blob/master/daytimesudp.go">Daytime Server UDP</a></p>
<p><a href="https://github.com/iofxl/practisego/blob/master/udpc.go">DialUDP</a></p>
<h1><a class="header" href="#引出conn-packetconn-listener接口的小总结" id="引出conn-packetconn-listener接口的小总结">引出Conn, PacketConn, Listener接口的小总结</a></h1>
<p>对比以瞅，Dial函数就是简化原来各个协议里的:</p>
<ul>
<li>先通过<code>network,address</code>去<code>ResolveTCPAddr</code>,再通过<code>DialTCP</code>返回<code>*TCPConn</code></li>
<li>先通过<code>network,address</code>去<code>ResolveUDPAddr</code>,再通过<code>DialUDP</code>返回<code>*UDPConn</code></li>
</ul>
<p>而直接通过<code>network, address</code>去<code>Dial</code>, 返回<code>Conn</code>接口</p>
<p><code>Listen</code>之于<code>ListenTCP</code>, <code>ListenPacket</code>之于<code>ListenUDP</code>, 统都一回事，<code>*TCPListener</code>结构实现<code>Listener</code>接口，<code>*UDPConn</code>结构实现<code>PacketConn</code>接口</p>
<p>一种是抽象的，一种是具体的。</p>
<p><strong>这种学习方式是由具体到抽象的步骤，我认为就是应该这样学，而不应该倒过来。</strong></p>
<pre><code class="language-go">func ResolveTCPAddr(network, address string) (*TCPAddr, error)
func DialTCP(network string, laddr, raddr *TCPAddr) (*TCPConn, error)

func ResolveUDPAddr(network, address string) (*UDPAddr, error)
func DialUDP(network string, laddr, raddr *UDPAddr) (*UDPConn, error)

func Dial(network, address string) (Conn, error)

func Listen(network, address string) (Listener, error)
func ListenTCP(network string, laddr *TCPAddr) (*TCPListener, error)

func ListenPacket(network, address string) (PacketConn, error)
func ListenUDP(network string, laddr *UDPAddr) (*UDPConn, error)
</code></pre>
<h2><a class="header" href="#重写前头的例子" id="重写前头的例子">重写前头的例子</a></h2>
<p><a href="https://github.com/iofxl/practisego/blob/master/tcpcInterface.go">TCP Client with Dial</a></p>
<p><a href="https://github.com/iofxl/practisego/blob/master/daytimes.with.listen.go">Daytime Server Support both TCP and UDP</a></p>
<p><a href="https://github.com/iofxl/practisego/blob/master/echos.use.Listen.go">Echo Server Support both TCP and UDP</a></p>
<p><a href="https://github.com/iofxl/practisego/blob/master/ping.go">Ping</a></p>
<h1><a class="header" href="#ip协议里3个结构ipnet-ipaddr-ipconn" id="ip协议里3个结构ipnet-ipaddr-ipconn">IP协议里3个结构：IPNet, IPAddr, IPConn</a></h1>
<p>IPNet, IPAddr 都实现了Addr 地址接口</p>
<h2><a class="header" href="#ipnet结构" id="ipnet结构">IPNet结构</a></h2>
<pre><code class="language-go">type IPNet struct {
    IP   IP     // network number
    Mask IPMask // network mask
}

func (n *IPNet) Network() string { return &quot;ip+net&quot; }
func (n *IPNet) String() string 

func (n *IPNet) Contains(ip IP) bool 
</code></pre>
<h2><a class="header" href="#ipaddr结构" id="ipaddr结构">IPAddr结构</a></h2>
<pre><code class="language-go">type IPAddr struct {
    IP   IP
    Zone string // IPv6 scoped addressing zone
}

func (a *IPAddr) Network() string { return &quot;ip&quot; }
func (a *IPAddr) String() string 

func ResolveIPAddr(network, address string) (*IPAddr, error) 
</code></pre>
<h2><a class="header" href="#ipconn结构" id="ipconn结构">IPConn结构</a></h2>
<p>IPConn 类型实现了3个接口: Conn, PacketConn, syscall.Conn</p>
<pre><code class="language-go">// IPConn is the implementation of the Conn and PacketConn interfaces
// for IP network connections.
type IPConn struct {
    conn
}

type conn struct {
    fd *netFD
}


// ReadFromIP acts like ReadFrom but returns an IPAddr.
func (c *IPConn) ReadFromIP(b []byte) (int, *IPAddr, error) 
func (c *IPConn) WriteToIP(b []byte, addr *IPAddr) (int, error)

func (c *IPConn) ReadFrom(b []byte) (int, Addr, error)
func (c *IPConn) WriteTo(b []byte, addr Addr) (int, error) 

func (c *IPConn) ReadMsgIP(b, oob []byte) (n, oobn, flags int, addr *IPAddr, err error) 
func (c *IPConn) WriteMsgIP(b, oob []byte, addr *IPAddr) (n, oobn int, err error) 

func (c *IPConn) SyscallConn() (syscall.RawConn, error) 

//net.go内的conn类型实现了Conn接口, 还实现了另外2个缓存设置函数及1个File函数
func (c *conn) SetReadBuffer(bytes int) error
func (c *conn) SetWriteBuffer(bytes int) error
// On Unix systems this will cause the SetDeadline methods to stop working.
func (c *conn) File() (f *os.File, err error)

func DialIP(network string, laddr, raddr *IPAddr) (*IPConn, error)
func ListenIP(network string, laddr *IPAddr) (*IPConn, error) 
</code></pre>
<h1><a class="header" href="#unix协议里3个结构unixaddr-unixconn-unixlistener" id="unix协议里3个结构unixaddr-unixconn-unixlistener">Unix协议里3个结构：UnixAddr, UnixConn, UnixListener</a></h1>
<h2><a class="header" href="#unixaddr结构" id="unixaddr结构">UnixAddr结构</a></h2>
<p>UnixAddr实现了Addr接口</p>
<pre><code class="language-go">type UnixAddr struct {
    Name string
    Net  string
}

func (a *UnixAddr) Network() string 
func (a *UnixAddr) String() string 

func ResolveUnixAddr(network, address string) (*UnixAddr, error) 
</code></pre>
<h2><a class="header" href="#unixconn结构" id="unixconn结构">UnixConn结构</a></h2>
<p>IPConn, TCPConn, UDPConn, UnixConn 本质上都一样, 结构内部都是一模一样的一个conn类型.只是实现的差别</p>
<p>UnixConn自己实现了包连接接口, 系统调用.连接接口,还有6个读写关闭相关函数</p>
<p>UnixConn类型实现的6个函数: 关闭读, 关闭写, 读从Unix, 写到Unix, 读消息Unix, 写消息Unix</p>
<p>两个返回UnixConn类型的函数: 拔号Unix, 监听Unixgram(一定要是Unixgram)</p>
<pre><code class="language-go">type UnixConn struct {
    conn
}


func (c *UnixConn) ReadFrom(b []byte) (int, Addr, error) 
func (c *UnixConn) WriteTo(b []byte, addr Addr) (int, error) 

func (c *UnixConn) SyscallConn() (syscall.RawConn, error) 

func (c *UnixConn) CloseRead() error
func (c *UnixConn) CloseWrite() error

func (c *UnixConn) ReadFromUnix(b []byte) (int, *UnixAddr, error)
func (c *UnixConn) WriteToUnix(b []byte, addr *UnixAddr) (int, error)

func (c *UnixConn) ReadMsgUnix(b, oob []byte) (n, oobn, flags int, addr *UnixAddr, err error)
func (c *UnixConn) WriteMsgUnix(b, oob []byte, addr *UnixAddr) (n, oobn int, err error)

func DialUnix(network string, laddr, raddr *UnixAddr) (*UnixConn, error)
func ListenUnixgram(network string, laddr *UnixAddr) (*UnixConn, error) 
</code></pre>
<h2><a class="header" href="#unixlistener结构" id="unixlistener结构">UnixListener结构</a></h2>
<pre><code class="language-go">type UnixListener struct {
    fd         *netFD
    path       string
    unlink     bool
    unlinkOnce sync.Once
}


func (l *UnixListener) Accept() (Conn, error) 
func (l *UnixListener) Close() error
func (l *UnixListener) Addr() Addr { return l.fd.laddr }

func (l *UnixListener) SyscallConn() (syscall.RawConn, error) 

func (l *UnixListener) AcceptUnix() (*UnixConn, error)
func (l *UnixListener) File() (f *os.File, err error) 
func (l *UnixListener) SetDeadline(t time.Time) error
func (l *UnixListener) SetUnlinkOnClose(unlink bool)

func ListenUnix(network string, laddr *UnixAddr) (*UnixListener, error)
</code></pre>
<h1><a class="header" href="#dialer结构" id="dialer结构">Dialer结构</a></h1>
<p>A Dialer contains options for connecting to an address.</p>
<p>The zero value for each field is equivalent to dialing without that option. Dialing with the zero value of Dialer is therefore equivalent to just calling the Dial function. </p>
<pre><code class="language-go">type Dialer struct {
    // The default is no timeout.
    // 会影响超时的东西, 操作系统设置的超时
    // Timeout, Deadline誰短誰有效吧
    Timeout time.Duration
    Deadline time.Time
    LocalAddr Addr
    // 没説这个默认值是什么
    DualStack bool
    FallbackDelay time.Duration
    // 默认值?
    KeepAlive time.Duration
    Resolver *Resolver
}

func Dial(network, address string) (Conn, error) {
    var d Dialer
    return d.Dial(network, address)
}
func DialTimeout(network, address string, timeout time.Duration) (Conn, error) {
    d := Dialer{Timeout: timeout}
    return d.Dial(network, address)
}

func (d *Dialer) Dial(network, address string) (Conn, error) {
    return d.DialContext(context.Background(), network, address)
}
func (d *Dialer) DialContext(ctx context.Context, network, address string) (Conn, error)
</code></pre>
<h1><a class="header" href="#listenconfig结构" id="listenconfig结构">ListenConfig结构</a></h1>
<p>ListenConfig contains options for listening to an address. </p>
<pre><code class="language-go">type ListenConfig struct {
// If Control is not nil, it is called after creating the network
// connection but before binding it to the operating system.
//
// Network and address parameters passed to Control method are not
// necessarily the ones passed to Listen. For example, passing &quot;tcp&quot; to
// Listen will cause the Control function to be called with &quot;tcp4&quot; or &quot;tcp6&quot;.
Control func(network, address string, c syscall.RawConn) error
}

func (lc *ListenConfig) Listen(ctx context.Context, network, address string) (Listener, error)
func (lc *ListenConfig) ListenPacket(ctx context.Context, network, address string) (PacketConn, error)
</code></pre>
<h1><a class="header" href="#dns的3个记录结构srv-mx-ns" id="dns的3个记录结构srv-mx-ns">DNS的3个记录结构：SRV, MX, NS</a></h1>
<pre><code class="language-go">// An SRV represents a single DNS SRV record.
type SRV struct {
    Target   string
    Port     uint16
    Priority uint16
    Weight   uint16
}

type MX struct {
    Host string
    Pref uint16
}

type NS struct {
    Host string
}
</code></pre>
<h1><a class="header" href="#resolver结构" id="resolver结构">Resolver结构</a></h1>
<p>是对 Dial() 的封装</p>
<h1><a class="header" href="#dns的9个查找函数" id="dns的9个查找函数">DNS的9个查找函数</a></h1>
<p>LookupAddr(r.LookupAddr)是反向查询, LookupIP(r.LookupIPAddr)不是</p>
<p><strong>LookupIP(r.LookupIPAddr)</strong> 和 LookupHost(r.LookupHost)是相同功能的.只不过返回类型不一样.前者返回相应的类型,后者返回字符串的切片.</p>
<pre><code class="language-go">var DefaultResolver = &amp;Resolver{}

type Resolver struct {
    PreferGo bool
    StrictErrors bool
    Dial func(ctx context.Context, network, address string) (Conn, error)
}

func LookupHost(host string) (addrs []string, err error) {
    return DefaultResolver.LookupHost(context.Background(), host)
}
func (r *Resolver) LookupHost(ctx context.Context, host string) (addrs []string, err error)

func LookupIP(host string) ([]IP, error) {
    addrs, err := DefaultResolver.LookupIPAddr(context.Background(), host)
    ...
}
func (r *Resolver) LookupIPAddr(ctx context.Context, host string) ([]IPAddr, error) 

func LookupPort(network, service string) (port int, err error)
func (r *Resolver) LookupPort(ctx context.Context, network, service string) (port int, err error) 

func LookupCNAME(host string) (cname string, err error) 
func (r *Resolver) LookupCNAME(ctx context.Context, host string) (cname string, err error)

func LookupSRV(service, proto, name string) (cname string, addrs []*SRV, err error) 
func (r *Resolver) LookupSRV(ctx context.Context, service, proto, name string) (cname string, addrs []*SRV, err error) 

func LookupMX(name string) ([]*MX, error) 
func (r *Resolver) LookupMX(ctx context.Context, name string) ([]*MX, error) 

func LookupNS(name string) ([]*NS, error)
func (r *Resolver) LookupNS(ctx context.Context, name string) ([]*NS, error) 

func LookupTXT(name string) ([]string, error) 
func (r *Resolver) LookupTXT(ctx context.Context, name string) ([]string, error)

func LookupAddr(addr string) (names []string, err error)
func (r *Resolver) LookupAddr(ctx context.Context, addr string) (names []string, err error)
</code></pre>
<h1><a class="header" href="#6种网络错误结构" id="6种网络错误结构">6种网络错误结构</a></h1>
<pre><code class="language-go">type ParseError struct {
    Type string
    Text string
}

type OpError struct {
    Op string
    Net string
    Source Addr
    Addr Addr
    Err error
}

type AddrError struct {
    Err  string
    Addr string
}

type UnknownNetworkError string

type InvalidAddrError string

type DNSError struct {
    Err         string // description of the error
    Name        string // name looked for
    Server      string // server used
    IsTimeout   bool   // if true, timed out; not all timeouts set this
    IsTemporary bool   // if true, error is temporary; not all errors set this
}
</code></pre>
<h1><a class="header" href="#buffers结构" id="buffers结构">Buffers结构</a></h1>
<pre><code class="language-go">type Buffers [][]byte
func (v *Buffers) Read(p []byte) (n int, err error)
func (v *Buffers) WriteTo(w io.Writer) (n int64, err error)
</code></pre>
<h1><a class="header" href="#2个拆合主机端口的函数" id="2个拆合主机端口的函数">2个拆合主机端口的函数</a></h1>
<pre><code class="language-go">func SplitHostPort(hostport string) (host, port string, err error)
func JoinHostPort(host, port string) string 
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgnettextprotopackage-textprotoa" id="a-hrefhttpsgolangorgpkgnettextprotopackage-textprotoa"><a href="https://golang.org/pkg/net/textproto/">Package textproto</a></a></h1>
<p>这个包是http, smtp等包的基础，所以非常有必要搞清楚。</p>
<p>配合smtp包一时学这个包。</p>
<p>借着这个包，还可以同时回顾一下bufio包</p>
<p>textproto.Conn这个东西客户端需要，实现服务端的时候，有textproto.Reader, textproto.Writer就会得罢</p>
<h1><a class="header" href="#overview-9" id="overview-9">Overview</a></h1>
<p>Package textproto implements generic support for text-based request/response protocols in the style of HTTP, NNTP, and SMTP.</p>
<p>The package provides:</p>
<p>Error, which represents a numeric error response from a server.</p>
<p>Pipeline, to manage pipelined requests and responses in a client.</p>
<p>Reader, to read numeric response code lines, key: value headers, lines wrapped with leading spaces on continuation lines, and whole text blocks ending with a dot on a line by itself.</p>
<p>Writer, to write dot-encoded text blocks.</p>
<p>Conn, a convenient packaging of Reader, Writer, and Pipeline for use with a single network connection. </p>
<h1><a class="header" href="#type-conn-struct" id="type-conn-struct">type Conn struct</a></h1>
<p>a textproto.Conn is just a conn with bufio.ReadWriter</p>
<pre><code class="language-go">type Conn struct {
        Reader
        Writer
        Pipeline
        // contains filtered or unexported fields
}

func Dial(network, addr string) (*Conn, error) {
	c, err := net.Dial(network, addr)
	if err != nil {
		return nil, err
	}
	return NewConn(c), nil
}
func NewConn(conn io.ReadWriteCloser) *Conn {
	return &amp;Conn{
		Reader: Reader{R: bufio.NewReader(conn)},
		Writer: Writer{W: bufio.NewWriter(conn)},
		conn:   conn,
	}
}

// c.Cmd内部使c.PrintfLine, c.W.PrintfLine内部使fmt.Fprintf,加上一个w.W.Write(crnl)
func (c *Conn) Cmd(format string, args ...interface{}) (id uint, err error) {
	id = c.Next()
	c.StartRequest(id)
	err = c.PrintfLine(format, args...)
	c.EndRequest(id)
	if err != nil {
		return 0, err
	}
	return id, nil
}
func (c *Conn) Close() error
</code></pre>
<p>For example, a client might run a HELP command that returns a dot-body by using:</p>
<pre><code class="language-go">id, err := c.Cmd(&quot;HELP&quot;)
if err != nil {
	return nil, err
}

c.StartResponse(id)
defer c.EndResponse(id)

if _, _, err = c.ReadCodeLine(110); err != nil {
	return nil, err
}
text, err := c.ReadDotBytes()
if err != nil {
	return nil, err
}
return c.ReadCodeLine(250)
</code></pre>
<h1><a class="header" href="#type-pipeline-struct" id="type-pipeline-struct">type Pipeline struct</a></h1>
<p>A Pipeline manages a pipelined in-order request/response sequence.</p>
<p>To use a Pipeline p to manage multiple clients on a connection, each client should run:</p>
<pre><code class="language-go">id := p.Next()	// take a number

p.StartRequest(id)	// wait for turn to send request
«send request»
p.EndRequest(id)	// notify Pipeline that request is sent

p.StartResponse(id)	// wait for turn to read response
«read response»
p.EndResponse(id)	// notify Pipeline that response is read
</code></pre>
<p>Pipeline这个东西，别个场地都有法使的。</p>
<pre><code class="language-go">type Pipeline struct {
mu       sync.Mutex
id       uint
request  sequencer
response sequencer
}

func (p *Pipeline) Next() uint {
	p.mu.Lock()
	id := p.id
	p.id++
	p.mu.Unlock()
	return id
}
func (p *Pipeline) StartRequest(id uint)
func (p *Pipeline) EndRequest(id uint)
func (p *Pipeline) StartResponse(id uint)
func (p *Pipeline) EndResponse(id uint)
</code></pre>
<h1><a class="header" href="#type-reader-struct-1" id="type-reader-struct-1">type Reader struct</a></h1>
<pre><code class="language-go">type Reader struct {
        R *bufio.Reader
	        // contains filtered or unexported fields
}

func NewReader(r *bufio.Reader) *Reader

// the msg after process by ReadRespnse is in this form: &quot;msg1\nmsg2\nmsg3\nmsg4&quot;, the end is no &quot;\n&quot;
// so can be taken to used by strings.Split(msg, &quot;\n&quot;)
func (r *Reader) ReadResponse(expectCode int) (code int, message string, err error) {
	code, continued, message, err := r.readCodeLine(expectCode)
	...
	for continued {
		line, err := r.ReadLine()
		...
		code2, continued, moreMessage, err = parseCodeLine(line, 0)
		if err != nil || code2 != code {
			message += &quot;\n&quot; + strings.TrimRight(line, &quot;\r\n&quot;)
			continued = true
			continue
		}
		message += &quot;\n&quot; + moreMessage
	}
	...	
	return
}

func (r *Reader) ReadCodeLine(expectCode int) (code int, message string, err error)
func (r *Reader) ReadLine() (string, error)
func (r *Reader) ReadLineBytes() ([]byte, error)
func (r *Reader) ReadContinuedLine() (string, error)
func (r *Reader) ReadContinuedLineBytes() ([]byte, error)

func (r *Reader) DotReader() io.Reader
func (r *Reader) ReadDotLines() ([]string, error)
func (r *Reader) ReadDotBytes() ([]byte, error)

func (r *Reader) ReadMIMEHeader() (MIMEHeader, error)

// it can't handle the second form. but r.ReadResponse will handle form 2 correct.
func parseCodeLine(line string, expectCode int) (code int, continued bool, message string, err error) {
	...
	continued = line[3] == '-'
	code, err = strconv.Atoi(line[0:3])
	...
	message = line[4:]
	...
	return
}
</code></pre>
<p>ReadResponse reads a multi-line response of the form:</p>
<pre><code>code-message line 1
code-message line 2
...
code message line n
</code></pre>
<p>another form of response accepted:</p>
<pre><code>code-message line 1
message line 2
...
code message line n
</code></pre>
<p>If the prefix of the status does not match the digits in expectCode, ReadResponse returns with err set to &amp;Error{code, message}. For example, if expectCode is 31, an error will be returned if the status is not in the range [310,319].</p>
<p>An expectCode &lt;= 0 disables the check of the status code.</p>
<h1><a class="header" href="#type-writer-struct-1" id="type-writer-struct-1">type Writer struct</a></h1>
<pre><code class="language-go">type Writer struct {
        W *bufio.Writer
        // contains filtered or unexported fields
}

func NewWriter(w *bufio.Writer) *Writer

func (w *Writer) PrintfLine(format string, args ...interface{}) error {
	w.closeDot()
	fmt.Fprintf(w.W, format, args...)
	w.W.Write(crnl)
	return w.W.Flush()
}
func (w *Writer) DotWriter() io.WriteCloser
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgnetsmtppackage-smtpa" id="a-hrefhttpsgolangorgpkgnetsmtppackage-smtpa"><a href="https://golang.org/pkg/net/smtp/">Package smtp</a></a></h1>
<h1><a class="header" href="#links-91" id="links-91">Links</a></h1>
<ul>
<li><a href="https://github.com/mailhog/MailHog">mailhog/MailHog: Web and API based SMTP testing</a></li>
<li><a href="https://godoc.org/github.com/bradfitz/go-smtpd/smtpd">smtpd - GoDoc</a></li>
</ul>
<h1><a class="header" href="#run-mailhog" id="run-mailhog">Run MailHog</a></h1>
<pre><code>docker pull mailhog/mailhog
docker run -p 1025:1025 -p 8025:8025 mailhog/mailhog
</code></pre>
<h1><a class="header" href="#type-client" id="type-client">type Client</a></h1>
<pre><code class="language-go">type Client struct {
        // Text is the textproto.Conn used by the Client. It is exported to allow for
        // clients to add extensions.
        Text *textproto.Conn
        // contains filtered or unexported fields
}

func Dial(addr string) (*Client, error) {
	conn, err := net.Dial(&quot;tcp&quot;, addr)
	if err != nil {
		return nil, err
	}
	host, _, _ := net.SplitHostPort(addr)
	return NewClient(conn, host)
}
func NewClient(conn net.Conn, host string) (*Client, error)
// Calling this method is only necessary if the client needs control over the host name used. 
func (c *Client) Hello(localName string) error
func (c *Client) Auth(a Auth) error
func (c *Client) Mail(from string) error
func (c *Client) Rcpt(to string) error
func (c *Client) Data() (io.WriteCloser, error)
// 发完数据关闭连接
func (c *Client) Close() error
func (c *Client) Quit() error

func (c *Client) Extension(ext string) (bool, string)
func (c *Client) Noop() error
func (c *Client) Reset() error
func (c *Client) StartTLS(config *tls.Config) error
func (c *Client) TLSConnectionState() (state tls.ConnectionState, ok bool)
func (c *Client) Verify(addr string) error

</code></pre>
<h1><a class="header" href="#func-sendmail" id="func-sendmail">func SendMail</a></h1>
<pre><code class="language-go">func SendMail(addr string, a Auth, from string, to []string, msg []byte) error
</code></pre>
<p>Example:</p>
<pre><code class="language-go">func main() {
        addr := &quot;localhost:1025&quot;
        auth := smtp.CRAMMD5Auth(&quot;username&quot;, &quot;password&quot;)
        from := &quot;x@y.org&quot;
        to := []string{&quot;z1@z.org&quot;, &quot;z2@z.org&quot;}
        msg := []byte(&quot;From: from@y.org\r\n&quot; +
                &quot;To: z1@z.org, z2@z.org\r\n&quot; +
                &quot;Subject: discount Gophers!\r\n&quot; +
                &quot;\r\n&quot; +
                &quot;This is the email body.\r\n&quot;)

        err := smtp.SendMail(addr, auth, from, to, msg)
        if err != nil {
                log.Fatal(err)
        }
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgnetmailpackage-maila" id="a-hrefhttpsgolangorgpkgnetmailpackage-maila"><a href="https://golang.org/pkg/net/mail/">Package mail</a></a></h1>
<h1><a class="header" href="#links-92" id="links-92">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Email_address">Email address - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/International_email">International email - Wikipedia</a></li>
</ul>
<h1><a class="header" href="#type-message-struct" id="type-message-struct">type Message struct</a></h1>
<pre><code class="language-go">type Message struct {
        Header Header
	Body   io.Reader
}

func ReadMessage(r io.Reader) (msg *Message, err error)
</code></pre>
<h1><a class="header" href="#type-header" id="type-header">type Header</a></h1>
<pre><code class="language-go">type Header map[string][]string

func (h Header) Get(key string) string {
	return textproto.MIMEHeader(h).Get(key)
}
func (h Header) AddressList(key string) ([]*Address, error)
// Date parses the Date header field.
func (h Header) Date() (time.Time, error) {
	hdr := h.Get(&quot;Date&quot;)
	if hdr == &quot;&quot; {
		return time.Time{}, ErrHeaderNotPresent
	}
	return ParseDate(hdr)
}

func ParseDate(date string) (time.Time, error)
</code></pre>
<h1><a class="header" href="#type-address-struct" id="type-address-struct">type Address struct</a></h1>
<pre><code class="language-go">type Address struct {
        Name    string // Proper name; may be empty.
	        Address string // user@domain
}

func ParseAddress(address string) (*Address, error)
func ParseAddressList(list string) ([]*Address, error)

func (a *Address) String() string
</code></pre>
<h1><a class="header" href="#type-addressparser-struct" id="type-addressparser-struct">type AddressParser struct</a></h1>
<pre><code class="language-go">type AddressParser struct {
        // WordDecoder optionally specifies a decoder for RFC 2047 encoded-words.
	WordDecoder *mime.WordDecoder
}

func (p *AddressParser) Parse(address string) (*Address, error)
func (p *AddressParser) ParseList(list string) ([]*Address, error)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgencodingpackage-encodinga" id="a-hrefhttpsgolangorgpkgencodingpackage-encodinga"><a href="https://golang.org/pkg/encoding/">Package encoding</a></a></h1>
<h1><a class="header" href="#overview-10" id="overview-10">Overview</a></h1>
<p>Package encoding defines interfaces shared by other packages that convert data to and from byte-level and textual representations. Packages that check for these interfaces include encoding/gob, encoding/json, and encoding/xml. As a result, implementing an interface once can make a type useful in multiple encodings. Standard types that implement these interfaces include time.Time and net.IP. The interfaces come in pairs that produce and consume encoded data. </p>
<h1><a class="header" href="#4个编解组接口" id="4个编解组接口">4个编解组接口</a></h1>
<pre><code class="language-go">type BinaryMarshaler interface {
    MarshalBinary() (data []byte, err error)
}

type BinaryUnmarshaler interface {
    UnmarshalBinary(data []byte) error
}

type TextMarshaler interface {
    MarshalText() (text []byte, err error)
}

type TextUnmarshaler interface {
    UnmarshalText(text []byte) error
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgencodingasn1package-asn1a" id="a-hrefhttpsgolangorgpkgencodingasn1package-asn1a"><a href="https://golang.org/pkg/encoding/asn1/">Package asn1</a></a></h1>
<!-- ToC start -->
<h1><a class="header" href="#table-of-contents-1" id="table-of-contents-1">Table of Contents</a></h1>
<ol>
<li><a href="go/pkg/encoding/asn1.html#links">Links</a></li>
<li><a href="go/pkg/encoding/asn1.html#overview">Overview</a></li>
<li><a href="go/pkg/encoding/asn1.html#package-files">Package files</a></li>
<li><a href="go/pkg/encoding/asn1.html#%E4%B8%A4%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%9A%84%E7%BC%96%E8%A7%A3%E7%BB%84%E5%87%BD%E6%95%B0">一对编解组函数</a></li>
<li><a href="go/pkg/encoding/asn1.html#%E4%B8%80%E6%9C%AB%E6%A6%82%E5%BF%B5">一末概念</a></li>
</ol>
<!-- ToC end -->
<h1><a class="header" href="#links-93" id="links-93">Links</a></h1>
<ul>
<li><a href="https://www.obj-sys.com/asn1tutorial/node4.html">ASN.1 - Abstract Syntax Notation</a></li>
<li><a href="https://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx">Introduction to ASN.1</a></li>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/dataserialisation/asn1.html">ASN.1 | Network Programming with Go (golang)</a></li>
<li><a href="https://yq.aliyun.com/articles/494985?spm=a2c4e.11153940.blogcont494986.9.3bc82a74DRPHjg">asn浅析--协议的设计-博客-云栖社区-阿里云</a></li>
<li><a href="https://yq.aliyun.com/articles/494986">asn浅析--简单介绍-博客-云栖社区-阿里云</a></li>
</ul>
<h1><a class="header" href="#overview-11" id="overview-11">Overview</a></h1>
<p>我本来以为这个包会实现encoding里的4个接口，否想到否实现</p>
<h1><a class="header" href="#package-files-1" id="package-files-1">Package files</a></h1>
<p>＃ <a href="https://golang.org/pkg/encoding/asn1/#pkg-index">Index</a></p>
<h1><a class="header" href="#一对编解组函数" id="一对编解组函数">一对编解组函数</a></h1>
<pre><code class="language-go">func Marshal(val interface{}) ([]byte, error)
func Unmarshal(val interface{}, b []byte) (rest []byte, err error)
</code></pre>
<p>编组东西,返回字节串跟错误</p>
<p>解组字节串进东西，返回剩余跟错误</p>
<h1><a class="header" href="#一末概念" id="一末概念">一末概念</a></h1>
<p>语法三元组：实际语法、抽象语法和传输语法</p>
<p>其实在早期的一些标准如ASCII，它们既定义了抽象语法（比如字母A），又定义了传输语法（0x41）。ASN.1分离了这两种概念，以便可以选择一种适合要求的编解码方法。</p>
<pre><code>asn1以字节为基础，定义1个字节为“类型”和“长度”的元长度，首先考虑“类型”，从高位到低位的规定：8位和7位两位定义class，一共四种，第6位表示后面的“值”是基本类型还是复合类型，再后面的5位表示一个tag，如果我们把class想象成大的类型，那么tag就是该大类中的小类，但是如果5个字节不够了怎么办，实际上如果你第5位为1，那么就说明接下来的字节还是表示tag，直到最高位不为1为止结束tag；接下来就是“长度”了，一个字节仅能表示最多一个字节的长度，如果长度超过256怎么办？解决办法就是只要“长度”的最高位为1，那么此字节表示的就是“长度”的长度，这样就可以定义更长的长度了；接下来的“值”要么是一个确定的数字要么是上面三元组的重复。
</code></pre>
<p><a href="https://github.com/iofxl/practisego/blob/master/asn1.go">asn1.go</a></p>
<p><a href="https://github.com/iofxl/practisego/blob/master/asndaytimes.go">ASN.1 Daytime Server</a>  <a href="https://github.com/iofxl/practisego/blob/master/asndaytimec.go">ASN.1 Daytime Client</a></p>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgencodingjsonpackage-jsona" id="a-hrefhttpsgolangorgpkgencodingjsonpackage-jsona"><a href="https://golang.org/pkg/encoding/json/">Package json</a></a></h1>
<h1><a class="header" href="#links-94" id="links-94">Links</a></h1>
<ul>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/dataserialisation/json.html">JSON | Network Programming with Go (golang)</a></li>
<li><a href="https://blog.golang.org/json-and-go">JSON and Go - The Go Blog</a></li>
<li><a href="https://mholt.github.io/json-to-go/">JSON-to-Go: Convert JSON to Go instantly</a></li>
</ul>
<h1><a class="header" href="#encoder-and-decoder" id="encoder-and-decoder">Encoder and Decoder</a></h1>
<pre><code class="language-go">type Encoder struct {
        // Has unexported fields.
}
    An Encoder writes JSON values to an output stream.

func NewEncoder(w io.Writer) *Encoder
func (enc *Encoder) Encode(v interface{}) error
func (enc *Encoder) SetEscapeHTML(on bool)
func (enc *Encoder) SetIndent(prefix, indent string)

type Decoder struct {
        // Has unexported fields.
}
    A Decoder reads and decodes JSON values from an input stream.

func NewDecoder(r io.Reader) *Decoder
func (dec *Decoder) Buffered() io.Reader
func (dec *Decoder) Decode(v interface{}) error
func (dec *Decoder) DisallowUnknownFields()
func (dec *Decoder) More() bool
func (dec *Decoder) Token() (Token, error)
func (dec *Decoder) UseNumber()

func (dec *Decoder) More() bool
    More reports whether there is another element in the current array or object
    being parsed.
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgencodinggobpackage-goba" id="a-hrefhttpsgolangorgpkgencodinggobpackage-goba"><a href="https://golang.org/pkg/encoding/gob/">Package gob</a></a></h1>
<h1><a class="header" href="#links-95" id="links-95">Links</a></h1>
<ul>
<li><a href="https://blog.golang.org/gobs-of-data">Gobs of data - The Go Blog</a></li>
</ul>
<h1><a class="header" href="#overview-12" id="overview-12">Overview</a></h1>
<p><a href="https://golang.org/pkg/encoding/gob/#pkg-overview">Overview</a></p>
<pre><code class="language-go">struct { A, B int }
</code></pre>
<p>can be sent from or received into any of these Go types:</p>
<pre><code class="language-go">struct { A, B int }	// the same
*struct { A, B int }	// extra indirection of the struct
struct { *A, **B int }	// extra indirection of the fields
struct { A, B int64 }	// different concrete value type; see below
</code></pre>
<p>It may also be received into any of these:</p>
<pre><code class="language-go">struct { A, B int }	// the same
struct { B, A int }	// ordering doesn't matter; matching is by name
struct { A, B, C int }	// extra field (C) ignored
struct { B int }	// missing field (A) ignored; data will be dropped
struct { B, C int }	// missing field (A) ignored; extra field (C) ignored.
</code></pre>
<p>Attempting to receive into these types will draw a decode error:</p>
<pre><code class="language-go">struct { A int; B uint }	// change of signedness for B
struct { A int; B float }	// change of type for B
struct { }			// no field names in common
struct { C, D int }		// no field names in common
</code></pre>
<p>Gob can encode a value of any type implementing the GobEncoder or encoding.BinaryMarshaler interfaces by calling the corresponding method, in that order of preference.</p>
<p>Gob can decode a value of any type implementing the GobDecoder or encoding.BinaryUnmarshaler interfaces by calling the corresponding method, again in that order of preference. </p>
<h1><a class="header" href="#一对gob編解码接口" id="一对gob編解码接口">一对Gob編解码接口</a></h1>
<pre><code class="language-go">type GobEncoder interface {
        // GobEncode returns a byte slice representing the encoding of the
        // receiver for transmission to a GobDecoder, usually of the same
        // concrete type.
        GobEncode() ([]byte, error)
}

type GobDecoder interface {
        // GobDecode overwrites the receiver, which must be a pointer,
        // with the value represented by the byte slice, which was written
        // by GobEncode, usually for the same concrete type.
        GobDecode([]byte) error
}

func Register(value interface{})
func RegisterName(name string, value interface{})
</code></pre>
<h1><a class="header" href="#一对編解码器结构" id="一对編解码器结构">一对編解码器结构</a></h1>
<pre><code class="language-go">type Encoder struct {
        // contains filtered or unexported fields
}
func (enc *Encoder) Encode(e interface{}) error {
    return enc.EncodeValue(reflect.ValueOf(e))
}
func (enc *Encoder) EncodeValue(value reflect.Value) error

func NewEncoder(w io.Writer) *Encoder

type Decoder struct {
        // contains filtered or unexported fields
}
func (dec *Decoder) Decode(e interface{}) error
func (dec *Decoder) DecodeValue(v reflect.Value) error

func NewDecoder(r io.Reader) *Decoder
</code></pre>
<p><a href="https://github.com/iofxl/practisego/blob/master/savegob.go">savegob.go</a></p>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgencodingbase64package-base64a" id="a-hrefhttpsgolangorgpkgencodingbase64package-base64a"><a href="https://golang.org/pkg/encoding/base64/">Package base64</a></a></h1>
<h1><a class="header" href="#links-96" id="links-96">Links</a></h1>
<ul>
<li><a href="https://zh.wikipedia.org/zh-hans/Base64">Base64 - 维基百科，自由的百科全书</a></li>
</ul>
<h1><a class="header" href="#overview-13" id="overview-13">Overview</a></h1>
<p>同asn1, json, gob这些库不大一样，别的库统都，要么编解组函数，要么套在读写接口上生成编解码器，再去编解码</p>
<p>这个是有一个编码结构，由这个结构的东西去编解码，或者是套在读写接口上，转换读写接口成读接口，写关接口，直接写数据到生成的编解码器</p>
<h1><a class="header" href="#principle" id="principle">Principle</a></h1>
<p>摘自<a href="https://zh.wikipedia.org/zh-hans/Base64">Base64 - 维基百科，自由的百科全书</a>:</p>
<pre><code>Base64是一种基于64个可打印字符来表示二进制数据的表示方法。由于 2^6 = 64 ，所以每6个位元为一个单元，对应某个可打印字符。3个字节有24个位元，对应于4个Base64单元，即3个字节可由4个可打印字符来表示。它可用来作为电子邮件的传输编码。在Base64中的可打印字符包括字母A-Z、a-z、数字0-9，这样共有62个字符，此外两个可打印符号在不同的系统中而不同。一些如uuencode的其他编码方法，和之后BinHex的版本使用不同的64字符集来代表6个二进制数字，但是不被称为Base64。 

Base64常用于在通常处理文本数据的场合，表示、传输、存储一些二进制数据，包括MIME的电子邮件及XML的一些复杂数据。
</code></pre>
<h1><a class="header" href="#encoding结构" id="encoding结构">Encoding结构</a></h1>
<pre><code class="language-go">type Encoding struct {
    encode    [64]byte
    decodeMap [256]byte
    padChar   rune
    strict    bool
}

func (enc *Encoding) Encode(dst, src []byte)
func (enc *Encoding) EncodeToString(src []byte) string
func (enc *Encoding) EncodedLen(n int) int

func (enc *Encoding) Decode(dst, src []byte) (n int, err error)
func (enc *Encoding) DecodeString(s string) ([]byte, error)
func (enc *Encoding) DecodedLen(n int) int

func (enc Encoding) Strict() *Encoding
func (enc Encoding) WithPadding(padding rune) *Encoding

func NewEncoding(encoder string) *Encoding

var StdEncoding = NewEncoding(encodeStd)
var URLEncoding = NewEncoding(encodeURL)
var RawStdEncoding = StdEncoding.WithPadding(NoPadding)
var RawURLEncoding = URLEncoding.WithPadding(NoPadding)
</code></pre>
<h1><a class="header" href="#编解码器本身即io接口" id="编解码器本身即io接口">编解码器本身即IO接口</a></h1>
<p>写接口转换后变为写关闭接口,写操作之后一定要执行<strong>关闭</strong></p>
<pre><code class="language-go">func NewEncoder(enc *Encoding, w io.Writer) io.WriteCloser {
	return &amp;encoder{enc: enc, w: w}
}

func NewDecoder(enc *Encoding, r io.Reader) io.Reader {
	return &amp;decoder{enc: enc, r: &amp;newlineFilteringReader{r}}
}


type encoder struct {
	err  error
	enc  *Encoding
	w    io.Writer
	buf  [3]byte    // buffered data waiting to be encoded
	nbuf int        // number of bytes in buf
	out  [1024]byte // output buffer
}

type decoder struct {
	err     error
	readErr error // error from r.Read
	enc     *Encoding
	r       io.Reader
	buf     [1024]byte // leftover input
	nbuf    int
	out     []byte // leftover decoded output
	outbuf  [1024 / 4 * 3]byte
}
</code></pre>
<p><a href="https://github.com/iofxl/practisego/blob/master/base64c.e.s.go">base64 Client and Server</a></p>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgencodinghexpackage-hexa" id="a-hrefhttpsgolangorgpkgencodinghexpackage-hexa"><a href="https://golang.org/pkg/encoding/hex/">Package hex</a></a></h1>
<h1><a class="header" href="#links-97" id="links-97">Links</a></h1>
<h1><a class="header" href="#principle-1" id="principle-1">Principle</a></h1>
<p>hex也称为base16，意思是使用16个可见字符来表示一个二进制数组，编码后数据大小将翻倍,因为1个字符需要用2个可见字符来表示。</p>
<h1><a class="header" href="#编解码函数" id="编解码函数">编解码函数</a></h1>
<pre><code class="language-go">func EncodeToString(src []byte) string
func DecodeString(s string) ([]byte, error)

func Encode(dst, src []byte) int
func Decode(dst, src []byte) (int, error)

func EncodedLen(n int) int
func DecodedLen(x int) int

func Dump(data []byte) string 
</code></pre>
<h1><a class="header" href="#编解码器本身即io接口-1" id="编解码器本身即io接口-1">编解码器本身即IO接口</a></h1>
<p>这个跟base64包里是一样的</p>
<pre><code class="language-go">func NewEncoder(w io.Writer) io.Writer
func NewDecoder(r io.Reader) io.Reader

func Dumper(w io.Writer) io.WriteCloser 
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgencodingpempackage-pema" id="a-hrefhttpsgolangorgpkgencodingpempackage-pema"><a href="https://golang.org/pkg/encoding/pem/">Package pem</a></a></h1>
<p>Package pem implements the PEM data encoding, which originated in Privacy
Enhanced Mail. The most common use of PEM encoding today is in TLS keys and
certificates. See RFC 1421.</p>
<pre><code class="language-go">func Encode(out io.Writer, b *Block) error
func EncodeToMemory(b *Block) []byte
func Decode(data []byte) (p *Block, rest []byte)

// A Block represents a PEM encoded structure.
//
// The encoded form is:
//    -----BEGIN Type-----
//    Headers
//    base64-encoded Bytes
//    -----END Type-----
// where Headers is a possibly empty sequence of Key: Value lines.
type Block struct {
        Type    string            // The type, taken from the preamble (i.e. &quot;RSA PRIVATE KEY&quot;).
        Headers map[string]string // Optional headers.
        Bytes   []byte            // The decoded bytes of the contents. Typically a DER encoded ASN.1 structure.
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptopackage-cryptoa" id="a-hrefhttpsgolangorgpkgcryptopackage-cryptoa"><a href="https://golang.org/pkg/crypto/">Package crypto</a></a></h1>
<h1><a class="header" href="#overview-14" id="overview-14">Overview</a></h1>
<p>Package crypto collects common cryptographic constants. </p>
<p>这个包的主要功能瞅着就是注册Hash方法使的</p>
<h1><a class="header" href="#注册hash和hash类型" id="注册hash和hash类型">注册Hash和Hash类型</a></h1>
<pre><code class="language-go">type Hash uint

func (h Hash) HashFunc() Hash {
    return h
}
func (h Hash) Size() int
func (h Hash) Available() bool
func (h Hash) New() hash.Hash

var hashes = make([]func() hash.Hash, maxHash)

// RegisterHash registers a function that returns a new instance of the given
// hash function. This is intended to be called from the init function in
// packages that implement hash functions.
func RegisterHash(h Hash, f func() hash.Hash) {
    if h &gt;= maxHash {
        panic(&quot;crypto: RegisterHash of unknown hash function&quot;)
    }
    hashes[h] = f
}
</code></pre>
<h1><a class="header" href="#hash-management" id="hash-management">Hash Management</a></h1>
<ul>
<li><code>hash.Hash</code> is <code>type Hash interface</code></li>
<li><code>crypto.Hash</code> is <code>type Hash uint</code></li>
<li><code>func RegisterHash(h Hash, f func() hash.Hash)</code> bind them.</li>
</ul>
<p><a href="https://golang.org/src/crypto/sha256/sha256.go">sha256.go</a>里开头就有这样的代码:</p>
<pre><code class="language-go">func init() {
    crypto.RegisterHash(crypto.SHA224, New224)
    crypto.RegisterHash(crypto.SHA256, New)
}
</code></pre>
<p>接口就是函数的集合.接口是&quot;属性是函数&quot;的类型.某种类型实现了这个函数的集合,就説这个类型实现了这个接口,这个类型就是这个接口.</p>
<p>RegisterHash函数的第一个参数是一个crypto.Hash无意义类型,第二参数是一个可以返回hash.Hash接口的函数.各个hash函数包里的New函数的本质是返回一个未导出的类型,它实现了hash.Hash接口.</p>
<p>为什么要注册呢,注册了有什么用? 当然目前我发现,注册了至少可以用crypto.Hash类型实现的这几个函数了.</p>
<p>其中,crypto.Hash类型实现的New函数,可以直接直接返回hash.Hash接口.其实就是调用了注册时提供的New函数.可以学习一下这种管理思路.</p>
<h1><a class="header" href="#公私钥签名解密相关接口" id="公私钥签名解密相关接口">公私钥，签名，解密相关接口</a></h1>
<pre><code class="language-go">type PublicKey interface{}

type PrivateKey interface{}

type Signer interface {
    Public() PublicKey
    Sign(rand io.Reader, digest []byte, opts SignerOpts) (signature []byte, err error)
}

type SignerOpts interface {
    HashFunc() Hash
}

type Decrypter interface {
    Public() PublicKey
    Decrypt(rand io.Reader, msg []byte, opts DecrypterOpts) (plaintext []byte, err error)
}

type DecrypterOpts interface{}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptorandpackage-randa" id="a-hrefhttpsgolangorgpkgcryptorandpackage-randa"><a href="https://golang.org/pkg/crypto/rand/">Package rand</a></a></h1>
<pre><code class="language-go">var Reader io.Reader
func Int(rand io.Reader, max *big.Int) (n *big.Int, err error)
func Prime(rand io.Reader, bits int) (p *big.Int, err error)
func Read(b []byte) (n int, err error)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptosha256package-sha256a" id="a-hrefhttpsgolangorgpkgcryptosha256package-sha256a"><a href="https://golang.org/pkg/crypto/sha256/">Package sha256</a></a></h1>
<p>New函数返回Hash接口,实现这个接口的类型是digest类型,各个sha.*包里的digest是不一样的.</p>
<p>该Hash接口同时也是二进制編解组接口</p>
<p>Sum224, Sum256函数返回的是数组, 而接口里的Sum()函数返回的是切片.</p>
<pre><code class="language-go">func New() hash.Hash {
    d := new(digest)
    d.Reset()
    return d
}

func New224() hash.Hash

func (d *digest) MarshalBinary() ([]byte, error)
func (d *digest) UnmarshalBinary(b []byte) error
</code></pre>
<pre><code class="language-go">func Sum224(data []byte) (sum224 [Size224]byte)
func Sum256(data []byte) [Size]byte
</code></pre>
<h1><a class="header" href="#ask" id="ask">Ask</a></h1>
<ol>
<li>Hash接口里的Sum函数,我看例子里的用法是h.Sum(nil),为什么?和用成h.Sum(data)效里一样吗?<br />
接口里的Sum函数,它的参数字节串不是要Hash的数据.如果带了不是nil的参数,而是Sum(b),那么函数返回的结果是b+Hash值.不会修改b的值.不知道这有什么用.</li>
<li>两个Sum256,Sum224函数和接口里的Sum函数有关系吗?这两个函数可以用nil作参数吗?<br />
这两个函数的参数是要被Hash的数据.</li>
</ol>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptosha512package-sha512a" id="a-hrefhttpsgolangorgpkgcryptosha512package-sha512a"><a href="https://golang.org/pkg/crypto/sha512/">Package sha512</a></a></h1>
<pre><code class="language-go">func New() hash.Hash
func New384() hash.Hash
func New512_256() hash.Hash
func New512_224() hash.Hash

func Sum512(data []byte) [Size]byte
func Sum384(data []byte) (sum384 [Size384]byte)
func Sum512_256(data []byte) (sum256 [Size256]byte)
func Sum512_224(data []byte) (sum224 [Size224]byte)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptosha1package-sha1a" id="a-hrefhttpsgolangorgpkgcryptosha1package-sha1a"><a href="https://golang.org/pkg/crypto/sha1/">Package sha1</a></a></h1>
<pre><code class="language-go">func New() hash.Hash
func Sum(data []byte) [Size]byte
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptomd5package-md5a" id="a-hrefhttpsgolangorgpkgcryptomd5package-md5a"><a href="https://golang.org/pkg/crypto/md5/">Package md5</a></a></h1>
<pre><code class="language-go">func New() hash.Hash
func Sum(data []byte) [Size]byte
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptoaespackage-aesa" id="a-hrefhttpsgolangorgpkgcryptoaespackage-aesa"><a href="https://golang.org/pkg/crypto/aes/">Package aes</a></a></h1>
<h1><a class="header" href="#生成块接口的函数" id="生成块接口的函数">生成块接口的函数</a></h1>
<pre><code class="language-go">func NewCipher(key []byte) (cipher.Block, error)
</code></pre>
<p>NewCipher creates and returns a new cipher.Block. The key argument should be the AES key, either 16, 24, or 32 bytes to select AES-128, AES-192, or AES-256. </p>
<p>key的长度是有讲究的，生成固定长度的办法：</p>
<ol>
<li>hash</li>
<li><a href="https://godoc.org/golang.org/x/crypto/hkdf">hkdf - GoDoc</a></li>
</ol>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptocipherpackage-ciphera" id="a-hrefhttpsgolangorgpkgcryptocipherpackage-ciphera"><a href="https://golang.org/pkg/crypto/cipher/">Package cipher</a></a></h1>
<h1><a class="header" href="#links-98" id="links-98">Links</a></h1>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A0%81%E5%AD%A6">密码学 - 维基百科，自由的百科全书</a></li>
<li><a href="https://zh.wikipedia.org/zh-hans/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F">分组密码工作模式 - 维基百科，自由的百科全书</a></li>
<li><a href="https://shadowsocks.org/en/spec/AEAD-Ciphers.html">Shadowsocks - AEAD Ciphers</a></li>
<li><a href="https://security.stackexchange.com/questions/2202/lessons-learned-and-misconceptions-regarding-encryption-and-cryptology">cryptography - Lessons learned and misconceptions regarding encryption and cryptology - Information Security Stack Exchange</a></li>
<li><a href="https://www.imperialviolet.org/2015/05/16/aeads.html">ImperialViolet - AEADs: getting better at symmetric cryptography</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E8%AE%A4%E8%AF%81%E5%8A%A0%E5%AF%86">认证加密 - 维基百科，自由的百科全书</a></li>
<li><a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Galois/Counter Mode - Wikipedia</a></li>
</ul>
<h1><a class="header" href="#package-files-2" id="package-files-2">Package files</a></h1>
<p><a href="https://golang.org/src/crypto/cipher/cipher.go">cipher.go</a> <a href="https://golang.org/src/crypto/cipher/io.go">io.go</a></p>
<h1><a class="header" href="#overview-15" id="overview-15">Overview</a></h1>
<p>这些都是指块密码加密法的工作模式: ECB，CBC，OFB, CFB</p>
<p>ECB: Electronic codebook</p>
<pre><code>同样的平文块会被加密成相同的密文块
</code></pre>
<p>CBC: Cipher block chaining 中文意思是&quot;密码块链&quot;；1976年，IBM发明</p>
<p>CFB: Cipher feedback, 和CBC类似</p>
<p>上面几种都是比较老的.2001年后,有了新的标准:AES.这个标准下的新的工作模式: CTR, </p>
<p>CTR: Counter mode</p>
<p><strong>AES(Advanced Encryption Standard) : 這個標準用來替代原先的DES(Data Encryption Standard).</strong></p>
<p>现在新的一类模式叫AE(Authenticated Encryption),中文意思是认证过的加密,这类的工作模式: GCM</p>
<p>AEAD: authenticated encryption with associated data</p>
<h1><a class="header" href="#block接口和blockmode接口" id="block接口和blockmode接口">Block接口和BlockMode接口</a></h1>
<p>aes.NewCipher函数生成cipher.Block接口<code>func NewCipher(key []byte) (cipher.Block, error)</code></p>
<p>NewCBCEncrypter returns a BlockMode which encrypts in cipher block chaining mode, using the given Block. The length of iv must be the same as the Block's block size. </p>
<pre><code class="language-go">type Block interface {
    BlockSize() int
    Encrypt(dst, src []byte)
    Decrypt(dst, src []byte)
}

type BlockMode interface {
    BlockSize() int
    CryptBlocks(dst, src []byte)
}

func NewCBCEncrypter(b Block, iv []byte) BlockMode
func NewCBCDecrypter(b Block, iv []byte) BlockMode
</code></pre>
<h2><a class="header" href="#examples-1" id="examples-1">Examples</a></h2>
<p><a href="https://github.com/iofxl/practisego/blob/master/05cipher/cbc.go">05cipher/cbc.go</a></p>
<h1><a class="header" href="#stream接口" id="stream接口">Stream接口</a></h1>
<p>基本使法应该是通过StreamReader, StreamWriter结构来读写的。</p>
<pre><code class="language-go">type Stream interface {
    XORKeyStream(dst, src []byte)
}

func NewCFBEncrypter(block Block, iv []byte) Stream
func NewCFBDecrypter(block Block, iv []byte) Stream

func NewCTR(block Block, iv []byte) Stream
func NewOFB(b Block, iv []byte) Stream
</code></pre>
<h1><a class="header" href="#streamreader和streamwriter结构" id="streamreader和streamwriter结构">StreamReader和StreamWriter结构</a></h1>
<pre><code class="language-go">type StreamReader struct {
        S Stream
        R io.Reader
}

func (r StreamReader) Read(dst []byte) (n int, err error) {
    n, err = r.R.Read(dst)
    r.S.XORKeyStream(dst[:n], dst[:n])
    return
}

type StreamWriter struct {
    S   Stream
    W   io.Writer
}

func (w StreamWriter) Write(src []byte) (n int, err error) 
func (w StreamWriter) Close() error
</code></pre>
<h2><a class="header" href="#examples-2" id="examples-2">Examples</a></h2>
<h1><a class="header" href="#aead接口" id="aead接口">AEAD接口</a></h1>
<p>AEAD接口中的Seal函数就是加密, Open函数就是解密</p>
<pre><code class="language-go">type AEAD interface {
    NonceSize() int
    Overhead() int
    Seal(dst, nonce, plaintext, additionalData []byte) []byte
    Open(dst, nonce, ciphertext, additionalData []byte) ([]byte, error)
}

func NewGCM(cipher Block) (AEAD, error)
func NewGCMWithNonceSize(cipher Block, size int) (AEAD, error)
func NewGCMWithTagSize(cipher Block, tagSize int) (AEAD, error)
</code></pre>
<h2><a class="header" href="#examples-3" id="examples-3">Examples</a></h2>
<p><a href="https://github.com/iofxl/practisego/blob/master/05cipher/gcm.go">gcm.go</a></p>
<h1><a class="header" href="#ctr" id="ctr">CTR</a></h1>
<p>本来想去理解一下不同块密码工作模式的算法 瞅不懂</p>
<p>CFB与CBC相似，明文的改变会影响接下来所有的密文，因此加密过程不能并行化；而同样的，与CBC类似，解密过程是可以并行化的。</p>
<p>每个使用OFB的输出块与其前面所有的输出块相关，因此不能并行化处理。然而，由于明文和密文只在最终的异或过程中使用，因此可以事先对IV进行加密，最后并行的将明文或密文进行并行的异或处理。</p>
<p>可以利用输入全0的CBC模式产生OFB模式的密钥流。这种方法十分实用，因为可以利用快速的CBC硬件实现来加速OFB模式的加密过程。 </p>
<p>CTR模式的特征类似于OFB，但它允许在解密时进行随机存取。由于<strong>加密和解密过程均可以进行并行处理</strong>，CTR适合运用于多处理器的硬件上。 </p>
<p><img src="go/pkg/crypto/img/1202px-CTR_encryption_2.svg.png" alt="CTR" /></p>
<h1><a class="header" href="#gcm-principle" id="gcm-principle">GCM Principle</a></h1>
<p>Although not completely standard, I differentiate an IV and an nonce thus: <strong>an IV needs to be unpredictable</strong> while <strong>an nonce needs only to be distinct</strong>. </p>
<p><img src="go/pkg/crypto/img/1000px-GCM-Galois_Counter_Mode.svg.png" alt="GCM" /></p>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptorsapackage-rsaa" id="a-hrefhttpsgolangorgpkgcryptorsapackage-rsaa"><a href="https://golang.org/pkg/crypto/rsa/">Package rsa</a></a></h1>
<h1><a class="header" href="#links-99" id="links-99">Links</a></h1>
<ul>
<li><a href="https://www.mathsisfun.com/prime-factorization.html">Prime Factorization</a></li>
<li><a href="https://www.mathsisfun.com/numbers/fundamental-theorem-arithmetic.html">Fundamental Theorem of Arithmetic</a></li>
<li><a href="https://en.wikipedia.org/wiki/Euler&#x27;s_totient_function">Euler's totient function - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)">RSA (cryptosystem) - Wikipedia</a></li>
<li><a href="https://security.stackexchange.com/questions/183179/what-is-rsa-oaep-rsa-pss-in-simple-terms">What is RSA OAEP &amp; RSA PSS in simple terms - Information Security Stack Exchange</a></li>
</ul>
<h1><a class="header" href="#type-privatekey-struct" id="type-privatekey-struct">type PrivateKey struct</a></h1>
<pre><code class="language-go">type PrivateKey struct {
        PublicKey            // public part.
        D         *big.Int   // private exponent
        Primes    []*big.Int // prime factors of N, has &gt;= 2 elements.

        // Precomputed contains precomputed values that speed up private
        // operations, if available.
        Precomputed PrecomputedValues
}

func GenerateMultiPrimeKey(random io.Reader, nprimes int, bits int) (*PrivateKey, error)
func GenerateKey(random io.Reader, bits int) (*PrivateKey, error) {
	return GenerateMultiPrimeKey(random, 2, bits)
}

func (priv *PrivateKey) Validate() error
func (priv *PrivateKey) Precompute()
func (priv *PrivateKey) Public() crypto.PublicKey
func (priv *PrivateKey) Decrypt(rand io.Reader, ciphertext []byte, opts crypto.DecrypterOpts) (plaintext []byte, err error)
//  implements crypto.Signer interface
func (priv *PrivateKey) Sign(rand io.Reader, digest []byte, opts crypto.SignerOpts) ([]byte, error)
</code></pre>
<h1><a class="header" href="#type-publickey-struct" id="type-publickey-struct">type PublicKey struct</a></h1>
<pre><code class="language-go">type PublicKey struct {
        N *big.Int // modulus
        E int      // public exponent
}

func (pub *PublicKey) Size() int
</code></pre>
<h1><a class="header" href="#func-3" id="func-3">Func</a></h1>
<pre><code class="language-go">func EncryptOAEP(hash hash.Hash, random io.Reader, pub *PublicKey, msg []byte, label []byte) ([]byte, error)
func EncryptPKCS1v15(rand io.Reader, pub *PublicKey, msg []byte) ([]byte, error)

func DecryptOAEP(hash hash.Hash, random io.Reader, priv *PrivateKey, ciphertext []byte, label []byte) ([]byte, error)
func DecryptPKCS1v15(rand io.Reader, priv *PrivateKey, ciphertext []byte) ([]byte, error)
func DecryptPKCS1v15SessionKey(rand io.Reader, priv *PrivateKey, ciphertext []byte, key []byte) error

func SignPSS(rand io.Reader, priv *PrivateKey, hash crypto.Hash, hashed []byte, opts *PSSOptions) ([]byte, error)
func SignPKCS1v15(rand io.Reader, priv *PrivateKey, hash crypto.Hash, hashed []byte) ([]byte, error)

func VerifyPSS(pub *PublicKey, hash crypto.Hash, hashed []byte, sig []byte, opts *PSSOptions) error
func VerifyPKCS1v15(pub *PublicKey, hash crypto.Hash, hashed []byte, sig []byte) error
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptox509package-x509a" id="a-hrefhttpsgolangorgpkgcryptox509package-x509a"><a href="https://golang.org/pkg/crypto/x509/">Package x509</a></a></h1>
<h1><a class="header" href="#links-100" id="links-100">Links</a></h1>
<ul>
<li><a href="https://golang.org/src/crypto/tls/generate_cert.go">src/crypto/tls/generate_cert.go - The Go Programming Language</a></li>
</ul>
<p>interlnal</p>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkginternalpollpackage-polla" id="a-hrefhttpsgolangorgpkginternalpollpackage-polla"><a href="https://golang.org/pkg/internal/poll/">Package poll</a></a></h1>
<h1><a class="header" href="#links-101" id="links-101">Links</a></h1>
<h1><a class="header" href="#type-fd-struct" id="type-fd-struct">type FD struct</a></h1>
<p>FD is a file descriptor. The net and os packages use this type as a field of
a larger type representing a network connection or OS file. </p>
<pre><code class="language-go">type FD struct {

        // System file descriptor. Immutable until Close.
        Sysfd int

        // Whether this is a streaming descriptor, as opposed to a
        // packet-based descriptor like a UDP socket. Immutable.
        IsStream bool

        // Whether a zero byte read indicates EOF. This is false for a
        // message based socket connection.
        ZeroReadIsEOF bool
        // contains filtered or unexported fields
}

func (fd *FD) Read(p []byte) (int, error) {
        ...
		n, err := syscall.Read(fd.Sysfd, p)
		...
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorg-subrepogo-sub-repository-packages---godoca" id="a-hrefhttpsgodocorg-subrepogo-sub-repository-packages---godoca"><a href="https://godoc.org/-/subrepo">Go Sub-Repository Packages - GoDoc</a></a></h1>
<ul>
<li><a href="go/pkgx/hkdf.html">hkdf</a></li>
</ul>
<p>crypto</p>
<h1><a class="header" href="#a-hrefhttpsgodocorggolangorgxcryptosshssh---godoca" id="a-hrefhttpsgodocorggolangorgxcryptosshssh---godoca"><a href="https://godoc.org/golang.org/x/crypto/ssh">ssh - GoDoc</a></a></h1>
<h1><a class="header" href="#links-102" id="links-102">Links</a></h1>
<ul>
<li><a href="https://medium.com/@Vasya4k/go-and-ssh-for-network-devices-128937852ccb">Go and SSH for network devices – Egor Krivosheev – Medium</a></li>
</ul>
<h1><a class="header" href="#handle-each-command-in-sshsessionshell" id="handle-each-command-in-sshsessionshell">Handle each command in ssh.Session.Shell()</a></h1>
<h1><a class="header" href="#sendrequest-in-sshchannel-interface" id="sendrequest-in-sshchannel-interface">SendRequest in ssh.Channel interface</a></h1>
<pre><code class="language-go">type Channel interface {
		...
        // SendRequest sends a channel request.  If wantReply is true,
        // it will wait for a reply and return the result as a
        // boolean, otherwise the return value will be false. Channel
        // requests are out-of-band messages so they may be sent even
        // if the data stream is closed or blocked by flow control.
        // If the channel is closed before a reply is returned, io.EOF
        // is returned.
        SendRequest(name string, wantReply bool, payload []byte) (bool, error)
		...
}
    A Channel is an ordered, reliable, flow-controlled, duplex stream that is
    multiplexed over an SSH connection.

func (s *Session) SendRequest(name string, wantReply bool, payload []byte) (bool, error)
    SendRequest sends an out-of-band channel request on the SSH channel
    underlying the session.
</code></pre>
<p>Exactly, all <code>ssh.Session.{CombinedOutput, Output, Run, Start, Shell}</code> finally
is just to call <code>s.ch.SendRequest(...)</code>, <code>ch</code> is a <code>ssh.Channel</code> interface
embed in <code>ssh.Session</code>.</p>
<p>How Client.NewSession ?</p>
<p>First, <code>Client.OpenChannel()</code>, then use <code>newSession()</code> to turn it into a session.</p>
<p><code>OpenChannel()</code> belongs to <code>Conn</code> interface. </p>
<p><code>mux</code> struct implements <code>Conn</code> interface.</p>
<p><code>channel</code> struct implements <code>Channel</code> interface.</p>
<p>How <code>s.ch.SendRequest</code> work ?</p>
<p>channel.sendMessage(channelRequestMsg)</p>
<p><code>sendMessage()</code> is <code>p = Marshal(msg)</code>, <code>ch.writePacket(p)</code></p>
<p><code>writePacket()</code> belongs to <code>packetConn</code> interface.</p>
<p>type <code>transport</code> implements <code>packetConn</code> interface</p>
<h1><a class="header" href="#a-hrefhttpsgodocorggolangorgxtexttext---godoca" id="a-hrefhttpsgodocorggolangorgxtexttext---godoca"><a href="https://godoc.org/golang.org/x/text">text - GoDoc</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgodocorggolangorgxtexttransformtransform---godoca" id="a-hrefhttpsgodocorggolangorgxtexttransformtransform---godoca"><a href="https://godoc.org/golang.org/x/text/transform">transform - GoDoc</a></a></h1>
<h1><a class="header" href="#variables-1" id="variables-1">Variables</a></h1>
<pre><code class="language-go">var (
    // Discard is a Transformer for which all Transform calls succeed
    // by consuming all bytes and writing nothing.
    Discard Transformer = discard{}

    // Nop is a SpanningTransformer that copies src to dst.
    Nop SpanningTransformer = nop{}
)
</code></pre>
<h1><a class="header" href="#type-transformer-and-spanningtransformer-interface" id="type-transformer-and-spanningtransformer-interface">type Transformer and SpanningTransformer interface</a></h1>
<pre><code class="language-go">type Transformer interface {
    // Transform writes to dst the transformed bytes read from src, and
    // returns the number of dst bytes written and src bytes read. The
    // atEOF argument tells whether src represents the last bytes of the
    // input.
    //
    // Callers should always process the nDst bytes produced and account
    // for the nSrc bytes consumed before considering the error err.
    //
    // A nil error means that all of the transformed bytes (whether freshly
    // transformed from src or left over from previous Transform calls)
    // were written to dst. A nil error can be returned regardless of
    // whether atEOF is true. If err is nil then nSrc must equal len(src);
    // the converse is not necessarily true.
    //
    // ErrShortDst means that dst was too short to receive all of the
    // transformed bytes. ErrShortSrc means that src had insufficient data
    // to complete the transformation. If both conditions apply, then
    // either error may be returned. Other than the error conditions listed
    // here, implementations are free to report other errors that arise.
    Transform(dst, src []byte, atEOF bool) (nDst, nSrc int, err error)

    // Reset resets the state and allows a Transformer to be reused.
    Reset()
}

func Chain(t ...Transformer) Transformer
func RemoveFunc(f func(r rune) bool) Transformer

func Append(t Transformer, dst, src []byte) (result []byte, n int, err error)
func Bytes(t Transformer, b []byte) (result []byte, n int, err error)
func String(t Transformer, s string) (result string, n int, err error)

type NopResetter struct{}
	func (NopResetter) Reset()
</code></pre>
<h1><a class="header" href="#type-spanningtransformer-interface" id="type-spanningtransformer-interface">type SpanningTransformer interface</a></h1>
<pre><code class="language-go">type SpanningTransformer interface {
    Transformer

    // Span returns a position in src such that transforming src[:n] results in
    // identical output src[:n] for these bytes. It does not necessarily return
    // the largest such n. The atEOF argument tells whether src represents the
    // last bytes of the input.
    //
    // Callers should always account for the n bytes consumed before
    // considering the error err.
    //
    // A nil error means that all input bytes are known to be identical to the
    // output produced by the Transformer. A nil error can be returned
    // regardless of whether atEOF is true. If err is nil, then n must
    // equal len(src); the converse is not necessarily true.
    //
    // ErrEndOfSpan means that the Transformer output may differ from the
    // input after n bytes. Note that n may be len(src), meaning that the output
    // would contain additional bytes after otherwise identical output.
    // ErrShortSrc means that src had insufficient data to determine whether the
    // remaining bytes would change. Other than the error conditions listed
    // here, implementations are free to report other errors that arise.
    //
    // Calling Span can modify the Transformer state as a side effect. In
    // effect, it does the transformation just as calling Transform would, only
    // without copying to a destination buffer and only up to a point it can
    // determine the input and output bytes are the same. This is obviously more
    // limited than calling Transform, but can be more efficient in terms of
    // copying and allocating buffers. Calls to Span and Transform may be
    // interleaved.
    Span(src []byte, atEOF bool) (n int, err error)
}
</code></pre>
<h1><a class="header" href="#type-reader-struct-2" id="type-reader-struct-2">type Reader struct</a></h1>
<pre><code class="language-go">type Reader struct {
    // contains filtered or unexported fields
}

func NewReader(r io.Reader, t Transformer) *Reader

func (r *Reader) Read(p []byte) (int, error)
</code></pre>
<h1><a class="header" href="#type-writer-struct-2" id="type-writer-struct-2">type Writer struct</a></h1>
<p>Writer wraps another io.Writer by transforming the bytes read. The user needs
to call Close to flush unwritten bytes that may be buffered. </p>
<pre><code class="language-go">type Writer struct {
    // contains filtered or unexported fields
}
func NewWriter(w io.Writer, t Transformer) *Writer
func (w *Writer) Close() error
func (w *Writer) Write(data []byte) (n int, err error)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggolangorgxtextencodingpackage-encodinga" id="a-hrefhttpsgodocorggolangorgxtextencodingpackage-encodinga"><a href="https://godoc.org/golang.org/x/text/encoding">package encoding</a></a></h1>
<h1><a class="header" href="#links-103" id="links-103">Links</a></h1>
<ul>
<li><a href="https://godoc.org/golang.org/x/text/encoding/simplifiedchinese">simplifiedchinese - GoDoc</a></li>
<li><a href="https://godoc.org/golang.org/x/text/encoding/charmap">charmap - GoDoc</a></li>
</ul>
<h1><a class="header" href="#type-decoder-struct" id="type-decoder-struct">type Decoder struct</a></h1>
<pre><code class="language-go">type Decoder struct {
    transform.Transformer
    // contains filtered or unexported fields
}

func (d *Decoder) Reader(r io.Reader) io.Reader
func (d *Decoder) Bytes(b []byte) ([]byte, error)
func (d *Decoder) String(s string) (string, error)
</code></pre>
<h1><a class="header" href="#type-encoder-struct" id="type-encoder-struct">type Encoder struct</a></h1>
<pre><code class="language-go">type Encoder struct {
    transform.Transformer
    // contains filtered or unexported fields
}

func HTMLEscapeUnsupported(e *Encoder) *Encoder
func ReplaceUnsupported(e *Encoder) *Encoder

func (e *Encoder) Writer(w io.Writer) io.Writer
func (e *Encoder) Bytes(b []byte) ([]byte, error)
func (e *Encoder) String(s string) (string, error)
</code></pre>
<h1><a class="header" href="#type-encoding-interface" id="type-encoding-interface">type Encoding interface</a></h1>
<pre><code class="language-go">type Encoding interface {
    // NewDecoder returns a Decoder.
    NewDecoder() *Decoder

    // NewEncoder returns an Encoder.
    NewEncoder() *Encoder
}

var Nop Encoding = nop{}
var Replacement Encoding = replacement{}
</code></pre>
<h1><a class="header" href="#package-simplifiedchinese" id="package-simplifiedchinese">package simplifiedchinese</a></h1>
<p>import &quot;golang.org/x/text/encoding/simplifiedchinese&quot;</p>
<ul>
<li>GB 2312 标准共收录 6763 个汉字</li>
<li>GBK 共收入 21886 个汉字和图形符号, 向下与 GB 2312 完全兼容</li>
<li>GB 18030 与 GB 2312-1980 和 GBK 兼容，共收录汉字70244个, 编码是一二四字节变长
编码。</li>
</ul>
<h2><a class="header" href="#variables-2" id="variables-2">Variables</a></h2>
<pre><code class="language-go">var (
    // GB18030 is the GB18030 encoding.
    GB18030 encoding.Encoding = &amp;gbk18030
    // GBK is the GBK encoding. It encodes an extension of the GB2312 character set
    // and is also known as Code Page 936.
    GBK encoding.Encoding = &amp;gbk
)

var All = []encoding.Encoding{GB18030, GBK, HZGB2312}

var HZGB2312 encoding.Encoding = &amp;hzGB2312
</code></pre>
<h1><a class="header" href="#package-charmap" id="package-charmap">package charmap</a></h1>
<pre><code class="language-go">var (
    // ISO8859_6E is the ISO 8859-6E encoding.
    ISO8859_6E encoding.Encoding = &amp;iso8859_6E

    // ISO8859_6I is the ISO 8859-6I encoding.
    ISO8859_6I encoding.Encoding = &amp;iso8859_6I

    // ISO8859_8E is the ISO 8859-8E encoding.
    ISO8859_8E encoding.Encoding = &amp;iso8859_8E

    // ISO8859_8I is the ISO 8859-8I encoding.
    ISO8859_8I encoding.Encoding = &amp;iso8859_8I
)
</code></pre>
<h2><a class="header" href="#type-charmap-struct" id="type-charmap-struct">type Charmap struct</a></h2>
<pre><code class="language-go">type Charmap struct {
    // contains filtered or unexported fields
}

// String returns the Charmap's name.
func (m *Charmap) String() string
func (m *Charmap) DecodeByte(b byte) rune
func (m *Charmap) EncodeRune(r rune) (b byte, ok bool)

func (m *Charmap) ID() (mib identifier.MIB, other string)

func (m *Charmap) NewDecoder() *encoding.Decoder
func (m *Charmap) NewEncoder() *encoding.Encoder
</code></pre>
<h1><a class="header" href="#examples-4" id="examples-4">Examples</a></h1>
<pre><code class="language-go">package main

import (
        &quot;fmt&quot;
        &quot;io&quot;
        &quot;io/ioutil&quot;
        &quot;log&quot;
        &quot;os&quot;

        &quot;golang.org/x/text/encoding/simplifiedchinese&quot;
)

func main() {

        if len(os.Args) == 1 {
                fmt.Println(&quot;Usage: os.Args[0] &lt;gbk_file&gt;&quot;)
                os.Exit(1)
        }

        f, err := os.Open(os.Args[1])
        if err != nil {
                log.Fatal(err)
        }

        defer f.Close()

        r := NewGBK2UTF8Reader(f)

        b, err := ioutil.ReadAll(r)

        if err != nil {
                log.Fatal(err)
        }

        fmt.Print(string(b))

}

func NewGBK2UTF8Reader(r io.Reader) io.Reader {
        dec := simplifiedchinese.GBK.NewDecoder()
        return dec.Reader(r)
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggolangorgxtextunicodeunicode---godoca" id="a-hrefhttpsgodocorggolangorgxtextunicodeunicode---godoca"><a href="https://godoc.org/golang.org/x/text/unicode">unicode - GoDoc</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgodocorggolangorgxtextunicodenormnorm---godoca" id="a-hrefhttpsgodocorggolangorgxtextunicodenormnorm---godoca"><a href="https://godoc.org/golang.org/x/text/unicode/norm">norm - GoDoc</a></a></h1>
<h1><a class="header" href="#links-104" id="links-104">Links</a></h1>
<ul>
<li><a href="https://zh.wikipedia.org/zh/Unicode%E7%AD%89%E5%83%B9%E6%80%A7">Unicode等價性 - 维基百科，自由的百科全书</a></li>
<li><a href="https://unicode.org/reports/tr15/">UAX #15: Unicode Normalization Forms</a></li>
<li><a href="https://unicode.org/notes/tn5/">Canonical Equivalence in Applications</a></li>
</ul>
<h1><a class="header" href="#type-form-int" id="type-form-int">type Form int</a></h1>
<pre><code class="language-go">type Form int

const (
    NFC Form = iota
    NFD
    NFKC
    NFKD
)


func (f Form) Bytes(b []byte) []byte
func (f Form) String(s string) string
func (f Form) IsNormal(b []byte) bool
func (f Form) IsNormalString(s string) bool

func (f Form) Append(out []byte, src ...byte) []byte
func (f Form) AppendString(out []byte, src string) []byte
func (f Form) FirstBoundary(b []byte) int
func (f Form) FirstBoundaryInString(s string) int
func (f Form) NextBoundary(b []byte, atEOF bool) int
func (f Form) NextBoundaryInString(s string, atEOF bool) int
func (f Form) LastBoundary(b []byte) int

func (f Form) Properties(s []byte) Properties
func (f Form) PropertiesString(s string) Properties

// Transform and Reset implements the Transform method of the transform.Transformer interface.
func (f Form) Transform(dst, src []byte, atEOF bool) (nDst, nSrc int, err error)
func (Form) Reset()

// Span implements transform.SpanningTransformer.
func (f Form) Span(b []byte, atEOF bool) (n int, err error)
func (f Form) SpanString(s string, atEOF bool) (n int, err error)
func (f Form) QuickSpan(b []byte) int
func (f Form) QuickSpanString(s string) int

func (f Form) Reader(r io.Reader) io.Reader
func (f Form) Writer(w io.Writer) io.WriteCloser
</code></pre>
<h1><a class="header" href="#type-properties-struct" id="type-properties-struct">type Properties struct</a></h1>
<pre><code class="language-go">type Properties struct {
    // contains filtered or unexported fields
}

func (p Properties) BoundaryAfter() bool
func (p Properties) BoundaryBefore() bool

func (p Properties) Size() int
func (p Properties) Decomposition() []byte

func (p Properties) CCC() uint8
func (p Properties) LeadCCC() uint8
func (p Properties) TrailCCC() uint8
</code></pre>
<h1><a class="header" href="#type-iter-struct" id="type-iter-struct">type Iter struct</a></h1>
<pre><code class="language-go">type Iter struct {
    // contains filtered or unexported fields
}

func (i *Iter) Init(f Form, src []byte)
func (i *Iter) InitString(f Form, src string)
func (i *Iter) Next() []byte
func (i *Iter) Done() bool
func (i *Iter) Pos() int
func (i *Iter) Seek(offset int64, whence int) (int64, error)
</code></pre>
<h1><a class="header" href="#package-community" id="package-community">Package Community</a></h1>
<ul>
<li>
<p><a href="https://godoc.org/github.com/ziutek/telnet">telnet - GoDoc</a></p>
</li>
<li>
<p><a href="go/pkgy/protobuf.html">protobuf</a></p>
</li>
<li>
<p><a href="go/pkgy/yaml.v2.html">yaml.v2</a></p>
</li>
<li>
<p><a href="go/pkgy/cobra.html">cobra</a></p>
</li>
<li>
<p><a href="go/pkgy/viper.html">viper</a></p>
</li>
<li>
<p><a href="go/pkgy/pflag.html">pflag</a></p>
</li>
<li>
<p><a href="go/pkgy/logrus.html">logrus</a></p>
</li>
<li>
<p><a href="go/pkgy/prometheus.html">prometheus</a></p>
</li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomgolangprotobufprotopackage-protoa" id="a-hrefhttpsgodocorggithubcomgolangprotobufprotopackage-protoa"><a href="https://godoc.org/github.com/golang/protobuf/proto">package proto</a></a></h1>
<p>import &quot;github.com/golang/protobuf/proto&quot;</p>
<h1><a class="header" href="#links-105" id="links-105">Links</a></h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=NoDRq6Twkts&amp;t=14s">Getting Started with Protocol Buffers in Go - Tutorial - YouTube</a></li>
<li><a href="https://github.com/golang/protobuf">GitHub - golang/protobuf: Go support for Google's protocol buffers</a></li>
<li><a href="https://github.com/protocolbuffers/protobuf/blob/master/src/README.md">protobuf/README.md at master · protocolbuffers/protobuf · GitHub</a></li>
<li><a href="https://developers.google.com/protocol-buffers/docs/gotutorial">Protocol Buffer Basics: Go  |  Protocol Buffers  |  Google Developers</a></li>
<li><a href="https://github.com/protocolbuffers/protobuf/tree/master/examples">protobuf/examples at master · protocolbuffers/protobuf</a></li>
<li><a href="https://developers.google.com/protocol-buffers/docs/proto3">Language Guide (proto3)  |  Protocol Buffers  |  Google Developers</a></li>
<li><a href="https://developers.google.com/protocol-buffers/docs/reference/go-generated">Go Generated Code  |  Protocol Buffers  |  Google Developers</a></li>
<li><a href="https://developers.google.com/protocol-buffers/docs/encoding">Encoding  |  Protocol Buffers  |  Google Developers</a></li>
</ul>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<p>直接在<a href="https://github.com/protocolbuffers/protobuf/releases">releases</a>下载编译好的程序</p>
<p>然后安装<code>protoc-gen-go</code>插件, <code>proto</code>库</p>
<p>需要配置<code>GOPATH</code>, 以及将<code>${GOPATH}/bin</code>加进<code>PATH</code></p>
<pre><code>go get -u github.com/golang/protobuf/protoc-gen-go
go get -u github.com/golang/protobuf/proto
</code></pre>
<h1><a class="header" href="#getting-started" id="getting-started">Getting Started</a></h1>
<p>定义</p>
<pre><code class="language-proto">$ cat person.proto 
syntax = &quot;proto3&quot;;
package person;

message Person {
	
	string name = 1;
	int32 age =2;
}
</code></pre>
<p>生成代码</p>
<p><code>protoc --go_out=. person.proto</code></p>
<p>执行这条命令后，会生成一个文件：<code>person.pb.go</code></p>
<p>使用示例</p>
<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;log&quot;

	// 这里是创建一个目录，把生成个person.pb.go放里面
	person &quot;./protobuf&quot;
	proto &quot;github.com/golang/protobuf/proto&quot;
)

func main() {

	// 这里不加上Name: Age: 就要报错
	p := &amp;person.Person{Name: &quot;zhangsan&quot;, Age: 99}

	data, err := proto.Marshal(p)

	if err != nil {
		log.Fatal(err)
	}

	fmt.Println(data, string(data))
	// [10 8 122 104 97 110 103 115 97 110 16 99] 
	// zhangsanc

	newp := new(person.Person)

	err = proto.Unmarshal(data, newp)

	if err != nil {
		log.Fatal(err)
	}

	fmt.Println(newp.GetName(), newp.GetAge())
	// zhangsan 99

}
</code></pre>
<h1><a class="header" href="#一对编解组函数-1" id="一对编解组函数-1">一对编解组函数</a></h1>
<p>Marshal takes a protocol buffer message and encodes it into the wire format, returning the data. This is the main entry point. </p>
<pre><code class="language-go">func Marshal(pb Message) ([]byte, error)
func Unmarshal(buf []byte, pb Message) error
</code></pre>
<h1><a class="header" href="#message接口" id="message接口">Message接口</a></h1>
<pre><code class="language-go">type Message interface {
    Reset()
    String() string
    ProtoMessage()
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggooglegolangorggrpcgrpc---godoca" id="a-hrefhttpsgodocorggooglegolangorggrpcgrpc---godoca"><a href="https://godoc.org/google.golang.org/grpc">grpc - GoDoc</a></a></h1>
<h1><a class="header" href="#links-106" id="links-106">Links</a></h1>
<ul>
<li><a href="https://grpc.io/docs/quickstart/go/">gRPC</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgodocorggopkginyamlv2package-yamla" id="a-hrefhttpsgodocorggopkginyamlv2package-yamla"><a href="https://godoc.org/gopkg.in/yaml.v2">package yaml</a></a></h1>
<p>import &quot;gopkg.in/yaml.v2&quot;</p>
<h1><a class="header" href="#links-107" id="links-107">Links</a></h1>
<ul>
<li><a href="https://github.com/go-yaml/yaml">GitHub - go-yaml/yaml: YAML support for the Go language.</a></li>
</ul>
<h1><a class="header" href="#一对编解组函数-2" id="一对编解组函数-2">一对编解组函数</a></h1>
<pre><code class="language-go">func Marshal(in interface{}) (out []byte, err error)
func Unmarshal(in []byte, out interface{}) (err error)
func UnmarshalStrict(in []byte, out interface{}) (err error)
</code></pre>
<h1><a class="header" href="#一对编解码器" id="一对编解码器">一对编解码器</a></h1>
<pre><code class="language-go">type Encoder struct {
    // contains filtered or unexported fields
}
func NewEncoder(w io.Writer) *Encoder

func (e *Encoder) Encode(v interface{}) (err error)
func (e *Encoder) Close() (err error)

type Decoder struct {
    // contains filtered or unexported fields
}
func NewDecoder(r io.Reader) *Decoder

func (dec *Decoder) Decode(v interface{}) (err error)
func (dec *Decoder) SetStrict(strict bool)
</code></pre>
<h1><a class="header" href="#一对编解组接口" id="一对编解组接口">一对编解组接口</a></h1>
<pre><code class="language-go">type Marshaler interface {
    MarshalYAML() (interface{}, error)
}

type Unmarshaler interface {
    UnmarshalYAML(unmarshal func(interface{}) error) error
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomspf13cobracobraa" id="a-hrefhttpsgodocorggithubcomspf13cobracobraa"><a href="https://godoc.org/github.com/spf13/cobra">cobra</a></a></h1>
<p><code>import &quot;github.com/spf13/cobra&quot;</code></p>
<h1><a class="header" href="#links-108" id="links-108">Links</a></h1>
<ul>
<li><a href="https://github.com/spf13/cobra">GitHub - spf13/cobra: A Commander for modern Go CLI interactions</a></li>
<li><a href="https://github.com/spf13/cobra/blob/master/cobra/README.md">Cobra Generator</a></li>
<li><a href="https://mycodesmells.com/post/building-cli-tools-in-go-with-cobra">Building CLI tools in Go with Cobra - My Code Smells!</a></li>
<li><a href="https://medium.com/@skdomino/writing-better-clis-one-snake-at-a-time-d22e50e60056">How to build great CLI’s in Golang, one snake at a time</a></li>
</ul>
<h1><a class="header" href="#overview-16" id="overview-16">Overview</a></h1>
<ol>
<li><code>var rootCmd = &amp;cobra.Command{}</code></li>
<li>in <code>init()</code> do <code>cobra.OnInitialize(initConfig,y ...func())</code>, <code>rootCmd.AddCommand(cmds)</code>, <code>rootCmd.Flags().XXXVarP</code>, <code>viper.BindPFlag</code>, <code>viper.SetDefault</code>(may)</li>
<li><code>func initConfig() { ...}</code></li>
<li><code>func Execute() { ... }</code></li>
</ol>
<h1><a class="header" href="#readme" id="readme">README</a></h1>
<p><a href="https://github.com/spf13/cobra/blob/master/README.md">cobra/README.md</a></p>
<h1><a class="header" href="#getting-started-1" id="getting-started-1">Getting Started</a></h1>
<p>参考<code>cobra init</code>生成的<a href="https://github.com/iofxl/practisego/tree/master/08cobra/init">代码</a></p>
<p>in the project dir, run:</p>
<pre><code>$ cobra init .
$ cobra add serve
$ cobra add config
$ cobra add create -p 'configCmd'
$ tree
.
├── LICENSE
├── cmd
│   ├── config.go
│   ├── create.go
│   ├── root.go
│   └── serve.go
└── main.go

// Now can run
$ go run main.go
$ go run main.go serve
$ go run main.go config
$ go run main.go config create
$ go run main.go help serve
</code></pre>
<h1><a class="header" href="#func-oninitialize" id="func-oninitialize">func OnInitialize</a></h1>
<pre><code class="language-go">func OnInitialize(y ...func())
</code></pre>
<p>OnInitialize sets the passed functions to be run when each command's Execute method is called.</p>
<h1><a class="header" href="#command结构" id="command结构">Command结构</a></h1>
<p>rootCmd.AddCommand(cmds)要放在init()里面，程序的执行顺序<code>import --&gt; const --&gt; var --&gt; init()</code></p>
<p><strong>无法在包级别调用东西的方法</strong>,所以*Command的其它的一些方法基本上统都要放在init()里去执行, 或者在自己的Run属性（类型<code>func(cmd *Command, args []string)</code>)里</p>
<pre><code class="language-go">type Command struct {
    // Use is the one-line usage message.
    Use string
    ...
    // Run: Typically the actual work function. Most commands will only implement this.
    Run func(cmd *Command, args []string)
    ...
}

// Execute uses the args (os.Args[1:] by default)
// and run through the command tree finding appropriate matches
// for commands and then corresponding flags.
func (c *Command) Execute() error
// AddCommand adds one or more commands to this parent command.
func (c *Command) AddCommand(cmds ...*Command) {
    for i, x := range cmds {
        ...
	c.commands = append(c.commands, x)
	...
    }
}
// Commands returns a sorted slice of child commands.
func (c *Command) Commands() []*Command

func (c *Command) Flag(name string) (flag *flag.Flag)
func (c *Command) Flags() *flag.FlagSet
func (c *Command) PersistentFlags() *flag.FlagSet
</code></pre>
<h1><a class="header" href="#pflagflag结构和pflagvalue接口" id="pflagflag结构和pflagvalue接口">pflag.Flag结构和pflag.Value接口</a></h1>
<p>Command结构通过Flag(name)方法返回Flag,然后Flag结构通过Value接口取得flag的值的字符串化</p>
<pre><code class="language-go">type Flag struct {
	Name                string              // name as it appears on command line
	Shorthand           string              // one-letter abbreviated flag
	Usage               string              // help message
	Value               Value               // value as set
	DefValue            string              // default value (as text); for usage message
	Changed             bool                // If the user set the value (or if left to default)
	NoOptDefVal         string              // default value (as text); if the flag is on the command line without any options
	Deprecated          string              // If this flag is deprecated, this string is the new or now thing to use
	Hidden              bool                // used by cobra.Command to allow flags to be hidden from help/usage text
	ShorthandDeprecated string              // If the shorthand of this flag is deprecated, this string is the new or now thing to use
	Annotations         map[string][]string // used by cobra.Command bash autocomple code
}

type Value interface {
    String() string
    Set(string) error
    Type() string
    }

</code></pre>
<h1><a class="header" href="#pflagflagset结构" id="pflagflagset结构">pflag.FlagSet结构</a></h1>
<p>A FlagSet represents a set of defined flags. </p>
<p><code>*Command.PersistentFlags()</code>方法和<code>*Command.Flags()</code>方法会返回这个结构</p>
<p>这个结构的各种方法，就是跟标准库里的flag.XXX函数作用一样</p>
<p>这个结构的<code>Lookup(name string) *Flag</code>方法返回*Flag结构</p>
<pre><code class="language-go">type FlagSet struct {
	// Usage is the function called when an error occurs while parsing flags.
	// The field is a function (not a method) that may be changed to point to
	// a custom error handler.
	Usage func()

	// SortFlags is used to indicate, if user wants to have sorted flags in
	// help/usage messages.
	SortFlags bool

	// ParseErrorsWhitelist is used to configure a whitelist of errors
	ParseErrorsWhitelist ParseErrorsWhitelist
	// contains filtered or unexported fields
}

func (f *FlagSet) String(name string, value string, usage string) *string
func (f *FlagSet) StringP(name, shorthand string, value string, usage string) *string
func (f *FlagSet) StringVar(p *string, name string, value string, usage string)
func (f *FlagSet) StringVarP(p *string, name, shorthand string, value string, usage string)

func (f *FlagSet) Lookup(name string) *Flag

// viper.BindPFlag
// BindPFlag binds a specific key to a pflag (as used by cobra).
// Example (where serverCmd is a Cobra instance):
//
//   serverCmd.Flags().Int(&quot;port&quot;, 1138, &quot;Port to run Application server on&quot;)
//   Viper.BindPFlag(&quot;port&quot;, serverCmd.Flags().Lookup(&quot;port&quot;))
//
func BindPFlag(key string, flag *pflag.Flag) error { return v.BindPFlag(key, flag) }
</code></pre>
<p>Example:</p>
<p><a href="https://github.com/spf13/cobra/#create-rootcmd">create-rootcmd</a></p>
<pre><code class="language-go">func init() {
  cobra.OnInitialize(initConfig)

  rootCmd.PersistentFlags().StringVar(&amp;cfgFile, &quot;config&quot;, &quot;&quot;, &quot;config file (default is $HOME/.cobra.yaml)&quot;)
  rootCmd.PersistentFlags().StringVarP(&amp;projectBase, &quot;projectbase&quot;, &quot;b&quot;, &quot;&quot;, &quot;base project directory eg. github.com/spf13/&quot;)
  rootCmd.PersistentFlags().StringP(&quot;author&quot;, &quot;a&quot;, &quot;YOUR NAME&quot;, &quot;Author name for copyright attribution&quot;)
  rootCmd.PersistentFlags().StringVarP(&amp;userLicense, &quot;license&quot;, &quot;l&quot;, &quot;&quot;, &quot;Name of license for the project (can provide `licensetext` in config)&quot;)
  rootCmd.PersistentFlags().Bool(&quot;viper&quot;, true, &quot;Use Viper for configuration&quot;)

  viper.BindPFlag(&quot;author&quot;, rootCmd.PersistentFlags().Lookup(&quot;author&quot;))
  viper.BindPFlag(&quot;projectbase&quot;, rootCmd.PersistentFlags().Lookup(&quot;projectbase&quot;))
  viper.BindPFlag(&quot;useViper&quot;, rootCmd.PersistentFlags().Lookup(&quot;viper&quot;))

  viper.SetDefault(&quot;author&quot;, &quot;NAME HERE &lt;EMAIL ADDRESS&gt;&quot;)
  viper.SetDefault(&quot;license&quot;, &quot;apache&quot;)
}
</code></pre>
<h1><a class="header" href="#working-with-flags" id="working-with-flags">Working with Flags</a></h1>
<h2><a class="header" href="#assign-flags-to-a-command" id="assign-flags-to-a-command">Assign flags to a command</a></h2>
<p>Since the flags are defined and used in different locations, we need to define a variable outside with the correct scope to assign the flag to work with.</p>
<pre><code class="language-go">var Verbose bool
var Source string
</code></pre>
<p>There are two different approaches to assign a flag.</p>
<h3><a class="header" href="#persistent-flags" id="persistent-flags">Persistent Flags</a></h3>
<p>A flag can be 'persistent' meaning that this flag will be available to the command it's assigned to as well as every command under that command. For global flags, assign a flag as a persistent flag on the root.</p>
<p><code>rootCmd.PersistentFlags().BoolVarP(&amp;Verbose, &quot;verbose&quot;, &quot;v&quot;, false, &quot;verbose output&quot;)</code></p>
<h3><a class="header" href="#local-flags" id="local-flags">Local Flags</a></h3>
<p>A flag can also be assigned locally which will only apply to that specific command.</p>
<p><code>rootCmd.Flags().StringVarP(&amp;Source, &quot;source&quot;, &quot;s&quot;, &quot;&quot;, &quot;Source directory to read from&quot;)</code></p>
<h2><a class="header" href="#local-flag-on-parent-commands" id="local-flag-on-parent-commands">Local Flag on Parent Commands</a></h2>
<p>By default Cobra only parses local flags on the target command, any local flags on parent commands are ignored. By enabling Command.TraverseChildren Cobra will parse local flags on each command before executing the target command.</p>
<pre><code class="language-go">command := cobra.Command{
  Use: &quot;print [OPTIONS] [COMMANDS]&quot;,
    TraverseChildren: true,
}
</code></pre>
<h2><a class="header" href="#bind-flags-with-config" id="bind-flags-with-config">Bind Flags with Config</a></h2>
<p>You can also bind your flags with viper:</p>
<pre><code class="language-go">var author string

func init() {
  rootCmd.PersistentFlags().StringVar(&amp;author, &quot;author&quot;, &quot;YOUR NAME&quot;, &quot;Author name for copyright attribution&quot;)
    viper.BindPFlag(&quot;author&quot;, rootCmd.PersistentFlags().Lookup(&quot;author&quot;))
}
</code></pre>
<p>In this example the persistent flag <code>author</code> is bound with <code>viper</code>. <strong>Note</strong>, that the variable <code>author</code> will not be set to the value from config, when the <code>--author</code> flag is not provided by user.</p>
<h2><a class="header" href="#required-flags" id="required-flags">Required flags</a></h2>
<p>Flags are optional by default. If instead you wish your command to report an error when a flag has not been set, mark it as required:</p>
<pre><code class="language-go">rootCmd.Flags().StringVarP(&amp;Region, &quot;region&quot;, &quot;r&quot;, &quot;&quot;, &quot;AWS region (required)&quot;)
rootCmd.MarkFlagRequired(&quot;region&quot;)
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomspf13vipervipera" id="a-hrefhttpsgodocorggithubcomspf13vipervipera"><a href="https://godoc.org/github.com/spf13/viper">viper</a></a></h1>
<p><code>import &quot;github.com/spf13/viper&quot;</code></p>
<h1><a class="header" href="#links-109" id="links-109">Links</a></h1>
<ul>
<li><a href="https://github.com/spf13/viper">GitHub - spf13/viper: Go configuration with fangs</a></li>
<li><a href="https://www.netlify.com/blog/2016/09/06/creating-a-microservice-boilerplate-in-go/">Creating a Microservice Boilerplate in Go | Netlify</a></li>
</ul>
<p><code>go get -u github.com/spf13/viper</code></p>
<h1><a class="header" href="#overview-17" id="overview-17">Overview</a></h1>
<h1><a class="header" href="#tips" id="tips">Tips</a></h1>
<ol>
<li><code>func ReadInConfig</code> 去加载配置文件，在这之前或者没找到配置文件，<code>func ConfigFileUsed</code> 返回都是空的。</li>
<li>只要<code>viper.BindPFlag</code>过，不管有无读到配置文件，<code>viper.GetXX</code>,<code>viper.Unmarshal(&amp;cfg)</code>统都有法使的</li>
<li>如果没读得配置文件，有法使<code>viper.WriteConfigAs(&quot;app.yaml&quot;)</code>保存</li>
<li><code>viper.Unmarshal(&amp;v)</code> can't directly unmarshal into a slice.</li>
</ol>
<p>优先级：</p>
<p>flag设置 &gt; 配置文件设置 &gt; <code>viper.SetDefault</code> &gt; flag默认值</p>
<h1><a class="header" href="#readme-1" id="readme-1">README</a></h1>
<ul>
<li><a href="https://github.com/spf13/viper/blob/master/README.md">viper/README.md</a></li>
</ul>
<h1><a class="header" href="#setconfgname-and-setconfigtype" id="setconfgname-and-setconfigtype">SetConfgName and SetConfigType</a></h1>
<p>SetConfgName不需要包含扩展名</p>
<pre><code class="language-go">// SetConfigFile explicitly defines the path, name and extension of the config file.
// Viper will use this and not check any of the config paths.
func SetConfigFile(in string)
func SetConfigName(in string)
func SetConfigType(in string)
</code></pre>
<p>＃ AddConfigPath</p>
<p>可以执行多次，也就是可以添加多个目录</p>
<pre><code class="language-go">func AddConfigPath(in string)
</code></pre>
<p>例：</p>
<pre><code class="language-go">viper.SetConfigName(&quot;config&quot;) // name of config file (without extension)
viper.SetConfigType(&quot;yaml&quot;)

viper.AddConfigPath(&quot;/etc/appname/&quot;)   // path to look for the config file in
viper.AddConfigPath(&quot;/usr/local/etc/appname/&quot;)   // path to look for the config file in
viper.AddConfigPath(&quot;$HOME/.appname&quot;)  // call multiple times to add many search paths
viper.AddConfigPath(&quot;.&quot;)               // optionally look for config in the working directory

err := viper.ReadInConfig() // Find and read the config file
if err != nil { // Handle errors reading the config file
	panic(fmt.Errorf(&quot;Fatal error config file: %s \n&quot;, err))
}
</code></pre>
<h1><a class="header" href="#readinconfig-and-reading-config-from-ioreader" id="readinconfig-and-reading-config-from-ioreader">ReadInConfig and Reading Config from io.Reader</a></h1>
<pre><code class="language-go">func ReadInConfig() error
func ReadConfig(in io.Reader) error
</code></pre>
<h1><a class="header" href="#getting-values-from-viper" id="getting-values-from-viper">Getting Values From Viper</a></h1>
<p>Get returns an interface. For a specific value use one of the Get____ methods. </p>
<pre><code class="language-go">func Get(key string) interface{}
func GetBool(key string) bool

func InConfig(key string) bool
func IsSet(key string) bool
</code></pre>
<h1><a class="header" href="#unmarshaling-a-config-struct" id="unmarshaling-a-config-struct">Unmarshaling a Config struct</a></h1>
<pre><code class="language-go">func Unmarshal(rawVal interface{}, opts ...DecoderConfigOption) error
</code></pre>
<p>Example:</p>
<pre><code class="language-go">// in conf/config.go
type Config struct {
	Port string
}

func LoadConfig()(*Config, error) {
// all the other loading code

	config := new(Config)
	if err := viper.Unmarshal(config); err != nil {
		return nil, err
	}

// all the error signatures above had to change to nil, err
	return config, nil
}
</code></pre>
<h1><a class="header" href="#writeconfig" id="writeconfig">WriteConfig</a></h1>
<pre><code class="language-go">func WriteConfig() error
func WriteConfigAs(filename string) error
// SafeWriteConfig writes current configuration to file only if the file does not exist.
func SafeWriteConfig() error
func SafeWriteConfigAs(filename string) error

// ConfigFileUsed returns the file used to populate the config registry.
func ConfigFileUsed() string
</code></pre>
<h1><a class="header" href="#viper结构" id="viper结构">Viper结构</a></h1>
<pre><code class="language-go">type Viper struct {
    // contains filtered or unexported fields
}

func GetViper() *Viper
// New returns an initialized Viper instance. 
func New() *Viper
func Sub(key string) *Viper
</code></pre>
<h1><a class="header" href="#make-viper-connection-with-variable" id="make-viper-connection-with-variable">Make viper connection with Variable</a></h1>
<pre><code class="language-go">func Set(key string, value interface{})
</code></pre>
<p>Example:</p>
<pre><code class="language-go">type Config struct {
	Port int
}

var cfg Config

func initConfig() {
	viper.Set(&quot;secret&quot;, cfg.Port)
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomspf13pflagpflag---godoca" id="a-hrefhttpsgodocorggithubcomspf13pflagpflag---godoca"><a href="https://godoc.org/github.com/spf13/pflag">pflag - GoDoc</a></a></h1>
<p><code>import &quot;github.com/spf13/pflag&quot;</code></p>
<h1><a class="header" href="#links-110" id="links-110">Links</a></h1>
<ul>
<li><a href="https://github.com/spf13/pflag">spf13/pflag: Drop-in replacement for Go's flag package, implementing POSIX/GNU-style --flags.</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgodocorgbitbucketorgbertimus9systemstatsystemstat---godoca" id="a-hrefhttpsgodocorgbitbucketorgbertimus9systemstatsystemstat---godoca"><a href="https://godoc.org/bitbucket.org/bertimus9/systemstat">systemstat - GoDoc</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgodocorggouberorgzapzap---godoca" id="a-hrefhttpsgodocorggouberorgzapzap---godoca"><a href="https://godoc.org/go.uber.org/zap">zap - GoDoc</a></a></h1>
<p>import &quot;go.uber.org/zap&quot;</p>
<h1><a class="header" href="#links-111" id="links-111">Links</a></h1>
<ul>
<li><a href="https://github.com/uber-go/zap">uber-go/zap: Blazing fast, structured, leveled logging in Go.</a></li>
<li><a href="https://blog.sandipb.net/2018/05/02/using-zap-simple-use-cases/">Using Zap - Simple use cases · sandipb.net</a></li>
</ul>
<h1><a class="header" href="#quick-start-3" id="quick-start-3">Quick Start</a></h1>
<pre><code class="language-go">// sugar := zap.NewExample().Sugar()
// defer sugar.Sync()

logger, _ := zap.NewProduction()
defer logger.Sync() // flushes buffer, if any
sugar := logger.Sugar()
sugar.Infow(&quot;failed to fetch URL&quot;,
  // Structured context as loosely typed key-value pairs.
  &quot;url&quot;, url,
  &quot;attempt&quot;, 3,
  &quot;backoff&quot;, time.Second,
)
sugar.Infof(&quot;Failed to fetch URL: %s&quot;, url)
</code></pre>
<p>When performance and type safety are critical, use the Logger. It's even faster than the SugaredLogger and allocates far less, but it only supports structured logging.</p>
<h1><a class="header" href="#type-logger-struct" id="type-logger-struct">type Logger struct</a></h1>
<pre><code class="language-go">func L() *Logger
func New(core zapcore.Core, options ...Option) *Logger
func NewExample(options ...Option) *Logger
func NewDevelopment(options ...Option) (*Logger, error)
func NewProduction(options ...Option) (*Logger, error)
func NewNop() *Logger

func (log *Logger) Sugar() *SugaredLogger
func (log *Logger) With(fields ...Field) *Logger
func (log *Logger) Sync() error
</code></pre>
<h1><a class="header" href="#type-sugaredlogger-struct" id="type-sugaredlogger-struct">type SugaredLogger struct</a></h1>
<pre><code class="language-go">func S() *SugaredLogger

func (s *SugaredLogger) Desugar() *Logger
func (s *SugaredLogger) With(args ...interface{}) *SugaredLogger
func (s *SugaredLogger) Sync() error
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomjlaffayeftppackage-ftpa" id="a-hrefhttpsgodocorggithubcomjlaffayeftppackage-ftpa"><a href="https://godoc.org/github.com/jlaffaye/ftp">package ftp</a></a></h1>
<h1><a class="header" href="#links-112" id="links-112">Links</a></h1>
<ul>
<li><a href="https://github.com/fclairamb/ftpserver#quick-test-with-docker">fclairamb/ftpserver: golang ftp server library with a sample implementation</a></li>
</ul>
<h1><a class="header" href="#run-ftpserver" id="run-ftpserver">Run ftpserver</a></h1>
<pre><code># Creating a storage dir
mkdir data

# Starting the sample FTP server
docker run --rm -d -p 2121-2200:2121-2200 -v $(pwd)/data:/data fclairamb/ftpserver

# Connecting to it and uploading a file
ftp ftp://test:test@localhost:2121
!wget -c -O ftpserver-v0.3 https://github.com/fclairamb/ftpserver/releases/download/v0.3/ftpserver
put ftpserver-v0.3 ftpserver-v0.3
quit
ls -lh data/ftpserver-v0.3
</code></pre>
<h1><a class="header" href="#type-entry-struct" id="type-entry-struct">type Entry struct</a></h1>
<pre><code class="language-go">type Entry struct {
    Name string
    Type EntryType
    Size uint64
    Time time.Time
}
</code></pre>
<h1><a class="header" href="#type-serverconn-struct" id="type-serverconn-struct">type ServerConn struct</a></h1>
<pre><code class="language-go">type ServerConn struct {
    // Do not use EPSV mode
    DisableEPSV bool

    // Timezone that the server is in
    Location *time.Location
    // contains filtered or unexported fields
}

func Dial(addr string) (*ServerConn, error)
func DialTimeout(addr string, timeout time.Duration) (*ServerConn, error)

func (c *ServerConn) Login(user, password string) error
func (c *ServerConn) Logout() error
func (c *ServerConn) NoOp() error
func (c *ServerConn) Quit() error

func (c *ServerConn) CurrentDir() (string, error)
func (c *ServerConn) ChangeDir(path string) error
func (c *ServerConn) ChangeDirToParent() error
func (c *ServerConn) MakeDir(path string) error
func (c *ServerConn) RemoveDir(path string) error
func (c *ServerConn) RemoveDirRecur(path string) error

func (c *ServerConn) Rename(from, to string) error
func (c *ServerConn) Delete(path string) error
func (c *ServerConn) FileSize(path string) (int64, error)

func (c *ServerConn) List(path string) (entries []*Entry, err error)
func (c *ServerConn) NameList(path string) (entries []string, err error)

// The returned ReadCloser must be closed to cleanup the FTP data connection.
func (c *ServerConn) Retr(path string) (*Response, error)
func (c *ServerConn) RetrFrom(path string, offset uint64) (*Response, error)

func (c *ServerConn) Stor(path string, r io.Reader) error
func (c *ServerConn) StorFrom(path string, r io.Reader, offset uint64) error
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcombradfitzgo-smtpdsmtpdsmtpd---godoca" id="a-hrefhttpsgodocorggithubcombradfitzgo-smtpdsmtpdsmtpd---godoca"><a href="https://godoc.org/github.com/bradfitz/go-smtpd/smtpd">smtpd - GoDoc</a></a></h1>
<p>import &quot;github.com/bradfitz/go-smtpd/smtpd&quot;</p>
<h1><a class="header" href="#type-server-struct" id="type-server-struct">type Server struct</a></h1>
<pre><code class="language-go">type Server struct {
    Addr         string        // TCP address to listen on, &quot;:25&quot; if empty
    Hostname     string        // optional Hostname to announce; &quot;&quot; to use system hostname
    ReadTimeout  time.Duration // optional read timeout
    WriteTimeout time.Duration // optional write timeout

    PlainAuth bool // advertise plain auth (assumes you're on SSL)

    // OnNewConnection, if non-nil, is called on new connections.
    // If it returns non-nil, the connection is closed.
    OnNewConnection func(c Connection) error

    // OnNewMail must be defined and is called when a new message beings.
    // (when a MAIL FROM line arrives)
    OnNewMail func(c Connection, from MailAddress) (Envelope, error)
}

func (srv *Server) ListenAndServe() error
func (srv *Server) Serve(ln net.Listener) error

func (srv *Server) newSession(rwc net.Conn) (s *session, err error) 
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomziutektelnettelnet---godoca" id="a-hrefhttpsgodocorggithubcomziutektelnettelnet---godoca"><a href="https://godoc.org/github.com/ziutek/telnet">telnet - GoDoc</a></a></h1>
<h1><a class="header" href="#links-113" id="links-113">Links</a></h1>
<ul>
<li><a href="https://www.bat.org/">BatMUD</a> an awesome game!</li>
</ul>
<h1><a class="header" href="#overview-18" id="overview-18">Overview</a></h1>
<p>E.g.: </p>
<pre><code class="language-go">func main() {
	conn, err := telnet.Dial(&quot;tcp&quot;, &quot;bat.org:23&quot;)
	if err != nil {
		log.Fatal(err)
	}

	buf := make([]byte, 512)
	for {
		n, err := conn.Read(buf) // Use raw read to find issue #15.
		os.Stdout.Write(buf[:n])
		if err != nil {
			log.Fatal(err)
		}

	}
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomjunipergo-netconfnetconfnetconf---godoca" id="a-hrefhttpsgodocorggithubcomjunipergo-netconfnetconfnetconf---godoca"><a href="https://godoc.org/github.com/Juniper/go-netconf/netconf">netconf - GoDoc</a></a></h1>
<h1><a class="header" href="#links-114" id="links-114">Links</a></h1>
<ul>
<li><a href="https://github.com/Juniper/go-netconf">GitHub - Juniper/go-netconf: NETCONF implementation in Go.</a></li>
<li><a href="https://www.ruijie.com.cn/fa/xw-hlw/61232/">netconf介绍</a></li>
<li><a href="https://www1.mg-soft.com/index.html">MG-SOFT Corporation: NETCONF, YANG, SNMP and SMI applications, products, toolkits, technologies and turn-key solutions.</a></li>
</ul>
<h1><a class="header" href="#gobot" id="gobot">gobot</a></h1>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomxtacikcp-gokcp---godoca" id="a-hrefhttpsgodocorggithubcomxtacikcp-gokcp---godoca"><a href="https://godoc.org/github.com/xtaci/kcp-go">kcp - GoDoc</a></a></h1>
<p>import &quot;github.com/xtaci/kcp-go&quot;</p>
<h1><a class="header" href="#links-115" id="links-115">Links</a></h1>
<ul>
<li><a href="https://gocn.vip/article/356">kcp-go源码解析 - Go中国技术社区 - golang</a></li>
<li><a href="https://www.reddit.com/r/golang/comments/9nrt5k/a_productiongrade_reliableudp_library_for_golang/">A Production-Grade Reliable-UDP Library for golang : golang</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomlibp2pgo-libp2plibp2p---godoca" id="a-hrefhttpsgodocorggithubcomlibp2pgo-libp2plibp2p---godoca"><a href="https://godoc.org/github.com/libp2p/go-libp2p">libp2p - GoDoc</a></a></h1>
<h1><a class="header" href="#links-116" id="links-116">Links</a></h1>
<ul>
<li><a href="https://github.com/libp2p/go-libp2p">libp2p/go-libp2p: libp2p implementation in Go</a> </li>
<li><a href="https://github.com/libp2p/specs">libp2p/specs: Technical specifications for the libp2p networking stack</a></li>
<li><a href="https://github.com/libp2p/go-libp2p-examples">libp2p/go-libp2p-examples: Example libp2p applications</a></li>
</ul>
<p>a</p>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomintel-gonff-goflowflow---godoca" id="a-hrefhttpsgodocorggithubcomintel-gonff-goflowflow---godoca"><a href="https://godoc.org/github.com/intel-go/nff-go/flow">flow - GoDoc</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomintel-gonff-gopacketpacket---godoca" id="a-hrefhttpsgodocorggithubcomintel-gonff-gopacketpacket---godoca"><a href="https://godoc.org/github.com/intel-go/nff-go/packet">packet - GoDoc</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomgooglegoexpectexpect---godoca" id="a-hrefhttpsgodocorggithubcomgooglegoexpectexpect---godoca"><a href="https://godoc.org/github.com/google/goexpect">expect - GoDoc</a></a></h1>
<h1><a class="header" href="#links-117" id="links-117">Links</a></h1>
<ul>
<li><a href="https://github.com/google/goexpect">GitHub - google/goexpect: Expect for Go</a></li>
</ul>
<h1><a class="header" href="#review" id="review">Review</a></h1>
<pre><code class="language-go">		select {
		case &lt;-timer.C:
			// Expect timeout.
			nr, err := io.Copy(&amp;tbuf, e)
			if err != nil {
				return tbuf.String(), nil, -1, fmt.Errorf(&quot;io.Copy failed: %v&quot;, err)
			}
			// If we got no new data we return otherwise give it another chance to match.
			if nr == 0 {
				return tbuf.String(), nil, -1, TimeoutError(timeout)
			}
			timer = time.NewTimer(timeout)
		case &lt;-chTicker.C:
			// Periodical timer to make sure data is handled in case the &lt;-e.rcv channel
			// was missed.
			if _, err := io.Copy(&amp;tbuf, e); err != nil {
				return tbuf.String(), nil, -1, fmt.Errorf(&quot;io.Copy failed: %v&quot;, err)
			}
		case &lt;-e.rcv:
			// Data to fetch.
			if _, err := io.Copy(&amp;tbuf, e); err != nil {
				return tbuf.String(), nil, -1, fmt.Errorf(&quot;io.Copy failed: %v&quot;, err)
			}
		}
</code></pre>
<p>I think this select is useless, it's the same as just one line <code>io.Copy(&amp;tbuf, e)</code>,
cause no matter in which case, it just read out from <code>e</code> anyway.</p>
<p>am I wrong ?</p>
<p>I think there should be have a reliable way to know:</p>
<ol>
<li>e.Send(in) has done.</li>
<li>the sended in command has response back.</li>
</ol>
<h1><a class="header" href="#protocols" id="protocols">protocols</a></h1>
<ul>
<li><a href="go/protocols/ping.html">ICMP:ping</a></li>
<li><a href="go/protocols/socks5.html">socks5</a></li>
<li><a href="go/protocols/shadowsocks.html">shadowsocks</a></li>
<li><a href="go/protocols/application_level_protocols.html">Application-Level Protocols</a></li>
<li><a href="go/protocols/ftp_replies.html">FTP REPLIES</a></li>
<li><a href="go/protocols/smtp.html">smtp</a></li>
<li><a href="go/protocols/ftp.html">ftp</a></li>
</ul>
<h1><a class="header" href="#application-level-protocols" id="application-level-protocols">Application-Level Protocols</a></h1>
<p><strong>Building any application requires design decisions before you start writing code.</strong></p>
<h1><a class="header" href="#links-118" id="links-118">Links</a></h1>
<ul>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/applevelprotocols/index.html">Application-Level Protocols | Network Programming with Go (golang)</a></li>
</ul>
<h1><a class="header" href="#the-content-of-a-protocol" id="the-content-of-a-protocol">The content of a protocol</a></h1>
<ul>
<li>Version Control</li>
<li>Message Format</li>
<li>Data Format</li>
<li>State Information</li>
</ul>
<h1><a class="header" href="#message-format" id="message-format">Message Format</a></h1>
<p>In the last chapter we discussed some possibilities for representing data to be sent across the wire. Now we look one level up, to the messages that may contain such data.</p>
<ul>
<li>The client and server will exchange messages with different meanings:
<ul>
<li>Login request</li>
<li>Login reply</li>
<li>Get record request</li>
<li>Record data reply</li>
</ul>
</li>
<li>The client will prepare a request, which must be understood by the server.</li>
<li>The server will prepare a reply, which must be understood by the client.</li>
</ul>
<p>Commonly, the first part of the message will be a message type.</p>
<ul>
<li>
<p>Client to server:</p>
<pre><code>    LOGIN &lt;name&gt; &lt;passwd&gt;
    GET &lt;subject&gt; grade
</code></pre>
</li>
<li>
<p>Server to client: LOGIN succeeded</p>
<pre><code>    GRADE &lt;subject&gt; &lt;grade&gt;
</code></pre>
</li>
</ul>
<h1><a class="header" href="#data-format" id="data-format">Data Format</a></h1>
<p>There are two main format choices for messages: byte encoded or character encoded.</p>
<h2><a class="header" href="#byte-format" id="byte-format">Byte Format</a></h2>
<p>In the byte format:</p>
<ul>
<li>The first part of the message is typically a byte to distinguish between message types. </li>
<li>The message handler examines this first byte to distinguish the message type and then performs a switch to select the appropriate handler for that type.</li>
<li>Further bytes in the message contain message content according to a predefined format (as discussed in the previous chapter).</li>
</ul>
<p>Pseudocode for a byte-format server is as follows:</p>
<pre><code class="language-go">handleConn(conn net.Conn) {
        for {
                b := conn.readByte()
                switch b {
                case msg1: ...
                case msg2: ...
		...
                }
        }
}
</code></pre>
<h2><a class="header" href="#character-format" id="character-format">Character Format</a></h2>
<p>In this mode, everything is sent as characters if possible. For example, an integer 234 would be sent as, say, the three characters 2, 3, and 4 instead of as the one byte 234. Data that is inherently binary may be Base64 encoded to change it into a 7-bit format and then sent as ASCII characters, as discussed in the previous chapter.</p>
<p>In character format:</p>
<ul>
<li>A message is a sequence of one or more lines. The start of the first line of the message is typically a word that represents the message type.</li>
<li>String-handling functions may be used to decode the message type and data.</li>
<li>The rest of the first line and successive lines contain the data.</li>
<li>Line-oriented functions and line-oriented conventions are used to manage this.</li>
</ul>
<p>The pseudocode is as follows:</p>
<pre><code class="language-go">handleConn(conn net.Conn) {
        for {
                line := conn.readLine()
                switch line.startWith() {
                case msg1: ...
                case msg2: ...
		...
                }
        }
}
</code></pre>
<h1><a class="header" href="#icmpping" id="icmpping">ICMP:ping</a></h1>
<h1><a class="header" href="#links-119" id="links-119">Links</a></h1>
<ul>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/socket/raw_sockets_and_the_type_ipconn.html">Raw sockets and the type IPConn | Network Programming with Go (golang)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Ping_(networking_utility)">ping (networking utility) - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol">Internet Control Message Protocol - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/Mike_Muuss">Mike Muuss - Wikipedia</a></li>
<li><a href="https://blog.csdn.net/zjli321/article/details/74908451">Checksum算法 - 简单的过客 - CSDN博客</a></li>
</ul>
<h1><a class="header" href="#协议格式" id="协议格式">协议格式</a></h1>
<h1><a class="header" href="#header" id="header">Header</a></h1>
<p>The ICMP header starts after the <a href="https://en.wikipedia.org/wiki/IPv4#Header">IPv4 header</a> and is identified by IP protocol number. All ICMP packets have an 8-byte header and variable-sized data section. The first 4 bytes of the header have fixed format, while the last 4 bytes depend on the type/code of that ICMP packet.</p>
<h1><a class="header" href="#icmp-header-format" id="icmp-header-format">ICMP Header Format</a></h1>
<pre><code class="language-go">msg[0] = Type
msg[1] = Code
msg[2:4] = Checksum
msg[4:8] = Rest of Header
</code></pre>
<h1><a class="header" href="#ping的包头" id="ping的包头">ping的包头</a></h1>
<p>ping 使Type = 8 and Type = 0 这两个。分别就是 Echo Request and Echo Reply, 两种都Code = 0</p>
<pre><code>The format of the ICMP packet payload is as follows:

• The first byte is 8, standing for the echo message.
• The second byte is zero.
• The third and fourth bytes are a checksum on the entire message.
• The fifth and sixth bytes are an arbitrary identifier.
• The seventh and eight bytes are an arbitrary sequence number.
• The rest of the packet is user data.
</code></pre>
<h1><a class="header" href="#checksum算法" id="checksum算法">Checksum算法</a></h1>
<p>里面的checksum怎么算,是只算包头部分还是要跟payload一时算?</p>
<p>是要跟payload一时算的。</p>
<p>依据就是: <code>^(x + ^x) == 0</code></p>
<p>数据按位取反，再跟原来的数相加，再取反，就是0；^x就是校验码，接收方收到数据，做上面那个公式就可以罢</p>
<p>具体算法就是把数据切分成每16bit一组，全部相加，如果数据是奇数个字节的，最末尾补一字节0</p>
<pre><code>checksum的计算方法

1、 先将需要计算checksum数据中的checksum设为0；
2、 计算checksum的数据按2byte划分开来，每2byte组成一个16bit的值，如果最后有单个byte的数据，补一个byte的0组成2byte；
3、 将所有的16bit值累加到一个32bit的值中；
4、 将32bit值的高16bit与低16bit相加到一个新的32bit值中，若新的32bit值大于0Xffff, 再将新值的高16bit与低16bit相加；
5、 将上一步计算所得的16bit值按位取反，即得到checksum值，存入数据的checksum字段即可
</code></pre>
<h1><a class="header" href="#socks5" id="socks5">SOCKS5</a></h1>
<h1><a class="header" href="#links-120" id="links-120">Links</a></h1>
<ul>
<li><a href="https://tools.ietf.org/html/rfc1928">RFC 1928 - SOCKS Protocol Version 5</a> </li>
<li><a href="https://www.jianshu.com/p/6fc3fd5dd5ea">socks5协议理解(TCP/UDP) - 简书</a></li>
<li><a href="https://www.jianshu.com/p/172810a70fad">一个简单的Golang实现的Socks5 Proxy - 简书</a></li>
<li><a href="https://godoc.org/golang.org/x/net/internal/socks">socks - GoDoc</a></li>
</ul>
<p><strong>Q:</strong> 代理UDP的时候，UDP报文是包在TCP链接里的，还是仍然是UDP 的报文 ？</p>
<p><strong>A:</strong> 事实是仍然是UDP的。不过像shadowsocks这种做法，套进TCP里也会得的</p>
<p><img src="go/protocols/img/socks5.udp.png" alt="alt text" /></p>
<p><strong>TCP VS UDP</strong></p>
<p>首先呢，不认为这是两个不同的东西，其实统都一样的，统都socket跟socket之间的byte
而已，区别不过是如何去解析协议而已</p>
<p>TCP是有连接的，UDP是无连接的，其实所谓有连接，就是过来的报文的包头底层会去处理
的。而UDP是要去解析包头的</p>
<p>所以也有另外一种曰法，TCP是面向内容的，UDP是面向报文的，这些统都搞些概念，使简
单的东西复杂起</p>
<h1><a class="header" href="#message-and-data-format" id="message-and-data-format">Message and Data Format</a></h1>
<h1><a class="header" href="#message-format-1" id="message-format-1">Message Format</a></h1>
<ul>
<li>Negotiation
<ol>
<li>The client connects to the server, and sends a version
identifier/method selection message.</li>
<li>The server selects from one of the methods given in METHODS, and
sends a METHOD selection message.</li>
</ol>
</li>
<li>Requests
<ol>
<li>Once the method-dependent subnegotiation has completed, the client
sends the request details.</li>
<li>The server evaluates the request, and returns a reply.</li>
</ol>
</li>
<li>Reply Processing<br />
When a reply (REP value other than X'00') indicates a failure, the
SOCKS server MUST terminate the TCP connection shortly after sending
the reply.  This must be no more than 10 seconds after detecting the
condition that caused a failure.<br />
If the reply code (REP value of X'00') indicates a success, and the
request was either a BIND or a CONNECT, the client may now start
passing data. </li>
</ul>
<h1><a class="header" href="#data-format-1" id="data-format-1">Data Format</a></h1>
<p>数据格式是去表达消息格式的</p>
<p>There are two main format choices for messages: <strong>byte encoded</strong> or <strong>character
encoded</strong>.</p>
<p>socks5 is <code>byte encoded</code>.</p>
<ul>
<li>Negotiation
<ol>
<li>
<p>The client connects to the server, and sends a version
identifier/method selection message.</p>
<pre><code>    +----+----------+----------+
    |VER | NMETHODS | METHODS  |
    +----+----------+----------+
    | 1  |    1     | 1 to 255 |
    +----+----------+----------+
</code></pre>
</li>
<li>
<p>The server selects from one of the methods given in METHODS, and
sends a METHOD selection message.</p>
<pre><code> 	 +----+--------+
 	 |VER | METHOD |
 	 +----+--------+
 	 | 1  |   1    |
 	 +----+--------+
</code></pre>
</li>
</ol>
</li>
<li>Requests
<ol>
<li>
<p>Once the method-dependent subnegotiation has completed, the client
sends the request details.</p>
<ul>
<li>----+-----+-------+------+----------+----------+
|VER | CMD |  RSV  | ATYP | DST.ADDR | DST.PORT |
+----+-----+-------+------+----------+----------+
| 1  |  1  | X'00' |  1   | Variable |    2     |
+----+-----+-------+------+----------+----------+</li>
</ul>
</li>
<li>
<p>The server evaluates the request, and returns a reply.</p>
<ul>
<li>----+-----+-------+------+----------+----------+
|VER | REP |  RSV  | ATYP | BND.ADDR | BND.PORT |
+----+-----+-------+------+----------+----------+
| 1  |  1  | X'00' |  1   | Variable |    2     |
+----+-----+-------+------+----------+----------+</li>
</ul>
</li>
</ol>
</li>
</ul>
<h1><a class="header" href="#shadowsocks-1" id="shadowsocks-1">shadowsocks</a></h1>
<h1><a class="header" href="#links-121" id="links-121">Links</a></h1>
<ul>
<li><a href="https://shadowsocks.org/en/spec/Protocol.html">Shadowsocks - Protocol</a></li>
<li><a href="https://shadowsocks.org/en/spec/AEAD-Ciphers.html">Shadowsocks - AEAD Ciphers</a></li>
<li><a href="https://github.com/shadowsocks/go-shadowsocks2">GitHub - shadowsocks/go-shadowsocks2</a></li>
<li><a href="https://github.com/UESTC-BBS/socket-tcp-proxy">GitHub - UESTC-BBS/socket-tcp-proxy</a></li>
</ul>
<h1><a class="header" href="#protocol-format" id="protocol-format">Protocol Format</a></h1>
<pre><code>[1-byte type][variable-length host][2-byte port]
</code></pre>
<p>协议的全部内容就是socks5中的地址的部分</p>
<h2><a class="header" href="#和socks5的区别" id="和socks5的区别">和socks5的区别</a></h2>
<p>socks5的做法是，解析得到addr后，去连接addr，回复成功或失败，再开始转发</p>
<p>ss的是做法是，C端将表达addr的字节串直接发得S端，S端解析得到addr后，就跟原socks5一样罢</p>
<h1><a class="header" href="#implementation" id="implementation">Implementation</a></h1>
<p><a href="https://github.com/iofxl/practisego/tree/master/06ss">6ss</a></p>
<h1><a class="header" href="#接口的设计" id="接口的设计">接口的设计</a></h1>
<p><a href="https://github.com/shadowsocks/go-shadowsocks2">go-shadowsocks2</a>的接口设计很漂亮，很GO。</p>
<p>最重要的一个接口就是一个以net.Conn接口为参数，并返回net.Conn接口的接口，经过这个接口处理之后，新的net.Conn接口的流为加密流</p>
<pre><code class="language-go">type Guochaner interface {                                                                                                                                                             
        Guochan( conn net.Conn ) net.Conn                                                                                                                                              
} 
</code></pre>
<p>要注意这种接口跟读写接口那种接口是有区别的：这种接口要求返回一个东西，读写接口那种要求实现一种功能。</p>
<pre><code class="language-go">func ( m Method ) Guochan( c net.Conn ) net.Conn {                                                                                                                                     
        return NewConn(m,c)                                                                                                                                                            
} 
</code></pre>
<p>接下来这个工作也就是一种设计，我感觉这是非常漂亮的设计，不需要等接口真正实现出来就有法做这些事体：</p>
<pre><code class="language-go">type listener struct {                                                                                                                                                                 
        net.Listener                                                                                                                                                                   
        Guochaner                                                                                                                                                                      
}                                                                                                                                                                                      
                                                                                                                                                                                       
func (l *listener ) Accept() (net.Conn, error) {                                                                                                                                       
        c, err := l.Listener.Accept()                                                                                                                                                  
        return l.Guochan(c), err                                                                                                                                                       
}                                                                                                                                                                                      
                                                                                                                                                                                       
func Listen( g Guochaner, network, address string ) (net.Listener, error ) {                                                                                                           
        l, err := net.Listen(network, address)                                                                                                                                         
        return &amp;listener{l, g}, err                                                                                                                                                    
}                                                                                                                                                                                      
                                                                                                                                                                                       
func Dial( g Guochaner, network, address string ) (net.Conn, error ) {                                                                                                                 
        c, err := net.Dial(network, address)                                                                                                                                           
        return g.Guochan(c), err                                                                                                                                                       
} 
</code></pre>
<p>这种接口设计的好处，就是不管么要使加密，使哪种加密方法，只要实现这个接口，代码统都不需要修改的。</p>
<p>到这时，所有的工作就是要去实现这个接口。</p>
<h1><a class="header" href="#加密" id="加密">加密</a></h1>
<p>要解决的一个问题，AEAD接口跟BlockMode接口都不是Stream接口这样的，有法直接读写流。要自己实现一下。</p>
<p>使Stream接口去实现简单</p>
<h1><a class="header" href="#加密方法的管理" id="加密方法的管理">加密方法的管理</a></h1>
<p>可以学习<code>crypto.Hash</code>结构管理<code>func() hash.Hash</code>的方法:</p>
<p>每一种方法使常量编号， 使切片存相关固定长度的东西等相关参数，还有生成接口的函数，通过New函数找得要使的函数并直接执行相应的函数，通过切片的key，将相关的东西跟编号联系起。</p>
<p>各个编号都实现这几个方法： New, Size, Available, HashFunc</p>
<p>这种东西可以喊作方法选择器</p>
<p>搞么很多时才没搞明白这么简单的道理： <strong>函数返回接口，返回的其实是实现了这个接口的东西</strong></p>
<p>在这里，我需要选择的一个加密方法，就要对应的需要的函数并执行这个函数</p>
<h1><a class="header" href="#smtp" id="smtp">smtp</a></h1>
<h1><a class="header" href="#links-122" id="links-122">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">Simple Mail Transfer Protocol - Wikipedia</a></li>
<li><a href="https://tools.ietf.org/html/rfc821#page-4">RFC 821 - Simple Mail Transfer Protocol#Page 4</a></li>
<li><a href="https://www.samlogic.net/articles/smtp-commands-reference.htm">SMTP Commands Reference (covers HELO/EHLO, MAIL, RCPT, DATA, RSET, VRFY, AUTH, STARTTLS etc)</a></li>
<li><a href="https://golang.org/pkg/net/smtp/">smtp - The Go Programming Language</a></li>
<li><a href="https://godoc.org/github.com/bradfitz/go-smtpd/smtpd">smtpd - GoDoc</a></li>
<li><a href="https://tools.ietf.org/html/rfc5321#section-4.5.2">RFC 5321 - Simple Mail Transfer Protocol</a></li>
</ul>
<p>Simple Mail Transfer Protocol (SMTP) is an Internet standard for electronic mail (email) transmission. First defined by RFC 821 in 1982, it was updated in 2008 with Extended SMTP additions by RFC 5321, which is the protocol in widespread use today. </p>
<p>SMTP defines message transport, not the message content. </p>
<p>Further implementations include FTP Mail[6] and Mail Protocol, both from 1973.[7] Development work continued throughout the 1970s, until the ARPANET transitioned into the modern Internet around 1980. Jon Postel then proposed a Mail Transfer Protocol in 1980 that began to remove the mail's reliance on FTP.[8] SMTP was published as RFC 788 in November 1981, also by Postel.</p>
<h1><a class="header" href="#protocol-overview" id="protocol-overview">Protocol overview</a></h1>
<p>SMTP is a connection-oriented, text-based protocol in which a mail sender communicates with a mail receiver by issuing command strings and supplying necessary data over a reliable ordered data stream channel, typically a Transmission Control Protocol (TCP) connection. </p>
<p>An SMTP transaction consists of three command/reply sequences:</p>
<ol start="0">
<li>
<p>Dial, Sverver response &quot;220 smtp.example.com ESMTP Postfix&quot;</p>
</li>
<li>
<p><code>HELO</code> or <code>EHLO</code> (res: 250)</p>
</li>
</ol>
<p>The client sends this command to the SMTP server to identify itself and initiate the SMTP conversation. </p>
<ol start="2">
<li><code>MAIL</code>, <code>RCPT</code>, <code>DATA</code> </li>
</ol>
<p><code>MAIL</code>: Specifies the e-mail address of the sender. If the senders e-mail address is accepted the server will reply with a 250 OK reply code. </p>
<p><code>RCPT</code>: Specifies the e-mail address of the recipient.  res 250</p>
<p><code>DATA</code>: The DATA command starts the transfer of the message contents (body text, attachments etc). </p>
<p>for DATA cmd it self, res 354, for data end, res 250.</p>
<ol start="3">
<li><code>QUIT</code></li>
</ol>
<p>Asks the server to close the connection. If the connection can be closed the servers replies with a 221 numerical code and then is the session closed.</p>
<h1><a class="header" href="#smtp-transport-example" id="smtp-transport-example">SMTP transport example</a></h1>
<pre><code class="language-sh">S: 220 smtp.example.com ESMTP Postfix
C: HELO relay.example.com
S: 250 smtp.example.com, I am glad to meet you
C: MAIL FROM:&lt;bob@example.com&gt;
S: 250 Ok
C: RCPT TO:&lt;alice@example.com&gt;
S: 250 Ok
C: RCPT TO:&lt;theboss@example.com&gt;
S: 250 Ok
C: DATA
S: 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
C: From: &quot;Bob Example&quot; &lt;bob@example.com&gt;
C: To: Alice Example &lt;alice@example.com&gt;
C: Cc: theboss@example.com
C: Date: Tue, 15 January 2008 16:02:43 -0500
C: Subject: Test message
C: 
C: Hello Alice.
C: This is a test message with 5 header fields and 4 lines in the message body.
C: Your friend,
C: Bob
C: .
S: 250 Ok: queued as 12345
C: QUIT
S: 221 Bye
{The server closes the connection}
</code></pre>
<h1><a class="header" href="#ehlo" id="ehlo">EHLO</a></h1>
<pre><code class="language-sh">S: 220 smtp2.example.com ESMTP Postfix
C: EHLO bob.example.com
S: 250-smtp2.example.com Hello bob.example.org [192.0.2.201]
S: 250-SIZE 14680064
S: 250-PIPELINING
S: 250 HELP
</code></pre>
<h1><a class="header" href="#dot-encoding" id="dot-encoding">Dot Encoding</a></h1>
<h1><a class="header" href="#telnet" id="telnet">TELNET</a></h1>
<h1><a class="header" href="#links-123" id="links-123">Links</a></h1>
<ul>
<li><a href="https://tools.ietf.org/html/rfc854">RFC 854 - Telnet Protocol Specification</a></li>
<li><a href="http://mars.netanya.ac.il/%7Eunesco/cdrom/booklet/HTML/NETWORKING/node300.html">THE TELNET PROTOCOL</a></li>
<li><a href="https://godoc.org/github.com/ziutek/telnet">telnet - GoDoc</a></li>
</ul>
<p>INTRODUCTION</p>
<p>The purpose of the TELNET Protocol is to provide a fairly general,
bi-directional, eight-bit byte oriented communications facility.  Its
primary goal is to allow a standard method of interfacing terminal
devices and terminal-oriented processes to each other.  It is
envisioned that the protocol may also be used for terminal-terminal
communication (&quot;linking&quot;) and process-process communication
(distributed computation).</p>
<p>GENERAL CONSIDERATIONS</p>
<p>A TELNET connection is a Transmission Control Protocol (TCP)
connection used to transmit data with interspersed TELNET control
information.</p>
<p>The TELNET Protocol is built upon three main ideas:  first, the
concept of a &quot;Network Virtual Terminal&quot;; second, the principle of
negotiated options; and third, a symmetric view of terminals and
processes.</p>
<p>In summary, WILL XXX is sent, by either party, to indicate that
party's desire (offer) to begin performing option XXX, DO XXX and
DON'T XXX being its positive and negative acknowledgments; similarly,
DO XXX is sent to indicate a desire (request) that the other party
(i.e., the recipient of the DO) begin performing option XXX, WILL XXX
and WON'T XXX being the positive and negative acknowledgments.  Since
the NVT is what is left when no options are enabled, the DON'T and
WON'T responses are guaranteed to leave the connection in a state
which both ends can handle.  Thus, all hosts may implement their
TELNET processes to be totally unaware of options that are not
supported, simply returning a rejection to (i.e., refusing) any
option request that cannot be understood.</p>
<h1><a class="header" href="#how-it-works" id="how-it-works">How it works</a></h1>
<ul>
<li>Once the connection has been established, the client program accepts keystrokes from the user and relays them, generally <strong>one character at a time</strong>, to the TELNET server. </li>
<li>The server on the destination machine accepts the characters sent to it by the client, and passes them to a terminal server. </li>
<li>A &quot;terminal server&quot; is just some facility provided by the operating system for entering keystrokes from a user's keyboard. </li>
</ul>
<p>...</p>
<ul>
<li>To accomodate this heterogeneity, TELNET defines a Network Virtual Terminal (NVT). Any user TELNETting in to a remote site is deemed to be on an NVT, regardless of the actual terminal type being used.</li>
<li>It is the responsibility of the client program to translate user keystrokes from the actual terminal type into NVT format, and of the server program to translate NVT characters into the format needed by the destination host. For data sent back from the destination host, the translation is the reverse. </li>
<li>NVT format defines all characters to be 8 bits (one byte) long. At startup, 7 bit US ASCII is used for data; bytes with the high order bit = 1 are command sequences. </li>
<li>The 128 7-bit long US ASCII characters are divided into 95 printable characters and 33 control codes. NVT maps the 95 printable characters into their defined values - decimal 65 = &quot;A&quot;, decimal 97 = &quot;a&quot;, etc. </li>
<li>The 33 control codes are defined for NVT as:</li>
</ul>
<pre><code>    ASCII Code    Decimal value      Meaning
      NUL            0               NO - OP
      BEL            7               Ring &quot;terminal bell&quot;
      BS             8               Backspace; move cursor left
      HT             9               Horizontal tab; move cursor right
      LF            10               Line feed; move down one line;
                                     stay in same column
      VT            11               Vertical tab; move cursor down
      FF            12               Form Feed
      CR            13               Carriage return; move cursor to
                                     beginning of current line
      all others                     NO - OP
  
      CTRL-GHIJKLM == 7 - 13
</code></pre>
<ul>
<li>
<p>NVT defines end-of-line to be a CR-LF combination - the two-character sequence. </p>
</li>
<li>
<p>In addition to the 128 characters mentioned above, there are 128 other possible characters in an 8-bit encoding scheme. NVT uses these 128 (with decimal values 128 through 255, inclusive) to pass control functions from client to server. </p>
<p>So:</p>
<p>TELNET only knows value between 0-255, some of these value has special meaning.</p>
</li>
</ul>
<p>// interesting</p>
<ul>
<li>A symmetric view of terminals and processes . </li>
<li>Because of the symmetric model used by TELNET, both the host and the client may propose additional options to be used.</li>
<li>The set of options is not part of the TELNET protocol, so that new terminal features can be incorporated without changing the TELNET protocol (mouse?). </li>
<li>Commands start with a special character called the Interpret as Command escape character (IAC). </li>
<li>The IAC code is 255. </li>
<li>If a 255 is sent as data - it must be followed by another 255 </li>
</ul>
<h1><a class="header" href="#the-nvt-network-virtual-terminal-concept" id="the-nvt-network-virtual-terminal-concept">The NVT (Network Virtual Terminal) concept</a></h1>
<ul>
<li>The NVT has a &quot;printer&quot; (or display) and a &quot;keyboard&quot;.</li>
<li>The keyboard produces outgoing data, which is sent over the TELNET connection. The printer receives the incoming data.</li>
<li>The basic characteristics of an NVT, unless they are modified by mutually agreed options are:
<ul>
<li>The data representation is 7-bit ASCII transmitted in 8-bit bytes.</li>
<li>The NVT is a half-duplex device operating in a line-buffered mode.</li>
<li>The NVT provides a local echo function. </li>
</ul>
</li>
<li>All of these may be negotiated by the two hosts. </li>
</ul>
<p><img src="go/protocols/img/telnet3.gif" alt="telnet NVT" /></p>
<ul>
<li>An NVT Printer has an unspecified carriage width and page length. It can handle printable ASCII characters (ASCII code 32 to 126) and understands some ASCII control characters such as: </li>
</ul>
<p><img src="go/protocols/img/telnet4.gif" alt="telnet control" /></p>
<h1><a class="header" href="#telnet-command-structure" id="telnet-command-structure">TELNET Command Structure</a></h1>
<ul>
<li>All internal TELNET commands consist of 2 or 3-byte sequences, depending on the command type.</li>
<li>The Interpret As Command (IAC) character is followed by a command code. If this command deals with option negotiation, the command will have a third byte to show the code for the referenced option. </li>
</ul>
<p><img src="go/protocols/img/telnet7.gif" alt="telnet cmd" /></p>
<ul>
<li>The key point is that, in order for any byte to be accepted as a command, it must be preceded by a byte with value 255 - &quot;Interpret as Command&quot; (IAC). Otherwise, the server program assumes that that byte is simply data that will be understood by the application program. </li>
<li>This command proposes negotiation about terminal type. </li>
</ul>
<p><img src="go/protocols/img/telnet8.gif" alt="telnet cmd2" /></p>
<h1><a class="header" href="#option-negotiation" id="option-negotiation">Option Negotiation</a></h1>
<ul>
<li>Using internal commands, TELNET in each host is able to negotiate options.</li>
<li>The starting base of negotiation is the NVT capability: each host to be connected must agree to this minimum.</li>
<li>Every option can be negotiated by the use of the four command codes WILL, WON'T, DO, DON'T described above.</li>
<li>In addition, some options have sub-options: if both parties agree to the option, they use the SB and SE commands to manage the sub-negotiation.</li>
<li>Here is a simplified example of how option negotiation works. </li>
</ul>
<p><img src="go/protocols/img/telnet9.gif" alt="option negotiation" /></p>
<ul>
<li>To use an option, the client and server must negotiate and agree to use it. The tools for negotiation are the commands we've already talked about. One side - usually, but not always, the client - sends a &quot;WILL X&quot; packet (WILL is decimal value 251), where X is the option it wants to use (numeric values for X are given on p. 373). The other side will respond with a DO X or a DON'T X, depending on whether it is willing to support the option.</li>
<li>Alternatively, the first side could send a &quot;DO X&quot; packet, in which case the response is either &quot;WILL X&quot; or &quot;WON'T X&quot;.</li>
<li>TELNET is one of the programs that requires the TCP Urgent Data function, because buffers may fill up (for example, if a program being executed is in an infinite loop), and the server's program will stop reading data - including the &quot;IP&quot; command the user sent after he realized what was happening. The packet with the &quot;Terminate&quot; command can be sent as &quot;urgent data&quot; at the TCP level; that will bypass the standard TCP flow controls and enable an out-of-control process to be stopped. </li>
</ul>
<h1><a class="header" href="#telnet-basic-commands" id="telnet-basic-commands">TELNET Basic Commands</a></h1>
<ul>
<li>The primary goal of the TELNET protocol is the provision of a standard interface for hosts over a network.</li>
<li>To allow the connection to start, the TELNET protocol defines a standard representation for some functions: </li>
</ul>
<pre><code>  IP     Interrupt Process 
  AO     Abort Output 
  AYT    Are You There 
  EC     Erase Character 
  EL     Erase Line 
  SYNCH  Synchronize 
  QUIT   quit session 
</code></pre>
<h1><a class="header" href="#yet-another-review-of-telnet" id="yet-another-review-of-telnet">Yet another review of TELNET</a></h1>
<pre><code>   Commands      Code No.   Description 
                 Dec Hex 
   ----------------------------------------------------------------
   data                     All terminal input/output data. 
   End subNeg    240 FO     End of option subnegotiation command. 
   No Operation  241 F1     No operation command. 
   Data Mark     242 F2     End of urgent data stream. 
   Break         243 F3     Operator pressed the Break key or the
                            Attention key. 
   Int process   244 F4     Interrupt current process. 
   Abort output  245 F5     Cancel output from current process. 
   You there?    246 F6     Request acknowledgment. 
   Erase char    247 F7     Request that operator erase the previous
                              character. 
   Erase line    248 F8     Request that operator erase the previous
                              line. 
   Go ahead!     249 F9     End of input for half-duplex connections.
   SubNegotiate  250 FA     Begin option subnegotiation. 
   Will Use      251 FB     Agreement to use the specified option. 
   Won’t Use     252 FC     Reject the proposed option. 
   Start use     253 FD     Request to start using specified option. 
   Stop Use      254 FE     Demand to stop using specified option. 
   IAC           255 FF     Interpret as command. 
</code></pre>
<ul>
<li>Each negotiable option has an ID, which immediately follows the command for option negotiation, that is, IAC: command, option code. Following is a list of TELNET option codes: </li>
</ul>
<pre><code>   Option ID     Option Codes     Description 
   Dec Hex
   -------------------------------------------------------------------
    0  0         Binary Xmit      Allows transmission of binary data. 
    1  1         Echo Data        Causes server to echo back
                                  all keystrokes.
    2  2         Reconnect        Reconnects to another TELNET host. 
    3  3         Suppress GA      Disables Go Ahead! command. 
    4  4         Message Sz       Conveys approximate message size. 
    5  5         Opt Status       Lists status of options. 
    6  6         Timing Mark      Marks a data stream position for
                                  reference. 
    7  7         R/C XmtEcho      Allows remote control of terminal
                                  printers. 
    8  8         Line Width       Sets output line width. 
    9  9         Page Length      Sets page length in lines. 
   10  A        CR Use            Determines handling of carriage returns. 
   11  B        Horiz Tabs        Sets horizontal tabs. 
   12  C        Hor Tab Use       Determines handling of horizontal tabs. 
   13  D        FF Use            Determines handling of form feeds. 
   14  E        Vert Tabs         Sets vertical tabs. 
   15  F        Ver Tab Use       Determines handling of vertical tabs. 
   16 10       Lf Use             Determines handling of line feeds. 
   17 11       Ext ASCII          Defines extended ASCII characters. 
   18 12       Logout             Allows for forced log-off. 
   19 13       Byte Macro         Defines byte macros. 
   20 14       Data Term          Allows subcommands for Data Entry to
                                  be sent. 
   21 15       SUPDUP             Allows use of SUPDUP display protocol. 
   22 16       SUPDUP Outp        Allows sending of SUPDUP output. 
   23 17       Send Locate        Allows terminal location to be sent. 
   24 18       Term Type          Allows exchange of terminal type
                                  information. 
   25 19       End Record         Allows use of the End of record code
                                  (0xEF). 
   26 1A       TACACS ID          User ID exchange used to avoid more
                                  than 1 log-in. 
   27 1B       Output Mark        Allows banner markings to be sent on
                                  output. 
   28 1C       Term Loc#          A numeric ID used to identify terminals. 
   29 1D       3270 Regime        Allows emulation of 3270 family
                                  terminals. 
   30 1E       X.3 PAD            Allows use of X.3 protocol emulation. 
   31 1F       Window Size        Conveys window size for emulation
                                  screen. 
   32 20       Term Speed         Conveys baud rate information. 
   33 21       Remote Flow        Provides flow control (XON, XOFF). 
   34 22       Linemode           Provides linemode bulk character
                                  transactions. 
   255 FF      Extended           options list  Extended options list. 
</code></pre>
<h1><a class="header" href="#ftp" id="ftp">FTP</a></h1>
<h1><a class="header" href="#links-124" id="links-124">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/File_Transfer_Protocol">File Transfer Protocol - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_FTP_commands">List of FTP commands - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_FTP_server_return_codes">List of FTP server return codes - Wikipedia</a></li>
<li><a href="https://www.ietf.org/rfc/rfc959.txt">ietf.org/rfc/rfc959.txt Page 36</a></li>
</ul>
<p>ftp是一个Request-Response的基于文本的协议。</p>
<h1><a class="header" href="#q" id="q">Q</a></h1>
<p>我有一个疑问，送LIST, PWD...Cmd, 结果是通过哪种方式返回的，是在textproto.Conn里返回的，还是在net.Conn里返回的？</p>
<p><strong>A:</strong> </p>
<p>PWD是在msg里返回的。而LIST的结果是建立新的连接返回的，甚至不是在原来的net.Conn里。</p>
<p>那么不有法直接在原来的net.Conn里传输数据呢？</p>
<pre><code class="language-go">// CurrentDir issues a PWD FTP command, which Returns the path of the current
// directory.
func (c *ServerConn) CurrentDir() (string, error) {
	_, msg, err := c.cmd(StatusPathCreated, &quot;PWD&quot;)
	if err != nil {
		return &quot;&quot;, err
	}

	start := strings.Index(msg, &quot;\&quot;&quot;)
	end := strings.LastIndex(msg, &quot;\&quot;&quot;)

	if start == -1 || end == -1 {
		return &quot;&quot;, errors.New(&quot;Unsuported PWD response format&quot;)
	}

	return msg[start+1 : end], nil
}

// cmdDataConnFrom executes a command which require a FTP data connection.
// Issues a REST FTP command to specify the number of bytes to skip for the transfer.
func (c *ServerConn) cmdDataConnFrom(offset uint64, format string, args ...interface{}) (net.Conn, error) {
	conn, err := c.openDataConn()
	if err != nil {
		return nil, err
	}

	if offset != 0 {
		_, _, err := c.cmd(StatusRequestFilePending, &quot;REST %d&quot;, offset)
		if err != nil {
			conn.Close()
			return nil, err
		}
	}

	_, err = c.conn.Cmd(format, args...)
	if err != nil {
		conn.Close()
		return nil, err
	}

	code, msg, err := c.conn.ReadResponse(-1)
	if err != nil {
		conn.Close()
		return nil, err
	}
	if code != StatusAlreadyOpen &amp;&amp; code != StatusAboutToSend {
		conn.Close()
		return nil, &amp;textproto.Error{Code: code, Msg: msg}
	}

	return conn, nil
}
</code></pre>
<h1><a class="header" href="#ftp-replies" id="ftp-replies">FTP REPLIES</a></h1>
<p>GO的textproto包里的 <a href="https://golang.org/pkg/net/textproto/#Reader.ReadResponse">func (*Reader) ReadResponse</a> 遵循这个协议的</p>
<p><code>func (r *Reader) ReadResponse(expectCode int) (code int, message string, err error)</code></p>
<pre><code># 4.2. FTP REPLIES

  An FTP reply consists of a three digit number (transmitted as
        three alphanumeric characters) followed by some text.

  A reply is defined to contain the 3-digit code, followed by Space
  &lt;SP&gt;, followed by one line of text (where some maximum line length
  has been specified), and terminated by the Telnet end-of-line
  code.  There will be cases however, where the text is longer than
  a single line. 

     Thus the format for multi-line replies is that the first line
     will begin with the exact required reply code, followed
     immediately by a Hyphen, &quot;-&quot; (also known as Minus), followed by
     text.  The last line will begin with the same code, followed
     immediately by Space &lt;SP&gt;, optionally some text, and the Telnet
     end-of-line code.

        For example:
</code></pre>
<pre><code>                                123-First line
                                Second line
                                  234 A line beginning with numbers
                                123 The last line
</code></pre>
<pre><code>     The user-process then simply needs to search for the second
     occurrence of the same reply code, followed by &lt;SP&gt; (Space), at
     the beginning of a line, and ignore all intermediary lines.  If
     an intermediary line begins with a 3-digit number, the Server
     must pad the front  to avoid confusion.

     There are five values for the first digit of the reply code:

    1yz   Positive Preliminary reply
    2yz   Positive Completion reply
    3yz   Positive Intermediate reply
    4yz   Transient Negative Completion reply
    5yz   Permanent Negative Completion reply
</code></pre>
<h1><a class="header" href="#yaml" id="yaml">YAML</a></h1>
<p>YAML stands for &quot;YAML Ain't Markup Language&quot; </p>
<h1><a class="header" href="#links-125" id="links-125">Links</a></h1>
<ul>
<li><a href="https://learn.getgrav.org/advanced/yaml">YAML Syntax | Grav Documentation</a></li>
<li><a href="https://squarism.com/2014/10/13/yaml-go/">YAML and Maps in Go | □▢ SQUARISM</a></li>
</ul>
<h1><a class="header" href="#basic-rules" id="basic-rules">Basic Rules</a></h1>
<ul>
<li>YAML files should end in .yaml whenever possible in Grav.</li>
<li>YAML is case sensitive.</li>
<li>YAML <strong>does not allow the use of tabs</strong>. Spaces are used instead as tabs are not universally supported.</li>
</ul>
<h1><a class="header" href="#basic-data-types" id="basic-data-types">Basic Data Types</a></h1>
<p>YAML excels at working with <strong>mappings</strong> (hashes / dictionaries), <strong>sequences</strong> (arrays / lists), and <strong>scalars</strong> (strings / numbers). </p>
<h1><a class="header" href="#scalars" id="scalars">Scalars</a></h1>
<pre><code>integer: 25
string: &quot;25&quot;
float: 25.0
boolean: Yes
</code></pre>
<h1><a class="header" href="#sequences" id="sequences">Sequences</a></h1>
<pre><code>- Cat
- Dog
- Goldfish
</code></pre>
<p><strong>nested sequence:</strong></p>
<pre><code>-
 - Cat
 - Dog
 - Goldfish
-
 - Python
 - Lion
 - Tiger
</code></pre>
<h1><a class="header" href="#mappings" id="mappings">Mappings</a></h1>
<ul>
<li>Block list items include same indentation as the surrounding block level
because <code>-</code> is considered as a part of indentation.</li>
</ul>
<pre><code>animal: pets
</code></pre>
<pre><code>pets:
 - Cat
 - Dog
 - Goldfish
</code></pre>
<h2><a class="header" href="#tricky" id="tricky">Tricky</a></h2>
<pre><code>fruits:
  apple:
    - red

------------------
Fruits map[string][]string
// Fruits have properties.  You have success.
</code></pre>
<pre><code>fruits:
  - apple:
    - red

------------------
Fruits []map[string][]string
// There are more fruits now.  Good job, fruit adventurer.
</code></pre>
<p>This is because apple has become an array value and not a key. </p>
<p>In other words, we can have many apples in the second example but not the first. </p>
<p>为什么第一个不是：</p>
<pre><code class="language-go">type Anything struct {
	Fruits map[string][]string
}
</code></pre>
<p>而第二个不是：</p>
<pre><code class="language-go">type Anything struct {
	Fruits []map[string][]string
}
</code></pre>
<h2><a class="header" href="#an-example" id="an-example">An Example</a></h2>
<pre><code class="language-go">type A struct {
        B string
        C int
}

type AS struct {
        As
}

type As []A

func main() {

        var as = As{{&quot;zhang1&quot;, 1}, {&quot;zhang2&quot;, 2}, {&quot;zhang3&quot;, 3}}
        var aS = AS{As{{&quot;zhang1&quot;, 1}, {&quot;zhang2&quot;, 2}, {&quot;zhang3&quot;, 3}}}

        b, err := yaml.Marshal(as)
        if err != nil {
                log.Fatal(err)
        }

        fmt.Println(string(b))
        fmt.Println()

        bS, err := yaml.Marshal(aS)

        if err != nil {
                log.Fatal(err)
        }

        fmt.Println(string(bS))

}
/* output:
- b: zhang1
  c: 1
- b: zhang2
  c: 2
- b: zhang3
  c: 3


as:
- b: zhang1
  c: 1
- b: zhang2
  c: 2
- b: zhang3
  c: 3
*/
</code></pre>
<h1><a class="header" href="#x509" id="x509">X.509</a></h1>
<h1><a class="header" href="#links-126" id="links-126">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/X.509">X.509 - Wikipedia</a></li>
<li><a href="https://www.blackhat.com/presentations/bh-usa-99/EdGerck/certover.pdf">certover.pdf</a> </li>
<li><a href="https://rehn.me/posts/pki-for-busy-people.html">PKI for busy people</a></li>
</ul>
<h1><a class="header" href="#overview-19" id="overview-19">Overview</a></h1>
<p>Of course, a private communication with a thief is not secure just because it
is private.</p>
<p>Absolute certification methods are a logical impossibility, because
a certificate cannot certify itself.</p>
<h1><a class="header" href="#what-problem-x509-solved" id="what-problem-x509-solved">What problem X.509 solved</a></h1>
<p>The problem here is, when you send messages to someone encryption with his
public key, or  verify messages with the public key, , How do you <strong>TRUST</strong> the
public key you got is really his ?, That is,</p>
<p>You need to know the bank is the bank, and, the bank need to know that you are
you.</p>
<h1><a class="header" href="#basics" id="basics">Basics</a></h1>
<p>They allow doing two things:</p>
<ul>
<li>Encrypt a message with the public key, decrypt it with the private key</li>
<li>Sign a message with the private key, verify it with the public key</li>
</ul>
<h2><a class="header" href="#what-is-it-x509" id="what-is-it-x509">what is it, X.509</a></h2>
<p>It’s a flexible format for representing certificates.</p>
<p><code>X.509</code> certificates are written in <code>ASN.1</code>. The ASN.1 is usually serialized
into <code>DER</code>. Since binary data can be a pain to transmit, it’s often further
encoded into <code>PEM</code>. PEM is essentially just <code>Base64-encoded</code> DER.</p>
<p><strong>it assumes we trust the CAs</strong></p>
<h2><a class="header" href="#what-is-certificate" id="what-is-certificate">What is Certificate</a></h2>
<h2><a class="header" href="#structure-of-a-certificate" id="structure-of-a-certificate">Structure of a certificate</a></h2>
<pre><code>    Certificate
        Version Number
        Serial Number
        Signature Algorithm ID
        Issuer Name
        Validity period
            Not Before
            Not After
        Subject name
        Subject Public Key Info
            Public Key Algorithm
            Subject Public Key
        Issuer Unique Identifier (optional)
        Subject Unique Identifier (optional)
        Extensions (optional)
            ...
    Certificate Signature Algorithm
    Certificate Signature
</code></pre>
<h2><a class="header" href="#what-is-certificaterequest" id="what-is-certificaterequest">What is CertificateRequest</a></h2>
<h2><a class="header" href="#what-is-pki" id="what-is-pki">What is PKI</a></h2>
<h1><a class="header" href="#summary" id="summary">Summary</a></h1>
<ol>
<li>With someone’s public key, we can verify their signatures and send them
encrypted messages</li>
<li>With our private key, we can sign messages and decrypt messages sent to us<br />
It works unless our public key is certified by a <strong>trusted</strong> CA. </li>
<li>Certificates identify public key owners</li>
<li>We trust a certificate because we trust the CA that signed it
So, be careful with your brower, It may have <strong>untrusted</strong> CA in it.</li>
<li>We trust the CA because Apple/Google/Microsoft/whoever added the CA’s
certificate on the server/etc. trusts them</li>
</ol>
<h1><a class="header" href="#ssh" id="ssh">SSH</a></h1>
<h1><a class="header" href="#links-127" id="links-127">Links</a></h1>
<ul>
<li><a href="https://www.cisco.com/c/en/us/about/press/internet-protocol-journal/back-issues/table-contents-46/124-ssh.html">Protocol Basics: Secure Shell Protocol - The Internet Protocol Journal, Volume 12, No.4 - Cisco</a></li>
<li><a href="https://tools.ietf.org/html/rfc4251">RFC 4251 - The Secure Shell (SSH) Protocol Architecture</a></li>
<li><a href="https://tools.ietf.org/html/rfc4252">RFC 4252 - The Secure Shell (SSH) Authentication Protocol</a></li>
<li><a href="https://tools.ietf.org/html/rfc4253">RFC 4253 - The Secure Shell (SSH) Transport Layer Protocol</a></li>
<li><a href="https://tools.ietf.org/html/rfc4254">RFC 4254 - The Secure Shell (SSH) Connection Protocol</a></li>
</ul>
<h1><a class="header" href="#packet" id="packet">Packet</a></h1>
<pre><code>Each packet is in the following format:

	uint32    packet_length
	byte      padding_length
	byte[n1]  payload; n1 = packet_length - padding_length - 1
	byte[n2]  random padding; n2 = padding_length
	byte[m]   mac (Message Authentication Code - MAC); m = mac_length
</code></pre>
<p><img src="go/protocols/img/124_ssh_fig03_lg.jpg" alt="ssh" /></p>
<p>From: <a href="https://www.cisco.com/c/dam/en_us/about/ac123/ac147/images/ipj/ipj_12-4/124_ssh_fig03_lg.jpg">https://www.cisco.com/c/dam/en_us/about/ac123/ac147/images/ipj/ipj_12-4/124_ssh_fig03_sm.jpg</a></p>
<h1><a class="header" href="#steps" id="steps">Steps</a></h1>
<p><img src="go/protocols/img/124_ssh_fig02_sm.jpg" alt="steps" /></p>
<p>From: <a href="https://www.cisco.com/c/dam/en_us/about/ac123/ac147/images/ipj/ipj_12-4/124_ssh_fig02_lg.jpg">https://www.cisco.com/c/dam/en_us/about/ac123/ac147/images/ipj/ipj_12-4/124_ssh_fig02_sm.jpg</a></p>
<h1><a class="header" href="#architecture" id="architecture">Architecture</a></h1>
<pre><code>It consists of three major components:

o  The Transport Layer Protocol [SSH-TRANS] provides server
	authentication, confidentiality, and integrity.  It may optionally
	also provide compression.  The transport layer will typically be
	run over a TCP/IP connection, but might also be used on top of any
	other reliable data stream.

o  The User Authentication Protocol [SSH-USERAUTH] authenticates the
	client-side user to the server.  It runs over the transport layer
	protocol.

o  The Connection Protocol [SSH-CONNECT] multiplexes the encrypted
	tunnel into several logical channels.  It runs over the user
	authentication protocol.
</code></pre>
<h2><a class="header" href="#host-keys" id="host-keys">Host Keys</a></h2>
<p>The way we normally use ssh are wrong.</p>
<pre><code>Two different trust models can be used:

o  The client has a local database that associates each host name (as
	typed by the user) with the corresponding public host key.  This
	method requires no centrally administered infrastructure, and no
	third-party coordination.  The downside is that the database of
	name-to-key associations may become burdensome to maintain.

o  The host name-to-key association is certified by a trusted
	certification authority (CA).  The client only knows the CA root
	key, and can verify the validity of all host keys certified by
	accepted CAs.
</code></pre>
<h1><a class="header" href="#utils" id="utils">Utils</a></h1>
<p><strong>不会写代码,读读代码都开心的.</strong></p>
<h1><a class="header" href="#cfssl" id="cfssl">cfssl</a></h1>
<h1><a class="header" href="#links-128" id="links-128">Links</a></h1>
<ul>
<li><a href="https://github.com/cloudflare/cfssl">GitHub - cloudflare/cfssl: CFSSL: Cloudflare's PKI and TLS toolkit</a></li>
</ul>
<h1><a class="header" href="#meshbird" id="meshbird">meshbird</a></h1>
<p>If you want to understand something, you always need to get the <strong>structure</strong>
of the thing.</p>
<h1><a class="header" href="#links-129" id="links-129">Links</a></h1>
<ul>
<li><a href="https://github.com/meshbird/meshbird">meshbird/meshbird: Distributed private networking</a></li>
</ul>
<h1><a class="header" href="#overview-20" id="overview-20">Overview</a></h1>
<h1><a class="header" href="#review-1" id="review-1">Review</a></h1>
<p>Structure:</p>
<pre><code class="language-go">a.server = transport.NewServer(a.config.BindAddrs, a, a.config.Key)
a.bootstrap()

go a.server.Start()
return a.runIface()
</code></pre>
<h1><a class="header" href="#func-bootstrap" id="func-bootstrap">func bootstrap</a></h1>
<p>What does bootstrap do is <code>func NewPeer</code> and do <code>peer.Start()</code></p>
<pre><code class="language-go">peer := NewPeer([]string{seedAddr}, a.config, a.getRoutes)
peer.Start()

func (p *Peer) Start() {
	p.client.Start()
	go p.process()
}
</code></pre>
<h2><a class="header" href="#type-peer-struct" id="type-peer-struct">type Peer struct</a></h2>
<p>Why peer do <code>SendPing()</code> every second ?</p>
<h2><a class="header" href="#func-c-client-start" id="func-c-client-start">func (c *Client) Start()</a></h2>
<pre><code class="language-go">for _, remoteAddr := range c.remoteAddrs {
			c.wg.Add(1)
			conn := NewClientConn(remoteAddr, c.key, connIndex, &amp;c.wg)
			c.conns[connIndex] = conn
			go c.conns[connIndex].run()
		}
</code></pre>
<h1><a class="header" href="#type-clientconn-struct" id="type-clientconn-struct">type ClientConn struct</a></h1>
<ul>
<li>The method <code>func (cc *ClientConn) run()</code> really do is run <code>func (cc *ClientConn) process() error</code></li>
<li>What <code>func ( cc *ClientConn) process()</code> do is get data from it's embeded
<code>chan []byte</code>, then write to it's <code>*net.TCPConn</code> field, and I think the
implementation of this <code>write()</code> method is not beautiful.</li>
</ul>
<p>The protocol is:</p>
<pre><code>|--------|--------|------|
| secure | length | data |
|--------|--------|------|
| 1      | 2      | N    |
|--------|--------|------|
</code></pre>
<h1><a class="header" href="#go-aserverstart" id="go-aserverstart">go a.server.Start()</a></h1>
<p>What it does is just <code>s.listen(tcpAddr)</code> on <code>config.BindAddrs</code>.</p>
<p>what <code>s.listen</code> do is <code>go serverConn.run()</code></p>
<pre><code class="language-go">func (sc *ServerConn) run() {
	...
	sc.handler.OnData(data)
	...
}
</code></pre>
<h1><a class="header" href="#func-a-app-ondatabuf-byte" id="func-a-app-ondatabuf-byte">func (a *App) OnData(buf []byte)</a></h1>
<h1><a class="header" href="#func-a-app-runiface-error" id="func-a-app-runiface-error">func (a *App) runIface() error</a></h1>
<h1><a class="header" href="#a-hrefhttpsgithubcomshadowsocksgo-shadowsocks2go-shadowsocks2a" id="a-hrefhttpsgithubcomshadowsocksgo-shadowsocks2go-shadowsocks2a"><a href="https://github.com/shadowsocks/go-shadowsocks2">go-shadowsocks2</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgithubcomsebdahmarkdown-tocsebdahmarkdown-toca" id="a-hrefhttpsgithubcomsebdahmarkdown-tocsebdahmarkdown-toca"><a href="https://github.com/sebdah/markdown-toc">sebdah/markdown-toc</a></a></h1>
<h1><a class="header" href="#question" id="question">Question</a></h1>
<ul>
<li>构建toc是先读出文件,再对读出的字节串转换成读接口,再套上扫描器类型,我觉得直接在文件上套上扫描器类型是不是更好</li>
<li>实现上toc是一个字符串的切片,我觉得既然是从文件读出来的,直接处理字节串,而不要转换成字符串是更恰当的方式</li>
</ul>
<h1><a class="header" href="#bug" id="bug">Bug</a></h1>
<ul>
<li>代码块里的#会被当作标题</li>
<li>Toc内部的Toc头在替换的时候被当作标题</li>
<li>如果标量末尾有空白是会有问题的</li>
</ul>
<h1><a class="header" href="#fix" id="fix">Fix</a></h1>
<ul>
<li>代码块里的#<br />
可以把代码块标记也读进ToC,最后从上往下把两个代码块标记之间的删除掉,如果只有一个就只删除它自己</li>
<li>如果标量末尾有空白是会有问题的<br />
除掉末尾的空白就好</li>
</ul>
<h1><a class="header" href="#orgalorg" id="orgalorg">orgalorg</a></h1>
<h1><a class="header" href="#links-130" id="links-130">Links</a></h1>
<ul>
<li><a href="https://github.com/reconquest/orgalorg">GitHub - reconquest/orgalorg: Parallel SSH commands executioner and file synchronization tool</a></li>
</ul>
<h1><a class="header" href="#u-root" id="u-root">u-root</a></h1>
<h1><a class="header" href="#links-131" id="links-131">Links</a></h1>
<ul>
<li><a href="https://github.com/u-root/u-root">u-root/u-root</a></li>
</ul>
<h1><a class="header" href="#howto-3" id="howto-3">Howto</a></h1>
<pre><code>go get github.com/u-root/u-root

// arch
sudo pacman -S qemu

// test
qemu-system-x86_64                          \
	-kernel path/to/kernel                  \
	-initrd /tmp/initramfs.linux_amd64.cpio \
	-append 'console=ttyS0'                 \
	--nographic                             \
	-serial mon:stdio 
</code></pre>
<h1><a class="header" href="#issue-with-loading-modules" id="issue-with-loading-modules">Issue with loading modules</a></h1>
<ul>
<li><a href="https://github.com/u-root/u-root/issues/1214">modprobe fails inside u-root shell · Issue #1214 · u-root/u-root · GitHub</a></li>
</ul>
<pre><code>cp -RLp /lib/modules/`uname -r` /tmp/modules
unxz `find -name '*.ko.xz' /tmp/modules`

// -format=cpio and -build=source are the default flag values.
u-root                              \
-files `which depmod`               \
-files `which modprobe`             \
-files /lib/modules/`uname -r`      \
-files /tmp/modules:mytmp           \
-files /usr/bin/vim                 \
-files /bin/nano                    \
-files /usr/share/terminfo/l/linux  \
-o initramfs-sluinit-files.cpio     \
./cmds/* ./examples/sluinit
</code></pre>
<h1><a class="header" href="#how-to-add-init-scripts-or-extend-init-process" id="how-to-add-init-scripts-or-extend-init-process">How to add init scripts or extend init process?</a></h1>
<ul>
<li><a href="https://github.com/u-root/u-root/issues/569#issuecomment-359951972">How to add init scripts or extend init process? · Issue #569 · u-root/u-root · GitHub</a></li>
</ul>
<p>Use <a href="https://github.com/hashicorp/go-plugin">hashicorp/go-plugin: Golang plugin system over RPC.</a></p>
<p>or</p>
<p>Include any Go command named <code>uinit</code>.</p>
<p>And this:</p>
<p><a href="https://github.com/u-root/u-root/issues/60#issuecomment-364807661">U-root Init Proposal</a></p>
<h2><a class="header" href="#type-servicer-interface" id="type-servicer-interface">type Servicer interface</a></h2>
<pre><code class="language-go">type Servicer interface {
	Start() error
	Stop() error
	Reload() error
	Restart() error
	Status() state.Value
	Unit() Unit
}
</code></pre>
<p>Currently state:</p>
<p>Sat Oct 19 22:46:29 CST 2019</p>
<ul>
<li><a href="https://github.com/u-root/u-root/issues/615">bb mode: move init out of bb-specific code · Issue #615 · u-root/u-root · GitHub</a></li>
<li><a href="https://github.com/u-root/u-root/pull/708">De-couple bb mode from init and rush. Add standalone makebb tool. by hugelgupf · Pull Request #708 · u-root/u-root · GitHub</a></li>
</ul>
<h1><a class="header" href="#uinit" id="uinit">uinit</a></h1>
<ul>
<li><a href="https://github.com/u-root/u-root#systemboot">systemboot</a></li>
<li><a href="https://godoc.org/github.com/u-root/u-root/pkg/uroot">uroot - GoDoc</a></li>
</ul>
<h1><a class="header" href="#sweet" id="sweet">sweet</a></h1>
<h1><a class="header" href="#links-132" id="links-132">Links</a></h1>
<ul>
<li><a href="https://github.com/AppliedTrust/sweet">GitHub - AppliedTrust/sweet: Network device configuration backups and change alerts for the 21st century - inspired by RANCID!</a></li>
</ul>
<h1><a class="header" href="#overview-21" id="overview-21">Overview</a></h1>
<p>一个简单的项目，设计一般，架构清晰。宣称 for the 21st ... 就有么...</p>
<p>ssh的方式使的是<code>exec.Command(&quot;ssh&quot;, args...)</code>有么难瞅，并且不支持telnet协议</p>
<p>其对log的处理方式我感觉还蛮好，<code>expectMulti(string...)</code>设计不错</p>
<p>bad</p>
<h1><a class="header" href="#jazigo" id="jazigo">jazigo</a></h1>
<h1><a class="header" href="#links-133" id="links-133">Links</a></h1>
<ul>
<li><a href="https://github.com/udhos/jazigo">GitHub - udhos/jazigo</a></li>
</ul>
<h1><a class="header" href="#overview-22" id="overview-22">Overview</a></h1>
<p>代码质量相当差。</p>
<p>接口的使法，log的处理，函数的设计，代码的风格，完全是乱七八糟，一塌糊涂。</p>
<p>这个项目名字听起来就像夹边沟。一个危险的名字。</p>
<h1><a class="header" href="#details" id="details">Details</a></h1>
<p>funny interface name</p>
<pre><code class="language-go">type hasPrintf interface {
	Printf(fmt string, v ...interface{})
}
</code></pre>
<p>我不喜欢这个结构，我觉得它至少应该包含一个<code>Body</code>才算是一个<code>Request</code>.</p>
<p>OK, 所以这个名字才叫<code>FetchRequest</code>, 而并不是<code>Request</code>. kind of signal.</p>
<pre><code class="language-go">// FetchRequest is a request for fetching a device configuration.
type FetchRequest struct {
	ID        string           // fetch this device
	ReplyChan chan FetchResult // reply on this channel
}
</code></pre>
<p><code>func Scan</code> just write a FetchRequest with deviceid and response channel into
the reqChan. and this reqChan is like a global valuable. I don't like it.  It's
hard to debug.</p>
<p>I don't like a function named <code>XXXer</code>. <code>func xxxer</code> just make nonsense.</p>
<p>所有函数都是这么一长串的参数，真的是瞅得就头痛。</p>
<p>烦躁。Sigh...</p>
<pre><code class="language-go">func Spawner(tab DeviceUpdater, logger hasPrintf, reqChan chan FetchRequest, repository, logPathPrefix string, options *conf.Options, ft *FilterTable) 
go d.Fetch(tab, logger, replyChan, 0, repository, logPathPrefix, opt, ft) // spawn per-request goroutine
func Scan(tab DeviceUpdater, devices []*Device, logger hasPrintf, opt *conf.AppConfig, reqChan chan FetchRequest) (int, int, int)
</code></pre>
<p>看不下去了。</p>
<h1><a class="header" href="#webdev" id="webdev">webdev</a></h1>
<h1><a class="header" href="#links-134" id="links-134">Links</a></h1>
<ul>
<li><a href="https://lets-go.alexedwards.net/">Let's Go! A start-to-finish guide on building web applications with Go</a></li>
<li><a href="https://www.alexedwards.net/blog/validation-snippets-for-go">Validation Snippets for Go - Alex Edwards</a></li>
</ul>
<h1><a class="header" href="#overview-23" id="overview-23">Overview</a></h1>
<h1><a class="header" href="#middleware" id="middleware">Middleware</a></h1>
<ul>
<li><a href="https://medium.com/@matryer/writing-middleware-in-golang-and-how-go-makes-it-so-much-fun-4375c1246e81">Writing middleware in #golang and how Go makes it so much fun.</a></li>
</ul>
<h1><a class="header" href="#ui" id="ui">UI</a></h1>
<ul>
<li><a href="https://divan.dev/posts/flutter_go/">Thought Experiment: Flutter in Go · divan's blog</a></li>
</ul>
<h1><a class="header" href="#representational-state-transfer-rest" id="representational-state-transfer-rest">Representational state transfer (REST)</a></h1>
<h1><a class="header" href="#links-135" id="links-135">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Representational_state_transfer#Architectural_constraints">Representational state transfer - Wikipedia</a></li>
</ul>
<h1><a class="header" href="#overview-24" id="overview-24">Overview</a></h1>
<h1><a class="header" href="#organising-database-access" id="organising-database-access">Organising Database Access</a></h1>
<h1><a class="header" href="#links-136" id="links-136">Links</a></h1>
<ul>
<li><a href="https://www.alexedwards.net/blog/organising-database-access">Practical Persistence in Go: Organising Database Access - Alex Edwards</a></li>
</ul>
<h1><a class="header" href="#overview-25" id="overview-25">Overview</a></h1>
<p>In general, it is good practice to inject dependencies into your handlers. </p>
<h1><a class="header" href="#closures-for-dependency-injection" id="closures-for-dependency-injection">Closures for Dependency Injection</a></h1>
<p>Since method form of handlers can't spread across multiple packages. so that's
a bad practice. In that case, an alternative approach is to create a config
package exporting an Application struct and have your handler functions close
over this to form a closure. Very roughly:</p>
<pre><code class="language-go">func main() {
    app := &amp;config.Application{
        ErrorLog: log.New(os.Stderr, &quot;ERROR\t&quot;, log.Ldate|log.Ltime|log.Lshortfile)
    }

    mux.Handle(&quot;/&quot;, handlers.Home(app))
}

func Home(app *config.Application) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        ...
        ts, err := template.ParseFiles(files...)
        if err != nil {
            app.ErrorLog.Println(err.Error())
            http.Error(w, &quot;Internal Server Error&quot;, 500)
            return
        }
        ...
    }
}
</code></pre>
<p>also see: <a href="https://gist.github.com/alexedwards/5cd712192b4831058b21">_tree · GitHub</a></p>
<h1><a class="header" href="#routers" id="routers">Routers</a></h1>
<h1><a class="header" href="#links-137" id="links-137">Links</a></h1>
<p>Recommendation by Order:</p>
<p>go-chi/chi</p>
<ul>
<li><a href="https://godoc.org/github.com/go-chi/chi">chi - GoDoc</a></li>
<li><a href="https://github.com/go-chi/chi">go-chi/chi: lightweight, idiomatic and composable router for building Go HTTP services</a></li>
</ul>
<p>gorilla/mux</p>
<ul>
<li><a href="https://godoc.org/github.com/gorilla/mux">mux - GoDoc</a></li>
<li><a href="https://github.com/gorilla/mux">gorilla/mux: A powerful HTTP router and URL matcher for building Go web servers with 🦍</a></li>
</ul>
<p>go-zoo/bone</p>
<ul>
<li><a href="https://godoc.org/github.com/go-zoo/bone">bone - GoDoc</a></li>
<li><a href="https://github.com/go-zoo/bone">go-zoo/bone: Lightning Fast HTTP Multiplexer</a></li>
</ul>
<p>bmizerany/pat</p>
<ul>
<li><a href="https://godoc.org/github.com/bmizerany/pat">pat - GoDoc</a></li>
<li><a href="https://github.com/bmizerany/pat">bmizerany/pat</a></li>
</ul>
<p>Alternative Routers:</p>
<ul>
<li>
<p><a href="https://github.com/julienschmidt/httprouter">julienschmidt/httprouter</a></p>
<p>it can’t cope with <a href="https://github.com/julienschmidt/httprouter/issues/175">conflicting
patterns</a> caused by
wildcard parameters, which can be a problem for applications that are using
a RESTful routing scheme (in our case <code>/snippet/create</code> and <code>/snippet/:id</code>
are conflicting patterns).</p>
</li>
</ul>
<h1><a class="header" href="#overview-26" id="overview-26">Overview</a></h1>
<h1><a class="header" href="#sessions" id="sessions">Sessions</a></h1>
<h1><a class="header" href="#links-138" id="links-138">Links</a></h1>
<ul>
<li>
<p><a href="https://github.com/gorilla/sessions">gorilla/sessions</a></p>
</li>
<li>
<p><a href="https://godoc.org/github.com/gorilla/sessions">sessions - GoDoc</a></p>
</li>
<li>
<p><a href="https://github.com/golangcollege/sessions">golangcollege/sessions</a> </p>
</li>
<li>
<p><a href="https://godoc.org/github.com/golangcollege/sessions">sessions - GoDoc</a></p>
</li>
</ul>
<h1><a class="header" href="#overview-27" id="overview-27">Overview</a></h1>
<h1><a class="header" href="#http" id="http">http</a></h1>
<h1><a class="header" href="#links-139" id="links-139">Links</a></h1>
<ul>
<li><a href="https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#1.2">HAProxy version 2.0.5 - Configuration Manual</a></li>
</ul>
<h1><a class="header" href="#protocol-tls" id="protocol-tls">Protocol TLS</a></h1>
<h1><a class="header" href="#links-140" id="links-140">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Transport_Layer_Security">Transport Layer Security - Wikipedia</a>
Many wonderful resources at end of the article.</li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgnethttppackage-httpa" id="a-hrefhttpsgolangorgpkgnethttppackage-httpa"><a href="https://golang.org/pkg/net/http/">Package http</a></a></h1>
<h1><a class="header" href="#links-141" id="links-141">Links</a></h1>
<ul>
<li><a href="https://polyglot.ninja/golang-making-http-requests/">Golang: Making HTTP Requests – Polyglot.Ninja()</a></li>
<li><a href="https://httpbin.org/">httpbin.org</a></li>
<li><a href="https://mariadesouza.com/2018/11/28/golang-net-http-package/">Golang Net HTTP Package – All Things Tech</a>(<strong>appreciate</strong>)</li>
<li><a href="https://www.nicolasmerouze.com/build-web-framework-golang">Build You Own Web Framework In Go | Nicolas Merouze</a>(<strong>Recommendation</strong>)</li>
<li><a href="https://ipfs.io/ipfs/QmfYeDhGH9bZzihBUDEQbCbTc5k5FZKURMUoUvfmc27BwL/http/index.html">HTTP | Network Programming with Go (golang)</a></li>
<li><a href="https://kev.inburke.com/kevin/golang-json-http/">Encoding and Decoding JSON, with Go’s net/http package | Kevin Burke</a></li>
<li><a href="https://golang.org/doc/articles/wiki/">Writing Web Applications - The Go Programming Language</a></li>
</ul>
<h1><a class="header" href="#related-packages" id="related-packages">Related Packages</a></h1>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgnethttphttputilpackage-httputila" id="a-hrefhttpsgolangorgpkgnethttphttputilpackage-httputila"><a href="https://golang.org/pkg/net/http/httputil/">Package httputil</a></a></h1>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgnethttphttptestpackage-httptesta" id="a-hrefhttpsgolangorgpkgnethttphttptestpackage-httptesta"><a href="https://golang.org/pkg/net/http/httptest/">Package httptest</a></a></h1>
<h1><a class="header" href="#overview-28" id="overview-28">Overview</a></h1>
<h1><a class="header" href="#what-is-servemux" id="what-is-servemux">What is ServeMux?</a></h1>
<p>A ServeMux is a HTTP request multiplexer or router that  matches the incoming
requests with a set of registered patterns and  calls  the associated handler
for that pattern.</p>
<p>simplely saying, a ServeMux is to Handle</p>
<h1><a class="header" href="#tricky-of-handlerfunc" id="tricky-of-handlerfunc">Tricky of HandlerFunc</a></h1>
<p>The HandlerFunc makes it possible for us to pass in any function to make it
a Handler. </p>
<pre><code class="language-go">// The HandlerFunc type is an adapter to allow the use of
// ordinary functions as HTTP handlers. If f is a function
// with the appropriate signature, HandlerFunc(f) is a
// Handler that calls f.
type HandlerFunc func(ResponseWriter, *Request)

// ServeHTTP calls f(w, r).
func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {
	f(w, r)
}
</code></pre>
<h1><a class="header" href="#handefunc-and-handle-and-handlerfunc-and-handler" id="handefunc-and-handle-and-handlerfunc-and-handler">HandeFunc and Handle and HandlerFunc and Handler</a></h1>
<p>HandleFunc needs a pattern and a func</p>
<p>Handle needs a pattern and a Handler</p>
<p>HandlerFunc implements Handler</p>
<p>and Handler is anything that implements ServeHTTP function</p>
<pre><code class="language-go">// A Handler responds to an HTTP request.
type Handler interface {
        ServeHTTP(ResponseWriter, *Request)
}
</code></pre>
<p>All we need to make a handler is to implemented a method with the signature
<code>ServeHTTP(http.ResponseWriter, *http.Request)</code> on it. </p>
<pre><code class="language-go">type home struct {}

func (h *home) ServeHTTP(w http.ResponseWriter, r *http.Request) {
    w.Write([]byte(&quot;This is my home page&quot;))
}

mux := http.NewServeMux()
mux.Handle(&quot;/&quot;, &amp;home{})

// or

func home(w http.ResponseWriter, r *http.Request) {
    w.Write([]byte(&quot;This is my home page&quot;))
}

mux := http.NewServeMux()
mux.Handle(&quot;/&quot;, http.HandlerFunc(home))
// or
mux.HandleFunc(&quot;/&quot;, home)
</code></pre>
<h1><a class="header" href="#type-client-struct" id="type-client-struct">type Client struct</a></h1>
<p><strong>Always Use a Timeout</strong></p>
<p>To make a request with custom headers, use NewRequest and Client.Do. </p>
<p><strong>So that’s it – create a client, create a request and then let the client Do the request.</strong></p>
<pre><code class="language-go">type Client struct {
        Transport RoundTripper
        CheckRedirect func(req *Request, via []*Request) error
        Jar CookieJar
        Timeout time.Duration
}
 

func (c *Client) Do(req *Request) (*Response, error)
func (c *Client) Get(url string) (resp *Response, err error)
func (c *Client) Head(url string) (resp *Response, err error)
func (c *Client) Post(url, contentType string, body io.Reader) (resp *Response, err error)
func (c *Client) PostForm(url string, data url.Values) (resp *Response, err error)
</code></pre>
<h1><a class="header" href="#cookiejar" id="cookiejar">CookieJar</a></h1>
<p>After the first time client.Do(req), The next time client.Do(req), it will add
cookies automatically.</p>
<h1><a class="header" href="#type-request-struct" id="type-request-struct">type Request struct</a></h1>
<p>NewRequest returns a new Request given a method, URL, and optional body.</p>
<p>NewRequest returns a Request suitable for use with Client.Do or Transport.RoundTrip.</p>
<pre><code class="language-go">type Request struct {
	Method string
	URL *url.URL
        Proto      string // &quot;HTTP/1.0&quot;
        ProtoMajor int    // 1
        ProtoMinor int    // 0
	Header Header
	Body io.ReadCloser
	GetBody func() (io.ReadCloser, error) // Go 1.8
	ContentLength int64
	...
}

func NewRequest(method, url string, body io.Reader) (*Request, error)
</code></pre>
<h2><a class="header" href="#func-request-parseform" id="func-request-parseform">func (*Request) ParseForm</a></h2>
<p>ParseForm populates r.Form and r.PostForm. </p>
<pre><code class="language-go">type Request struct {

	...

    // Form contains the parsed form data, including both the URL
    // field's query parameters and the PATCH, POST, or PUT form data.
    // This field is only available after ParseForm is called.
    // The HTTP client ignores Form and uses Body instead.
    Form url.Values

    // PostForm contains the parsed form data from PATCH, POST
    // or PUT body parameters.
    //
    // This field is only available after ParseForm is called.
    // The HTTP client ignores PostForm and uses Body instead.
    PostForm url.Values // Go 1.1

    // MultipartForm is the parsed multipart form, including file uploads.
    // This field is only available after ParseMultipartForm is called.
    // The HTTP client ignores MultipartForm and uses Body instead.
    MultipartForm *multipart.Form

	...
}

func (r *Request) ParseForm() error

</code></pre>
<h2><a class="header" href="#parsing-form-data" id="parsing-form-data">Parsing Form Data</a></h2>
<ol>
<li>First, we need to use the <code>r.ParseForm()</code> method to parse the request body. </li>
<li>We can then get to the form data contained in <code>r.PostForm</code> by using the
<code>r.PostForm.Get()</code> method. </li>
</ol>
<p>Strictly speaking, the <code>r.PostForm.Get()</code> method that we’ve used above only
returns the first value for a specific form field. This means you can’t use it
with form fields which potentially send multiple values, such as a group of
checkboxes.</p>
<p>The underlying type of the <code>r.PostForm</code> map is <code>url.Values</code>, which in turn has
the underlying type <code>map[string][]string</code>. </p>
<pre><code class="language-go">func (v Values) Get(key string) string
    Get gets the first value associated with the given key. If there are no
    values associated with the key, Get returns the empty string. To access
    multiple values, use the map directly.
</code></pre>
<h1><a class="header" href="#type-response-struct" id="type-response-struct">type Response struct</a></h1>
<pre><code class="language-go">func (t *Transport) RoundTrip(req *Request) (*Response, error)

type Response struct {
        Status     string // e.g. &quot;200 OK&quot;
        StatusCode int    // e.g. 200
        Proto      string // e.g. &quot;HTTP/1.0&quot;
        ProtoMajor int    // e.g. 1
        ProtoMinor int    // e.g. 0
	Header Header
	Body io.ReadCloser
	...
}
</code></pre>
<h1><a class="header" href="#what-is-http-referer" id="what-is-http-referer">What is HTTP referer</a></h1>
<p>Referer logging is used to allow websites and web servers to identify where
people are visiting them from, for promotional or statistical purposes.</p>
<p><strong>Caution: The default behaviour of referer leaking puts websites at risk of
privacy and security breaches.</strong></p>
<h1><a class="header" href="#func-error" id="func-error">func Error</a></h1>
<pre><code class="language-go">func Error(w ResponseWriter, error string, code int) {
	w.Header().Set(&quot;Content-Type&quot;, &quot;text/plain; charset=utf-8&quot;)
	w.Header().Set(&quot;X-Content-Type-Options&quot;, &quot;nosniff&quot;)
	w.WriteHeader(code)
	fmt.Fprintln(w, error)
}
</code></pre>
<h1><a class="header" href="#type-header-struct" id="type-header-struct">type Header struct</a></h1>
<pre><code class="language-go">type Header map[string][]string

type Header
    func (h Header) Add(key, value string)
    func (h Header) Clone() Header
    func (h Header) Del(key string)
    func (h Header) Get(key string) string
    func (h Header) Set(key, value string)
    func (h Header) Write(w io.Writer) error
    func (h Header) WriteSubset(w io.Writer, exclude map[string]bool) error
</code></pre>
<p>for <code>json</code>:</p>
<pre><code class="language-go">w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)
w.Write([]byte(`{&quot;name&quot;:&quot;Alex&quot;}`))
</code></pre>
<p>When sending a response Go will automatically set three system-generated
headers for you: <code>Date</code> and <code>Content-Length</code> and <code>Content-Type</code>.</p>
<p>The <code>Del()</code> method doesn’t remove system-generated headers. To suppress these,
you need to access the underlying header map directly and set the value to
<code>nil</code>.  If you want to suppress the Date header, for example, you need to
write:</p>
<pre><code class="language-go">w.Header()[&quot;Date&quot;] = nil
</code></pre>
<h1><a class="header" href="#readtimeout-and-idletimeout" id="readtimeout-and-idletimeout">ReadTimeout and IdleTimeout</a></h1>
<p>One important thing. If you set <code>ReadTimeout</code> but don’t set <code>IdleTimeout</code>, then
<code>IdleTimeout</code> will default to using the same setting as <code>ReadTimeout</code>. </p>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgneturlpackage-urla" id="a-hrefhttpsgolangorgpkgneturlpackage-urla"><a href="https://golang.org/pkg/net/url/">Package url</a></a></h1>
<h1><a class="header" href="#links-142" id="links-142">Links</a></h1>
<ul>
<li><a href="https://www.urlencoder.io/golang/">How to URL Encode a String in Golang | URLEncoder</a></li>
</ul>
<h1><a class="header" href="#basic-4" id="basic-4">Basic</a></h1>
<p>From <a href="https://www.urlencoder.io/golang/">How to URL Encode a String in Golang | URLEncoder</a>:</p>
<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;net/url&quot;
)

func main() {
	// Let's start with a base url
	baseUrl, err := url.Parse(&quot;http://www.mywebsite.com&quot;)
	if err != nil {
		fmt.Println(&quot;Malformed URL: &quot;, err.Error())
		return
	}

	// Add a Path Segment (Path segment is automatically escaped)
	baseUrl.Path += &quot;path with?reserved characters&quot;

	// Prepare Query Parameters
	params := url.Values{}
	params.Add(&quot;q&quot;, &quot;Hello World&quot;)
	params.Add(&quot;u&quot;, &quot;@rajeev&quot;)

	// Add Query Parameters to the URL
	baseUrl.RawQuery = params.Encode() // Escape Query Parameters

	fmt.Printf(&quot;Encoded URL is %q\n&quot;, baseUrl.String())
}
</code></pre>
<h1><a class="header" href="#type-values" id="type-values">type Values</a></h1>
<pre><code class="language-go">type Values map[string][]string
    Values maps a string key to a list of values. It is typically used for query
    parameters and form values. Unlike in the http.Header map, the keys in a
    Values map are case-sensitive.

func ParseQuery(query string) (Values, error)
func (v Values) Add(key, value string)
func (v Values) Del(key string)
func (v Values) Encode() string
func (v Values) Get(key string) string
func (v Values) Set(key, value string)

func (u *URL) Query() Values
    Query parses RawQuery and returns the corresponding values. It silently
    discards malformed value pairs. To check errors use ParseQuery.

// http.Request
type Request struct {
    // URL specifies either the URI being requested (for server requests) or the
    // URL to access (for client requests).
    //
    // For server requests, the URL is parsed from the URI supplied on the
    // Request-Line as stored in RequestURI. For most requests, fields other than
    // Path and RawQuery will be empty. (See RFC 7230, Section 5.3)
    //
    // For client requests, the URL's Host specifies the server to connect to,
    // while the Request's Host field optionally specifies the Host header value to
    // send in the HTTP request.
    URL *url.URL

    // ... other fields elided ...
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgtexttemplatepackage-templatea" id="a-hrefhttpsgolangorgpkgtexttemplatepackage-templatea"><a href="https://golang.org/pkg/text/template/">Package template</a></a></h1>
<h1><a class="header" href="#links-143" id="links-143">Links</a></h1>
<h1><a class="header" href="#text-and-spaces" id="text-and-spaces">Text and spaces</a></h1>
<ul>
<li><code>{{- </code>: all trailing white space is trimmed from the immediately preceding text.</li>
<li><code> -}}</code>: all leading white space is trimmed from the immediately following text. </li>
<li><code>{{-3}}</code>: parses as an action containing the number -3</li>
</ul>
<p>For instance:</p>
<pre><code>&quot;{{23 -}} &lt; {{- 45}}&quot;
</code></pre>
<p>will generate:</p>
<pre><code>&quot;23&lt;45&quot;
</code></pre>
<h1><a class="header" href="#func-template-funcs" id="func-template-funcs">func (*Template) Funcs</a></h1>
<p>Funcs adds the elements of the argument map to the template's function map. It
must be called before the template is parsed. It panics if a value in the map
is not a function with appropriate return type. However, it is legal to
overwrite elements of the map. The return value is the template, so calls can
be chained. </p>
<pre><code class="language-go">func (t *Template) Funcs(funcMap FuncMap) *Template
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgolangorgpkgcryptotlspackage-tlsa" id="a-hrefhttpsgolangorgpkgcryptotlspackage-tlsa"><a href="https://golang.org/pkg/crypto/tls/">Package tls</a></a></h1>
<h1><a class="header" href="#links-144" id="links-144">Links</a></h1>
<ul>
<li><a href="https://golang.org/src/crypto/tls/generate_cert.go">generate_cert.go</a></li>
</ul>
<pre><code class="language-go">go run /usr/local/go/src/crypto/tls/generate_cert.go --host localhost
</code></pre>
<p>`</p>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomjustinasalicealice---godoca" id="a-hrefhttpsgodocorggithubcomjustinasalicealice---godoca"><a href="https://godoc.org/github.com/justinas/alice">alice - GoDoc</a></a></h1>
<h1><a class="header" href="#links-145" id="links-145">Links</a></h1>
<ul>
<li><a href="https://github.com/justinas/alice">justinas/alice: Painless middleware chaining for Go</a> </li>
</ul>
<h1><a class="header" href="#overview-29" id="overview-29">Overview</a></h1>
<p>In short, it transforms</p>
<p><code>Middleware1(Middleware2(Middleware3(App)))</code></p>
<p>to</p>
<p><code>alice.New(Middleware1, Middleware2, Middleware3).Then(App)</code></p>
<h1><a class="header" href="#a-hrefhttpsgithubcomgolanggowikiwebassemblywebassembly--golanggo-wiki--githuba" id="a-hrefhttpsgithubcomgolanggowikiwebassemblywebassembly--golanggo-wiki--githuba"><a href="https://github.com/golang/go/wiki/WebAssembly">WebAssembly · golang/go Wiki · GitHub</a></a></h1>
<h1><a class="header" href="#links-146" id="links-146">Links</a></h1>
<h1><a class="header" href="#where-is-wasm_execjs" id="where-is-wasm_execjs">where is wasm_exec.js</a></h1>
<ul>
<li><a href="https://github.com/golang/go/blob/master/misc/wasm/wasm_exec.js">go/wasm_exec.js at master · golang/go</a></li>
</ul>
<p>and how to load and run compiled Go wasm module:</p>
<ul>
<li><a href="https://siongui.github.io/2018/10/06/load-and-run-golang-wasm-code/">Load and Run Go WebAssembly Module</a></li>
</ul>
<pre><code class="language-javascript">&lt;script src=&quot;wasm_exec.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
      const go = new Go();
      let mod, inst;
      WebAssembly.instantiateStreaming(
              fetch(&quot;mymodule.wasm&quot;, {cache: 'no-cache'}), go.importObject).then((result) =&gt; {
              mod = result.module;
              inst = result.instance;
              run();
      });
      async function run() {
              await go.run(inst);
      };
&lt;/script&gt;
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggiouiorggiouiorg---godoca" id="a-hrefhttpsgodocorggiouiorggiouiorg---godoca"><a href="https://godoc.org/gioui.org">gioui.org - GoDoc</a></a></h1>
<h1><a class="header" href="#links-147" id="links-147">Links</a></h1>
<ul>
<li><a href="https://gioui.org/">Gio - immediate mode GUI in Go</a></li>
</ul>
<h1><a class="header" href="#packages" id="packages">Packages</a></h1>
<ul>
<li>
<p><a href="https://godoc.org/gioui.org/app">app - GoDoc</a></p>
<p>Package app provides a platform-independent interface to operating system
functionality for running graphical user interfaces. </p>
</li>
<li>
<p><a href="https://godoc.org/gioui.org/io/event">event - GoDoc</a></p>
<p>Package event contains the types for event handling. </p>
</li>
<li>
<p><a href="https://godoc.org/gioui.org/unit">unit - GoDoc</a></p>
<p>Package unit implements device independent units and values. </p>
</li>
<li>
<p><a href="https://godoc.org/gioui.org/layout">layout - GoDoc</a></p>
<p>Package layout implements layouts common to GUI programs. </p>
</li>
<li>
<p><a href="https://godoc.org/gioui.org/font/gofont">gofont - GoDoc</a></p>
<p>Package gofont registers the Go fonts in the font registry. </p>
</li>
<li>
<p><a href="https://godoc.org/gioui.org/widget">widget - GoDoc</a></p>
<p>Package widget implements state tracking and event handling of common user
interface controls. To draw widgets, use a theme packages such as package
gioui.org/widget/material.</p>
</li>
<li>
<p><a href="https://godoc.org/gioui.org/widget/material">material - GoDoc</a></p>
<p>Package material implements the Material design.</p>
</li>
</ul>
<h1><a class="header" href="#overview-30" id="overview-30">Overview</a></h1>
<h1><a class="header" href="#webassembly" id="webassembly">Webassembly</a></h1>
<pre><code class="language-sh">go run gioui.org/cmd/gogio -target js gioui.org/example/gophers
go get github.com/shurcooL/goexec
goexec 'http.ListenAndServe(&quot;:8080&quot;, http.FileServer(http.Dir(&quot;gophers&quot;)))'
</code></pre>
<p>`</p>
<h1><a class="header" href="#vugu" id="vugu">vugu</a></h1>
<h1><a class="header" href="#links-148" id="links-148">Links</a></h1>
<ul>
<li><a href="https://github.com/vugu/vugu">vugu/vugu: Vugu: A modern UI library for Go+WebAssembly (experimental)</a></li>
</ul>
<h1><a class="header" href="#overview-31" id="overview-31">Overview</a></h1>
<h1><a class="header" href="#vecty" id="vecty">vecty</a></h1>
<h1><a class="header" href="#links-149" id="links-149">Links</a></h1>
<ul>
<li><a href="https://github.com/gopherjs/vecty">gopherjs/vecty: Vecty: your frontend, in Go</a></li>
<li><a href="https://godoc.org/github.com/gopherjs/vecty">vecty - GoDoc</a></li>
</ul>
<h1><a class="header" href="#overview-32" id="overview-32">Overview</a></h1>
<h1><a class="header" href="#hugo" id="hugo">Hugo</a></h1>
<h1><a class="header" href="#links-150" id="links-150">Links</a></h1>
<ul>
<li><a href="https://gohugo.io/">Hugo</a></li>
</ul>
<h1><a class="header" href="#install-14" id="install-14">Install</a></h1>
<pre><code>// macOS
brew install hugo
</code></pre>
<h1><a class="header" href="#quick-start-4" id="quick-start-4">Quick Start</a></h1>
<p><a href="https://gohugo.io/getting-started/quick-start/">Quick Start | Hugo</a></p>
<pre><code>hugo new site &lt;dir&gt;
</code></pre>
<h1><a class="header" href="#theme-1" id="theme-1">Theme</a></h1>
<p><a href="https://themes.gohugo.io/">Complete List | Hugo Themes</a></p>
<pre><code>cd &lt;hugodir&gt;
git init
git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke
echo 'theme = &quot;ananke&quot;' &gt;&gt; config.toml
</code></pre>
<h1><a class="header" href="#beautiful-theme" id="beautiful-theme">Beautiful Theme</a></h1>
<ul>
<li><a href="https://themes.gohugo.io/syna/">Syna | Hugo Themes</a></li>
</ul>
<h1><a class="header" href="#serve" id="serve">Serve</a></h1>
<pre><code>hugo server -D
</code></pre>
<h1><a class="header" href="#bootstrap" id="bootstrap">Bootstrap</a></h1>
<h1><a class="header" href="#links-151" id="links-151">Links</a></h1>
<ul>
<li><a href="https://getbootstrap.com/docs/4.3/getting-started/introduction/">Introduction · Bootstrap</a></li>
<li><a href="https://github.com/twbs/bootstrap">GitHub - twbs/bootstrap: The most popular HTML, CSS, and JavaScript framework for developing responsive, mobile first projects on the web.</a></li>
</ul>
<h1><a class="header" href="#install-15" id="install-15">Install</a></h1>
<ul>
<li><a href="https://github.com/twbs/bootstrap/releases">Releases · twbs/bootstrap · GitHub</a></li>
</ul>
<pre><code>unzip bootstrap-4.3.1-dist.zip
</code></pre>
<h1><a class="header" href="#quickstart" id="quickstart">QuickStart</a></h1>
<ul>
<li><a href="https://www.taniarascia.com/what-is-bootstrap-and-how-do-i-use-it/">What is Bootstrap and How Do I Use It? – Tania Rascia</a></li>
</ul>
<p>Serve it on <code>/static/</code>:</p>
<pre><code class="language-go">fileserver := http.FileServer(http.Dir(&quot;./ui/static/bootstrap&quot;))
mux.Handle(&quot;/static/&quot;, http.StripPrefix(&quot;/static&quot;, fileserver))
</code></pre>
<p>CSS</p>
<p>Copy-paste the stylesheet <link> into your <head> before all other stylesheets
to load our CSS.</p>
<pre><code>&lt;!-- Bootstrap CSS --&gt;
&lt;link href=&quot;/static/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
</code></pre>
<p>JS</p>
<p>Many of our components require the use of JavaScript to function. Specifically,
they require jQuery, Popper.js, and our own JavaScript plugins. Place the
following <code>&lt;script&gt;</code>s near the end of your pages, right before the closing
<code>&lt;/body&gt;</code> tag, to enable them. jQuery must come first, then Popper.js, and then
our JavaScript plugins.</p>
<pre><code>&lt;!-- Optional JavaScript --&gt;
&lt;!-- jQuery first, then Popper.js, then Bootstrap JS --&gt;
&lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.slim.min.js&quot; integrity=&quot;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js&quot; integrity=&quot;sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;/static/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<h1><a class="header" href="#navigation-bar" id="navigation-bar">Navigation Bar</a></h1>
<ul>
<li><a href="https://getbootstrap.com/docs/4.3/components/navbar/#">Navbar · Bootstrap</a></li>
</ul>
<h1><a class="header" href="#jumbotron" id="jumbotron">Jumbotron</a></h1>
<ul>
<li><a href="https://getbootstrap.com/docs/4.3/components/jumbotron/">Jumbotron · Bootstrap</a></li>
</ul>
<h1><a class="header" href="#theme-2" id="theme-2">Theme</a></h1>
<ul>
<li>
<p><a href="https://github.com/ColorlibHQ/gentelella">GitHub - ColorlibHQ/gentelella: Free Bootstrap 4 Admin Dashboard Template</a></p>
</li>
<li>
<p><a href="https://github.com/topics/bootstrap?o=desc&amp;s=stars">bootstrap · GitHub Topics · GitHub</a></p>
</li>
</ul>
<h1><a class="header" href="#db" id="db">db</a></h1>
<h1><a class="header" href="#sample-data" id="sample-data">Sample Data</a></h1>
<ul>
<li><a href="https://github.com/lerocha/chinook-database/tree/master/ChinookDatabase/DataSources">chinook-database/ChinookDatabase/DataSources</a></li>
</ul>
<h1><a class="header" href="#oracle" id="oracle">oracle</a></h1>
<h1><a class="header" href="#links-152" id="links-152">Links</a></h1>
<ul>
<li></li>
</ul>
<h1><a class="header" href="#overview-33" id="overview-33">Overview</a></h1>
<h1><a class="header" href="#create-listener" id="create-listener">Create listener</a></h1>
<ul>
<li><a href="https://oracle-base.com/articles/misc/oracle-network-configuration">ORACLE-BASE - Oracle Network Configuration (listener.ora , tnsnames.ora , sqlnet.ora)</a></li>
</ul>
<pre><code>cat &gt; listener.ora &lt;&lt;EOF
LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1)) 
      (ADDRESS = (PROTOCOL = TCP)(HOST = myserver.example.com)(PORT = 1521))
    )
  )

SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = orcl.example.com)
      (ORACLE_HOME = /u01/app/oracle/product/11.2.0.4/db_1)
      (SID_NAME = orcl)
    )
  )
EOF
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorgdatabasesqlsql---godoca" id="a-hrefhttpsgodocorgdatabasesqlsql---godoca"><a href="https://godoc.org/database/sql">sql - GoDoc</a></a></h1>
<h1><a class="header" href="#links-153" id="links-153">Links</a></h1>
<h1><a class="header" href="#overview-34" id="overview-34">Overview</a></h1>
<p>Go provides three different methods for executing database queries:</p>
<ul>
<li><code>DB.Query()</code> is used for SELECT queries which return multiple rows.</li>
<li><code>DB.QueryRow()</code> is used for SELECT queries which return a single row.</li>
<li><code>DB.Exec()</code> is used for statements which don’t return rows (like INSERT and DELETE).</li>
</ul>
<h1><a class="header" href="#redis-a-data-structures-server" id="redis-a-data-structures-server">redis: a data structures server</a></h1>
<h1><a class="header" href="#links-154" id="links-154">Links</a></h1>
<ul>
<li><a href="https://redis.io/topics/quickstart">Redis Quick Start – Redis</a></li>
<li><a href="https://redis.io/topics/data-types-intro">An introduction to Redis data types and abstractions – Redis</a></li>
</ul>
<h1><a class="header" href="#port" id="port">Port</a></h1>
<p><code>port 6379</code></p>
<h1><a class="header" href="#ping" id="ping">PING</a></h1>
<p><code>redis-cli ping</code></p>
<h1><a class="header" href="#example" id="example">Example</a></h1>
<pre><code>$ redis-cli                                                                
redis 127.0.0.1:6379&gt; ping
PONG
redis 127.0.0.1:6379&gt; set mykey somevalue
OK
redis 127.0.0.1:6379&gt; get mykey
&quot;somevalue&quot;
</code></pre>
<h1><a class="header" href="#a-hrefhttpssqliteorgindexhtmlsqlitea" id="a-hrefhttpssqliteorgindexhtmlsqlitea"><a href="https://sqlite.org/index.html">SQLite</a></a></h1>
<h1><a class="header" href="#links-155" id="links-155">Links</a></h1>
<ul>
<li><a href="https://sqlite.org/cli.html">Command Line Shell For SQLite</a></li>
</ul>
<h1><a class="header" href="#example-1" id="example-1">Example</a></h1>
<pre><code>$ sqlite3 ex1
SQLite version 3.28.0 2019-03-02 15:25:24
Enter &quot;.help&quot; for usage hints.
sqlite&gt; create table tbl1(one varchar(10), two smallint);
sqlite&gt; insert into tbl1 values('hello!',10);
sqlite&gt; insert into tbl1 values('goodbye', 20);
sqlite&gt; select * from tbl1;
hello!|10
goodbye|20
sqlite&gt;
</code></pre>
<h1><a class="header" href="#basics-1" id="basics-1">Basics</a></h1>
<pre><code>.tables ?TABLE?          List names of tables matching LIKE pattern TABLE
.schema ?PATTERN?        Show the CREATE statements matching PATTERN

.schema Album 		
pragma table_info(Album); 		// get column information of a table.
</code></pre>
<h1><a class="header" href="#backup" id="backup">Backup</a></h1>
<h2><a class="header" href="#archive-and-reconstruct" id="archive-and-reconstruct">archive and reconstruct</a></h2>
<p>The text format is pure SQL so you can also use the <code>.dump</code> command to export
an SQLite database into other popular SQL database engines.</p>
<pre><code>// dump
sqlite3 ex1 .dump | gzip -c &gt;ex1.dump.gz
// reconstruct
zcat ex1.dump.gz | sqlite3 ex2
</code></pre>
<h1><a class="header" href="#misc-2" id="misc-2">Misc</a></h1>
<h2><a class="header" href="#get-the-last-record" id="get-the-last-record">Get the last record</a></h2>
<pre><code>SELECT * FROM table ORDER BY column DESC LIMIT 1;
</code></pre>
<h1><a class="header" href="#sqlite3-driver" id="sqlite3-driver">sqlite3 driver</a></h1>
<ul>
<li><a href="https://godoc.org/github.com/mattn/go-sqlite3#SQLiteDriver.Open">sqlite3 - GoDoc</a></li>
</ul>
<h1><a class="header" href="#mysql" id="mysql">MySQL</a></h1>
<h1><a class="header" href="#links-156" id="links-156">Links</a></h1>
<ul>
<li><a href="https://godoc.org/github.com/go-sql-driver/mysql">mysql - GoDoc</a> </li>
</ul>
<h1><a class="header" href="#overview-35" id="overview-35">Overview</a></h1>
<h1><a class="header" href="#install-16" id="install-16">Install</a></h1>
<pre><code class="language-go">brew install mysql


brew services start mysql

mysql_secure_installation

brew services restart mysql
</code></pre>
<h1><a class="header" href="#usage" id="usage">Usage</a></h1>
<pre><code class="language-sql">// login
mysql -u root -p

-- Create a new UTF-8 `snippetbox` database.
CREATE DATABASE snippetbox CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Switch to using the `snippetbox` database.
USE snippetbox;

-- Create a `snippets` table.
CREATE TABLE snippets (
    id INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(100) NOT NULL,
    content TEXT NOT NULL,
    created DATETIME NOT NULL,
    expires DATETIME NOT NULL
);

-- Add an index on the created column.
CREATE INDEX idx_snippets_created ON snippets(created);

-- Add some dummy records (which we'll use in the next couple of chapters).
INSERT INTO snippets (title, content, created, expires) VALUES (
    'An old silent pond',
    'An old silent pond...\nA frog jumps into the pond,\nsplash! Silence again.\n\n– Matsuo Bashō',
    UTC_TIMESTAMP(),
    DATE_ADD(UTC_TIMESTAMP(), INTERVAL 365 DAY)
);

INSERT INTO snippets (title, content, created, expires) VALUES (
    'Over the wintry forest',
    'Over the wintry\nforest, winds howl in rage\nwith no leaves to blow.\n\n– Natsume Soseki',
    UTC_TIMESTAMP(),
    DATE_ADD(UTC_TIMESTAMP(), INTERVAL 365 DAY)
);

INSERT INTO snippets (title, content, created, expires) VALUES (
    'First autumn morning',
    'First autumn morning\nthe mirror I stare into\nshows my father''s face.\n\n– Murakami Kijo',
    UTC_TIMESTAMP(),
    DATE_ADD(UTC_TIMESTAMP(), INTERVAL 7 DAY)
);


CREATE USER 'web'@'localhost'; 
GRANT SELECT, INSERT ON snippetbox.* TO 'web'@'localhost';
-- Important: Make sure to swap 'pass' with a password of your own choosing.
ALTER USER 'web'@'localhost' IDENTIFIED BY 'pass';

exit

-- Test the new user
mysql -D snippetbox -u web -p

mysql&gt; use snippetbox

mysql&gt; SELECT id, title, expires FROM snippets;

mysql&gt; DROP TABLE snippets;
ERROR 1142 (42000): DROP command denied to user 'web'@'localhost' for table 'snippets'
</code></pre>
<h1><a class="header" href="#creating-a-user-model" id="creating-a-user-model">Creating a User Model</a></h1>
<pre><code class="language-sql">USE snippetbox;

CREATE TABLE users (
    id INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    hashed_password CHAR(60) NOT NULL,
    created DATETIME NOT NULL
);

ALTER TABLE users ADD CONSTRAINT users_uc_email UNIQUE (email);
</code></pre>
<p>`</p>
<h1><a class="header" href="#it" id="it">IT</a></h1>
<h1><a class="header" href="#links-157" id="links-157">Links</a></h1>
<ul>
<li><a href="https://cloudscaling.com/blog/cloud-computing/the-history-of-pets-vs-cattle/">The History of Pets vs Cattle and How to Use the Analogy Properly | Cloudscaling</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpswwwdpdkorgdpdka" id="a-hrefhttpswwwdpdkorgdpdka"><a href="https://www.dpdk.org/">DPDK</a></a></h1>
<h1><a class="header" href="#links-158" id="links-158">Links</a></h1>
<ul>
<li><a href="https://doc.dpdk.org/guides/linux_gsg/sys_reqs.html">2. System Requirements — Data Plane Development Kit 19.08.0-rc0 documentation</a></li>
</ul>
<h1><a class="header" href="#linux-drivers" id="linux-drivers">Linux Drivers</a></h1>
<p><a href="https://doc.dpdk.org/guides/linux_gsg/linux_drivers.html">5. Linux Drivers — Data Plane Development Kit 19.08.0-rc0 documentation</a></p>
<h1><a class="header" href="#a-hrefhttpsminiominio--object-storage-for-aia" id="a-hrefhttpsminiominio--object-storage-for-aia"><a href="https://min.io/">MinIO | Object Storage for AI</a></a></h1>
<h1><a class="header" href="#links-159" id="links-159">Links</a></h1>
<ul>
<li><a href="https://github.com/minio/minio">GitHub - minio/minio: MinIO is a high performance object storage server compatible with Amazon S3 APIs</a></li>
</ul>
<h1><a class="header" href="#install-17" id="install-17">Install</a></h1>
<p>Mac</p>
<p>api</p>
<h1><a class="header" href="#telegram-bots" id="telegram-bots">Telegram Bots</a></h1>
<h1><a class="header" href="#links-160" id="links-160">Links</a></h1>
<ul>
<li><a href="https://godoc.org/gopkg.in/tucnak/telebot.v2">telebot - GoDoc</a></li>
<li><a href="https://godoc.org/github.com/go-telegram-bot-api/telegram-bot-api">tgbotapi - GoDoc</a></li>
</ul>
<h1><a class="header" href="#create-a-bot" id="create-a-bot">Create a bot</a></h1>
<ul>
<li><a href="https://telegram.me/botfather">Telegram: Contact @botfather</a></li>
</ul>
<h1><a class="header" href="#api" id="api">API</a></h1>
<ul>
<li><a href="https://core.telegram.org/bots/api#authorizing-your-bot">Telegram Bot API</a></li>
<li><a href="https://godoc.org/github.com/go-telegram-bot-api/telegram-bot-api">tgbotapi - GoDoc</a></li>
<li><a href="https://tutorials.botsfloor.com/creating-a-bot-using-the-telegram-bot-api-5d3caed3266d?gi=7b34239cc74c">Creating a Bot using the Telegram Bot API – Bot Tutorials</a></li>
</ul>
<h1><a class="header" href="#more" id="more">More</a></h1>
<ul>
<li><code>getUserProfilePhotos</code><br />
Use this method to get a list of profile pictures for a user. Returns a <code>UserProfilePhotos</code> object.</li>
</ul>
<h1><a class="header" href="#privacy-mode" id="privacy-mode">Privacy mode</a></h1>
<ul>
<li><a href="https://core.telegram.org/bots#privacy-mode">Bots: An introduction for developers</a></li>
</ul>
<h1><a class="header" href="#getupdates" id="getupdates">getUpdates</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Push_technology#Long_polling">Push technology: Long polling - Wikipedia</a></li>
</ul>
<h1><a class="header" href="#type-update-struct" id="type-update-struct">type Update struct</a></h1>
<pre><code class="language-go">type Update struct {
    UpdateID           int                 `json:&quot;update_id&quot;`
    Message            *Message            `json:&quot;message&quot;`
    EditedMessage      *Message            `json:&quot;edited_message&quot;`
    ChannelPost        *Message            `json:&quot;channel_post&quot;`
    EditedChannelPost  *Message            `json:&quot;edited_channel_post&quot;`
    InlineQuery        *InlineQuery        `json:&quot;inline_query&quot;`
    ChosenInlineResult *ChosenInlineResult `json:&quot;chosen_inline_result&quot;`
    CallbackQuery      *CallbackQuery      `json:&quot;callback_query&quot;`
    ShippingQuery      *ShippingQuery      `json:&quot;shipping_query&quot;`
    PreCheckoutQuery   *PreCheckoutQuery   `json:&quot;pre_checkout_query&quot;`
}

type UpdatesChannel &lt;-chan Update
	func (ch UpdatesChannel) Clear()

func (bot *BotAPI) GetUpdates(config UpdateConfig) ([]Update, error)
func (bot *BotAPI) GetUpdatesChan(config UpdateConfig) (UpdatesChannel, error)

type UpdateConfig
    func NewUpdate(offset int) UpdateConfig
</code></pre>
<h1><a class="header" href="#func-botapi-send" id="func-botapi-send">func (*BotAPI) Send</a></h1>
<ul>
<li>sendMessage<br />
Use this method to send text messages. On success, the sent Message is returned.</li>
</ul>
<pre><code class="language-go">func (bot *BotAPI) Send(c Chattable) (Message, error)

// Chattable is any config type that can be sent.
type Chattable interface {
	values() (url.Values, error)
	method() string
}

type Message struct {
    MessageID             int                `json:&quot;message_id&quot;`
    From                  *User              `json:&quot;from&quot;` // optional
    Date                  int                `json:&quot;date&quot;`
    Chat                  *Chat              `json:&quot;chat&quot;`
	... 	// balabala a lot.
}
    func (m *Message) Command() string
    func (m *Message) CommandArguments() string
    func (m *Message) CommandWithAt() string
    func (m *Message) IsCommand() bool
    func (m *Message) Time() time.Time

type MessageConfig
    func NewMessage(chatID int64, text string) MessageConfig
    func NewMessageToChannel(username string, text string) MessageConfig


// values returns a url.Values representation of MessageConfig.
func (config MessageConfig) values() (url.Values, error) {
	v, err := config.BaseChat.values()
	if err != nil {
		return v, err
	}
	v.Add(&quot;text&quot;, config.Text)
	v.Add(&quot;disable_web_page_preview&quot;, strconv.FormatBool(config.DisableWebPagePreview))
	if config.ParseMode != &quot;&quot; {
		v.Add(&quot;parse_mode&quot;, config.ParseMode)
	}

	return v, nil
}

// method returns Telegram API method name for sending Message.
func (config MessageConfig) method() string {
	return &quot;sendMessage&quot;
}
</code></pre>
<p><strong>It's confused me a lot of time, <code>type Message struct</code> really is not
a <code>Chattable</code>, but <code>MessageConfig</code> does.</strong></p>
<h1><a class="header" href="#framework" id="framework">Framework</a></h1>
<ul>
<li><a href="https://godoc.org/gopkg.in/tucnak/telebot.v2">telebot - GoDoc</a></li>
</ul>
<h1><a class="header" href="#weixin_web" id="weixin_web">WEIXIN_WEB</a></h1>
<h1><a class="header" href="#links-161" id="links-161">Links</a></h1>
<ul>
<li><a href="https://www.cnblogs.com/flashsun/p/8493306.html">微信网页版接口详解 - 闪客sun - 博客园</a></li>
<li><a href="https://github.com/songtianyi/wechat-go">GitHub - songtianyi/wechat-go: go version wechat web api and message framework for building wechat robot</a></li>
<li><a href="https://work.weixin.qq.com/api/doc#90002/90151/90854">企业微信API</a></li>
<li><a href="https://godoc.org/github.com/xen0n/go-workwx#example-Workwx">workwx - GoDoc</a></li>
</ul>
<h1><a class="header" href="#notes-3" id="notes-3">Notes</a></h1>
<ul>
<li>plugin should in a sepatate package.and I think it's more elegible that
a session to register a plugin, than the vice visa.<br />
I more like this way to register:<br />
<code>func RegisterHash(h Hash, f func() hash.Hash)</code></li>
<li>there's a lot of keyword <code>else</code>, <code>else</code> is the enemy of clearnity.</li>
<li>It seems fetchJokes will be memory leak.</li>
</ul>
<h1><a class="header" href="#how-it-work" id="how-it-work">How it work</a></h1>
<pre><code class="language-go">func CreateSession(common *Common, handlerRegister *HandlerRegister, qrmode int) (*Session, error) {

VVV

// a session to LoginAndServe ? 
func (s *Session) LoginAndServe(useCache bool) error

VVV

func (s *Session) serve() error {
	msg := make(chan []byte, 1000)
	// syncheck
	errChan := make(chan error)
	go s.producer(msg, errChan)
	for {
		select {
		case m := &lt;-msg:
			go s.consumer(m)
		case err := &lt;-errChan:
			// TODO maybe not all consumed messages ended
			return err
		}
	}
}
</code></pre>
<p>devops</p>
<h1><a class="header" href="#a-hrefhttpsgithubcomgooglemtailgithub---googlemtail-extract-whitebox-monitoring-data-from-application-logs-for-collection-in-a-timeseries-databasea" id="a-hrefhttpsgithubcomgooglemtailgithub---googlemtail-extract-whitebox-monitoring-data-from-application-logs-for-collection-in-a-timeseries-databasea"><a href="https://github.com/google/mtail">GitHub - google/mtail: extract whitebox monitoring data from application logs for collection in a timeseries database</a></a></h1>
<h1><a class="header" href="#links-162" id="links-162">Links</a></h1>
<ul>
<li><a href="https://github.com/google/mtail/releases">Releases · google/mtail · GitHub</a></li>
<li><a href="https://github.com/google/mtail#read-more">GitHub - google/mtail: extract whitebox monitoring data from application logs for collection in a timeseries database</a></li>
</ul>
<h1><a class="header" href="#caution-1" id="caution-1">Caution</a></h1>
<p>Depends on the log file, we may need to run it as root.</p>
<h1><a class="header" href="#testing-programs" id="testing-programs">Testing programs</a></h1>
<p><a href="https://github.com/google/mtail/blob/master/docs/Testing.md">mtail/Testing.md at master · google/mtail · GitHub</a></p>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomprometheusprometheusprometheus---godoca" id="a-hrefhttpsgodocorggithubcomprometheusprometheusprometheus---godoca"><a href="https://godoc.org/github.com/prometheus/prometheus">prometheus - GoDoc</a></a></h1>
<h1><a class="header" href="#links-163" id="links-163">Links</a></h1>
<ul>
<li><a href="https://github.com/prometheus/prometheus/blob/master/documentation/internal_architecture.md">prometheus/internal_architecture.md at master Â· prometheus/prometheus</a></li>
<li><a href="https://godoc.org/github.com/oklog/run">github.com/oklog/run - GoDoc</a></li>
</ul>
<h1><a class="header" href="#actors" id="actors">Actors</a></h1>
<pre><code class="language-go">var g run.Group

g.Add( func() error {...}, func( err error ) {...} )
g.Add( func() error {...}, func( err error ) {...} )
...
err := g.Run()
</code></pre>
<p>Does this better than <code>sync.WaitGroup</code> ?</p>
<h1><a class="header" href="#configuration-2" id="configuration-2">Configuration</a></h1>
<ul>
<li><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Configuration | Prometheus</a></li>
<li><a href="https://godoc.org/github.com/prometheus/prometheus/config">prometheus/config - GoDoc</a></li>
</ul>
<pre><code class="language-go">type Config struct {
    GlobalConfig   GlobalConfig    `yaml:&quot;global&quot;`
    AlertingConfig AlertingConfig  `yaml:&quot;alerting,omitempty&quot;`
    RuleFiles      []string        `yaml:&quot;rule_files,omitempty&quot;`
    ScrapeConfigs  []*ScrapeConfig `yaml:&quot;scrape_configs,omitempty&quot;`

    RemoteWriteConfigs []*RemoteWriteConfig `yaml:&quot;remote_write,omitempty&quot;`
    RemoteReadConfigs  []*RemoteReadConfig  `yaml:&quot;remote_read,omitempty&quot;`
    // contains filtered or unexported fields
}

func Load(s string) (*Config, error)
func LoadFile(filename string) (*Config, error)

func (c Config) String() string
func (c *Config) UnmarshalYAML(unmarshal func(interface{}) error) error
</code></pre>
<p><strong>Reload handler</strong></p>
<h1><a class="header" href="#querying-prometheus" id="querying-prometheus">Querying Prometheus</a></h1>
<ul>
<li><a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">Querying basics | Prometheus</a></li>
<li><a href="https://prometheus.io/docs/prometheus/latest/querying/operators/">Operators | Prometheus</a></li>
<li><a href="https://prometheus.io/docs/prometheus/latest/querying/functions/">Query functions | Prometheus</a></li>
<li><a href="https://www.robustperception.io/combining-alert-conditions">Combining alert conditions – Robust Perception | Prometheus Monitoring Experts</a></li>
</ul>
<p>In Prometheus's expression language, an expression or sub-expression can evaluate to one of four types:</p>
<ul>
<li><strong>Instant vector</strong> - a set of time series containing a single sample for each time series, all sharing the same timestamp</li>
<li><strong>Range vector</strong> - a set of time series containing a range of data points over time for each time series</li>
<li><strong>Scalar</strong> - a simple numeric floating point value</li>
<li><strong>String</strong> - a simple string value; currently unused</li>
</ul>
<h1><a class="header" href="#time-series-selectors" id="time-series-selectors">Time series Selectors</a></h1>
<h2><a class="header" href="#instant-vector-selectors" id="instant-vector-selectors">Instant vector selectors</a></h2>
<p>Instant vector selectors allow the selection of a set of time series and a single sample value for each at a given timestamp (instant): in the simplest form, only a metric name is specified. This results in an instant vector containing elements for all time series that have this metric name.</p>
<h2><a class="header" href="#range-vector-selectors" id="range-vector-selectors">Range Vector Selectors</a></h2>
<p>Range vector literals work like instant vector literals, except that they select a range of samples back from the current instant. Syntactically, a range duration is appended in square brackets ([]) at the end of a vector selector to specify how far back in time values should be fetched for each resulting range vector element.</p>
<h1><a class="header" href="#offset-modifier" id="offset-modifier">Offset modifier</a></h1>
<p>The offset modifier allows changing the time offset for individual instant and range vectors in a query.</p>
<h1><a class="header" href="#vector-matching" id="vector-matching">Vector matching</a></h1>
<p>Operations between vectors attempt to find a matching element in the right-hand side vector for each entry in the left-hand side. There are two basic types of matching behavior: One-to-one and many-to-one/one-to-many.</p>
<h2><a class="header" href="#one-to-one-vector-matches" id="one-to-one-vector-matches">One-to-one vector matches</a></h2>
<p>The <code>ignoring</code> keyword allows ignoring certain labels when matching, while the <code>on</code> keyword allows reducing the set of considered labels to a provided list:</p>
<pre><code>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) &lt;vector expr&gt;
</code></pre>
<p>E.g.</p>
<p>Input:</p>
<pre><code>method_code:http_errors:rate5m{method=&quot;get&quot;, code=&quot;500&quot;}  24
method_code:http_errors:rate5m{method=&quot;get&quot;, code=&quot;404&quot;}  30
method_code:http_errors:rate5m{method=&quot;put&quot;, code=&quot;501&quot;}  3
method_code:http_errors:rate5m{method=&quot;post&quot;, code=&quot;500&quot;} 6
method_code:http_errors:rate5m{method=&quot;post&quot;, code=&quot;404&quot;} 21

method:http_requests:rate5m{method=&quot;get&quot;}  600
method:http_requests:rate5m{method=&quot;del&quot;}  34
method:http_requests:rate5m{method=&quot;post&quot;} 120
</code></pre>
<p>Query:</p>
<pre><code>method_code:http_errors:rate5m{code=&quot;500&quot;} / ignoring(code) method:http_requests:rate5m

{method=&quot;get&quot;}  0.04            //  24 / 600
{method=&quot;post&quot;} 0.05            //   6 / 120
</code></pre>
<p>因为要标签完全一样也有法比，所以要忽略code这个标签</p>
<h2><a class="header" href="#many-to-one-and-one-to-many-vector-matches" id="many-to-one-and-one-to-many-vector-matches">Many-to-one and one-to-many vector matches</a></h2>
<pre><code>&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;
&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;
</code></pre>
<pre><code>method_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m
</code></pre>
<p>In this case the left vector contains more than one entry per method label value. Thus, we indicate this using group_left. The elements from the right side are now matched with multiple elements with the same method label on the left:</p>
<pre><code>{method=&quot;get&quot;, code=&quot;500&quot;}  0.04            //  24 / 600
{method=&quot;get&quot;, code=&quot;404&quot;}  0.05            //  30 / 600
{method=&quot;post&quot;, code=&quot;500&quot;} 0.05            //   6 / 120
{method=&quot;post&quot;, code=&quot;404&quot;} 0.175           //  21 / 120
</code></pre>
<p>Many-to-one and one-to-many matching are advanced use cases that should be carefully considered. Often a proper use of ignoring(<labels>) provides the desired outcome.</p>
<h1><a class="header" href="#aggregation-operators" id="aggregation-operators">Aggregation operators</a></h1>
<p><code>without</code> removes the listed labels from the result vector, while all other labels are preserved the output.
<code>by</code> does the opposite and drops labels that are not listed in the by clause, even if their label values are identical between all elements of the vector.</p>
<h1><a class="header" href="#我只关心早上9点到晚上10点" id="我只关心早上9点到晚上10点">我只关心早上9点到晚上10点</a></h1>
<pre><code>job:request_latency_seconds:mean5m{job=&quot;myjob&quot;} &gt; 0.5 and ON() hour() &gt; 9 &lt; 10
</code></pre>
<p>Here hour() returns the hour of the day in UTC as a time series with no labels. We can use comparison operators to filter this down to the time we care about. Finally as there's no matching labels on either side of the and, we specify ON() to ignore all labels when matching.</p>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomprometheusclient_golangclient_golang---godoca" id="a-hrefhttpsgodocorggithubcomprometheusclient_golangclient_golang---godoca"><a href="https://godoc.org/github.com/prometheus/client_golang">client_golang - GoDoc</a></a></h1>
<h1><a class="header" href="#links-164" id="links-164">Links</a></h1>
<ul>
<li><a href="https://github.com/prometheus/client_golang">GitHub - prometheus/client_golang: Prometheus instrumentation library for Go applications</a></li>
<li><a href="https://prometheus.io/docs/practices/naming/">Metric and label naming | Prometheus</a> </li>
<li><a href="https://prometheus.io/docs/guides/go-application/">Instrumenting a Go application | Prometheus</a></li>
<li><a href="https://prometheus.io/docs/concepts/metric_types/">Metric types | Prometheus</a></li>
</ul>
<h1><a class="header" href="#install-18" id="install-18">Install</a></h1>
<pre><code>go get github.com/prometheus/client_golang/...
</code></pre>
<h1><a class="header" href="#metrics-and-collectors" id="metrics-and-collectors">Metrics and Collectors</a></h1>
<p>In addition to the fundamental metric types Gauge, Counter, Summary, Histogram,
and Untyped, a very important part of the Prometheus data model is the
partitioning of samples along dimensions called labels, which results in metric
vectors. The fundamental types are GaugeVec, CounterVec, SummaryVec,
HistogramVec, and UntypedVec. </p>
<p>While only the fundamental metric types implement the Metric interface, both
the metrics and their vector versions implement the Collector interface. </p>
<p><strong>A Collector manages the collection of a number of Metrics</strong>, but for
convenience, a Metric can also “collect itself”. </p>
<p>Note that Gauge, Counter, Summary, Histogram, and Untyped are interfaces
themselves while GaugeVec, CounterVec, SummaryVec, HistogramVec, and UntypedVec
are not. (<strong>What does interface themselves mean ?</strong>)</p>
<p>To create instances of Metrics and their vector versions, you need a suitable …
Opts struct, i.e. GaugeOpts, CounterOpts, SummaryOpts, HistogramOpts, or
UntypedOpts. </p>
<p>If you just need to call a function to get a single float value to collect as
a metric, GaugeFunc, CounterFunc, or UntypedFunc might be interesting
shortcuts. </p>
<pre><code class="language-go">type Collector interface {
    Describe(chan&lt;- *Desc)	
	Collect(chan&lt;- Metric)
}


type Metric interface {
	Desc() *Desc
	Write(*dto.Metric) error
}
</code></pre>
<p>So what does a <code>Metric</code> interface do ?</p>
<p>it returns a <code>*Desc</code> and Write a <code>*dto.Metric</code>.</p>
<h1><a class="header" href="#collector" id="collector">Collector</a></h1>
<p>A Collector has to be registered for collection. </p>
<h1><a class="header" href="#registry" id="registry">Registry</a></h1>
<h1><a class="header" href="#func-describebycollect" id="func-describebycollect">func DescribeByCollect</a></h1>
<pre><code class="language-go">func DescribeByCollect(c Collector, descs chan&lt;- *Desc) {
	metrics := make(chan Metric)
	go func() {
		c.Collect(metrics)
		close(metrics)
	}()
	for m := range metrics {
		descs &lt;- m.Desc()
	}
}
</code></pre>
<h1><a class="header" href="#metric-names" id="metric-names">Metric names</a></h1>
<p>e.g.</p>
<pre><code>prometheus_notifications_total
process_cpu_seconds_total
http_request_duration_seconds
</code></pre>
<p>Rules:</p>
<p><code>app_what_unit_[total]</code></p>
<h1><a class="header" href="#what-to-instrument" id="what-to-instrument">What to instrument</a></h1>
<ul>
<li><a href="https://alex.dzyoba.com/blog/go-prometheus-service/">Instrumenting a Go service for Prometheus | There is no magic here</a></li>
<li><a href="https://www.weave.works/blog/the-red-method-key-metrics-for-microservices-architecture/">The RED Method: key metrics for microservices architecture</a></li>
</ul>
<p>four golden signals:</p>
<ul>
<li>Traffic or Request Rate</li>
<li>Errors</li>
<li>Latency or Duration of the requests</li>
<li>Saturation</li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomprometheusclient_golangprometheuspromhttppromhttp---godoca" id="a-hrefhttpsgodocorggithubcomprometheusclient_golangprometheuspromhttppromhttp---godoca"><a href="https://godoc.org/github.com/prometheus/client_golang/prometheus/promhttp">promhttp - GoDoc</a></a></h1>
<h1><a class="header" href="#links-165" id="links-165">Links</a></h1>
<ul>
<li></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomprometheusclient_golangprometheuspromautopromauto---godoca" id="a-hrefhttpsgodocorggithubcomprometheusclient_golangprometheuspromautopromauto---godoca"><a href="https://godoc.org/github.com/prometheus/client_golang/prometheus/promauto">promauto - GoDoc</a></a></h1>
<h1><a class="header" href="#links-166" id="links-166">Links</a></h1>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomprometheusclient_golangapiapi---godoca" id="a-hrefhttpsgodocorggithubcomprometheusclient_golangapiapi---godoca"><a href="https://godoc.org/github.com/prometheus/client_golang/api">api - GoDoc</a></a></h1>
<h1><a class="header" href="#links-167" id="links-167">Links</a></h1>
<ul>
<li><a href="https://github.com/prometheus/client_golang/issues/194#issuecomment-194319793">documentation for API client · Issue #194 · prometheus/client_golang · GitHub</a></li>
</ul>
<h1><a class="header" href="#basics-2" id="basics-2">Basics</a></h1>
<pre><code class="language-go">	rawurl := &quot;http://prom.org&quot;

	c, err := api.NewClient(
		api.Config{
			Address: rawurl,
		})

	if err != nil {
		log.Fatal(err)
	}

	api := v1.NewAPI(c)

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	v, w, err := api.Query(ctx, `100 - (avg by (instance) (irate(node_cpu_seconds_total{job=&quot;node&quot;,mode=&quot;idle&quot;}[5m])) * 100)`, time.Now())

	if err != nil || w != nil {
		log.Fatal(err)
	}

	fmt.Println(v.String())

</code></pre>
<h1><a class="header" href="#alertmanager" id="alertmanager">Alertmanager</a></h1>
<h1><a class="header" href="#links-168" id="links-168">Links</a></h1>
<ul>
<li><a href="https://github.com/prometheus/alertmanager">prometheus/alertmanager: Prometheus Alertmanager</a></li>
<li><a href="https://prometheus.io/docs/alerting/overview/">Alerting overview | Prometheus</a></li>
<li><a href="https://prometheus.io/docs/operating/integrations/#alertmanager-webhook-receiver">Integrations | Prometheus</a></li>
<li><a href="https://prometheus.io/docs/practices/alerting/">Alerting | Prometheus</a></li>
<li><a href="https://prometheus.io/docs/alerting/configuration/">Configuration | Prometheus</a></li>
</ul>
<h1><a class="header" href="#packages-1" id="packages-1">Packages</a></h1>
<ul>
<li><a href="https://godoc.org/github.com/prometheus/alertmanager/template">template - GoDoc</a></li>
</ul>
<h1><a class="header" href="#sms" id="sms">SMS</a></h1>
<ul>
<li><a href="https://github.com/messagebird/sachet">GitHub - messagebird/sachet: SMS alerts for Prometheus' Alertmanager</a></li>
</ul>
<h1><a class="header" href="#webhook_config" id="webhook_config">&lt;webhook_config&gt;</a></h1>
<pre><code># Whether or not to notify about resolved alerts.
[ send_resolved: &lt;boolean&gt; | default = true ]

# The endpoint to send HTTP POST requests to.
url: &lt;string&gt;

# The HTTP client's configuration.
[ http_config: &lt;http_config&gt; | default = global.http_config ]
</code></pre>
<p>The Alertmanager will send HTTP POST requests in the following JSON format to
the configured endpoint:</p>
<pre><code>{
  &quot;version&quot;: &quot;4&quot;,
  &quot;groupKey&quot;: &lt;string&gt;,    // key identifying the group of alerts (e.g. to deduplicate)
  &quot;status&quot;: &quot;&lt;resolved|firing&gt;&quot;,
  &quot;receiver&quot;: &lt;string&gt;,
  &quot;groupLabels&quot;: &lt;object&gt;,
  &quot;commonLabels&quot;: &lt;object&gt;,
  &quot;commonAnnotations&quot;: &lt;object&gt;,
  &quot;externalURL&quot;: &lt;string&gt;,  // backlink to the Alertmanager.
  &quot;alerts&quot;: [
    {
      &quot;status&quot;: &quot;&lt;resolved|firing&gt;&quot;,
      &quot;labels&quot;: &lt;object&gt;,
      &quot;annotations&quot;: &lt;object&gt;,
      &quot;startsAt&quot;: &quot;&lt;rfc3339&gt;&quot;,
      &quot;endsAt&quot;: &quot;&lt;rfc3339&gt;&quot;,
      &quot;generatorURL&quot;: &lt;string&gt; // identifies the entity that caused the alert
    },
    ...
  ]
}
</code></pre>
<h1><a class="header" href="#node_exporter" id="node_exporter">node_exporter</a></h1>
<h1><a class="header" href="#links-169" id="links-169">Links</a></h1>
<ul>
<li><a href="https://github.com/prometheus/node_exporter">GitHub - prometheus/node_exporter: Exporter for machine metrics</a></li>
</ul>
<h1><a class="header" href="#textfile-collector" id="textfile-collector">Textfile Collector</a></h1>
<ul>
<li><a href="https://prometheus.io/docs/instrumenting/exposition_formats/">Exposition formats | Prometheus</a></li>
</ul>
<p>To use it, set the <code>--collector.textfile.directory</code> flag on the Node exporter.
The collector will parse all files in that directory matching the glob <code>*.prom</code>
using the text format.</p>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomfreesql_exportercollectorsql_exporter---godoca" id="a-hrefhttpsgodocorggithubcomfreesql_exportercollectorsql_exporter---godoca"><a href="https://godoc.org/github.com/free/sql_exporter#Collector">sql_exporter - GoDoc</a></a></h1>
<h1><a class="header" href="#links-170" id="links-170">Links</a></h1>
<ul>
<li><a href="https://github.com/free/sql_exporter">GitHub - free/sql_exporter: Database agnostic SQL exporter for Prometheus</a></li>
</ul>
<h1><a class="header" href="#overview-36" id="overview-36">Overview</a></h1>
<p>After several days, still didn't get how this software works. For me, the most
dificult is that I can't figer out how those struct work together.</p>
<p>Cant figer out, a column of a row of sql results, is be as a label, or as a metric ?</p>
<p>Sun Jul 14 23:41:58 CST 2019</p>
<p>After read <a href="https://github.com/free/sql_exporter/blob/master/documentation/sql_exporter.yml">sql_exporter/sql_exporter.yml at master · free/sql_exporter · GitHub</a>, I finally get something:</p>
<pre><code>    # The result columns conceptually fall into two categories:
    #  * zero or more key columns: their values will be directly mapped to labels of the same name;
    #  * one or more value columns:
    #     * if exactly one value column, the column name name is ignored and its value becomes the metric value
    #     * with multiple value columns, a `value_label` must be defined; the column name will populate this label and
    #       the column value will popilate the metric value.
</code></pre>
<p>但是这什么意思啊？ 什么叫0或多个key列？？？他们的值会直接给有相同labels的，
谁和谁相同啊？？？</p>
<p>label就是label, 分什么key_label, value_label???</p>
<p>Mon Jul 15 00:30:09 CST 2019</p>
<p>This query may result in multiple rows. There has metric with a label named
<code>db</code>, then the result of this will use the value of the <code>db</code> column to the
label <code>db</code>,kind of: </p>
<pre><code>mssql_log_growths{db=&quot;db1&quot;} 12
mssql_log_growths{db=&quot;db2&quot;} 25
mssql_log_growths{db=&quot;db3&quot;} 32
</code></pre>
<pre><code>SELECT rtrim(instance_name) AS db, cntr_value AS counter
FROM sys.dm_os_performance_counters
WHERE counter_name = 'Log Growths' AND instance_name &lt;&gt; '_Total'
</code></pre>
<h1><a class="header" href="#is-one-query-only-get-one-metric-" id="is-one-query-only-get-one-metric-">Is one query only get one metric ?</a></h1>
<p>This is the core work.</p>
<pre><code class="language-go">func (q *Query) Collect(ctx context.Context, conn *sql.DB, ch chan&lt;- Metric) {

	...

	for rows.Next() {
		row, err := q.scanRow(rows, dest)
		if err != nil {
			ch &lt;- NewInvalidMetric(err)
			continue
		}
		for _, mf := range q.metricFamilies {
			mf.Collect(row, ch)
		}
	}

	...
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgodocorggithubcomprometheusprocfsprocfs---godoca" id="a-hrefhttpsgodocorggithubcomprometheusprocfsprocfs---godoca"><a href="https://godoc.org/github.com/prometheus/procfs">procfs - GoDoc</a></a></h1>
<h1><a class="header" href="#links-171" id="links-171">Links</a></h1>
<h1><a class="header" href="#grafana" id="grafana">grafana</a></h1>
<h1><a class="header" href="#links-172" id="links-172">Links</a></h1>
<h1><a class="header" href="#install-19" id="install-19">Install</a></h1>
<ul>
<li><a href="https://github.com/helm/charts/tree/master/stable/grafana">charts/stable/grafana at master · helm/charts · GitHub</a></li>
</ul>
<p>values:</p>
<pre><code>
</code></pre>
<p>install:</p>
<pre><code>helm install -f value.yaml stable/grafana


NOTES:
1. Get your 'admin' user password by running:

   kubectl get secret --namespace default nomadic-horse-grafana -o jsonpath=&quot;{.data.admin-password}&quot; | base64 --decode ; echo

2. The Grafana server can be accessed via port 80 on the following DNS name from within your cluster:

   nomadic-horse-grafana.default.svc.cluster.local

   Get the Grafana URL to visit by running these commands in the same shell:

     export POD_NAME=$(kubectl get pods --namespace default -l &quot;app=grafana,release=nomadic-horse&quot; -o jsonpath=&quot;{.items[0].metadata.name}&quot;)
     kubectl --namespace default port-forward $POD_NAME 3000

3. Login with the password from step 1 and the username: admin
#################################################################################
######   WARNING: Persistence is disabled!!! You will lose your data when   #####
######            the Grafana pod is terminated.                            #####
#################################################################################

</code></pre>
<h1><a class="header" href="#sachet" id="sachet">sachet</a></h1>
<h1><a class="header" href="#links-173" id="links-173">Links</a></h1>
<ul>
<li><a href="https://github.com/messagebird/sachet">GitHub - messagebird/sachet: SMS alerts for Prometheus' Alertmanager</a></li>
</ul>
<h1><a class="header" href="#install-20" id="install-20">Install</a></h1>
<pre><code>go get github.com/messagebird/sachet/cmd/sachet
</code></pre>
<h1><a class="header" href="#git-1" id="git-1">Git</a></h1>
<h1><a class="header" href="#links-174" id="links-174">Links</a></h1>
<ul>
<li><a href="https://rogerdudler.github.io/git-guide/">git - the simple guide - no deep shit!</a></li>
<li><a href="https://help.github.com/articles/connecting-to-github-with-ssh/">Connecting to GitHub with SSH - User Documentation</a></li>
<li><a href="https://help.github.com/articles/changing-a-remote-s-url/#switching-remote-urls-from-https-to-ssh">Changing a remote's URL - User Documentation</a></li>
</ul>
<h1><a class="header" href="#ssh-1" id="ssh-1">ssh</a></h1>
<p><strong>Tip:</strong> with ssh,<code>http_proxy</code> in <code>git config</code> won't work.may use <code>proxychains</code> instead.</p>
<pre><code class="language-sh">git remote set-url origin git@github.com:USERNAME/REPOSITORY.git
// Verify new remote URL
git remote -v
</code></pre>
<h1><a class="header" href="#delete-all-commits-history" id="delete-all-commits-history">Delete All Commits History</a></h1>
<p><strong>Links:</strong> <a href="https://gist.github.com/heiswayi/350e2afda8cece810c0f6116dadbe651">GitHub - Delete commits history with git commands</a></p>
<pre><code class="language-sh">rm -rf .git

git init
git remote add origin git@github.com:USERNAME/REPOSITORY.git
git remote -v

git add --all
git commit -am &quot;Initial commit&quot;
git push -f origin master
</code></pre>
<h1><a class="header" href="#create-a-new-branch-with-git-and-manage-branches" id="create-a-new-branch-with-git-and-manage-branches">Create a new branch with git and manage branches</a></h1>
<p><strong>Links:</strong> <a href="https://github.com/Kunena/Kunena-Forum/wiki/Create-a-new-branch-with-git-and-manage-branches">Create a new branch with git and manage branches · Kunena/Kunena-Forum Wiki · GitHub</a></p>
<pre><code class="language-sh">// list
git branch

// create at local
git checkout -b [name_of_your_new_branch]

// Change working branch
git checkout [name_of_your_new_branch]

// Push the branch on remote  
git push origin [name_of_your_new_branch]

// create at remote  
git remote add [name_of_your_remote] [name_of_your_new_branch]

// Push changes from your commit into your branch
git push [name_of_your_new_remote] [url]

// Update your branch when the original branch from official repository has been updated 
git fetch [name_of_your_remote]

// Then you need to apply to merge changes, if your branch is derivated from develop you need to do :
git merge [name_of_your_remote]/develop

// delete at local  
git branch -d &lt;branch_name&gt;

// To force the deletion of local branch on your filesystem :
git branch -D [name_of_your_new_branch]

// delete at remote  
git push -d &lt;remote_name&gt; &lt;branch_name&gt;
</code></pre>
<h1><a class="header" href="#delete-file-from-git-repo" id="delete-file-from-git-repo">Delete File From Git Repo</a></h1>
<p><strong>Links:</strong> <a href="https://stackoverflow.com/a/2047477">git rm - How can I delete a file from git repo? - Stack Overflow</a></p>
<pre><code class="language-sh">git rm file1.txt
git commit -m &quot;remove file1.txt&quot;

// But if you want to remove the file only from the Git repository and not remove it from the filesystem, use:
git rm --cached file1.txt
git commit -m &quot;remove file1.txt&quot;

// And to push changes to remote repo
git push origin branch_name
</code></pre>
<h1><a class="header" href="#merge-with-local-modifications" id="merge-with-local-modifications">Merge With Local Modifications</a></h1>
<p><strong>Links:</strong> <a href="https://stackoverflow.com/a/15745424">How do I resolve git saying &quot;Commit your changes or stash them before you can merge&quot;? - Stack Overflow</a></p>
<p>You can't merge with local modifications. Git protects you from losing potentially important changes.
You have three options: </p>
<ul>
<li>
<p>Stash</p>
<pre><code class="language-sh">git commit -m &quot;My message&quot;
// Stashing acts as a stack, where you can push changes, and you pop them in reverse order.
git stash
// Do the merge, and then pull the stash:
git stash pop
</code></pre>
</li>
<li>
<p>Discard the local changes</p>
<pre><code class="language-sh">git reset --hard
// or
git checkout -t -f remote/branch
</code></pre>
</li>
<li>
<p>Discard local changes for a specific file</p>
<pre><code class="language-sh">git checkout filename
</code></pre>
</li>
</ul>
<h1><a class="header" href="#replace-with-ssh" id="replace-with-ssh">replace with ssh</a></h1>
<p><code>git config --global url.&quot;git@git.xxx.com:&quot;.insteadOf &quot;https://git.xxx.com/&quot;</code></p>
<h1><a class="header" href="#undoing-commits--changes" id="undoing-commits--changes">Undoing Commits &amp; Changes</a></h1>
<h1><a class="header" href="#links-175" id="links-175">Links</a></h1>
<ul>
<li><a href="https://www.atlassian.com/git/tutorials/undoing-changes">Git - Undoing changes | Atlassian Git Tutorial</a><br />
Very good article.</li>
</ul>
<h1><a class="header" href="#overview-37" id="overview-37">Overview</a></h1>
<ul>
<li><code>git revert</code> is the best tool for undoing shared public changes</li>
<li><code>git reset</code> is best used for undoing local private changes</li>
</ul>
<p>infra</p>
<h1><a class="header" href="#a-hrefhttpswwwvagrantupcomvagrant-by-hashicorpa" id="a-hrefhttpswwwvagrantupcomvagrant-by-hashicorpa"><a href="https://www.vagrantup.com/">Vagrant by HashiCorp</a></a></h1>
<h1><a class="header" href="#links-176" id="links-176">Links</a></h1>
<ul>
<li><a href="https://www.vagrantup.com/intro/getting-started/index.html">Getting Started - Vagrant by HashiCorp</a></li>
<li><a href="https://app.vagrantup.com/boxes/search">Discover Vagrant Boxes - Vagrant Cloud</a></li>
</ul>
<h1><a class="header" href="#install-21" id="install-21">Install</a></h1>
<ul>
<li><a href="https://www.vagrantup.com/downloads.html">Download - Vagrant by HashiCorp</a></li>
</ul>
<pre><code>brew cask install vagrant
</code></pre>
<h1><a class="header" href="#basis-3" id="basis-3">Basis</a></h1>
<pre><code>vagrant up
vagrant ssh core-01 -- -A

vagrant plugin update vagrant-ignition

vagrant destroy -f
</code></pre>
<h1><a class="header" href="#boxes" id="boxes">boxes</a></h1>
<ul>
<li><a href="https://www.vagrantup.com/docs/boxes/versioning.html">Box Versioning - Vagrant by HashiCorp</a></li>
</ul>
<pre><code>vagrant box list
vagrant box update
</code></pre>
<h1><a class="header" href="#archlinux" id="archlinux">Archlinux</a></h1>
<ul>
<li><a href="https://app.vagrantup.com/archlinux/boxes/archlinux">Vagrant box archlinux/archlinux - Vagrant Cloud</a></li>
</ul>
<pre><code>vagrant init archlinux/archlinux
vagrant up
</code></pre>
<h1><a class="header" href="#ubuntu" id="ubuntu">Ubuntu</a></h1>
<ul>
<li><a href="https://app.vagrantup.com/ubuntu/boxes/disco64">Vagrant box ubuntu/disco64 - Vagrant Cloud</a></li>
</ul>
<pre><code>// ubuntu 19
vagrant init ubuntu/disco64
vagrant up
</code></pre>
<ul>
<li><a href="https://app.vagrantup.com/ubuntu/boxes/bionic64">Vagrant box ubuntu/bionic64 - Vagrant Cloud</a></li>
</ul>
<pre><code>// ubuntu 18
vagrant init ubuntu/bionic64
vagrant up
</code></pre>
<h1><a class="header" href="#centos7" id="centos7">centos7</a></h1>
<ul>
<li><a href="https://app.vagrantup.com/centos">centos - Vagrant Cloud</a></li>
<li><a href="https://app.vagrantup.com/centos/boxes/7">Vagrant box centos/7 - Vagrant Cloud</a></li>
</ul>
<pre><code>vagrant init centos/7
vagrant up
</code></pre>
<h1><a class="header" href="#forwarded-ports" id="forwarded-ports">Forwarded Ports</a></h1>
<ul>
<li><a href="https://www.vagrantup.com/docs/networking/forwarded_ports.html">Forwarded Ports - Networking - Vagrant by HashiCorp</a></li>
</ul>
<p>This will allow accessing port 80 on the guest via port 8080 on the host.</p>
<pre><code>Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.network &quot;forwarded_port&quot;, guest: 80, host: 8080
  config.vm.network &quot;forwarded_port&quot;, guest: 2003, host: 12003, protocol: &quot;tcp&quot;
  config.vm.network &quot;forwarded_port&quot;, guest: 2003, host: 12003, protocol: &quot;udp&quot;
end
</code></pre>
<h1><a class="header" href="#bridged-networking" id="bridged-networking">Bridged Networking</a></h1>
<pre><code>Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.network &quot;public_network&quot;
end
</code></pre>
<h1><a class="header" href="#multi-machine" id="multi-machine">Multi-Machine</a></h1>
<ul>
<li><a href="https://www.vagrantup.com/docs/multi-machine/">Multi-Machine - Vagrant by HashiCorp</a></li>
</ul>
<pre><code>config.vm.box = &quot;ubuntu/disco64&quot;
config.vm.provision :shell, path: &quot;ss.sh&quot;


config.vm.define &quot;airport&quot; do |airport|
	config.vm.network &quot;public_network&quot;
	airport.vm.network &quot;private_network&quot;, ip: &quot;192.168.33.2&quot;
end

config.vm.define &quot;vps&quot; do |vps|
	vps.vm.network &quot;private_network&quot;, ip: &quot;192.168.33.1&quot;
end
</code></pre>
<p>This will bring up 4 machine:</p>
<pre><code>% cat Vagrantfile
IMAGE_NAME = &quot;centos/7&quot;
M = 2
N = 2

Vagrant.configure(&quot;2&quot;) do |config|

    config.vm.provider &quot;virtualbox&quot; do |v|
        v.memory = 1024
        v.cpus = 2
    end

   (1..M).each do |i|
      config.vm.define &quot;master#{i}&quot; do |master|
        master.vm.box = IMAGE_NAME
        master.vm.network &quot;private_network&quot;, ip: &quot;10.1.1.#{i+10}&quot;
        master.vm.hostname = &quot;master#{i}&quot;
      end
        end

    (1..N).each do |i|
      config.vm.define &quot;node#{i}&quot; do |node|
        node.vm.box = IMAGE_NAME
        node.vm.network &quot;private_network&quot;, ip: &quot;10.1.1.#{i + 12}&quot;
        node.vm.hostname = &quot;node#{i}&quot;
      end
    end
end
</code></pre>
<h1><a class="header" href="#how-to-copy-file-from-a-vagrant-machine-to-local-host" id="how-to-copy-file-from-a-vagrant-machine-to-local-host">How to copy file from a Vagrant machine to local host</a></h1>
<ul>
<li><a href="https://stackoverflow.com/a/46203304">linux - How to copy file from a Vagrant machine to local host - Stack Overflow</a></li>
</ul>
<pre><code>vagrant ssh-config &gt; config.txt
scp -F config.txt default:/path/to/file .
</code></pre>
<h1><a class="header" href="#providers" id="providers">Providers</a></h1>
<h2><a class="header" href="#virtualbox" id="virtualbox">VirtualBox</a></h2>
<ul>
<li><a href="https://www.vagrantup.com/docs/virtualbox/">VirtualBox Provider - Vagrant by HashiCorp</a></li>
</ul>
<p>There are some convenience shortcuts for memory and CPU settings:</p>
<pre><code>config.vm.provider &quot;virtualbox&quot; do |v|
  v.memory = 1024
  v.cpus = 2
end
</code></pre>
<h1><a class="header" href="#plugins-2" id="plugins-2">Plugins</a></h1>
<h2><a class="header" href="#vagrant-disksize" id="vagrant-disksize">vagrant-disksize</a></h2>
<ul>
<li><a href="https://github.com/sprotheroe/vagrant-disksize">GitHub - sprotheroe/vagrant-disksize: Vagrant plugin to resize disks in VirtualBox</a></li>
</ul>
<p>Installation</p>
<pre><code>vagrant plugin install vagrant-disksize
</code></pre>
<p>Usage</p>
<pre><code>Vagrant.configure('2') do |config|
  config.vm.box = 'ubuntu/xenial64'
  config.disksize.size = '50GB'
end
</code></pre>
<h1><a class="header" href="#terraform" id="terraform">Terraform</a></h1>
<p>Infrastructure as Code (IAC)</p>
<h1><a class="header" href="#links-177" id="links-177">Links</a></h1>
<ul>
<li><a href="https://www.terraform.io/docs/providers/index.html">Providers - Terraform by HashiCorp</a>(majority)</li>
<li><a href="https://learn.hashicorp.com/terraform/#getting-started">Terraform Curriculum - HashiCorp Learn</a></li>
<li><a href="https://learn.hashicorp.com/terraform/getting-started/build">Build Infrastructure | Terraform - HashiCorp Learn</a></li>
<li><a href="https://www.terraform.io/docs/index.html">Documentation - Terraform by HashiCorp</a></li>
</ul>
<h1><a class="header" href="#installation-1" id="installation-1">Installation</a></h1>
<p><a href="https://www.terraform.io/downloads.html">Download Terraform - Terraform by HashiCorp</a></p>
<pre><code>go get github.com/hashicorp/terraform
</code></pre>
<h1><a class="header" href="#first-steps" id="first-steps">First Steps</a></h1>
<ul>
<li><code>mkdir foo &amp;&amp; touch example.tf</code></li>
<li><code>terraform init</code><br />
<code>Usage: terraform init [options] [DIR]</code></li>
<li><code>terraform apply</code></li>
<li><code>terraform show</code><br />
Terraform also wrote some data into the <code>terraform.tfstate</code> file.</li>
<li><code>terraform destroy</code></li>
</ul>
<h1><a class="header" href="#shell-tab-completion" id="shell-tab-completion">Shell Tab-completion</a></h1>
<pre><code>terraform -install-autocomplete
terraform -uninstall-autocomplete
</code></pre>
<h1><a class="header" href="#cli-configuration-file" id="cli-configuration-file">CLI Configuration File</a></h1>
<ul>
<li><a href="https://www.terraform.io/docs/commands/cli-config.html">CLI Configuration - Terraform by HashiCorp</a></li>
</ul>
<p><code>.terraformrc</code> or <code>terraform.rc</code></p>
<p>The CLI configuration file configures per-user settings for CLI behaviors,
which apply across all Terraform working directories. </p>
<h1><a class="header" href="#plugins-3" id="plugins-3">Plugins</a></h1>
<ul>
<li><a href="https://www.terraform.io/docs/commands/init.html">Command: init - Terraform by HashiCorp</a></li>
</ul>
<p>For providers distributed by HashiCorp, init will automatically download and
install plugins if necessary. Plugins can also be manually installed in the
user plugins directory, located at <code>~/.terraform.d/plugins</code></p>
<h2><a class="header" href="#provider-plugin-cache" id="provider-plugin-cache">Provider Plugin Cache</a></h2>
<pre><code>// config in .terraformrc

plugin_cache_dir = &quot;$HOME/.terraform.d/plugin-cache&quot;
</code></pre>
<p>This directory must already exist before Terraform will cache plugins;
Terraform will not create the directory itself.</p>
<p>Still need to do <code>cp plugin-cache/* plugins/</code> manually to make <code>terraform plan</code>
work correctly, kind of bug.</p>
<h1><a class="header" href="#providers-1" id="providers-1">Providers</a></h1>
<h2><a class="header" href="#linode-provider" id="linode-provider">Linode Provider</a></h2>
<ul>
<li><a href="https://www.terraform.io/docs/providers/linode/index.html">Provider: Linode - Terraform by HashiCorp</a></li>
<li><a href="https://www.linode.com/docs/applications/configuration-management/beginners-guide-to-terraform/">Linode: A Beginner's Guide to Terraform</a></li>
<li><a href="https://developers.linode.com/api/v4/">Linode API Documentation</a></li>
<li><a href="https://www.linode.com/docs/applications/configuration-management/how-to-build-your-infrastructure-using-terraform-and-linode/">Use Terraform to Provision Linode Environments</a></li>
<li><a href="https://github.com/LinodeContent/terraform-provider-linode">GitHub - LinodeContent/terraform-provider-linode: A terraform plugin for linode</a></li>
</ul>
<h2><a class="header" href="#api-1" id="api-1">API</a></h2>
<ul>
<li><a href="https://api.linode.com/v4/images">images</a></li>
<li><a href="https://api.linode.com/v4/linode/types">types</a></li>
<li><a href="https://api.linode.com/v4/regions">regions</a></li>
</ul>
<h1><a class="header" href="#configuration-language" id="configuration-language">Configuration Language</a></h1>
<h1><a class="header" href="#resource-syntax" id="resource-syntax">Resource Syntax</a></h1>
<p><a href="https://www.terraform.io/docs/configuration/resources.html">Resources - Configuration Language - Terraform by HashiCorp</a></p>
<p>A resource block declares a resource of a given type (&quot;aws_instance&quot;) with
a given local name (&quot;web&quot;). </p>
<h1><a class="header" href="#input-variables" id="input-variables">Input Variables</a></h1>
<p>For all files which match <code>terraform.tfvars</code> or <code>*.auto.tfvars</code> present in the
current directory, Terraform automatically loads them to populate variables. </p>
<p>We <strong>don't recommend</strong> saving usernames and password to version control, but
you can create a local secret variables file and use <code>-var-file</code> to load it.</p>
<h2><a class="header" href="#lists" id="lists">Lists</a></h2>
<pre><code># implicitly by using brackets [...]
variable &quot;cidrs&quot; { default = [] }

# explicitly
variable &quot;cidrs&quot; { type = &quot;list&quot; }

cidrs = [ &quot;10.0.0.0/16&quot;, &quot;10.1.0.0/16&quot; ]
</code></pre>
<h2><a class="header" href="#maps" id="maps">Maps</a></h2>
<h1><a class="header" href="#modules-1" id="modules-1">Modules</a></h1>
<p>Think of modules as similar to functions in programming languages.</p>
<h1><a class="header" href="#a-hrefhttpswwwpackeriopacker-by-hashicorpa" id="a-hrefhttpswwwpackeriopacker-by-hashicorpa"><a href="https://www.packer.io/">Packer by HashiCorp</a></a></h1>
<h1><a class="header" href="#links-178" id="links-178">Links</a></h1>
<ul>
<li><a href="https://www.packer.io/intro/getting-started/install.html">Install Packer - Getting Started - Packer by HashiCorp</a></li>
</ul>
<h1><a class="header" href="#ipxe" id="ipxe">iPXE</a></h1>
<p>iPXE is the leading open source network boot firmware. </p>
<h1><a class="header" href="#links-179" id="links-179">Links</a></h1>
<ul>
<li><a href="https://ipxe.org/howto/chainloading">iPXE - open source boot firmware</a></li>
</ul>
<h1><a class="header" href="#chainloading-ipxe" id="chainloading-ipxe">Chainloading iPXE</a></h1>
<p>Download <a href="http://boot.ipxe.org/undionly.kpxe">undionly.kpxe</a> and save it to
your TFTP server directory.  Configure your DHCP server to hand out
<code>undionly.kpxe</code> as the boot file.</p>
<p>Example <code>/var/lib/tftpboot/pxelinux.cfg/default</code>:</p>
<pre><code>timeout 10
default iPXE
LABEL iPXE
// May I change ipxe.lkrn to undionly.kpxe, so this is the right way ?
KERNEL ipxe.lkrn
APPEND dhcp &amp;&amp; chain http://matchbox.example.com:8080/boot.ipxe
</code></pre>
<h2><a class="header" href="#breaking-the-infinite-loop" id="breaking-the-infinite-loop">Breaking the infinite loop</a></h2>
<p>PXE will load iPXE which will load iPXE which will load iPXE which will load
iPXE… </p>
<h2><a class="header" href="#uefi" id="uefi">UEFI</a></h2>
<p>If you have machines which attempt to perform a UEFI network boot, then
download <a href="http://boot.ipxe.org/ipxe.efi">ipxe.ef</a> and save it to your TFTP
server directory. </p>
<p><strong>Note</strong> that UEFI network booting tends to be substantially slower than BIOS
network booting, due to fundamental architectural limitations in UEFI. Most
UEFI systems provide the ability to perform a network boot in a BIOS
compatibility mode. You may wish to upgrade your system to use BIOS mode for
network booting. </p>
<h1><a class="header" href="#dnsmasq" id="dnsmasq">dnsmasq</a></h1>
<h1><a class="header" href="#links-180" id="links-180">Links</a></h1>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Dnsmasq">dnsmasq - ArchWiki</a></li>
<li><a href="https://unix.stackexchange.com/questions/304050/how-to-avoid-conflicts-between-dnsmasq-and-systemd-resolved">How to avoid conflicts between dnsmasq and systemd-resolved? - Unix &amp; Linux Stack Exchange</a></li>
</ul>
<h1><a class="header" href="#to-disable-dnsmasqs-dns-server-functionality" id="to-disable-dnsmasqs-dns-server-functionality">to disable dnsmasq's DNS server functionality</a></h1>
<pre><code># To disable dnsmasq's DNS server functionality.
port=0
</code></pre>
<h1><a class="header" href="#pxe-enabled-dhcp" id="pxe-enabled-dhcp">PXE-enabled DHCP</a></h1>
<ul>
<li><a href="https://github.com/coreos/matchbox/blob/master/Documentation/network-setup.md">matchbox/network-setup.md at master · coreos/matchbox · GitHub</a></li>
<li><a href="https://github.com/cobbler/cobbler/blob/master/templates/etc/dnsmasq.template">cobbler/dnsmasq.template at master · cobbler/cobbler · GitHub</a></li>
<li><a href="https://github.com/poseidon/matchbox/blob/master/Documentation/network-setup.md#pxe-enabled-dhcp">PXE-enabled DHCP</a></li>
</ul>
<p>Add <a href="http://boot.ipxe.org/ipxe.efi">ipxe.efi</a> and <a href="http://boot.ipxe.org/undionly.kpxe">unidonly.kpxe</a> to your tftp-root (e.g. <code>/var/lib/tftpboot</code>).</p>
<h2><a class="header" href="#tips-1" id="tips-1">Tips</a></h2>
<pre><code>dhcp-ignore=tag:!known
# Set the DHCP server to authoritative mode. In this mode it will barge in
# and take over the lease for any client which broadcasts on the network,
# whether it has a record of the lease or not. This avoids long timeouts
# when a machine wakes up on a new network. DO NOT enable this if there's
# the slightest chance that you might end up accidentally configuring a DHCP
# server for your campus/company accidentally. The ISC server uses
# the same option, and this URL provides more information:
# http://www.isc.org/files/auth.html
dhcp-authoritative

dhcp-range=set:red,192.168.1.1,192.168.1.254,30m
# router
dhcp-option=tag:red,3,192.168.1.254

dhcp-host=11:22:33:44:55:66,12:34:56:78:90:12,192.168.1.60

enable-tftp
tftp-root=/var/lib/tftpboot

# Legacy PXE
dhcp-match=set:bios,option:client-arch,0
dhcp-boot=tag:bios,undionly.kpxe

# UEFI
# If you want to use a separate TFTP server instead of dnsmasq, specify its IP address after the boot-loader path
# dhcp-boot=tag:efi32,ipxe.efi,192.168.1.101
# and it seems we always should put tftp server address here when on UEFI
dhcp-match=set:efi32,option:client-arch,6
dhcp-boot=tag:efi32,ipxe.efi,192.168.1.100
dhcp-match=set:efibc,option:client-arch,7
dhcp-boot=tag:efibc,ipxe.efi,192.168.1.100
dhcp-match=set:efi64,option:client-arch,9
dhcp-boot=tag:efi64,ipxe.efi,192.168.1.100

# iPXE - chainload to matchbox ipxe boot script
dhcp-userclass=set:ipxe,iPXE
dhcp-boot=tag:ipxe,http://matchbox.example.com:8080/boot.ipxe

# verbose
log-queries
log-dhcp

# static DNS assignements
address=/matchbox.example.com/192.168.1.100

# (optional) disable DNS and specify alternate
# port=0
# dhcp-option=6,192.168.1.100
</code></pre>
<h1><a class="header" href="#tftp-server-address-when-on-uefi" id="tftp-server-address-when-on-uefi">tftp server address when on UEFI</a></h1>
<p>it seems we always should put tftp server address here when on UEFI</p>
<pre><code>dhcp-boot=tag:efi32,ipxe.efi,192.168.1.101
</code></pre>
<h1><a class="header" href="#configurable-tftp" id="configurable-tftp">Configurable TFTP</a></h1>
<p><a href="https://ipxe.org/start">iPXE - open source boot firmware</a></p>
<p>If your DHCP server is configured to network boot PXE clients (but not iPXE
clients), add a pxelinux.cfg to serve an iPXE kernel image and append commands.</p>
<p><strong>Only</strong> when you can't control dhcpd's <code>dhcp-boot</code></p>
<p>Example <code>/var/lib/tftpboot/pxelinux.cfg/default</code>:</p>
<pre><code>timeout 10
default iPXE
LABEL iPXE
KERNEL ipxe.krn
APPEND dhcp &amp;&amp; chain http://matchbox.example.com:8080/boot.ipxe
</code></pre>
<p>Add <a href="http://boot.ipxe.org/ipxe.iso">ipxe.krn</a> to <code>/var/lib/tftpboot</code> ,<br />
get it from <a href="http://boot.ipxe.org/ipxe.iso">http://boot.ipxe.org/ipxe.iso</a></p>
<h1><a class="header" href="#matchbox" id="matchbox">matchbox</a></h1>
<h1><a class="header" href="#links-181" id="links-181">Links</a></h1>
<ul>
<li><a href="https://github.com/coreos/matchbox">GitHub - coreos/matchbox: Network boot and provision Container Linux clusters (e.g. etcd3, Kubernetes, more)</a></li>
</ul>
<h1><a class="header" href="#matchbox-concepts" id="matchbox-concepts">matchbox concepts</a></h1>
<ul>
<li><a href="https://coreos.com/matchbox/docs/latest/matchbox.html">Matchbox concepts</a></li>
</ul>
<p><img src="infra/imgs/overview.png" alt="matchbox concepts" /><br />
Image from: <a href="https://coreos.com/matchbox/docs/latest/matchbox.html">Matchbox concepts</a></p>
<h1><a class="header" href="#lifecycle-of-a-physical-machine" id="lifecycle-of-a-physical-machine">Lifecycle of a physical machine</a></h1>
<ul>
<li><a href="https://coreos.com/matchbox/docs/latest/machine-lifecycle.html">Lifecycle of a physical machine</a></li>
</ul>
<p><img src="infra/imgs/machine-lifecycle.png" alt="Lifecycle of a physical machine" /><br />
Image from: <a href="https://coreos.com/matchbox/docs/latest/machine-lifecycle.html">Lifecycle of a physical machine</a></p>
<h1><a class="header" href="#installation-2" id="installation-2">Installation</a></h1>
<p><a href="https://github.com/coreos/matchbox/releases">Releases · coreos/matchbox · GitHub</a></p>
<p>This link is useful, very straightforward:</p>
<p><a href="https://github.com/coreos/matchbox/blob/master/Documentation/deployment.md">matchbox/deployment.md at master · coreos/matchbox · GitHub</a></p>
<h2><a class="header" href="#download-container-linux-optional" id="download-container-linux-optional">Download Container Linux (optional)</a></h2>
<p><a href="https://coreos.com/releases/">CoreOS Container Linux Release</a></p>
<pre><code>./scripts/get-coreos stable 2079.3.0 .     # note the &quot;.&quot; 3rd argument
sudo cp -r coreos /var/lib/matchbox/assets

// verify
curl http://matchbox.example.com:8080/assets/coreos/2079.3.0/
</code></pre>
<h1><a class="header" href="#network-setup" id="network-setup">Network setup</a></h1>
<p><a href="https://github.com/coreos/matchbox/blob/master/Documentation/network-setup.md">matchbox/network-setup.md at master · coreos/matchbox · GitHub</a></p>
<h1><a class="header" href="#getting-started-2" id="getting-started-2">Getting Started</a></h1>
<h2><a class="header" href="#terraform-provider-matchbox" id="terraform-provider-matchbox">terraform-provider-matchbox</a></h2>
<ul>
<li><a href="https://www.terraform.io/downloads.html">Download Terraform - Terraform by HashiCorp</a></li>
<li><a href="https://github.com/poseidon/terraform-provider-matchbox/releases">Releases · poseidon/terraform-provider-matchbox · GitHub</a></li>
</ul>
<h2><a class="header" href="#example-simple-install" id="example-simple-install">Example simple-install</a></h2>
<ul>
<li><a href="https://github.com/poseidon/matchbox/blob/master/Documentation/getting-started.md#first-cluster">matchbox/getting-started.md at master · poseidon/matchbox · GitHub</a></li>
</ul>
<p>After change change <code>terraform.tfvars.example</code> to <code>terraform.tfvars</code>, and
modified it. then run <code>terraform apply</code>, some files will be generated:</p>
<pre><code>$ tree /var/lib/matchbox/
/var/lib/matchbox/
├── assets
├── groups
│   ├── default.json
│   └── node1.json
├── ignition
│   ├── coreos-install.yaml.tmpl
│   └── simple.yaml.tmpl
└── profiles
    ├── coreos-install.json
    └── simple.json

4 directories, 6 files
</code></pre>
<p>and these links will be accessable:</p>
<p>Matchbox serves configs to machines and respects query parameters, if you're
interested:</p>
<ul>
<li>iPXE default - <a href="http://matchbox.example.com:8080/ipxe">/ipxe</a></li>
<li>Ignition default - <a href="http://matchbox.example.com:8080/ignition">/ignition</a></li>
<li>Ignition post-install - <a href="http://matchbox.example.com:8080/ignition?os=installed">/ignition?os=installed</a></li>
<li>GRUB default - <a href="http://matchbox.example.com:8080/grub">/grub</a></li>
</ul>
<h2><a class="header" href="#terraform-provider-matchbox-1" id="terraform-provider-matchbox-1">terraform-provider-matchbox</a></h2>
<p><strong>Provider</strong></p>
<pre><code>// Configure the matchbox provider
provider &quot;matchbox&quot; {
  endpoint = &quot;${var.matchbox_rpc_endpoint}&quot;
  client_cert = &quot;${file(&quot;~/.matchbox/client.crt&quot;)}&quot;
  client_key = &quot;${file(&quot;~/.matchbox/client.key&quot;)}&quot;
  ca         = &quot;${file(&quot;~/.matchbox/ca.crt&quot;)}&quot;
}
</code></pre>
<p><strong>Resources</strong></p>
<pre><code>resource &quot;matchbox_profile&quot; &quot;coreos-install&quot; {
  name = &quot;coreos-install&quot;
  kernel = &quot;https://stable.release.core-os.net/amd64-usr/current/coreos_production_pxe.vmlinuz&quot;
  initrd = [
    &quot;https://stable.release.core-os.net/amd64-usr/current/coreos_production_pxe_image.cpio.gz&quot;
  ]
  args = [
    &quot;coreos.config.url=${var.matchbox_http_endpoint}/ignition?uuid=$${uuid}&amp;mac=$${mac:hexhyp}&quot;,
    &quot;coreos.first_boot=yes&quot;,
    &quot;console=tty0&quot;,
    &quot;console=ttyS0&quot;,
  ]
  container_linux_config = &quot;${file(&quot;./cl/coreos-install.yaml.tmpl&quot;)}&quot;
}
</code></pre>
<p>This group does not have a selector block, so any machines which network boot
from matchbox will match this group and be provisioned using the coreos-install
profile. </p>
<pre><code>resource &quot;matchbox_group&quot; &quot;default&quot; {
  name = &quot;default&quot;
  profile = &quot;${matchbox_profile.coreos-install.name}&quot;
  # no selector means all machines can be matched
  metadata {
    ignition_endpoint = &quot;${var.matchbox_http_endpoint}/ignition&quot;
    ssh_authorized_key = &quot;${var.ssh_authorized_key}&quot;
  }
}
</code></pre>
<h1><a class="header" href="#a-hrefhttpsgithubcomcoreosignitioncoreosignition-first-boot-installer-and-configuration-toola" id="a-hrefhttpsgithubcomcoreosignitioncoreosignition-first-boot-installer-and-configuration-toola"><a href="https://github.com/coreos/ignition">coreos/ignition: First boot installer and configuration tool</a></a></h1>
<h1><a class="header" href="#links-182" id="links-182">Links</a></h1>
<ul>
<li><a href="https://coreos.com/ignition/docs/latest/">Ignition Documentation | Install Ignition with CoreOS</a></li>
<li><a href="https://coreos.com/blog/introducing-ignition.html">Introducing Ignition: The new CoreOS machine provisioning utility | CoreOS</a></li>
<li><a href="https://github.com/coreos/container-linux-config-transpiler/releases">Releases · coreos/container-linux-config-transpiler · GitHub</a></li>
<li><a href="https://coreos.com/os/docs/latest/configuration.html">Configuration Specification | Container Linux | CoreOS</a></li>
</ul>
<p>Ignition, the utility in Container Linux responsible for provisioning the
machine, fetches and executes the Ignition Config. Container Linux directly
consumes the Ignition Config configuration format.</p>
<h1><a class="header" href="#booting-coreos-container-linux-via-pxe" id="booting-coreos-container-linux-via-pxe">Booting CoreOS Container Linux via PXE</a></h1>
<ul>
<li><a href="https://coreos.com/os/docs/latest/booting-with-pxe.html">PXE Boot | Booting CoreOS Container Linux via PXE</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpstyphoonpsdniotyphoona" id="a-hrefhttpstyphoonpsdniotyphoona"><a href="https://typhoon.psdn.io/">Typhoon</a></a></h1>
<h1><a class="header" href="#links-183" id="links-183">Links</a></h1>
<ul>
<li></li>
</ul>
<h1><a class="header" href="#travis-ci" id="travis-ci">travis-ci</a></h1>
<!-- ToC start -->
<!-- ToC end -->
<h1><a class="header" href="#links-184" id="links-184">Links</a></h1>
<ul>
<li><a href="https://docs.travis-ci.com/user/for-beginners">Core Concepts for Beginners - Travis CI</a></li>
<li><a href="https://docs.travis-ci.com/user/getting-started/">Getting started - Travis CI</a></li>
</ul>
<p>在travis的环境里，在<code>script</code> <code>deploy</code> 里的目录相关的，都是相对于仓库的根目录</p>
<h1><a class="header" href="#github-pages-deployment" id="github-pages-deployment">GitHub Pages Deployment</a></h1>
<h1><a class="header" href="#links-185" id="links-185">Links</a></h1>
<ul>
<li><a href="https://docs.travis-ci.com/user/deployment/pages/">GitHub Pages Deployment - Travis CI</a></li>
<li><a href="https://github.com/settings/tokens">Personal Access Tokens</a> </li>
<li><a href="https://docs.travis-ci.com/user/environment-variables#defining-variables-in-repository-settings">Environment Variables - Travis CI</a></li>
</ul>
<p>For a minimal configuration, add the following to your <code>.travis.yml</code>:</p>
<pre><code class="language-yaml">deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
  keep-history: true
  on:
    branch: master
</code></pre>
<h1><a class="header" href="#setting-the-github-token" id="setting-the-github-token">Setting the GitHub token</a></h1>
<p>You’ll need to generate a personal access token with the public_repo or repo scope (repo is required for private repositories). Since the token should be private, you’ll want to pass it to Travis securely in your repository settings or via encrypted variables in .travis.yml.</p>
<p><a href="https://github.com/settings/tokens">Personal Access Tokens</a> </p>
<p><a href="https://docs.travis-ci.com/user/environment-variables#defining-variables-in-repository-settings">Environment Variables - Travis CI</a></p>
<h1><a class="header" href="#报错" id="报错">报错</a></h1>
<p>因为这个报错，我整理这个资料</p>
<p><code>invalid option &quot;--github-token=&quot;</code></p>
<h1><a class="header" href="#ansible" id="ansible">Ansible</a></h1>
<h1><a class="header" href="#links-186" id="links-186">Links</a></h1>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">Installation Guide — Ansible Documentation</a></li>
</ul>
<h1><a class="header" href="#install-22" id="install-22">Install</a></h1>
<pre><code>pip3 install --user ansible
</code></pre>
<h1><a class="header" href="#k8s" id="k8s">k8s</a></h1>
<h1><a class="header" href="#links-187" id="links-187">Links</a></h1>
<h1><a class="header" href="#certified-kubernetes-administrator-cka" id="certified-kubernetes-administrator-cka">Certified Kubernetes Administrator (CKA)</a></h1>
<ul>
<li><a href="https://scriptcrunch.com/kubernetes-exam-guide/">The Complete Certified Kubernetes Administrator (CKA) Exam Guide</a></li>
<li><a href="https://training.linuxfoundation.org/training/introduction-to-kubernetes/">Introduction to Kubernetes (LFS158) - Linux Foundation - Training</a></li>
</ul>
<h1><a class="header" href="#must-1" id="must-1">MUST</a></h1>
<ul>
<li>Backup etcd.</li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgodocorgk8sioclient-goclient-go---godoca" id="a-hrefhttpsgodocorgk8sioclient-goclient-go---godoca"><a href="https://godoc.org/k8s.io/client-go">client-go - GoDoc</a></a></h1>
<h1><a class="header" href="#links-188" id="links-188">Links</a></h1>
<ul>
<li><a href="https://github.com/kubernetes/client-go/">kubernetes/client-go: Go client for Kubernetes.</a> </li>
</ul>
<h1><a class="header" href="#overview-38" id="overview-38">Overview</a></h1>
<p>concepts</p>
<h1><a class="header" href="#a-hrefhttpskubernetesiodocsconceptsservices-networkingingressingress---kubernetesa" id="a-hrefhttpskubernetesiodocsconceptsservices-networkingingressingress---kubernetesa"><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress - Kubernetes</a></a></h1>
<h1><a class="header" href="#links-189" id="links-189">Links</a></h1>
<ul>
<li><a href="https://blog.getambassador.io/kubernetes-ingress-nodeport-load-balancers-and-ingress-controllers-6e29f1c44f2d?gi=33271a43bd46">Kubernetes Ingress 101: NodePort, Load Balancers, and Ingress Controllers</a> </li>
<li><a href="https://stackoverflow.com/questions/45079988/ingress-vs-load-balancer">kubernetes - Ingress vs Load Balancer - Stack Overflow</a></li>
</ul>
<h1><a class="header" href="#does-an-ingress-has-a-port-" id="does-an-ingress-has-a-port-">Does an Ingress has a port ?</a></h1>
<p>I know after all, it must be a silly question.<br />
Wed Sep 25 00:56:51 CST 2019</p>
<ul>
<li><code>Ingress</code> is just routers.</li>
<li><code>LoadBalancer</code> service type automatically deploys an external load balancer to
your <code>NodePort</code>.</li>
<li>An <code>Ingress Controller</code> is responsible for reading the <code>Ingress Resource</code>
information and processing that data accordingly. </li>
</ul>
<p><strong>So, the question is, what makes it possible that both <code>foo.com</code> and <code>bar.com</code>
go in cluster through the same port, port <code>80</code> ?</strong></p>
<p><strong>what I know is, that different services can't bind to the same <code>NodePort</code></strong></p>
<h1><a class="header" href="#the-point-of-loadbalancer" id="the-point-of-loadbalancer">The Point Of LoadBalancer</a></h1>
<pre><code>Regardless of your ingress strategy, you probably will need to start with
an external load balancer. This load balancer will then route traffic to
a Kubernetes service (or ingress) on your cluster that will perform
service-specific routing. In this set up, your load balancer provides a stable
endpoint (IP address) for external traffic to access.

Both ingress controllers and Kubernetes services require an external load
balancer, and, as previously discussed, NodePorts are not designed to be
directly used for production.  
</code></pre>
<h1><a class="header" href="#can-i-just-use-multiple-dns-record-to-every-node-" id="can-i-just-use-multiple-dns-record-to-every-node-">Can I just use multiple DNS record to every node ?</a></h1>
<ul>
<li><a href="https://community.spiceworks.com/topic/336568-single-a-records-multiple-ip-addresses?page=1#entry-2201467">Single A records, multiple IP addresses - DNS - Spiceworks</a></li>
</ul>
<pre><code>You can have multiple A records for the same FQDN. That's how DNS round-robin works.

for example - nslookup www.google.com

Non-authoritative answer:
Name:    www.google.com
Addresses:  2a00:1450:400b:c02::63
          74.125.24.147
          74.125.24.99
          74.125.24.103
          74.125.24.104
          74.125.24.105
          74.125.24.106
</code></pre>
<h1><a class="header" href="#conclusion-1" id="conclusion-1">Conclusion</a></h1>
<p>At this point, I think I don't need a LoadBalancer.</p>
<pre><code>I think it's wrong.  
Fri Sep 27 01:17:53 CST 2019
</code></pre>
<h1><a class="header" href="#haproxy" id="haproxy">HAProxy</a></h1>
<h1><a class="header" href="#links-190" id="links-190">Links</a></h1>
<ul>
<li><a href="https://www.haproxy.org/">HAProxy - The Reliable, High Performance TCP/HTTP Load Balancer</a></li>
<li><a href="https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#2">HAProxy version 2.0.5 - Configuration Manual</a></li>
</ul>
<h1><a class="header" href="#configuration-file-format" id="configuration-file-format">Configuration file format</a></h1>
<pre><code>HAProxy's configuration process involves 3 major sources of parameters :

  - the arguments from the command-line, which always take precedence
  - the &quot;global&quot; section, which sets process-wide parameters
  - the proxies sections which can take form of &quot;defaults&quot;, &quot;listen&quot;,
    &quot;frontend&quot; and &quot;backend&quot;.
</code></pre>
<h1><a class="header" href="#simple" id="simple">Simple</a></h1>
<pre><code>    # Simple configuration for an HTTP proxy listening on port 80 on all
    # interfaces and forwarding requests to a single backend &quot;servers&quot; with a
    # single server &quot;server1&quot; listening on 127.0.0.1:8000
    global
        daemon
        maxconn 256

    defaults
        mode http
        timeout connect 5000ms
        timeout client 50000ms
        timeout server 50000ms

    frontend http-in
        bind *:80
        default_backend servers

    backend servers
        server server1 127.0.0.1:8000 maxconn 32


    # The same configuration defined with a single listen block. Shorter but
    # less expressive, especially in HTTP mode.
    global
        daemon
        maxconn 256

    defaults
        mode http
        timeout connect 5000ms
        timeout client 50000ms
        timeout server 50000ms

    listen http-in
        bind *:80
        server server1 127.0.0.1:8000 maxconn 32
</code></pre>
<p>Assuming haproxy is in $PATH, test these configurations in a shell with:</p>
<pre><code>    $ sudo haproxy -f configuration.conf -c
</code></pre>
<h1><a class="header" href="#global-parameters" id="global-parameters">Global parameters</a></h1>
<ul>
<li><a href="https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#3">Global parameters</a></li>
</ul>
<pre><code>daemon

	Makes the process fork into background. This is the recommended mode of
	operation. It is equivalent to the command line &quot;-D&quot; argument. It can be
	disabled by the command line &quot;-db&quot; argument. This option is ignored in
	systemd mode.


</code></pre>
<h1><a class="header" href="#a-hrefhttpswwwdockercomdockera" id="a-hrefhttpswwwdockercomdockera"><a href="https://www.docker.com/">Docker</a></a></h1>
<h1><a class="header" href="#links-191" id="links-191">Links</a></h1>
<ul>
<li><a href="https://docs.docker.com/get-started/">Get Started, Part 1: Orientation and setup | Docker Documentation</a></li>
<li><a href="https://medium.freecodecamp.org/the-easy-way-to-set-up-docker-on-a-raspberry-pi-7d24ced073ef">The easy way to set up Docker on a Raspberry Pi – freeCodeCamp.org</a></li>
</ul>
<h1><a class="header" href="#install-23" id="install-23">Install</a></h1>
<ul>
<li>
<p>centos</p>
</li>
<li>
<p><a href="https://docs.docker.com/install/linux/docker-ce/centos/">Get Docker Engine - Community for CentOS | Docker Documentation</a></p>
</li>
</ul>
<pre><code># 0
sudo yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2

# 1
sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo

# 2
# Install a specific version
sudo yum install docker-ce-18.09.1 docker-ce-cli-18.09.1 containerd.io

# 3
sudo systemctl start docker
sudo systemctl enable docker

# 4
sudo usermod -aG docker x
</code></pre>
<ul>
<li>Raspberry or Ubuntu 18.04</li>
</ul>
<pre><code>curl -sSL https://get.docker.com | sh

sudo usermod -aG docker x
  -G, --groups GROUPS           new list of supplementary GROUPS
  -a, --append                  append the user to the supplemental GROUPS
                                mentioned by the -G option without removing
                                him/her from other groups

Remember that you will have to log out and back in for this to take effect!

docker run hello-world
</code></pre>
<p>test docker installation</p>
<pre><code>docker version
docker info
docker run hello-world
</code></pre>
<h1><a class="header" href="#logs" id="logs">logs</a></h1>
<pre><code>docker logs [OPTIONS] CONTAINER
</code></pre>
<h1><a class="header" href="#save-and-load-image" id="save-and-load-image">save and load image</a></h1>
<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/save/">docker save | Docker Documentation</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/load/">docker load | Docker Documentation</a></li>
</ul>
<pre><code>// list
docker images

// save
docker save -o busybox.tar busybox

// load
docker load -i busybox.tar
</code></pre>
<h2><a class="header" href="#save-and-load-all-images" id="save-and-load-all-images">save and load all images</a></h2>
<ul>
<li><a href="https://stackoverflow.com/a/54669431">How to save all Docker images and copy to another machine - Stack Overflow</a></li>
</ul>
<pre><code>// save
docker save $(docker images --format '{{.Repository}}:{{.Tag}}') -o allinone.tar

// load
docker load -i allinone.tar
</code></pre>
<h1><a class="header" href="#delete-all-containers-and-images" id="delete-all-containers-and-images">delete all containers and images</a></h1>
<pre><code>docker rm $(docker ps -a -q)
docker rmi $(docker images -q)
</code></pre>
<h1><a class="header" href="#basic-5" id="basic-5">Basic</a></h1>
<p><img src="k8s/docker/img/Container@2x.png" alt="Container" /></p>
<p><img src="k8s/docker/img/VM@2x.png" alt="VM" /></p>
<pre><code class="language-docker">docker build -t friendlyhello .  # Create image using this directory's Dockerfile
docker run -p 4000:80 friendlyhello  # Run &quot;friendlyname&quot; mapping port 4000 to 80
docker run -d -p 4000:80 friendlyhello         # Same thing, but in detached mode

docker container ls                                # List all running containers
docker container ls -a             # List all containers, even those not running
docker container ls -aq					     # all in quiet mode
docker container stop &lt;hash&gt;           # Gracefully stop the specified container
docker container kill &lt;hash&gt;         # Force shutdown of the specified container
docker container rm &lt;hash&gt;        # Remove specified container from this machine
docker container rm $(docker container ls -a -q)         # Remove all containers

docker image ls -a                             # List all images on this machine
docker image rm &lt;image id&gt;            # Remove specified image from this machine
docker image rm $(docker image ls -a -q)   # Remove all images from this machine

docker login             # Log in this CLI session using your Docker credentials
docker tag &lt;image&gt; username/repository:tag  # Tag &lt;image&gt; for upload to registry
docker push username/repository:tag            # Upload tagged image to registry
docker run username/repository:tag                   # Run image from a registry
</code></pre>
<h1><a class="header" href="#docker-compose" id="docker-compose">Docker Compose</a></h1>
<ul>
<li><a href="https://github.com/docker/compose/releases">Releases · docker/compose · GitHub</a></li>
</ul>
<pre><code>curl -L https://github.com/docker/compose/releases/download/1.25.0-rc2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
</code></pre>
<h1><a class="header" href="#kubeadm-quickstart" id="kubeadm-quickstart">kubeadm quickstart</a></h1>
<h1><a class="header" href="#links-192" id="links-192">Links</a></h1>
<ul>
<li><a href="https://www.katacoda.com/loodse/courses/kubernetes/kubernetes-03-cluster-setup">Setup a kubernetes cluster with kubeadm | loodse | Katacoda</a></li>
<li><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-config/">kubeadm config - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#steps-1" id="steps-1">Steps</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/">Installing kubeadm - Kubernetes</a></li>
<li><a href="https://docs.docker.com/install/linux/docker-ce/centos/">Get Docker Engine - Community for CentOS | Docker Documentation</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">Install and Set Up kubectl - Kubernetes</a></li>
</ul>
<h2><a class="header" href="#install-cri" id="install-cri">Install CRI</a></h2>
<h2><a class="header" href="#systemd" id="systemd">systemd</a></h2>
<h2><a class="header" href="#swapoff--a" id="swapoff--a">swapoff -a</a></h2>
<p>and also delete swap in <code>/etc/fstab</code></p>
<h2><a class="header" href="#installing-kubeadm-kubelet-and-kubectl" id="installing-kubeadm-kubelet-and-kubectl">Installing kubeadm, kubelet and kubectl</a></h2>
<p>There are some nodes on centos7:</p>
<ul>
<li>
<p>Setting SELinux in permissive</p>
<pre><code># Set SELinux in permissive mode (effectively disabling it)
setenforce 0
sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config
</code></pre>
</li>
<li>
<p>Some users on RHEL/CentOS 7 have reported issues with traffic being routed
incorrectly due to iptables being bypassed. You should ensure
net.bridge.bridge-nf-call-iptables is set to 1 in your sysctl config, e.g.</p>
<pre><code>cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system
</code></pre>
</li>
<li>
<p>Make sure that the <code>br_netfilter</code> module is loaded before this step. This can
be done by running <code>lsmod | grep br_netfilter</code>. To load it explicitly call
<code>modprobe br_netfilter</code>.</p>
</li>
</ul>
<pre><code>cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF

yumdownloader --resolve kubelet kubeadm kubectl --disableexcludes=kubernetes
sudo um localinstall *

systemctl enable --now kubelet
</code></pre>
<h2><a class="header" href="#config---nodeip" id="config---nodeip">Config --nodeip</a></h2>
<ul>
<li><a href="https://github.com/kubernetes/kubeadm/issues/203">kubeadm should make the --node-ip option available · Issue #203 · kubernetes/kubeadm · GitHub</a></li>
</ul>
<p><strong>This Step is important, before come up with this, several days life have been
taken, due to vagrant's default NAT interface</strong></p>
<p>Mon Oct 07 21:01:41 CST 2019</p>
<p>In <code>/etc/sysconfig/kubelet</code>:<br />
on <code>ubuntu</code> use <code>/etc/default/kubelet</code>:</p>
<pre><code>KUBELET_EXTRA_ARGS=--node-ip=10.1.1.11
</code></pre>
<p>then</p>
<pre><code>systemctl daemon-reload
systemctl restart kubelet
</code></pre>
<p>The kubelet is now restarting every few seconds, as it waits in a crashloop for
kubeadm to tell it what to do.</p>
<h2><a class="header" href="#docker-load-images" id="docker-load-images">docker load images</a></h2>
<pre><code>// save
docker save $(docker images --format '{{.Repository}}:{{.Tag}}') -o allinone.tar

// load
docker load -i allinone.tar
</code></pre>
<h2><a class="header" href="#on-master" id="on-master">On master</a></h2>
<pre><code>// 1
$ kubeadm config images pull
// output
[config/images] Pulled k8s.gcr.io/kube-apiserver:v1.16.0
[config/images] Pulled k8s.gcr.io/kube-controller-manager:v1.16.0
[config/images] Pulled k8s.gcr.io/kube-scheduler:v1.16.0
[config/images] Pulled k8s.gcr.io/kube-proxy:v1.16.0
[config/images] Pulled k8s.gcr.io/pause:3.1
[config/images] Pulled k8s.gcr.io/etcd:3.3.15-0
[config/images] Pulled k8s.gcr.io/coredns:1.6.2

// 2
master $ kubeadm init --pod-network-cidr=192.168.0.0/16
// output
I0915 13:37:12.697153   16228 version.go:240] remote version is much newer: v1.15.3; falling back to: stable-1.14
[init] Using Kubernetes version: v1.14.6
[preflight] Running pre-flight checks
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Activating the kubelet service
[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;
[certs] Generating &quot;front-proxy-ca&quot; certificate and key
[certs] Generating &quot;front-proxy-client&quot; certificate and key
[certs] Generating &quot;etcd/ca&quot; certificate and key
[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
[certs] Generating &quot;etcd/peer&quot; certificate and key
[certs] etcd/peer serving cert is signed for DNS names [master localhost] and IPs [172.17.0.35 127.0.0.1 ::1]
[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key
[certs] Generating &quot;etcd/server&quot; certificate and key
[certs] etcd/server serving cert is signed for DNS names [master localhost] and IPs [172.17.0.35 127.0.0.1 ::1]
[certs] Generating &quot;ca&quot; certificate and key
[certs] Generating &quot;apiserver&quot; certificate and key
[certs] apiserver serving cert is signed for DNS names [master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 172.17.0.35]
[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
[certs] Generating &quot;sa&quot; key and public key
[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;
[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;
[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s
[apiclient] All control plane components are healthy after 17.503286 seconds
[upload-config] storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.14&quot; in namespace kube-system with the configuration for the kubelets inthe cluster
[upload-certs] Skipping phase. Please see --experimental-upload-certs
[mark-control-plane] Marking the node master as control-plane by adding the label &quot;node-role.kubernetes.io/master=''&quot;
[mark-control-plane] Marking the node master as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]
[bootstrap-token] Using token: z36he9.hlio8gqvxognvuuk
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 172.17.0.35:6443 --token z36he9.hlio8gqvxognvuuk \
    --discovery-token-ca-cert-hash sha256:a4f314dd5f59656e0a42699b5ac5ac962e6b29914f4d2b0732d202dd997cf139

// 3
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

// 4
curl https://docs.projectcalico.org/v3.9/manifests/calico-typha.yaml -o calico.yaml
kubectl apply -f calico.yaml
</code></pre>
<h2><a class="header" href="#on-node" id="on-node">On node</a></h2>
<pre><code>// 1
node01 $ kubeadm join 172.17.0.35:6443 --token z36he9.hlio8gqvxognvuuk \
&gt;     --discovery-token-ca-cert-hash sha256:a4f314dd5f59656e0a42699b5ac5ac962e6b29914f4d2b0732d202dd997cf139
// output
[preflight] Running pre-flight checks
[preflight] Reading configuration from the cluster...
[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[kubelet-start] Downloading configuration for the kubelet from the &quot;kubelet-config-1.14&quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Activating the kubelet service
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
</code></pre>
<h1><a class="header" href="#more-about-networking" id="more-about-networking">More about Networking</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">Installing Addons - Kubernetes</a></li>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/">Cluster Networking - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#creating-highly-available-clusters-with-kubeadm" id="creating-highly-available-clusters-with-kubeadm">Creating Highly Available clusters with kubeadm</a></h1>
<h1><a class="header" href="#links-193" id="links-193">Links</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/">Creating Highly Available clusters with kubeadm - Kubernetes</a></li>
<li><a href="https://v1-12.docs.kubernetes.io/docs/setup/independent/high-availability/">Creating Highly Available Clusters with kubeadm - V1-12</a></li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/setup-ha-etcd-with-kubeadm/">Set up a High Availability etcd cluster with kubeadm - Kubernetes</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/clustering.md">etcd/clustering.md at master · etcd-io/etcd · GitHub</a></li>
</ul>
<h1><a class="header" href="#options-for-highly-available-topology" id="options-for-highly-available-topology">Options for Highly Available topology</a></h1>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/">Options for Highly Available topology - Kubernetes</a></p>
</li>
<li>
<p>With stacked control plane nodes. This approach requires less infrastructure.
The etcd members and control plane nodes are co-located.</p>
</li>
<li>
<p>With an external etcd cluster. This approach requires more infrastructure.
The control plane nodes and etcd members are separated.</p>
</li>
</ul>
<h1><a class="header" href="#first-steps-1" id="first-steps-1">First Steps</a></h1>
<ul>
<li><a href="https://www.haproxy.org/">HAProxy - The Reliable, High Performance TCP/HTTP Load Balancer</a></li>
</ul>
<h2><a class="header" href="#create-load-balancer-for-kube-apiserver" id="create-load-balancer-for-kube-apiserver">Create load balancer for kube-apiserver</a></h2>
<ol>
<li>Create a kube-apiserver load balancer with a name that resolves to DNS.<br />
<strong>MUST</strong>: make sure DNS works correctly, at least put it in <code>/etc/hosts</code>,
and write a record has current hostname in the <code>/etc/hosts</code></li>
<li>Add control plane nodes to the load balancer and test the connection:<br />
<code>nc -v LOAD_BALANCER_IP PORT</code></li>
</ol>
<p>haproxy.cfg:</p>
<pre><code>listen k8s
    bind *:443
	mode tcp
    server master1 10.1.1.11:6443 check fall 3 rise 2
    server master2 10.1.1.12:6443 check fall 3 rise 2
</code></pre>
<p>Config /etc/hosts</p>
<pre><code>10.1.1.11 k8s.go
</code></pre>
<h2><a class="header" href="#kubeadm-config-image-pull" id="kubeadm-config-image-pull">kubeadm config image pull</a></h2>
<h1><a class="header" href="#steps-for-the-first-control-plane-node" id="steps-for-the-first-control-plane-node">Steps for the first control plane node</a></h1>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/issues/33618">Issue when using kubeadm with multiple network interfaces · Issue #33618 · kubernetes/kubernetes · GitHub</a></li>
</ul>
<h1><a class="header" href="#kubeadm-api" id="kubeadm-api">kubeadm api</a></h1>
<ul>
<li><a href="https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta2">v1beta2 - GoDoc</a></li>
</ul>
<p>To print the defaults for &quot;init&quot; and &quot;join&quot; actions use the following commands:</p>
<pre><code>kubeadm config print init-defaults
kubeadm config print join-defaults
</code></pre>
<p>Example Config File:</p>
<pre><code>apiVersion: kubeadm.k8s.io/v1beta2
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 10.1.1.11
  bindPort: 6443
nodeRegistration:
  name: master1
---
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
clusterName: k8s.go
controlPlaneEndpoint: k8s.go
imageRepository: k8s.gcr.io
networking:
  dnsDomain: k8s.go
  serviceSubnet: 10.96.0.0/12
  podSubnet: 192.168.0.0/16
</code></pre>
<ol>
<li>kubeadm init</li>
</ol>
<pre><code>sudo kubeadm init --node-name master01 --apiserver-advertise-address 10.1.1.11 \
     --control-plane-endpoint k8s.go \
	 --pod-network-cidr 192.168.0.0/16 \
	 --service-dns-domain k8s.go \
	 --upload-certs \
	 -v 5
</code></pre>
<p>some options:</p>
<pre><code>  --config string                        Path to a kubeadm configuration file.

  --upload-certs                         Upload control-plane certificates to the kubeadm-certs Secret.
  --node-name string                     Specify the node name.
  --apiserver-advertise-address string   The IP address the API Server will advertise it's listening on.If not set the default network interface will be used
  --control-plane-endpoint string        Specify a stable IP address or DNS name for the control plane.
  --pod-network-cidr string              Specify range of IP addresses for the pod network. If set, the control plane will automatically allocate CIDRs for every node.
  --service-dns-domain string            Use alternative domain for services, e.g. &quot;myorg.internal&quot;. (default &quot;cluster.local&quot;)
  --image-repository string              Choose a container registry to pull control plane images from (default &quot;k8s.gcr.io&quot;)

Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use
&quot;kubeadm init phase upload-certs --upload-certs&quot; to reload certs afterward.
</code></pre>
<ol start="2">
<li>
<p>Write the output join commands that are returned to a text file for later use.</p>
</li>
<li>
<p>Install CNI</p>
</li>
<li>
<p>kubeadm join</p>
</li>
</ol>
<ul>
<li><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-token/">kubeadm token - Kubernetes</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/issues/33618#issuecomment-516114988">issue with multiple interface when kubeadm join</a>:</li>
</ul>
<p>Config /etc/hosts</p>
<pre><code># must not config master02 in hosts when use vagrant
10.1.1.11 k8s.go
</code></pre>
<pre><code>// control-plane
sudo kubeadm join k8s.go:6443 --token xxx.xxx \
  --discovery-token-ca-cert-hash sha256:xxx \
  --control-plane --certificate-key xxx \
  --apiserver-advertise-address 10.1.1.12 \
  --node-name master02 \
  -v 5

// worker
kubeadm join k8s.go:6443 --token xxx.xxx \
    --discovery-token-ca-cert-hash sha256:xxx \
	--node-name node01 \
	-v 5
</code></pre>
<h1><a class="header" href="#web-ui-dashboard" id="web-ui-dashboard">Web UI (Dashboard)</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Web UI (Dashboard) - Kubernetes</a></li>
<li><a href="https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md">dashboard/creating-sample-user.md at master · kubernetes/dashboard · GitHub</a></li>
</ul>
<h2><a class="header" href="#create-user" id="create-user">Create user</a></h2>
<pre><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
</code></pre>
<h2><a class="header" href="#bearer-token" id="bearer-token">Bearer Token</a></h2>
<pre><code>kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')
</code></pre>
<h1><a class="header" href="#tear-down" id="tear-down">Tear down</a></h1>
<ul>
<li><a href="https://v1-13.docs.kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#tear-down">Creating a single master cluster with kubeadm - Kubernetes</a></li>
</ul>
<pre><code>kubectl drain &lt;node name&gt; --delete-local-data --force --ignore-daemonsets
kubectl delete node &lt;node name&gt;
</code></pre>
<p>Then, on the node being removed, reset all kubeadm installed state:</p>
<pre><code>kubeadm reset
</code></pre>
<p>Then:</p>
<pre><code>iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X
// or
ipvsadm -C
</code></pre>
<h1><a class="header" href="#calico-secure-networking-for-the-cloud-native-era" id="calico-secure-networking-for-the-cloud-native-era">Calico: Secure networking for the cloud native era</a></h1>
<h1><a class="header" href="#links-194" id="links-194">Links</a></h1>
<ul>
<li><a href="https://docs.projectcalico.org/v3.9/getting-started/kubernetes/installation/calico">Installing Calico for policy and networking (recommended)</a></li>
</ul>
<h1><a class="header" href="#install-24" id="install-24">Install</a></h1>
<p><strong>Note</strong>: </p>
<p><code>pod-network-cidr</code> can't assign save network as node.</p>
<pre><code>// 1
curl https://docs.projectcalico.org/v3.9/manifests/calico.yaml -O

// 2
POD_CIDR=&quot;&lt;your-pod-cidr&gt;&quot; \
sed -i -e &quot;s?192.168.0.0/16?$POD_CIDR?g&quot; calico.yaml

// 3
kubectl apply -f calico.yaml
</code></pre>
<h1><a class="header" href="#kubectl" id="kubectl">kubectl</a></h1>
<h1><a class="header" href="#links-195" id="links-195">Links</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">Organizing Cluster Access Using kubeconfig Files - Kubernetes</a></li>
<li><a href="https://ahmet.im/blog/mastering-kubeconfig/">Mastering the KUBECONFIG file</a></li>
</ul>
<h1><a class="header" href="#kubeconfig" id="kubeconfig">kubeconfig</a></h1>
<h1><a class="header" href="#kubeconfig-1" id="kubeconfig-1">KUBECONFIG</a></h1>
<p>If the <code>KUBECONFIG</code> environment variable does exist, kubectl uses an effective
configuration that is the result of merging the files listed in the
<code>KUBECONFIG</code> environment variable.</p>
<h1><a class="header" href="#completion" id="completion">Completion</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#kubectl-autocompletion-2">Install and Set Up kubectl - Kubernetes</a></li>
</ul>
<pre><code>// bash
echo 'source &lt;(kubectl completion bash)' &gt;&gt;~/.bashrc
echo 'alias k=kubectl' &gt;&gt;~/.bashrc
echo 'complete -F __start_kubectl k' &gt;&gt;~/.bashrc

// zsh
echo 'source &lt;(kubectl completion zsh)' &gt;&gt; ~/.zshrc
echo 'alias k=kubectl' &gt;&gt;~/.zshrc
echo 'complete -F __start_kubectl k' &gt;&gt;~/.zshrc

// zsh need these lines in .zshrc, or you will get an error like complete:13: command not found: compdef
autoload -Uz compinit
compinit
</code></pre>
<h1><a class="header" href="#kubernetes" id="kubernetes">Kubernetes</a></h1>
<h1><a class="header" href="#links-196" id="links-196">Links</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/reference/">Reference - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#kubernetes-setup-using-ansible-and-vagrant" id="kubernetes-setup-using-ansible-and-vagrant">Kubernetes Setup Using Ansible and Vagrant</a></h1>
<ul>
<li><a href="https://kubernetes.io/blog/2019/03/15/kubernetes-setup-using-ansible-and-vagrant/">Kubernetes Setup Using Ansible and Vagrant - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#concepts" id="concepts">Concepts</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/">Concepts - Kubernetes</a></li>
<li><a href="https://www.youtube.com/watch?v=ZuIQurh_kDk">Kubernetes Design Principles: Understand the Why - Saad Ali, Google - YouTube</a>(<strong>Good</strong>)</li>
</ul>
<h1><a class="header" href="#services" id="services">Services</a></h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=5lzUpDtmWgM&amp;list=PL2We04F3Y_43dAehLMT5GxJhtk3mJtkl5&amp;index=10">Kubernetes - Services Explained - YouTube</a></li>
</ul>
<h1><a class="header" href="#ingress" id="ingress">Ingress</a></h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=VicH6KojwCI&amp;feature=youtu.be">Kubernetes Ingress Explained For Beginners - YouTube</a></li>
</ul>
<h1><a class="header" href="#volumes" id="volumes">Volumes</a></h1>
<h2><a class="header" href="#type-of-volumes" id="type-of-volumes">Type of Volumes</a></h2>
<ul>
<li>configMap</li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">Configure a Pod to Use a ConfigMap - Kubernetes</a>(<strong>good</strong>)</li>
</ul>
<pre><code>kubectl create configmap &lt;map-name&gt; &lt;data-source&gt;
kubectl create configmap game-config --from-file=configure-pod-container/configmap/
kubectl create configmap game-config-3 --from-file=&lt;my-key-name&gt;=&lt;path-to-file&gt;
kubectl create configmap special-config --from-literal=special.how=very --from-literal=special.type=charm
</code></pre>
<h1><a class="header" href="#kubernetes-basics" id="kubernetes-basics">Kubernetes Basics</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/">Learn Kubernetes Basics - Kubernetes</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployments - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#code-2" id="code-2">Code</a></h1>
<ul>
<li><a href="https://github.com/kubernetes/community/tree/master/contributors/devel#readme">community/contributors/devel at master · kubernetes/community · GitHub</a></li>
</ul>
<h1><a class="header" href="#cheat-sheet" id="cheat-sheet">Cheat Sheet</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">kubectl Cheat Sheet - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#install-and-set-up-kubectl" id="install-and-set-up-kubectl">Install and Set Up kubectl</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-on-macos">Install and Set Up kubectl - Kubernetes</a></li>
<li><a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">Configure Access to Multiple Clusters - Kubernetes</a></li>
</ul>
<pre><code>source &lt;(kubectl completion bash) # setup autocomplete in bash into the current shell, bash-completion package should be installed first.
echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc # add autocomplete permanently to your bash shell.

alias k=kubectl
complete -F __start_kubectl k


source &lt;(kubectl completion zsh)  # setup autocomplete in zsh into the current shell
echo &quot;if [ $commands[kubectl] ]; then source &lt;(kubectl completion zsh); fi&quot; &gt;&gt; ~/.zshrc # add autocomplete permanently to your zsh shell
</code></pre>
<h1><a class="header" href="#install-minikube" id="install-minikube">Install minikube</a></h1>
<pre><code>curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 \
  &amp;&amp; chmod +x minikube

sudo mv minikube /usr/local/bin

minikube start
minikube stop
minikube delete

minikube dashboard
// or
kubectl proxy
// access the Dashboard over this url
http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/kubernetes-dashboard:/proxy/#!/overview?namespace=default 
</code></pre>
<h1><a class="header" href="#etcd" id="etcd">etcd</a></h1>
<h1><a class="header" href="#links-197" id="links-197">Links</a></h1>
<ul>
<li><a href="https://github.com/etcd-io/etcd/tree/master/Documentation">etcd/Documentation at master · etcd-io/etcd · GitHub</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/faq.md">etcd/faq.md at master · etcd-io/etcd · GitHub</a></li>
</ul>
<h1><a class="header" href="#getting-started-3" id="getting-started-3">Getting Started</a></h1>
<p><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/dl_build.md">etcd/dl_build.md at master · etcd-io/etcd · GitHub</a></p>
<h1><a class="header" href="#install-25" id="install-25">Install</a></h1>
<p><a href="https://github.com/etcd-io/etcd/releases/">Releases · etcd-io/etcd · GitHub</a></p>
<pre><code>go get -v go.etcd.io/etcd
go get -v go.etcd.io/etcd/etcdctl

// start
etcd

// test
etcdctl put foo bar
// Should Output: OK
</code></pre>
<h1><a class="header" href="#demo" id="demo">Demo</a></h1>
<p>Very Straightforward</p>
<p><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/demo.md">etcd/demo.md at master · etcd-io/etcd · GitHub</a></p>
<h1><a class="header" href="#local-multi-member-cluster" id="local-multi-member-cluster">Local multi-member cluster</a></h1>
<p><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/dev-guide/local_cluster.md">etcd/local_cluster.md at master · etcd-io/etcd · GitHub</a></p>
<h1><a class="header" href="#clustering" id="clustering">Clustering</a></h1>
<ul>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/clustering.md">etcd/clustering.md at master · etcd-io/etcd · GitHub</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/runtime-configuration.md">etcd/runtime-configuration.md at master · etcd-io/etcd · GitHub</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/runtime-reconf-design.md">etcd/runtime-reconf-design.md at master · etcd-io/etcd · GitHub</a></li>
</ul>
<h1><a class="header" href="#backing-up-an-etcd-cluster" id="backing-up-an-etcd-cluster">Backing up an etcd cluster</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster">Operating etcd clusters for Kubernetes - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpshelmshhelma" id="a-hrefhttpshelmshhelma"><a href="https://helm.sh/">Helm</a></a></h1>
<h1><a class="header" href="#links-198" id="links-198">Links</a></h1>
<h1><a class="header" href="#install-26" id="install-26">Install</a></h1>
<pre><code>// macOS
brew install kubernetes-helm

// linux
curl -L https://git.io/get_helm.sh | bash
helm init

// example
$ helm repo update
$ helm install stable/traefik
</code></pre>
<h1><a class="header" href="#issue" id="issue">Issue</a></h1>
<p>*. Error: Get https://10.96.0.1:443/api/v1/namespaces/kube-system/configmaps?labelSelector=OWNER%!D(MISSING)TILLER: dial tcp 10.96.0.1:443: i/o timeout</p>
<p><strong>Answers</strong>:</p>
<p>It's a calico's error. pod_network_cidr can't be same as node's IP.</p>
<ul>
<li>Helm: Error: no available release name found</li>
</ul>
<p>Answer:</p>
<p><a href="https://stackoverflow.com/questions/43499971/helm-error-no-available-release-name-found/45306258#45306258">kubernetes - Helm: Error: no available release name found - Stack Overflow</a></p>
<pre><code>kubectl create serviceaccount --namespace kube-system tiller
kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller
kubectl patch deploy --namespace kube-system tiller-deploy -p '{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccount&quot;:&quot;tiller&quot;}}}}'
</code></pre>
<h1><a class="header" href="#plugins-4" id="plugins-4">Plugins</a></h1>
<ul>
<li><a href="https://helm.sh/docs/related/#helm-plugins">Helm Plugins</a></li>
</ul>
<h1><a class="header" href="#rook" id="rook">Rook</a></h1>
<h1><a class="header" href="#links-199" id="links-199">Links</a></h1>
<ul>
<li><a href="https://rook.github.io/docs/rook/v1.1/">Rook Docs</a></li>
<li><a href="https://rook.github.io/docs/rook/v1.1/ceph-quickstart.html">Rook Docs</a></li>
</ul>
<h1><a class="header" href="#install-27" id="install-27">Install</a></h1>
<ul>
<li><a href="https://rook.io/docs/rook/v1.1/k8s-pre-reqs.html">Rook Docs: k8s-pre-reqs</a></li>
</ul>
<p>Rook Ceph requires a Linux kernel built with the RBD module. </p>
<pre><code>modprobe rbd
</code></pre>
<p>LVM package</p>
<pre><code># Centos
sudo yum install -y lvm2

# Ubuntu
sudo apt-get install -y lvm2
</code></pre>
<h2><a class="header" href="#deploy-the-rook-operator" id="deploy-the-rook-operator">Deploy the Rook Operator</a></h2>
<p>It is recommended that the rook operator be installed into the rook-ceph
namespace (you will install your clusters into separate namespaces).</p>
<ul>
<li><a href="https://rook.io/docs/rook/v1.1/helm-operator.html">helm-operator</a></li>
</ul>
<pre><code>helm repo add rook-release https://charts.rook.io/release
helm search rook-ceph
helm install --namespace rook-ceph rook-release/rook-ceph

// or
helm fetch rook-release/rook-ceph
// custom value
helm install --namespace rook-ceph -f value.custom.yaml rook-release/rook-ceph 

// output
NOTES:
The Rook Operator has been installed. Check its status by running:
 kubectl --namespace rook-ceph get pods -l &quot;app=rook-ceph-operator&quot;

Visit https://rook.io/docs/rook/master for instructions on how to create and configure Rook clusters

Note: You cannot just create a CephCluster resource, you need to also create a namespace and
install suitable RBAC roles and role bindings for the cluster. The Rook Operator will not do
this for you. Sample CephCluster manifest templates that include RBAC resources are available:

- https://rook.github.io/docs/rook/master/ceph-quickstart.html
- https://github.com/rook/rook/blob/master/cluster/examples/kubernetes/ceph/cluster.yaml

Important Notes:
- The links above are for the unreleased master version, if you deploy a different release you must find matching manifests.
- You must customise the 'CephCluster' resource at the bottom of the sample manifests to met your situation.
- Each CephCluster must be deployed to its own namespace, the samples use `rook-ceph` for the cluster.
- The sample manifests assume you also installed the rook-ceph operator in the `rook-ceph` namespace.
- The helm chart includes all the RBAC required to create a CephCluster CRD in the same namespace.
- Any disk devices you add to the cluster in the 'CephCluster' must be empty (no filesystem and no partitions).
- In the 'CephCluster' you must refer to disk devices by their '/dev/something' name, e.g. 'sdb' or 'xvde'.
</code></pre>
<h2><a class="header" href="#create-a-rook-ceph-cluster" id="create-a-rook-ceph-cluster">Create a Rook Ceph Cluster</a></h2>
<ul>
<li><a href="https://rook.io/docs/rook/v1.1/ceph-cluster-crd.html">ceph-cluster-crd</a></li>
</ul>
<h1><a class="header" href="#production-environments" id="production-environments">Production Environments</a></h1>
<ul>
<li><a href="https://rook.io/docs/rook/v1.1/ceph-examples.html">ceph-examples</a></li>
<li><a href="https://rook.io/docs/rook/v1.1/ceph-common-issues.html">Ceph Common Issues</a></li>
</ul>
<h1><a class="header" href="#rook-toolbox" id="rook-toolbox">Rook Toolbox</a></h1>
<ul>
<li><a href="https://rook.io/docs/rook/v1.1/ceph-toolbox.html">Rook Toolbox</a></li>
</ul>
<pre><code>kubectl -n rook-ceph exec -it $(kubectl -n rook-ceph get pod -l &quot;app=rook-ceph-tools&quot; -o jsonpath='{.items[0].metadata.name}') bash

ceph status
ceph osd status
ceph df
rados df
</code></pre>
<h1><a class="header" href="#harbor" id="harbor">Harbor</a></h1>
<h1><a class="header" href="#links-200" id="links-200">Links</a></h1>
<h1><a class="header" href="#install-28" id="install-28">Install</a></h1>
<ul>
<li>
<p><a href="https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md">harbor/installation_guide.md at master · goharbor/harbor · GitHub</a></p>
</li>
<li>
<p><a href="https://github.com/goharbor/harbor/releases">Releases · goharbor/harbor · GitHub</a></p>
</li>
<li>
<p><a href="https://github.com/goharbor/harbor/blob/master/docs/configure_https.md">harbor/configure_https.md at master · goharbor/harbor · GitHub</a></p>
</li>
</ul>
<h1><a class="header" href="#a-hrefhttpstraefikiotraefik---the-cloud-native-edge-routera" id="a-hrefhttpstraefikiotraefik---the-cloud-native-edge-routera"><a href="https://traefik.io/">Traefik - The Cloud Native Edge Router</a></a></h1>
<h1><a class="header" href="#links-201" id="links-201">Links</a></h1>
<ul>
<li><a href="https://docs.traefik.io/user-guide/kubernetes/">Kubernetes - Traefik</a></li>
</ul>
<h1><a class="header" href="#install-29" id="install-29">Install</a></h1>
<ul>
<li><a href="https://github.com/helm/charts/tree/master/stable/traefik">charts/stable/traefik at master · helm/charts · GitHub</a></li>
</ul>
<p>value:</p>
<pre><code>$ cat value.yaml
rbac:
  enabled: true
dashboard:
  enabled: true
  domain: traefik.l
</code></pre>
<p>install:</p>
<pre><code>$ helm install --namespace kube-system --values value.yaml stable/traefik
NAME:   agile-lobster
LAST DEPLOYED: Fri Aug 30 23:56:23 2019
NAMESPACE: kube-system
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/ClusterRole
NAME                   AGE
agile-lobster-traefik  3s

==&gt; v1/ClusterRoleBinding
NAME                   AGE
agile-lobster-traefik  3s

==&gt; v1/ConfigMap
NAME                        DATA  AGE
agile-lobster-traefik       1     3s
agile-lobster-traefik-test  1     3s

==&gt; v1/Deployment
NAME                   READY  UP-TO-DATE  AVAILABLE  AGE
agile-lobster-traefik  0/1    0           0          1s

==&gt; v1/Service
NAME                             TYPE          CLUSTER-IP     EXTERNAL-IP  PORT(S)                     AGE
agile-lobster-traefik            LoadBalancer  10.96.162.166  &lt;pending&gt;    80:31899/TCP,443:30909/TCP  1s
agile-lobster-traefik-dashboard  ClusterIP     10.102.35.190  &lt;none&gt;       80/TCP                      3s

==&gt; v1/ServiceAccount
NAME                   SECRETS  AGE
agile-lobster-traefik  0        3s

==&gt; v1beta1/Ingress
NAME                             HOSTS      ADDRESS  PORTS  AGE
agile-lobster-traefik-dashboard  traefik.l  80       1s


NOTES:

1. Get Traefik's load balancer IP/hostname:

     NOTE: It may take a few minutes for this to become available.

     You can watch the status by running:

         $ kubectl get svc agile-lobster-traefik --namespace kube-system -w

     Once 'EXTERNAL-IP' is no longer '&lt;pending&gt;':

         $ kubectl describe svc agile-lobster-traefik --namespace kube-system | grep Ingress | awk '{print $3}'

2. Configure DNS records corresponding to Kubernetes ingress resources to point to the load balancer IP/hostname found in step 1

</code></pre>
<h1><a class="header" href="#a-hrefhttpswwwconsulioconsul-by-hashicorpa" id="a-hrefhttpswwwconsulioconsul-by-hashicorpa"><a href="https://www.consul.io/">Consul by HashiCorp</a></a></h1>
<h1><a class="header" href="#links-202" id="links-202">Links</a></h1>
<h1><a class="header" href="#install-30" id="install-30">Install</a></h1>
<ul>
<li><a href="https://learn.hashicorp.com/consul/getting-started-k8s/helm-deploy">Deploy Consul with Kubernetes | Consul - HashiCorp Learn</a></li>
</ul>
<h1><a class="header" href="#rancher" id="rancher">Rancher</a></h1>
<h1><a class="header" href="#links-203" id="links-203">Links</a></h1>
<ul>
<li><a href="https://rancher.com/quick-start/">Getting Started with Kubernetes | Rancher Quick Start</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpscoreoscomcoreosa" id="a-hrefhttpscoreoscomcoreosa"><a href="https://coreos.com/">CoreOS</a></a></h1>
<h1><a class="header" href="#links-204" id="links-204">Links</a></h1>
<ul>
<li><a href="https://coreos.com/os/docs/latest/quickstart.html">Container Linux Quick Start | Container Linux by CoreOS</a></li>
<li><a href="https://github.com/coreos/">CoreOS · GitHub</a></li>
<li><a href="https://coreos.com/os/docs/latest/booting-on-vagrant.html">Vagrant</a></li>
<li><a href="https://stable.release.core-os.net/amd64-usr/current/">stable.release.core-os.net/amd64-usr/current/</a></li>
</ul>
<h1><a class="header" href="#install-with-vagrant-and-ignition" id="install-with-vagrant-and-ignition">Install with Vagrant and ignition</a></h1>
<ul>
<li><a href="https://github.com/coreos/coreos-vagrant#provisioning-with-ignition-virtualbox-provider-default">GitHub - coreos/coreos-vagrant: Minimal Vagrantfile for Container Linux</a></li>
<li><a href="https://coreos.com/os/docs/latest/dynamic-data.html">CL Config Dynamic Data</a></li>
</ul>
<p><code>Vagrant-Virtualbox</code> currently only support these Dynamic Data: <code>PRIVATE_IPV4</code>
and <code>HOSTNAME</code></p>
<pre><code>curl https://discovery.etcd.io/new\?size\=3
// replace &lt;token&gt; in the cl.conf file with the generated token from the curl command.
// replace &lt;PUBLIC_IPV4&gt; to &lt;PRIVATE_IPV4&gt; in the cl.conf
ct --platform=vagrant-virtualbox &lt; cl.conf &gt; config.ign

vagrant up
</code></pre>
<p>The Vagrantfile will parse a <code>config.rb</code> file containing a set of options used
to configure your CoreOS cluster. See <code>config.rb.sample</code> for more information.</p>
<h1><a class="header" href="#etcd-1" id="etcd-1">etcd</a></h1>
<h2><a class="header" href="#docker-forwarding" id="docker-forwarding">Docker Forwarding</a></h2>
<p>By setting the <code>$expose_docker_tcp</code> configuration value in <code>config.rb.sample</code></p>
<p>then:</p>
<pre><code>vagrant reload --provision
</code></pre>
<p>Then you can then use the docker command from your local shell by setting DOCKER_HOST:</p>
<p><code>export DOCKER_HOST=tcp://localhost:2375</code></p>
<p>test etcd:</p>
<pre><code> vagrant ssh core-01

core@core-01 ~ $ systemctl status etcd-member
core@core-01 ~ $ etcdctl set /message Hello
Hello
core@core-01 ~ $ etcdctl get /message
Hello
core@core-01 ~ $  etcdctl rm /message
PrevNode.Value: Hello
</code></pre>
<h1><a class="header" href="#easy-developmenttesting-cluster" id="easy-developmenttesting-cluster">Easy development/testing cluster</a></h1>
<p><a href="https://coreos.com/os/docs/latest/cluster-architectures.html">CoreOS Container Linux Cluster Architectures | Linux Clustering</a></p>
<h1><a class="header" href="#a-hrefhttpsgodocorgsigsk8siosig-storage-lib-external-provisionersig-storage-lib-external-provisioner---godoca" id="a-hrefhttpsgodocorgsigsk8siosig-storage-lib-external-provisionersig-storage-lib-external-provisioner---godoca"><a href="https://godoc.org/sigs.k8s.io/sig-storage-lib-external-provisioner">sig-storage-lib-external-provisioner - GoDoc</a></a></h1>
<h1><a class="header" href="#links-205" id="links-205">Links</a></h1>
<ul>
<li><a href="https://github.com/kubernetes-sigs/sig-storage-lib-external-provisioner">GitHub - kubernetes-sigs/sig-storage-lib-external-provisioner</a></li>
<li><a href="https://github.com/kubernetes-incubator/external-storage">GitHub - kubernetes-incubator/external-storage: External storage plugins, provisioners, and helper libraries</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner">Storage Classes - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#type-provisioner-interface" id="type-provisioner-interface">type Provisioner interface</a></h1>
<pre><code class="language-go">// Provisioner is an interface that creates templates for PersistentVolumes
// and can create the volume as a new resource in the infrastructure provider.
// It can also remove the volume it created from the underlying storage
// provider.
type Provisioner interface {
	// Provision creates a volume i.e. the storage asset and returns a PV object
	// for the volume
	Provision(ProvisionOptions) (*v1.PersistentVolume, error)
	// Delete removes the storage asset that was created by Provision backing the
	// given PV. Does not delete the PV object itself.
	//
	// May return IgnoredError to indicate that the call has been ignored and no
	// action taken.
	Delete(*v1.PersistentVolume) error
}
</code></pre>
<h1><a class="header" href="#type-provisioncontroller-struct" id="type-provisioncontroller-struct">type ProvisionController struct</a></h1>
<pre><code class="language-go">// NewProvisionController creates a new provision controller using
// the given configuration parameters and with private (non-shared) informers.
func NewProvisionController(
	client kubernetes.Interface,
	provisionerName string,
	provisioner Provisioner,
	kubeVersion string,
	options ...func(*ProvisionController) error,
) *ProvisionController {

// processNextClaimWorkItem processes items from claimQueue
func (ctrl *ProvisionController) processNextClaimWorkItem() bool 
func (ctrl *ProvisionController) processNextVolumeWorkItem() bool
</code></pre>
<h1><a class="header" href="#-1" id="-1"></a></h1>
<h1><a class="header" href="#links-206" id="links-206">Links</a></h1>
<ul>
<li><a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs">external-storage/nfs at master · kubernetes-incubator/external-storage · GitHub</a></li>
</ul>
<h1><a class="header" href="#this-is-a-in-cluster-nfs-server" id="this-is-a-in-cluster-nfs-server">This is a in-cluster nfs server</a></h1>
<p>Choose some volume for your nfs-provisioner instance to store its state &amp; data
in and mount the volume at <code>/export</code> in <code>deploy/kubernetes/deployment.yaml</code>. It
doesn't have to be a <code>hostPath</code> volume, it can e.g. be a PVC. Note that the
volume must have a supported file system on it: any local filesystem on Linux
is supported &amp; <strong>NFS is not supported</strong>.</p>
<h1><a class="header" href="#kubernetes-nfs-client-provisioner" id="kubernetes-nfs-client-provisioner">Kubernetes NFS-Client Provisioner</a></h1>
<h1><a class="header" href="#links-207" id="links-207">Links</a></h1>
<ul>
<li><a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client">external-storage/nfs-client at master · kubernetes-incubator/external-storage · GitHub</a></li>
</ul>
<h1><a class="header" href="#what-is-it" id="what-is-it">What is it</a></h1>
<p>nfs-client is an automatic provisioner that use your existing and already
configured NFS server to support dynamic provisioning of Kubernetes Persistent
Volumes via Persistent Volume Claims. Persistent volumes are provisioned as
<code>${namespace}-${pvcName}-${pvName}</code>.</p>
<p><strong>To note again, you must already have an NFS Server.</strong></p>
<h1><a class="header" href="#install-31" id="install-31">Install</a></h1>
<ul>
<li><a href="https://github.com/helm/charts/tree/master/stable/nfs-client-provisioner">charts/stable/nfs-client-provisioner at master · helm/charts · GitHub</a></li>
</ul>
<pre><code>helm install --name my-release --set nfs.server=x.x.x.x --set nfs.path=/exported/path stable/nfs-client-provisioner
</code></pre>
<h1><a class="header" href="#change-the-default-storageclass" id="change-the-default-storageclass">Change the default StorageClass</a></h1>
<h1><a class="header" href="#links-208" id="links-208">Links</a></h1>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/change-default-storage-class/">Change the default StorageClass - Kubernetes</a></li>
</ul>
<h1><a class="header" href="#how" id="how">How</a></h1>
<p>The default StorageClass has an annotation
<code>storageclass.kubernetes.io/is-default-class</code> set to <code>true</code>. Any other value or
absence of the annotation is interpreted as <code>false</code>.</p>
<pre><code>kubectl patch storageclass &lt;your-class-name&gt; -p '{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}'
// Verify
kubectl get storageclass
</code></pre>
<p>Please note that at most one StorageClass can be marked as default. If two or
more of them are marked as default, a PersistentVolumeClaim without
storageClassName explicitly specified cannot be created.</p>
<h1><a class="header" href="#linux" id="linux">linux</a></h1>
<h1><a class="header" href="#mirrors-list" id="mirrors-list">Mirrors List</a></h1>
<ul>
<li><a href="https://centos.org/download/mirrors/">CentOS</a></li>
</ul>
<h1><a class="header" href="#pxeboot" id="pxeboot">pxeboot</a></h1>
<ul>
<li><a href="http://mirror.centos.org/centos/7/os/x86_64/images/pxeboot/">CentOS</a></li>
</ul>
<h1><a class="header" href="#distribution" id="distribution">Distribution</a></h1>
<ul>
<li><a href="https://www.ubuntu.com/download/alternative-downloads">Downloads | Ubuntu</a></li>
<li><a href="https://stable.release.core-os.net/amd64-usr/current/">stable.release.core-os.net/amd64-usr/current/</a></li>
</ul>
<h1><a class="header" href="#date-and-time" id="date-and-time">Date and Time</a></h1>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-configuring_the_date_and_time">Chapter 3. Configuring the Date and Time - Red Hat Customer Portal</a></p>
<pre><code>timedatectl 
timedatectl list-timezones | grep Rome
timedatectl set-timezone “Asia/Kolkata”
timedatectl set-timezone UTC
timedatectl set-time 15:58:30
timedatectl set-time 20151120
timedatectl set-time '2015-11-20 16:14:50'

// Hardware Clock
timedatectl set-local-rtc 0		// set to utc

// must have NTP installed on the system
timedatectl set-ntp true

systemctl restart systemd-timedated.service


date
date --utc
date +&quot;format&quot;
date --set HH:MM:SS
date --set HH:MM:SS --utc
date --set YYYY-MM-DD
date --set &quot;2017-06-02 23:26:00&quot;

hwclock
hwclock --systohc
hwclock --systohc --utc
hwclock --hctosys
</code></pre>
<h1><a class="header" href="#users-and-groups" id="users-and-groups">Users and Groups</a></h1>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-managing_users_and_groups">Chapter 4. Managing Users and Groups - Red Hat Customer Portal</a></p>
<h1><a class="header" href="#networking-1" id="networking-1">Networking</a></h1>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/ch-configuring_ip_networking">Chapter 3. Configuring IP Networking - Red Hat Customer Portal</a></li>
</ul>
<h2><a class="header" href="#configuring-ip-networking-with-nmcli-1" id="configuring-ip-networking-with-nmcli-1">Configuring IP Networking with nmcli</a></h2>
<pre><code>systemctl start|stop|restart|status network 

nmcli connection modify eth0 ipv4.address 192.168.122.88/24

// reload config file
nmcli connection reload
nmcli con load /etc/sysconfig/network-scripts/ifcfg-ifname

// down and up
nmcli dev disconnect interface-name
nmcli con up interface-name
</code></pre>
<h1><a class="header" href="#speedtest" id="speedtest">speedtest</a></h1>
<pre><code>curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python -
</code></pre>
<h1><a class="header" href="#x11-forwarding" id="x11-forwarding">X11 Forwarding</a></h1>
<p>rhel7</p>
<pre><code class="language-sh">sudo yum install xauth

// cfg file: /etc/ssh/sshd_config

X11Forwarding yes
X11DisplayOffset 10
X11UseLocalhost no

// reload
systemctl restart sshd
</code></pre>
<h1><a class="header" href="#network-scan" id="network-scan">Network Scan</a></h1>
<pre><code>// -sn: Ping Scan - disable port scan
nmap -sn 192.168.1.0/24
</code></pre>
<h1><a class="header" href="#ls-color" id="ls-color">LS COLOR</a></h1>
<p><a href="https://geoff.greer.fm/lscolors/">LSCOLORS Generator</a></p>
<h1><a class="header" href="#permit-app-bind-service" id="permit-app-bind-service">PERMIT APP BIND SERVICE</a></h1>
<pre><code>setcap cap_net_bind_service+ep /path/to/bin
</code></pre>
<h1><a class="header" href="#mv-directory-not-empty" id="mv-directory-not-empty">mv: Directory not empty</a></h1>
<p><a href="https://askubuntu.com/questions/269775/mv-directory-not-empty#269818">mv: Directory not empty</a></p>
<p>Though its man page doesn't document it, mv will refuse to rename a directory
to another directory if the target directory contains files. This is a good
thing in your case because you turn out to want to merge the content of the
source into the target, which mv will not do.  Use:</p>
<p><code>rsync -a backup/ backupArchives/</code></p>
<p>instead. After that run:</p>
<p><code>rm -rf backup/*</code></p>
<p>Instead of using rsync, you also can do the classical</p>
<p><code>(cd backup &amp;&amp; tar c .) | (cd backupArchives &amp;&amp; tar xf -)</code></p>
<p>which earns you more geek points.</p>
<h1><a class="header" href="#newvps" id="newvps">NewVPS</a></h1>
<h1><a class="header" href="#links-209" id="links-209">Links</a></h1>
<ul>
<li><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-using-the-repository">Get Docker CE for Ubuntu | Docker Documentation</a></li>
</ul>
<h1><a class="header" href="#first-step" id="first-step">First Step</a></h1>
<p><strong>CentOS 7</strong></p>
<ol>
<li><code>useradd -ms /bin/bash xx &amp;&amp; passwd xx</code></li>
<li><code>vim /etc/sudoers</code></li>
<li><code>vim /etc/ssh/sshd_config</code> 
<pre><code># egrep '^Port|^PermitRootLogin|^P.*Auth' /etc/ssh/sshd_config

Port 26271
PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
</code></pre>
</li>
<li><code>yum install policycoreutils-python</code>; <code>semanage port -a -t ssh_port_t -p tcp 26271</code></li>
<li><code>firewall-cmd --zone=public --add-port=26271/tcp --permanent</code> then <strong>must</strong> <code>firewall-cmd --reload</code></li>
<li><code>sshcopykey.sh xx@host</code></li>
<li><code>systemctl restart sshd</code></li>
<li><strong>Don't logout.</strong> <code>ssh xx@host</code> in other tab to make sure it's OK.</li>
</ol>
<h1><a class="header" href="#install-docker-on-ubuntu-1804" id="install-docker-on-ubuntu-1804">install docker on Ubuntu 18.04</a></h1>
<p><strong>run screen first</strong></p>
<pre><code>sudo apt-get update

sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

// x86_64
sudo add-apt-repository \
   &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable&quot;
sudo apt-get update

// install
sudo apt-get install docker-ce docker-ce-cli containerd.io

// test
sudo docker run hello-world

// permission
// MUST logout once after.
sudo usermod -a -G docker $USER

// run
docker run \
        -p 443:8388 \
        -e PASSWORD=&quot;passwd&quot; \
        -e METHOD=&quot;aes-128-gcm&quot; \
        -e ARGS=-v \
        -d \
        --restart always \
        shadowsocks/shadowsocks-libev
</code></pre>
<h1><a class="header" href="#update-gce-vm-cpu" id="update-gce-vm-cpu">UPDATE GCE VM CPU</a></h1>
<p><a href="https://mrtang.tw/blog/post/how-to-change-a-machine-type-on-google-compute-engine">GCM教學：如何變更VM執行個體的CPU數量、記憶體大小或硬碟大小？ – 電癮院</a></p>
<ul>
<li>stop the VM, then u can edit it.</li>
<li>f1-micro's speed is about 3Mbps, it's shared CPU(0.2vCPU~0.5vCPU), ~ $5/m</li>
<li>g1-small's speed is ~ 60Mbps, it's 1 vCPU. ~ $15/m</li>
</ul>
<h1><a class="header" href="#gnu-screen" id="gnu-screen">GNU Screen</a></h1>
<h1><a class="header" href="#links-210" id="links-210">Links</a></h1>
<ul>
<li><a href="https://linuxize.com/post/how-to-use-linux-screen/">How To Use Linux Screen | Linuxize</a></li>
</ul>
<h1><a class="header" href="#start" id="start">Start</a></h1>
<pre><code>screen -S session_name
</code></pre>
<h1><a class="header" href="#basic-config" id="basic-config">Basic Config</a></h1>
<p>Config File <code>.screenrc</code>:</p>
<pre><code>escape ^jj

startup_message off
vbell off

hardstatus on
altscreen on
defscrollback 10000
</code></pre>
<h1><a class="header" href="#basic-command" id="basic-command">Basic Command</a></h1>
<pre><code>prefix c 	Create a new window (with shell)
prefix &quot; 	List all window
prefix 0 	Switch to window 0 (by number )
prefix A 	Rename the current window
prefix S 	Split current region horizontally into two regions
prefix | 	Split current region vertically into two regions
prefix tab 	Switch the input focus to the next region
prefix Ctrl+a 	Toggle between the current and previous region
prefix Q 	Close all regions but the current one
prefix X 	Close the current region

prefix d 	Detach from Linux Screen Session
</code></pre>
<pre><code>screen -r	Reattach to a Linux Screen
screen -ls	List
</code></pre>
<h1><a class="header" href="#zsh" id="zsh">Zsh</a></h1>
<h1><a class="header" href="#links-211" id="links-211">Links</a></h1>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Zsh">Zsh - ArchWiki</a></li>
<li><a href="https://github.com/zplug/zplug">GitHub - zplug/zplug: A next-generation plugin manager for zsh</a></li>
<li><a href="https://medium.com/@oldwestaction/beautifying-your-terminal-with-zsh-prezto-powerlevel9k-9e8de2023046">Beautifying your terminal with Zsh, Prezto, &amp; Powerlevel9k</a></li>
<li><a href="https://www.slideshare.net/brendon_jag/why-zsh-is-cooler-than-your-shell?next_slideshow=1">Why zsh is Cooler than Your Shell</a></li>
<li><a href="https://gist.github.com/laggardkernel/4a4c4986ccdcaf47b91e8227f9868ded">Comparison of ZSH frameworks and plugin managers</a></li>
<li><a href="https://github.com/goreliu/zshguide">goreliu/zshguide: Zsh 开发指南</a></li>
</ul>
<h1><a class="header" href="#install-32" id="install-32">Install</a></h1>
<pre><code>brew install zsh zsh-completions
</code></pre>
<h1><a class="header" href="#installing-fonts" id="installing-fonts">Installing Fonts</a></h1>
<ul>
<li><a href="https://github.com/powerline/fonts">GitHub - powerline/fonts: Patched fonts for Powerline users.</a></li>
<li><a href="https://github.com/ryanoasis/nerd-fonts">ryanoasis/nerd-fonts: Iconic font aggregator, collection, and patcher. 40+ patched fonts, over 3,600 glyph/icons, includes popular collections such as Font Awesome &amp; fonts such as Hack</a></li>
</ul>
<pre><code>git clone https://github.com/powerline/fonts.git --depth=1
cd fonts &amp;&amp; ./install.sh

// Install nerdfont
brew tap homebrew/cask-fonts
brew cask install font-hack-nerd-font
</code></pre>
<h1><a class="header" href="#comparison-of-zsh-plugin-managers" id="comparison-of-zsh-plugin-managers">Comparison of Zsh plugin managers</a></h1>
<ul>
<li><a href="https://gist.github.com/laggardkernel/4a4c4986ccdcaf47b91e8227f9868ded">Comparison of ZSH frameworks and plugin managers · GitHub</a></li>
</ul>
<h1><a class="header" href="#zplugin" id="zplugin">zplugin</a></h1>
<pre><code>mkdir -p ~/.zplugin
git clone https://github.com/zdharma/zplugin.git ~/.zplugin/bin
zcompile ~/.zplugin/bin/zplugin.zsh
</code></pre>
<h1><a class="header" href="#load-completition-file" id="load-completition-file">load completition file</a></h1>
<ul>
<li><a href="https://docs.docker.com/machine/completion/">Command-line completion | Docker Documentation</a></li>
</ul>
<h1><a class="header" href="#bash" id="bash">Bash</a></h1>
<h1><a class="header" href="#links-212" id="links-212">Links</a></h1>
<h1><a class="header" href="#what-is-" id="what-is-">what is $$</a></h1>
<p><code>$$</code> is the process ID (PID) of the script itself. </p>
<h1><a class="header" href="#execute-binary-from-curl" id="execute-binary-from-curl">Execute binary from curl</a></h1>
<p><a href="https://stackoverflow.com/questions/14909827/execute-binary-directly-from-curl/14909927#14909927">bash - execute binary directly from curl - Stack Overflow</a></p>
<pre><code class="language-sh">#!/bin/sh

# Arrange for the temporary file to be deleted when the script terminates
trap 'rm -f &quot;/tmp/exec.$$&quot;' 0
trap 'exit $?' 1 2 3 15

# Create temporary file from the standard input
cat &gt;/tmp/exec.$$

# Make the temporary file executable
chmod +x /tmp/exec.$$

# Execute the temporary file
/tmp/exec.$$
</code></pre>
<h1><a class="header" href="#read-line" id="read-line">Read Line</a></h1>
<p><a href="https://stackoverflow.com/questions/10929453/read-a-file-line-by-line-assigning-the-value-to-a-variable/10929511#10929511">bash - Read a file line by line assigning the value to a variable - Stack Overflow</a></p>
<pre><code class="language-bash">#!/bin/bash
while IFS='' read -r line || [[ -n &quot;$line&quot; ]]; do
    echo &quot;Text read from file: $line&quot;
done &lt; &quot;$1&quot;
</code></pre>
<p>Explanation:</p>
<ul>
<li><code>IFS=''</code> (or <code>IFS=</code>) prevents leading/trailing whitespace from being trimmed.</li>
<li><code>-r</code> prevents backslash escapes from being interpreted.</li>
<li><code>|| [[ -n $line ]]</code> prevents the last line from being ignored if it doesn't
end with a <code>\n</code> (since <code>read</code> returns a non-zero exit code when it encounters
EOF).</li>
</ul>
<h1><a class="header" href="#math-calculation" id="math-calculation">Math calculation</a></h1>
<p><a href="https://www.shell-tips.com/2010/06/14/performing-math-calculation-in-bash/">Performing Math calculation in Bash - Shell Tips!</a></p>
<ul>
<li><code>myvar=$(expr 1 + 1)</code></li>
<li><code>let myvar+=1</code></li>
<li><code>myvar=$((myvar+3))</code></li>
</ul>
<p>a</p>
<h1><a class="header" href="#systemdtimer" id="systemdtimer">systemd.timer</a></h1>
<h1><a class="header" href="#links-213" id="links-213">Links</a></h1>
<ul>
<li><a href="https://coreos.com/os/docs/latest/scheduling-tasks-with-systemd-timers.html">Linux Task Scheduler | Scheduling Tasks with systemd Timers</a></li>
<li><a href="https://www.certdepot.net/rhel7-use-systemd-timers/">RHEL7: How to use Systemd timers. - CertDepot</a></li>
</ul>
<h1><a class="header" href="#list" id="list">List</a></h1>
<pre><code>systemctl list-timers
systemctl list-timers --all
</code></pre>
<h1><a class="header" href="#how-to-use" id="how-to-use">How to Use</a></h1>
<p>date.service:</p>
<pre><code>[Unit]
Description=Prints date into /tmp/date file

[Service]
Type=oneshot
ExecStart=/usr/bin/sh -c '/usr/bin/date &gt;&gt; /tmp/date'

[Install]
WantedBy=date.timer
</code></pre>
<p>date.timmer:</p>
<pre><code>[Unit]
Description=Run date.service every 10 minutes

[Timer]
OnCalendar=*:0/10
Unit=promreporter.service

[Install]
WantedBy=timers.target
</code></pre>
<p>This config will run <code>date.service</code> every 10 minutes. </p>
<h1><a class="header" href="#systemd-1" id="systemd-1">systemd</a></h1>
<h1><a class="header" href="#links-214" id="links-214">Links</a></h1>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/systemd-essentials-working-with-services-units-and-the-journal">Systemd Essentials: Working with Services, Units, and the Journal | DigitalOcean</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files">Understanding Systemd Units and Unit Files | DigitalOcean</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd">Chapter 10. Managing Services with systemd - Red Hat Customer Portal</a></li>
<li><a href="https://medium.com/horrible-hacks/using-systemd-as-a-better-cron-a4023eea996d">Using systemd as a better cron – Horrible Hacks – Medium</a></li>
</ul>
<h1><a class="header" href="#conflicts-between-dnsmasq-and-systemd-resolved" id="conflicts-between-dnsmasq-and-systemd-resolved">Conflicts between dnsmasq and systemd-resolved</a></h1>
<p>I agree that disabling systemd-resolved is a bad idea and should be avoided.</p>
<p><a href="https://cnly.github.io/2017/09/02/ubuntu1704-dnsmasq-resolvconf.html">Ubuntu 17.04 - Conflicts between systemd-resolved, dnsmasq and resolvconf</a></p>
<p>Append to Config File <code>/etc/default/dnsmasq</code>:</p>
<pre><code>DNSMASQ_EXCEPT=lo
</code></pre>
<h1><a class="header" href="#change-default-editor-to-vim-for-sudo-systemctl-edit-unit" id="change-default-editor-to-vim-for-sudo-systemctl-edit-unit">change default editor to vim for &quot;sudo systemctl edit <unit>&quot;</a></h1>
<pre><code>export SYSTEMD_EDITOR=&quot;vim&quot; 
</code></pre>
<p>And then sudo visudo and add this line:</p>
<pre><code>Defaults  env_keep += &quot;SYSTEMD_EDITOR&quot;
</code></pre>
<h1><a class="header" href="#basic-6" id="basic-6">Basic</a></h1>
<pre><code>systemctl start|stop|restart|reload|enable|disable|status nginx.service
systemctl is-active|is-enabled|is-failed application.service	    // to check
systemctl mask|unmask nginx.service	    // mark a unit as completely unstartable, automatically or manually, by linking it to /dev/null. 
systemctl   // default to systemctl list-units
systemctl list-units --all
systemctl list-unit-files
systemctl cat nginx.service
systemctl list-dependencies nginx.service
systemctl list-dependencies --all nginx.service	    // To expand all dependent units recursively
systemctl show nginx.service	    // to see the low-level details of the unit's settings
systemctl edit nginx.service
systemctl edit --full nginx.service
systemctl daemon-reload	    // After modifying a unit file, you should reload the systemd process itself to pick up your changes

systemctl rescue		// single-user environment 
systemctl --no-wall rescue
systemctl emergency		// the most minimal environment
systemctl --no-wall emergency

systemctl halt|poweroff|reboot|suspend|hibernate|hybrid-sleep

systemctl list-timers

journalctl
journalctl -b	// see the journal entries from the current boot
journalctl -k // To see only kernel messages, such as those that are typically represented by dmesg
journalctl -k -b
journalctl -u nginx.service
journalctl -b -u nginx.service
journalctl --list-boots
journalctl --since &quot;2015-01-10&quot; --until &quot;2015-01-11 03:00&quot;
journalctl --since yesterday
journalctl --since 09:00 --until &quot;1 hour ago&quot;
journalctl _PID=8088
journalctl _UID=33 --since today
journalctl -F _GID
journalctl /usr/bin/bash
journalctl -p err -b
    0: emerg
    1: alert
    2: crit
    3: err
    4: warning
    5: notice
    6: info
    7: debug

journalctl -n 20	// as tail -n 20
journalctl -f		// as tail -f
journalctl --disk-usage

</code></pre>
<h1><a class="header" href="#targets-runlevels" id="targets-runlevels">Targets (Runlevels)</a></h1>
<pre><code>systemctl list-unit-files --type=target
systemctl get-default	    // To view the default target 
systemctl set-default multi-user.target
systemctl list-dependencies multi-user.target	    // To see what units are tied to a target
</code></pre>
<h1><a class="header" href="#time" id="time">Time</a></h1>
<pre><code>timedatectl list-timezones
timedatectl set-timezone zone
timedatectl status
</code></pre>
<h1><a class="header" href="#unit-files" id="unit-files">Unit Files</a></h1>
<pre><code>/lib/systemd/system/
/usr/lib/systemd/system/
/etc/systemd/system/	    // this directory location take precedence over any of the other locations
/run/systemd/system/	    // run-time
</code></pre>
<p>The correct way to do this is to create a directory named after the unit file with <code>.d</code> appended on the end. So for a unit called <code>example.service</code>, a subdirectory called <code>example.service.d</code> could be created. Within this directory a file ending with <code>.conf</code> can be used to override or extend the attributes of the system's unit file.</p>
<p>E.g.</p>
<p><code>app.service</code></p>
<pre><code class="language-systemd">[Unit]
Description= describe the name and basic functionality of the unit
Documentation=
Requires= any units upon which this unit essentially depends. These units are started in parallel with the current unit by default.
Wants= similar to Requires=, but less strict.
BindsTo= similar to Requires=,  but also causes the current unit to stop when the associated unit terminates.
Before= I'm before these units. they are after me.
After= I'm after these units. they are before me.
Conflicts= 
Condition...=
Assert...=


[Install] 
WantedBy= For instance, if the current unit has WantedBy=multi-user.target, a directory called multi-user.target.wants will be created within /etc/systemd/system (if not already available) and a symbolic link to the current unit will be placed within. Disabling this unit removes the link and removes the dependency relationship.

RequiredBy= similar to the WantedBy= directive, but instead specifies a required dependency that will cause the activation to fail if not met. When enabled, a unit with this directive will create a directory ending with .requires.

Alias= another name
Also= Supporting units that should always be available when this unit is active can be listed here. 
DefaultInstance= 

[Service]
Type= This is important because it tells systemd how to correctly manage the servie and find out its state. 

RemainAfterExit= commonly used with the oneshot type. It indicates that the service should be considered active even after the process exits.

PIDFile= if Type = forking

BusName= if Type = dbus

NotifyAccess= if Type = notify, this can be &quot;none&quot;, &quot;main&quot;, &quot;all&quot;, default &quot;none&quot;

ExecStart= if Type != &quot;oneshot&quot;, this may only be specified once 
ExecStartPre=
ExecStartPost=
ExecReload=
ExecStop= If this is not given, the process will be killed immediately when the service is stopped.
ExecStopPost=
RestartSec= the amount of time to wait before attempting to restart the service.
Restart=  This can be set to values like &quot;always&quot;, &quot;on-success&quot;, &quot;on-failure&quot;, &quot;on-abnormal&quot;, &quot;on-abort&quot;, or &quot;on-watchdog&quot;. 
TimeoutSec= This configures the amount of time that systemd will wait when stopping or stopping the service before marking it as failed or forcefully killing it. 

[Socket]
ListenStream= TCP
ListenDatagram= UDP
ListenSequentialPacket= Unix
ListenFIFO= you can also specify a FIFO buffer instead of a socket.
</code></pre>
<h1><a class="header" href="#template-unit-files" id="template-unit-files">Template Unit Files</a></h1>
<p><code>example@.service</code> be used to create <code>example@instance1.service</code></p>
<pre><code>%n		// full resulting unit name
%N		// reverse escaping

%p		// unit name prefix
%P

%i		// instance name
%I		

%f		// unescaped instance name or the prefix name, prepended with a /
%c		// indicate the control group

%u		// user name
%U		// UID
%H		// host name
%%		// literal %%
</code></pre>
<p>E.g.</p>
<p><code>/usr/lib/systemd/system/postifix.service</code></p>
<pre><code class="language-systemd">[Unit]
Description=Postfix Mail Transport Agent
After=syslog.target network.target
Conflicts=sendmail.service exim.service

[Service]
Type=forking
PIDFile=/var/spool/postfix/pid/master.pid
EnvironmentFile=-/etc/sysconfig/network
ExecStartPre=-/usr/libexec/postfix/aliasesdb
ExecStartPre=-/usr/libexec/postfix/chroot-update
ExecStart=/usr/sbin/postfix start
ExecReload=/usr/sbin/postfix reload
ExecStop=/usr/sbin/postfix stop

[Install]
WantedBy=multi-user.target
</code></pre>
<h1><a class="header" href="#creating-custom-unit-files" id="creating-custom-unit-files">Creating Custom Unit Files</a></h1>
<ol>
<li>
<p>Prepare the executable file with the custom service. </p>
</li>
<li>
<p>Create a unit file in the /etc/systemd/system/ directory and make sure it has correct file permissions.</p>
<pre><code class="language-sh">touch /etc/systemd/system/name.service 
chmod 664 /etc/systemd/system/name.service
</code></pre>
</li>
<li>
<p>cfg</p>
<pre><code class="language-sh">[Unit]
Description=service_description
After=network.target

[Service]
ExecStart=path_to_executable
Type=forking
PIDFile=path_to_pidfile

[Install]
WantedBy=default.target
</code></pre>
</li>
</ol>
<p>E.g.</p>
<pre><code class="language-sh">cat /etc/issue
Ubuntu 18.04.1 LTS \n \l

// 1

file /lib/systemd/system/shadowsocks-libev*
/lib/systemd/system/shadowsocks-libev-local@.service:  ASCII text
/lib/systemd/system/shadowsocks-libev-redir@.service:  ASCII text
/lib/systemd/system/shadowsocks-libev-server@.service: ASCII text
/lib/systemd/system/shadowsocks-libev.service:         ASCII text
/lib/systemd/system/shadowsocks-libev-tunnel@.service: ASCII text

$ cat /lib/systemd/system/shadowsocks-libev-server@.service 
#  This file is part of shadowsocks-libev.
#
#  Shadowsocks-libev is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 3 of the License, or
#  (at your option) any later version.
#
#  This is a template unit file. Users may copy and rename the file into
#  config directories to make new service instances. See systemd.unit(5)
#  for details.

[Unit]
Description=Shadowsocks-Libev Custom Server Service for %I
Documentation=man:ss-server(1)
After=network.target

[Service]
Type=simple
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
ExecStart=/usr/bin/ss-server -c /etc/shadowsocks-libev/%i.json

[Install]
WantedBy=multi-user.target

$ cat /lib/systemd/system/shadowsocks-libev-local@.service 
#  This file is part of shadowsocks-libev.
#
#  Shadowsocks-libev is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 3 of the License, or
#  (at your option) any later version.
#
#  This is a template unit file. Users may copy and rename the file into
#  config directories to make new service instances. See systemd.unit(5)
#  for details.

[Unit]
Description=Shadowsocks-Libev Custom Client Service for %I
Documentation=man:ss-local(1)
After=network.target

[Service]
Type=simple
CapabilityBoundingSet=CAP_NET_BIND_SERVICE
ExecStart=/usr/bin/ss-local -c /etc/shadowsocks-libev/%i.json

[Install]
WantedBy=multi-user.target

// 2
file /etc/shadowsocks-libev/config.json 
/etc/shadowsocks-libev/config.json: ASCII text

cd /lib/systemd/system/
mv shadowsocks-libev-local\@.service shadowsocks-libev-local\@config.service 
systemctl enable shadowsocks-libev-local\@config.service 
Created symlink /etc/systemd/system/multi-user.target.wants/shadowsocks-libev-local@config.service → /lib/systemd/system/shadowsocks-libev-local@config.service.
systemctl enable shadowsocks-libev-local\@config.service 
journalctl -u shadowsocks-libev-local\@config -f
</code></pre>
<h1><a class="header" href="#grub-2" id="grub-2">GRUB 2</a></h1>
<h1><a class="header" href="#links-215" id="links-215">Links</a></h1>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-working_with_the_grub_2_boot_loader">Chapter 25. Working with GRUB 2 - Red Hat Customer Portal</a></li>
</ul>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>GRUB 2 reads its configuration from the <code>/boot/grub2/grub.cfg</code> file on
traditional BIOS-based machines and from the <code>/boot/efi/EFI/redhat/grub.cfg</code>
file on UEFI machines. This file contains menu information. </p>
<h1><a class="header" href="#grubby" id="grubby">grubby</a></h1>
<p><strong>worked on grub legacy(grub 1) too.</strong></p>
<pre><code>// Listing the Default Kernel
grubby --default-kernel			

// To find out the index number of the default kernel
grubby --default-index			

// This command is very useful 
// you can then know which one to --set-default with this command.
// To list all the kernel menu entries
grubby --info=ALL

// To view the GRUB 2 menu entry for a specific kernel
grubby --info /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64

// Changing the Default Boot Entry persistent
grubby --set-default /boot/vmlinuz-3.10.0-229.4.2.el7.x86_64
</code></pre>
<h1><a class="header" href="#grub-legacy-grub-1" id="grub-legacy-grub-1">GRUB Legacy (grub 1)</a></h1>
<p>The configuration file is located at <code>/boot/grub/menu.lst</code></p>
<h1><a class="header" href="#memory-based-file-system-ram-disk" id="memory-based-file-system-ram-disk">memory based file system (RAM disk)</a></h1>
<h1><a class="header" href="#links-216" id="links-216">Links</a></h1>
<ul>
<li><a href="https://www.jamescoyle.net/how-to/943-create-a-ram-disk-in-linux">Create a RAM disk in Linux – JamesCoyle.net Limited</a></li>
<li><a href="https://www.jamescoyle.net/knowledge/951-the-difference-between-a-tmpfs-and-ramfs-ram-disk">The Difference Between a tmpfs and ramfs RAM Disk – JamesCoyle.net Limited</a></li>
</ul>
<h1><a class="header" href="#tmpfs-vs-ramfs" id="tmpfs-vs-ramfs">tmpfs vs ramfs</a></h1>
<ul>
<li>
<p>ramfs is the older file system type and is largely replaced in most scenarios
by tmpfs.</p>
</li>
<li>
<p>ramfs file systems cannot be limited in size like a disk base file system
which is limited by it’s capacity. ramfs will continue using memory storage
until the system runs out of RAM and likely crashes or becomes unresponsive.
This is a problem if the application writing to the file system cannot be
limited in total size. Another issue is you cannot see the size of the file
system in df and it can only be estimated by looking at the cached entry in
free.</p>
</li>
<li>
<p>You can specify a size limit in tmpfs which will give a ‘disk full’ error
when the limit is reached. This behaviour is exactly the same as a partition
of a physical disk.</p>
</li>
</ul>
<h1><a class="header" href="#create" id="create">Create</a></h1>
<pre><code>mkdir /mnt/ramdisk
mount -t tmpfs -o size=512m tmpfs /mnt/ramdisk
</code></pre>
<p>make persist, <code>vim /etc/fstab:</code></p>
<pre><code>tmpfs       /mnt/ramdisk tmpfs   nodev,nosuid,noexec,nodiratime,size=1024M   0 0
</code></pre>
<h1><a class="header" href="#ubuntu-1" id="ubuntu-1">Ubuntu</a></h1>
<h1><a class="header" href="#ubuntu的lts" id="ubuntu的lts">Ubuntu的LTS</a></h1>
<p>LTS: Long term support</p>
<h1><a class="header" href="#links-217" id="links-217">Links</a></h1>
<ul>
<li><a href="https://www.ubuntu.com/about/release-cycle">Ubuntu release cycle | Ubuntu</a></li>
<li><a href="https://wiki.ubuntu.com/Releases">Releases - Ubuntu Wiki</a></li>
<li><a href="https://launchpad.net/ubuntu/+archivemirrors">Mirrors : Ubuntu</a></li>
</ul>
<p>一般是以.04结尾的版本是LTS</p>
<h1><a class="header" href="#版本升级" id="版本升级">版本升级</a></h1>
<p><code>proxychains do-release-upgrade</code></p>
<h1><a class="header" href="#更新源" id="更新源">更新源</a></h1>
<p>cfg:</p>
<p><code>/etc/apt/sources.list</code></p>
<pre><code># 放在最前头
deb http://linux.yz.yamagata-u.ac.jp/ubuntu/ bionic main restricted universe
deb-src http://linux.yz.yamagata-u.ac.jp/ubuntu/ bionic main restricted universe
</code></pre>
<h1><a class="header" href="#更新" id="更新">更新</a></h1>
<p>通过proxychains走代理</p>
<pre><code>proxychains apt update
proxychains apt upgrade
</code></pre>
<h1><a class="header" href="#apt-1" id="apt-1">apt</a></h1>
<h1><a class="header" href="#links-218" id="links-218">Links</a></h1>
<h1><a class="header" href="#add-apt-repository-command-not-found" id="add-apt-repository-command-not-found">add-apt-repository: command not found</a></h1>
<pre><code>apt install software-properties-common
</code></pre>
<h1><a class="header" href="#difference-between-main-restricted-universe-and-multiverse" id="difference-between-main-restricted-universe-and-multiverse">Difference Between Main, Restricted, Universe and Multiverse</a></h1>
<p><a href="https://www.howtogeek.com/194247/whats-the-difference-between-main-restricted-universe-and-multiverse-on-ubuntu/">What’s the Difference Between Main, Restricted, Universe, and Multiverse on Ubuntu?</a></p>
<pre><code>Main – Officially Supported, Open-Source Software
Restricted – Officially Supported, Closed-Source Software
Universe – Community-Maintained, Open-Source Software
Multiverse – Unsupported, Closed-Source and Patent-Encumbered Software
</code></pre>
<h1><a class="header" href="#安装archlinux" id="安装archlinux">安装archlinux</a></h1>
<p>在U盘上安装</p>
<h4><a class="header" href="#参考链接" id="参考链接">参考链接</a></h4>
<p>https://wiki.archlinux.org/index.php/Installing_Arch_Linux_on_a_USB_key
https://wiki.archlinux.org/index.php/installation_guide
https://wiki.archlinux.org/index.php/Improving_performance#Reduce_disk_reads.2Fwrites
http://www.wyae.de/docs/boot-usb3/
https://wiki.archlinux.org/index.php/General_recommendations
https://wiki.archlinux.org/index.php/List_of_applications
https://wiki.archlinux.org/index.php/Wayland
https://wiki.archlinux.org/index.php/GRUB</p>
<h4><a class="header" href="#连网" id="连网">连网</a></h4>
<ul>
<li>
<p>有线一般通过 dhcpcd eth0 连接网络</p>
</li>
<li>
<p>配置代理</p>
<pre><code class="language-bash">export http_proxy=&quot;https://username:password@server:port&quot;
</code></pre>
</li>
</ul>
<h4><a class="header" href="#创建文件系统" id="创建文件系统">创建文件系统</a></h4>
<h5><a class="header" href="#分区及文件系统" id="分区及文件系统">分区及文件系统</a></h5>
<p>为了兼容性，所以采用msdos的分区表。<br />
为了仍然可以有部分容量作为U盘使用，所以系统安装在第二个分区,因为windows只认U盘的第一个分区。
给第一个分区创建exfat文件系统，这样可以放超过4G大小的文件.</p>
<pre><code class="language-bash">parted -s -- /dev/sda mkpart 1m 32g
parted -s -- /dev/sda mkpart 32g -1
parted -s -- /dev/sda set 2 boot on
mkfs.exfat /dev/sda1
mkfs.ext4 /dev/sda2
mount /dev/sda2 /mnt
</code></pre>
<h4><a class="header" href="#pacstrap" id="pacstrap">pacstrap</a></h4>
<p><code>pacstrap /mnt</code></p>
<h4><a class="header" href="#配置系统" id="配置系统">配置系统</a></h4>
<h5><a class="header" href="#生成fstab" id="生成fstab">生成fstab</a></h5>
<p><code># genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</code></p>
<h5><a class="header" href="#chroot" id="chroot">chroot</a></h5>
<p><code># arch-chroot /mnt</code></p>
<h5><a class="header" href="#安装基础软件包" id="安装基础软件包">安装基础软件包</a></h5>
<p>目标是重启后可以连网</p>
<pre><code class="language-bash">pacman -S privoxy shadowsocks-libev simple-obfs proxychains-ng kcptun iw wpa_supplicant dhcpcd
</code></pre>
<h5><a class="header" href="#时区" id="时区">时区</a></h5>
<pre><code class="language-bash"># ln -sf /usr/share/zoneinfo/Region/City /etc/localtime
# hwclock --systohc
</code></pre>
<h5><a class="header" href="#locale" id="locale">locale</a></h5>
<p>编辑/etc/locale.gen，然后执行 <code># locale-gen</code>:</p>
<pre><code class="language-bash">/etc/locale.conf
LANG=en_US.UTF-8
</code></pre>
<h5><a class="header" href="#主机名" id="主机名">主机名</a></h5>
<pre><code class="language-bash"># cat /etc/hostname
myhostname
</code></pre>
<h5><a class="header" href="#initramfs-重要和常规有变化" id="initramfs-重要和常规有变化">Initramfs (重要，和常规有变化)</a></h5>
<p>Before creating the initial RAM disk # mkinitcpio -p linux, in /etc/mkinitcpio.conf add the block hook to the hooks array right after udev. This is necessary for appropriate module loading in early userspace.</p>
<p>要hooks里udev后面马上跟block</p>
<p><code># mkinitcpio -p linux</code></p>
<h5><a class="header" href="#配置引导程序" id="配置引导程序">配置引导程序</a></h5>
<pre><code class="language-bash">pacman -S grub
# grub-install --target=i386-pc /dev/sda --removable --recheck
# grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
<h5><a class="header" href="#配置root密码添加用户配置用户密码" id="配置root密码添加用户配置用户密码">配置root密码，添加用户，配置用户密码</a></h5>
<pre><code class="language-bash">passwd
# useradd -m -G wheel -s /bin/bash &lt;username&gt;
passwd &lt;username&gt;
</code></pre>
<h5><a class="header" href="#重启" id="重启">重启</a></h5>
<pre><code class="language-bash"># umount /mnt
reboot
</code></pre>
<h4><a class="header" href="#第一次进入系统" id="第一次进入系统">第一次进入系统</a></h4>
<h5><a class="header" href="#a-hreflinuxarchlinux配置网络a" id="a-hreflinuxarchlinux配置网络a"><a href="linux/archlinux/">配置网络</a></a></h5>
<h5><a class="header" href="#a-hreflinuxarchlinux配置代理a" id="a-hreflinuxarchlinux配置代理a"><a href="linux/archlinux/">配置代理</a></a></h5>
<h5><a class="header" href="#安装基本软件包" id="安装基本软件包">安装基本软件包</a></h5>
<pre><code class="language-bash">pacman -S base-devel dosfstools ntfs-3g exfat-utils openssh screen gvim p7zip zip unzip git gnupg  lsof  ntp gnu-netcat nmap cronie bc dstat bash-completion
</code></pre>
<h5><a class="header" href="#安装图形" id="安装图形">安装图形</a></h5>
<pre><code class="language-bash">pacman -S  xf86-input-synaptics xf86-video-vesa  xf86-video-ati xf86-video-intel  xf86-video-nouveau weston xorg-server-xwayland xorg-xrdb gtk3  sway rxvt-unicode dmenu alsa-utils alsa-firmware libsamplerate pulseaudio pulseaudio-alsa pavucontrol fcitx noto-fonts noto-fonts-cjk
</code></pre>
<h5><a class="header" href="#安装多媒体工具" id="安装多媒体工具">安装多媒体工具</a></h5>
<pre><code class="language-bash">pacman -S mpv imv
</code></pre>
<h5><a class="header" href="#为了访问android" id="为了访问android">为了访问Android</a></h5>
<pre><code class="language-bash">pacman -s android-tools android-udev
# gpasswd -a &lt;username&gt; adbusers
</code></pre>
<h5><a class="header" href="#文档处理" id="文档处理">文档处理</a></h5>
<pre><code class="language-bash">pacman -S mupdf
</code></pre>
<h1><a class="header" href="#automatic-mount-udevil" id="automatic-mount-udevil">automatic mount: udevil</a></h1>
<p>pacman -S udevil</p>
<p>systemctl enable devmon@<username></p>
<h1><a class="header" href="#视频播放器" id="视频播放器">视频播放器</a></h1>
<h4><a class="header" href="#compare" id="compare">Compare</a></h4>
<ul>
<li>qmplay2</li>
<li>smplayer<br />
两次开着导致系统卡住,可能比较占用资源.</li>
</ul>
<h4><a class="header" href="#qmplay2" id="qmplay2">qmplay2</a></h4>
<pre><code>yaourt -S qmplay2  

// start
QMPlay2
</code></pre>
<h4><a class="header" href="#mpv" id="mpv">mpv</a></h4>
<pre><code>https://mpv.io/  
https://www.smplayer.info/

//archlinux
pacman -S mpv

// Front Ends
pacman S smplayer

</code></pre>
<h1><a class="header" href="#桌面环境desktop-environment" id="桌面环境desktop-environment">桌面环境Desktop Environment</a></h1>
<h4><a class="header" href="#lxde" id="lxde">lxde</a></h4>
<ul>
<li>安装: <code>pacman -S lxde-gtk3</code></li>
<li>启动: 在<code>.xinitrc</code>中添加<code>exec startlxde</code>, 然后执行<code>startx</code></li>
</ul>
<h1><a class="header" href="#窗口管理器window-manager" id="窗口管理器window-manager">窗口管理器Window Manager</a></h1>
<h4><a class="header" href="#i3" id="i3">i3</a></h4>
<ul>
<li>安装: <code>sudo pacman -S i3</code></li>
<li>启动: <code>.xinitrc</code>中添加<code>exec i3</code>,然后执行<code>startx</code></li>
</ul>
<h1><a class="header" href="#蓝牙bluetooth" id="蓝牙bluetooth">蓝牙Bluetooth</a></h1>
<h4><a class="header" href="#蓝牙耳机" id="蓝牙耳机">蓝牙耳机</a></h4>
<h5><a class="header" href="#遇到的问题" id="遇到的问题">遇到的问题</a></h5>
<ul>
<li>配对成功, 但连接失败</li>
</ul>
<p>我的最终解决办法是bluetoothctl用root执行,PulseAudio用当前普通用户执行.</p>
<h1><a class="header" href="#输入法" id="输入法">输入法</a></h1>
<p><strong>debians</strong></p>
<p><code>apt-get install fcitx fcitx-table-zhengma-large</code></p>
<h1><a class="header" href="#邮件服务器postfixdovecot" id="邮件服务器postfixdovecot">邮件服务器postfix/dovecot</a></h1>
<h1><a class="header" href="#grep" id="grep">grep</a></h1>
<ul>
<li>从文件尾开始匹配
<pre><code></code></pre>
</li>
</ul>
<p>tac foo | grep -m 3 foo
-m 匹配到3次后就停止读文件,这样会非常效率.</p>
<pre><code>* 高亮显示匹配  
  `--color=auto`


</code></pre>
<h1><a class="header" href="#sed" id="sed">sed</a></h1>
<ul>
<li>Sed修改某一行<br />
<code>sed '5s/^.*$/xxxxx/'  file</code></li>
<li>sed修改下一行<br />
<code>sed '/DIVIDER/{n;s/.*/[begin]&amp;[end]\n/;}' file1</code></li>
<li>sed打印下一行<br />
<code>sed -n '/^\[dns/{n;p}' /etc/cobbler/modules.conf</code></li>
<li>sed打印本行加下一行<br />
<code>sed -n '/^\[dns/{N;p}' /etc/cobbler/modules.conf</code></li>
</ul>
<h1><a class="header" href="#awk" id="awk">awk</a></h1>
<ul>
<li>use system command<br />
<code>awk '/^VoiceRoot/ { if ( ! system ( &quot;test -d &quot; $2 ) )  system(&quot;ln -sf &quot; $2&quot; &quot; $1 ) }' &lt;file&gt;</code></li>
<li>use shell variable as pattern<br />
<code>a=&quot;patter1&quot;; awk -v a=&quot;$a&quot; '$0 ~ a { print }'</code></li>
</ul>
<h1><a class="header" href="#wifi" id="wifi">wifi</a></h1>
<h2><a class="header" href="#links-219" id="links-219">Links</a></h2>
<p>https://wiki.archlinux.org/index.php/Wireless_network_configuration_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)</p>
<h2><a class="header" href="#-2" id="-2"></a></h2>
<h1><a class="header" href="#simple-anonymous-ftp-server" id="simple-anonymous-ftp-server">simple anonymous ftp server</a></h1>
<h1><a class="header" href="#links-220" id="links-220">Links</a></h1>
<ul>
<li><a href="https://www.g-loaded.eu/2008/12/02/set-up-an-anonymous-ftp-server-with-vsftpd-in-less-than-a-minute/">Set up an anonymous FTP server with vsftpd in less than a minute | G-Loaded Journal</a></li>
</ul>
<p>Config </p>
<p>rhel6: <code>/etc/vsftpd/vsftpd.conf</code></p>
<pre><code>use_localtime=YES

local_enable=NO
anonymous_enable=YES
no_anon_password=YES
write_enable=NO

anon_root=/ftp_root_dir/
</code></pre>
<p>Run</p>
<p><code>/etc/init.d/vsftpd start</code></p>
<h1><a class="header" href="#multi-dir" id="multi-dir">Multi Dir</a></h1>
<p>comment  <code>anon_root</code>, so to se the default ftp dir <code>/var/ftp/pub/</code></p>
<p>then config <code>mount --bind</code> and put them in <code>/etc/rc.local</code></p>
<pre><code>mount --bind /dir1/ /var/ftp/pub/dir1
mount --bind /dir2/ /var/ftp/pub/dir2
</code></pre>
<h1><a class="header" href="#log-1" id="log-1">log</a></h1>
<p><code>xferlog_enable</code> control whether log or not.</p>
<pre><code># The target log file can be vsftpd_log_file or xferlog_file.
# This depends on setting xferlog_std_format parameter
xferlog_enable=YES
</code></pre>
<p><code>xferlog_std_format</code> is a switch to control which file to log</p>
<pre><code># Switches between logging into vsftpd_log_file and xferlog_file files.
# NO writes to vsftpd_log_file, YES to xferlog_file
xferlog_std_format=YES
</code></pre>
<p>if <code>xferlog_std_format=NO</code>, then need to config this:</p>
<pre><code>vsftpd_log_file=/var/log/vsftpd.log
log_ftp_protocol=YES
</code></pre>
<h1><a class="header" href="#a-hrefhttpswwwarchlinuxorgarch-linuxa" id="a-hrefhttpswwwarchlinuxorgarch-linuxa"><a href="https://www.archlinux.org/">Arch Linux</a></a></h1>
<h1><a class="header" href="#links-221" id="links-221">Links</a></h1>
<h1><a class="header" href="#pacman" id="pacman">Pacman</a></h1>
<ul>
<li>Pacman key error</li>
</ul>
<p><code>pacman -Sy archlinux-keyring &amp;&amp; pacman -Syyu</code></p>
<ul>
<li>lock error</li>
</ul>
<p><code>rm /var/lib/pacman/db.lck</code></p>
<h1><a class="header" href="#mirror-status" id="mirror-status">Mirror Status</a></h1>
<ul>
<li><a href="https://www.archlinux.org/mirrors/status/">Arch Linux - Mirror Status</a></li>
</ul>
<p>Sorting mirrors</p>
<pre><code>pacman -S pacman-contrib 
sync.Once.Do(
	cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.backup
)
sed -i 's/^#Server/Server/' /etc/pacman.d/mirrorlist.backup
rankmirrors -n 6 /etc/pacman.d/mirrorlist.backup &gt; /etc/pacman.d/mirrorlist
</code></pre>
<h1><a class="header" href="#安装archlinux-1" id="安装archlinux-1">安装archlinux</a></h1>
<p>在U盘上安装</p>
<h4><a class="header" href="#参考链接-1" id="参考链接-1">参考链接</a></h4>
<p>https://wiki.archlinux.org/index.php/Installing_Arch_Linux_on_a_USB_key
https://wiki.archlinux.org/index.php/installation_guide
https://wiki.archlinux.org/index.php/Improving_performance#Reduce_disk_reads.2Fwrites
http://www.wyae.de/docs/boot-usb3/
https://wiki.archlinux.org/index.php/General_recommendations
https://wiki.archlinux.org/index.php/List_of_applications
https://wiki.archlinux.org/index.php/Wayland
https://wiki.archlinux.org/index.php/GRUB</p>
<h4><a class="header" href="#连网-1" id="连网-1">连网</a></h4>
<ul>
<li>
<p>有线一般通过 dhcpcd eth0 连接网络</p>
</li>
<li>
<p>配置代理</p>
<pre><code class="language-bash">export http_proxy=&quot;https://username:password@server:port&quot;
</code></pre>
</li>
</ul>
<h4><a class="header" href="#创建文件系统-1" id="创建文件系统-1">创建文件系统</a></h4>
<h5><a class="header" href="#分区及文件系统-1" id="分区及文件系统-1">分区及文件系统</a></h5>
<p>为了兼容性，所以采用msdos的分区表。<br />
为了仍然可以有部分容量作为U盘使用，所以系统安装在第二个分区,因为windows只认U盘的第一个分区。
给第一个分区创建exfat文件系统，这样可以放超过4G大小的文件.</p>
<pre><code class="language-bash">parted -s -- /dev/sda mkpart 1m 32g
parted -s -- /dev/sda mkpart 32g -1
parted -s -- /dev/sda set 2 boot on
mkfs.exfat /dev/sda1
mkfs.ext4 /dev/sda2
mount /dev/sda2 /mnt
</code></pre>
<h4><a class="header" href="#pacstrap-1" id="pacstrap-1">pacstrap</a></h4>
<p><code>pacstrap /mnt</code></p>
<h4><a class="header" href="#配置系统-1" id="配置系统-1">配置系统</a></h4>
<h5><a class="header" href="#生成fstab-1" id="生成fstab-1">生成fstab</a></h5>
<p><code># genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</code></p>
<h5><a class="header" href="#chroot-1" id="chroot-1">chroot</a></h5>
<p><code># arch-chroot /mnt</code></p>
<h5><a class="header" href="#安装基础软件包-1" id="安装基础软件包-1">安装基础软件包</a></h5>
<p>目标是重启后可以连网</p>
<pre><code class="language-bash">pacman -S privoxy shadowsocks-libev simple-obfs proxychains-ng kcptun iw wpa_supplicant dhcpcd
</code></pre>
<h5><a class="header" href="#时区-1" id="时区-1">时区</a></h5>
<pre><code class="language-bash"># ln -sf /usr/share/zoneinfo/Region/City /etc/localtime
# hwclock --systohc
</code></pre>
<h5><a class="header" href="#locale-1" id="locale-1">locale</a></h5>
<p>编辑/etc/locale.gen，然后执行 <code># locale-gen</code>:</p>
<pre><code class="language-bash">/etc/locale.conf
LANG=en_US.UTF-8
</code></pre>
<h5><a class="header" href="#主机名-1" id="主机名-1">主机名</a></h5>
<pre><code class="language-bash"># cat /etc/hostname
myhostname
</code></pre>
<h5><a class="header" href="#initramfs-重要和常规有变化-1" id="initramfs-重要和常规有变化-1">Initramfs (重要，和常规有变化)</a></h5>
<p>Before creating the initial RAM disk # mkinitcpio -p linux, in /etc/mkinitcpio.conf add the block hook to the hooks array right after udev. This is necessary for appropriate module loading in early userspace.</p>
<p>要hooks里udev后面马上跟block</p>
<p><code># mkinitcpio -p linux</code></p>
<h5><a class="header" href="#配置引导程序-1" id="配置引导程序-1">配置引导程序</a></h5>
<pre><code class="language-bash">pacman -S grub
# grub-install --target=i386-pc /dev/sda --removable --recheck
# grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
<h5><a class="header" href="#配置root密码添加用户配置用户密码-1" id="配置root密码添加用户配置用户密码-1">配置root密码，添加用户，配置用户密码</a></h5>
<pre><code class="language-bash">passwd
# useradd -m -G wheel -s /bin/bash &lt;username&gt;
passwd &lt;username&gt;
</code></pre>
<h5><a class="header" href="#重启-1" id="重启-1">重启</a></h5>
<pre><code class="language-bash"># umount /mnt
reboot
</code></pre>
<h4><a class="header" href="#第一次进入系统-1" id="第一次进入系统-1">第一次进入系统</a></h4>
<h5><a class="header" href="#a-hreflinuxarchlinux配置网络a-1" id="a-hreflinuxarchlinux配置网络a-1"><a href="linux/archlinux/">配置网络</a></a></h5>
<h5><a class="header" href="#a-hreflinuxarchlinux配置代理a-1" id="a-hreflinuxarchlinux配置代理a-1"><a href="linux/archlinux/">配置代理</a></a></h5>
<h5><a class="header" href="#安装基本软件包-1" id="安装基本软件包-1">安装基本软件包</a></h5>
<pre><code class="language-bash">pacman -S base-devel dosfstools ntfs-3g exfat-utils openssh screen gvim p7zip zip unzip git gnupg  lsof  ntp gnu-netcat nmap cronie bc dstat bash-completion
</code></pre>
<h5><a class="header" href="#安装图形-1" id="安装图形-1">安装图形</a></h5>
<pre><code class="language-bash">pacman -S  xf86-input-synaptics xf86-video-vesa  xf86-video-ati xf86-video-intel  xf86-video-nouveau weston xorg-server-xwayland xorg-xrdb gtk3  sway rxvt-unicode dmenu alsa-utils alsa-firmware libsamplerate pulseaudio pulseaudio-alsa pavucontrol fcitx noto-fonts noto-fonts-cjk
</code></pre>
<h5><a class="header" href="#安装多媒体工具-1" id="安装多媒体工具-1">安装多媒体工具</a></h5>
<pre><code class="language-bash">pacman -S mpv imv
</code></pre>
<h5><a class="header" href="#为了访问android-1" id="为了访问android-1">为了访问Android</a></h5>
<pre><code class="language-bash">pacman -s android-tools android-udev
# gpasswd -a &lt;username&gt; adbusers
</code></pre>
<h5><a class="header" href="#文档处理-1" id="文档处理-1">文档处理</a></h5>
<pre><code class="language-bash">pacman -S mupdf
</code></pre>
<p>a</p>
<h1><a class="header" href="#yum" id="yum">YUM</a></h1>
<h1><a class="header" href="#links-222" id="links-222">Links</a></h1>
<h1><a class="header" href="#creating-a-yum-repository" id="creating-a-yum-repository">Creating a Yum Repository</a></h1>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/sec-yum_repository">8.4.6. Creating a Yum Repository - Red Hat Customer Portal</a></li>
</ul>
<pre><code>yum install createrepo
createrepo --database /mnt/local_repo
</code></pre>
<h1><a class="header" href="#working-with-package-groups" id="working-with-package-groups">Working with Package Groups</a></h1>
<pre><code>yum groups summary
yum group info glob_expression…

yum group install &quot;group name&quot;
yum group install groupid
// same as group install
yum install @group
// Replace group with the groupid or quoted group name. 
yum install @^group

yum group remove group_name
yum group remove groupid
yum remove @group
yum remove @^group
</code></pre>
<h1><a class="header" href="#list-all-version-of-packages" id="list-all-version-of-packages">List all version of packages</a></h1>
<p>with <code>--showduplicates</code></p>
<pre><code>sudo yum search --showduplicates kubeadm
</code></pre>
<h1><a class="header" href="#how-do-i-use-yum-to-download-a-package-without-installing-it" id="how-do-i-use-yum-to-download-a-package-without-installing-it">How do I use yum to download a package without installing it?</a></h1>
<h1><a class="header" href="#links-223" id="links-223">Links</a></h1>
<ul>
<li><a href="https://access.redhat.com/solutions/10154">How to use yum to download a package without installing it - Red Hat Customer Portal</a></li>
</ul>
<h1><a class="header" href="#environment" id="environment">Environment</a></h1>
<ul>
<li>Red Hat Enterprise Linux (RHEL) 7</li>
<li>Red Hat Enterprise Linux 6</li>
<li>Red Hat Enterprise Linux 5</li>
</ul>
<h1><a class="header" href="#issue-1" id="issue-1">Issue</a></h1>
<ul>
<li>How do I use yum to download a package without installing it?</li>
</ul>
<h1><a class="header" href="#resolution" id="resolution">Resolution</a></h1>
<p>There are two ways to download a package without installing it.</p>
<p>One is using the &quot;downloadonly&quot; plugin for yum, the other is using &quot;yumdownloader&quot; utility.</p>
<pre><code>yum install yum-plugin-downloadonly
yum install --downloadonly --downloaddir=&lt;directory&gt; &lt;package&gt;


Note:

    Before using the plugin, check /etc/yum/pluginconf.d/downloadonly.conf to confirm that this plugin is &quot;enabled=1&quot;
    This is applicable for &quot;yum install/yum update&quot; and not for &quot;yum groupinstall&quot;. Use &quot;yum groupinfo&quot; to identify packages within a specific group.
    If only the package name is specified, the latest available package is downloaded (such as sshd). Otherwise, you can specify the full package name and version (such as httpd-2.2.3-22.el5).
    If you do not use the --downloaddir option, files are saved by default in /var/cache/yum/ in rhel-{arch}-channel/packages
    If desired, you can download multiple packages on the same command.
    You still need to re-download the repodata if the repodata expires before you re-use the cache. By default it takes two hours to expire.
</code></pre>
<h1><a class="header" href="#yumdownloader" id="yumdownloader">Yumdownloader</a></h1>
<p>If downloading a installed package, &quot;yumdownloader&quot; is useful.</p>
<pre><code>yum install yum-utils
yumdownloader &lt;package&gt;
</code></pre>
<p>Note:</p>
<ul>
<li>The package is saved in the current working directly by default; use the
<code>--destdir</code> option to specify an alternate location.</li>
<li>Be sure to add <code>--resolve</code> if you need to download dependencies.</li>
</ul>
<h1><a class="header" href="#networking-2" id="networking-2">Networking</a></h1>
<h1><a class="header" href="#links-224" id="links-224">Links</a></h1>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/">Red Hat Enterprise Linux 7 Networking Guide - Red Hat Customer Portal</a></li>
</ul>
<h1><a class="header" href="#cpu-time" id="cpu-time">cpu time</a></h1>
<h1><a class="header" href="#links-225" id="links-225">Links</a></h1>
<ul>
<li><a href="https://serverfault.com/questions/648704/how-are-cpu-time-and-cpu-usage-the-same/648708#648708">linux - How are CPU time and CPU usage the same? - Server Fault</a></li>
<li><a href="https://www.robustperception.io/understanding-machine-cpu-usage">Understanding Machine CPU usage – Robust Perception | Prometheus Monitoring Experts</a></li>
<li><a href="https://stackoverflow.com/questions/5732192/ps-utility-in-linux-procps-how-to-check-which-cpu-is-used">ps utility in linux (procps), how to check which CPU is used - Stack Overflow</a></li>
<li><a href="https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part1.html">Scheduling In Go : Part I - OS Scheduler</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/resource_management_guide/">Resource Management Guide - Red Hat Customer Portal</a></li>
<li><a href="https://people.seas.harvard.edu/%7Eapw/stress/">stress project page</a></li>
<li><a href="https://cizixs.com/2017/01/03/how-slow-is-disk-and-network/">让 CPU 告诉你硬盘和网络到底有多慢 | Cizixs Write Here</a></li>
<li><a href="https://bitbucket.org/bertimus9/systemstat">bertimus9 / systemstat — Bitbucket</a></li>
</ul>
<p>CPU time is allocated in discrete time slices (ticks). For a certain number of time slices, the cpu is busy, other times it is not (which is represented by the idle process). In the picture below the CPU is busy for 6 of the 10 CPU slices. 6/10 = .60 = 60% of busy time (and there would therefore be 40% idle time).</p>
<p><img src="linux/img/cputime.png" alt="cputime" /></p>
<p>A percentage is defined as &quot;a number or rate that is expressed as a certain number of parts of something divided into 100 parts&quot;. So in this case, those parts are discrete slices of time and the something is busy time slices vs idle time slices -- the rate of busy to idle time slices.</p>
<p>Since CPUs operate in GHz (billionths of cycles a second). The operating system slices that time in smaller units called ticks. They are not really 1/10 of a second. The tick rate in windows is 10 million ticks in a second and in Linux it is sysconf(_SC_CLK_TCK) (usually 100 ticks per second).</p>
<p>In something like top, the busy cpu cycles are then further broken down into percentages of things like user time and system time. In top on Linux and perfmon in Windows, you will often get a display that goes over 100%, that is because the total is 100% * the_number_of_cpu_cores.</p>
<p>In an operating system, it is the scheduler's job to allocate these precious slices to processes, so the scheduler is what reports this.</p>
<p>**so rate cputime is the usage per second. **</p>
<h1><a class="header" href="#node_exporter-1" id="node_exporter-1">Node_exporter</a></h1>
<p>This metric comes from <code>/proc/stat</code> and tell us how many seconds each CPU spent doing each type of work:</p>
<ul>
<li>user: The time spent in userland</li>
<li>system: The time spent in the kernel</li>
<li>iowait: Time spent waiting for I/O</li>
<li>idle: Time the CPU had nothing to do</li>
<li>irq&amp;softirq: Time servicing interrupts</li>
<li>guest: If you are running VMs, the CPU they use</li>
<li>steal: If you are a VM, time other VMs &quot;stole&quot; from your CPUs</li>
</ul>
<p>These modes are mutually exclusive. A high iowait means that you are disk or network bound, high user or system means that you are CPU bound.</p>
<p><code>sum by (mode, instance) (irate(node_cpu_seconds_total{job=&quot;node&quot;}[5m]))</code></p>
<p>As these values always sum to one second per second for each cpu, the per-second rates are also the ratios of usage. We can use this to calculate the percentage of CPU used, by subtracting the idle usage from 100%:</p>
<p><code>100 - (avg by (instance) (irate(node_cpu_seconds_total{job=&quot;node&quot;,mode=&quot;idle&quot;}[5m])) * 100)</code></p>
<h1><a class="header" href="#howto-eat-cpu-time" id="howto-eat-cpu-time">Howto eat cpu time</a></h1>
<p>最近有个项目，需要吃cpu, 但是不能100％使用，要有法调整使用的%比。</p>
<p>无法直接loop, loop会100％使用cpu，cpu就是这样设计的。</p>
<p>发现这个代码可以占用一个固定量的cpu</p>
<pre><code class="language-go">func main() {
        // tick := time.NewTicker(time.Nanosecond) // 300%
        // tick := time.NewTicker(time.Microsecond) // 190%
        tick := time.NewTicker(time.Millisecond) // 9%
        // tick := time.NewTicker(time.Second) // 0%
	defer tick.Stop()
	/*
	无法直接这样放goroutine里使的，这种goroutine无办法释放
	for range tick.C {
        }
	*/
	// 正确的方法：
	for range tick.C {
		select {
			case &lt;- stop:
				return
				default:
		}
	}

}
</code></pre>
<h1><a class="header" href="#restricting-process-cpu-usage-using-cgroups" id="restricting-process-cpu-usage-using-cgroups">Restricting process CPU usage using cgroups</a></h1>
<p>see <a href="linux/cgroups.html">cgroups</a></p>
<h1><a class="header" href="#stress" id="stress">stress</a></h1>
<p>这个是吃cpu最方便的工具，配合cgroups，非常好使</p>
<pre><code>cat stress.service 
[Unit]
Description=stress
Wants=stress.timer

[Service]
Type=simple
ExecStart=/usr/bin/stress --cpu 2 --io 1 --vm 1 --vm-bytes 128M --timeout 10s --verbose
RemainAfterExit=yes
Slice=stress.slice

[Install]
WantedBy=multi-user.target
</code></pre>
<pre><code>cat stress.timer
[Unit]
Description=Run stress every 2-3 minutes
Requires=stress.service

[Timer]
Unit=stress.service
OnUnitInactiveSec=2min		// m is different from min
RandomizedDelaySec=1min
AccuracySec=1s

[Install]
WantedBy=timers.target

</code></pre>
<pre><code>cat stress.service.d/cpu.conf
[Service]
CPUQuota=20%
</code></pre>
<p>or </p>
<pre><code>cat stress.slice
[Unit]
Description=Limited resources Slice
DefaultDependencies=no
Before=slices.target

[Slice]
CPUQuota=20%
MemoryLimit=2.7G
</code></pre>
<h1><a class="header" href="#check-cpu-usage" id="check-cpu-usage">Check CPU Usage</a></h1>
<h2><a class="header" href="#procstat" id="procstat">/proc/stat</a></h2>
<p>content in <code>/proc/stat/</code>, if used to calculate percentage, must read twice, E.g. :</p>
<p><code>idle1 - idle0 / total1 - total0</code></p>
<h2><a class="header" href="#ps" id="ps">ps</a></h2>
<pre><code class="language-sh">ps -C &quot;process&quot; -L -o pid,lwp,pcpu,cpuid,time

    -C: select the process named &quot;process&quot;
    -L: list the process threads
    -o: specify output info
        pid: process id
        lwp: light weight process (thread)
        pcpu: CPU usage (percent)
        cpuid: CPU id
        time: thread time (from start)
</code></pre>
<h2><a class="header" href="#top" id="top">top</a></h2>
<pre><code class="language-sh">top -d delay -n iterations
top -n 1		// once
</code></pre>
<h2><a class="header" href="#iostat" id="iostat">iostat</a></h2>
<p>This utility display system’s average CPU utilization <strong>since the last reboot</strong>. </p>
<p>To list the individual report use -c, -d and -n switch for CPU utilization, device utilization and network file system utilization.</p>
<pre><code class="language-sh">iostat	    // displays cpu, device, network file system
iostat -c	// cpu
iostat -d	// device	
iostat -n	// network file system
</code></pre>
<h2><a class="header" href="#vmstat" id="vmstat">vmstat</a></h2>
<h2><a class="header" href="#mpstat" id="mpstat">mpstat</a></h2>
<h2><a class="header" href="#sar" id="sar">sar</a></h2>
<pre><code class="language-sh">sar 2 5				// interval count
sar -u [ALL] 2 5 		// -u cpu
sar -P ALL 2 3 			// all cpu
sar -P 0 2 3 			// the first cpu

sar -r 				// memory
sar -d 				// device
sar -n ALL|DEV|NDEV|...		// network
sar -q				// load
</code></pre>
<h1><a class="header" href="#process-vs-thread" id="process-vs-thread">Process vs Thread</a></h1>
<p>Your program is just a series of machine instructions that need to be executed one after the other sequentially. To make that happen, the operating system uses the concept of a Thread. It’s the job of the Thread to account for and sequentially execute the set of instructions it’s assigned. Execution continues until there are no more instructions for the Thread to execute. This is why I call a Thread, “a path of execution”.</p>
<p><strong>Every program you run creates a Process and each Process is given an initial Thread.</strong> Threads have the ability to create more Threads. All these different Threads run independently of each other and scheduling decisions are made at the Thread level, not at the Process level. Threads can run concurrently (each taking a turn on an individual core), or in parallel (each running at the same time on different cores). Threads also maintain their own state to allow for the safe, local, and independent execution of their instructions.</p>
<p>以前我认为进程是一级的，一个进程有法有很多线程。</p>
<p>其实不是。</p>
<p>程序拉进内存就是进程，所有程序启动都会分配一个初始线程。线程是进程执行的路.thread is used for os scheduler to schedule cpu time.</p>
<h1><a class="header" href="#context-switch" id="context-switch">context switch</a></h1>
<h1><a class="header" href="#links-226" id="links-226">Links</a></h1>
<ul>
<li><a href="https://serverfault.com/questions/190049/find-out-which-task-is-generating-a-lot-of-context-switches-on-linux">performance monitoring - Find out which task is generating a lot of context switches on linux - Server Fault</a></li>
</ul>
<h1><a class="header" href="#check-1" id="check-1">Check</a></h1>
<pre><code>// sar [xxx interval count]
sar -w 1 3
       -w     Report task creation and system switching activity.
              proc/s
                     Total number of tasks created per second.
              cswch/s
                     Total number of context switches per second.


vmstat 1 3
   System
       in: The number of interrupts per second, including the clock.
       cs: The number of context switches per second.
</code></pre>
<p>pid level</p>
<pre><code>pidstat -wt 1 3
       -w     Report  task  switching  activity  (kernels 2.6.23 and later
              only).  The following values are displayed:

              PID
                     The identification number of  the  task  being  moni-
                     tored.

              cswch/s
                     Total  number  of voluntary context switches the task
                     made per second.  A voluntary context  switch  occurs
                     when  a  task  blocks  because it requires a resource
                     that is unavailable.

              nvcswch/s
                     Total number of non voluntary  context  switches  the
                     task  made  per second.  A involuntary context switch
                     takes place when a task executes for the duration  of
                     its  time  slice and then is forced to relinquish the
                     processor.

              Command
                     The command name of the task.

       -t     Also display statistics for threads associated with selected tasks.

              This option adds the following values to the reports:

              TGID
                     The identification number of the thread group leader.

              TID
                     The identification number of the thread being monitored.
</code></pre>
<h1><a class="header" href="#cgroups" id="cgroups">cgroups</a></h1>
<h1><a class="header" href="#links-227" id="links-227">Links</a></h1>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/resource_management_guide/">Resource Management Guide - Red Hat Customer Portal</a></li>
</ul>
<h1><a class="header" href="#default-cgroup-hierarchies-and-resource-controllers-in-linux-kernel" id="default-cgroup-hierarchies-and-resource-controllers-in-linux-kernel">DEFAULT CGROUP HIERARCHIES and RESOURCE CONTROLLERS IN LINUX KERNEL</a></h1>
<p>systemd automatically mounts hierarchies for important kernel resource controllers in the <code>/sys/fs/cgroup/</code> directory.</p>
<p>Find the list of currently mounted resource controllers in <code>/proc/cgroups</code></p>
<pre><code class="language-sh">$ cat /proc/cgroups 
#subsys_name    hierarchy       num_cgroups     enabled
cpuset  3       1       1
cpu     5       70      1
cpuacct 5       70      1
blkio   12      70      1
memory  2       215     1
devices 9       70      1
freezer 6       2       1
net_cls 4       1       1
perf_event      11      1       1
net_prio        4       1       1
hugetlb 8       1       1
pids    10      80      1
rdma    7       1       1
</code></pre>
<h1><a class="header" href="#systemd-unit-types" id="systemd-unit-types">Systemd Unit Types</a></h1>
<ul>
<li>
<p>Service — A process or a group of processes</p>
</li>
<li>
<p>Scope — A group of externally created processes.</p>
</li>
<li>
<p>Slice — A group of hierarchically organized units.</p>
<p>Slices describe resource limits. I have one slice that limits the resources used by all my services as a whole.</p>
</li>
</ul>
<h1><a class="header" href="#creating-control-groups" id="creating-control-groups">CREATING CONTROL GROUPS</a></h1>
<p>The <code>systemd-run</code> command is used to create and start a transient service or scope unit and run a custom command in the unit.</p>
<pre><code class="language-sh">systemd-run --unit=name --scope --slice=slice_name command
// Use the optional --scope parameter to create a transient scope unit instead of service unit that is created by default.
// With the --slice option, you can make your newly created service or scope unit a member of a specified slice. Replace slice_name with the name of an existing slice (as shown in the output of systemctl -t slice), or create a new slice by passing a unique name. By default, services and scopes are created as members of the system.slice.
</code></pre>
<p>E.g.</p>
<p><code>systemd-run --unit=toptest --slice=test top -b</code></p>
<p>or use config file.</p>
<h1><a class="header" href="#modifying-control-groups" id="modifying-control-groups">MODIFYING CONTROL GROUPS</a></h1>
<pre><code>systemctl set-property name parameter=value
systemctl set-property --runtime name property=value	// makes your settings transient

systemctl set-property httpd.service CPUShares=600 MemoryLimit=500M
</code></pre>
<h1><a class="header" href="#modifying-unit-files" id="modifying-unit-files">Modifying Unit Files</a></h1>
<p>default cfg file: <code>/etc/systemd/system.conf</code>
unit cfg file: <code>/etc/systemd/system/httpd.service.d/cpu.conf</code></p>
<pre><code class="language-sh">[Service]
CPUShares=1500		// default 1024
CPUQuota=20%
MemoryLimit=1G	
BlockIOWeight=100	// Choose a single value between 10 and 1000, the default setting is 1000.
BlockIODeviceWeight=device_name value
BlockIOReadBandwidth=device_name value
BlockIOWriteBandwidth=device_name value
BlockIODeviceWeight=/home/jdoe 750
BlockIOReadBandwith=/var/log 5M
DeviceAllow=device_name options
// device_name stands for a path to a device node or a device group name as specified in /proc/devices. Replace options with a combination of r, w, and m to allow the unit to read, write, or create device nodes.
DevicePolicy=value		// strict, closed, auto
Slice=slice_name		// default is system.slice. 
</code></pre>
<p>Users can thus monitor the usage of the processor with the <code>systemd-cgtop</code> command.</p>
<p>reload:</p>
<pre><code class="language-sh">systemctl daemon-reload
systemctl restart httpd.service
</code></pre>
<h1><a class="header" href="#obtaining-information-about-control-groups" id="obtaining-information-about-control-groups">OBTAINING INFORMATION ABOUT CONTROL GROUPS</a></h1>
<pre><code>systemd-cgls	// view the hierarchy of control groups
systemd-cgls name
systemd-cgls memory
systemd-cgtop 	// monitor their resource consumption in real time.
machinectl	// dedicated to monitoring Linux containers

cat proc/PID/cgroup
</code></pre>
<h1><a class="header" href="#ssh-2" id="ssh-2">ssh</a></h1>
<h1><a class="header" href="#show-ssh-key-length" id="show-ssh-key-length">show ssh key length</a></h1>
<pre><code>ssh-keygen -lf .ssh/id_rsa
</code></pre>
<h1><a class="header" href="#change-private-key-passphrase" id="change-private-key-passphrase">change private key passphrase</a></h1>
<pre><code>ssh-keygen -p -f ~/.ssh/id_dsa

	-p      Requests changing the passphrase of a private key file instead of creating a new private key. 
</code></pre>
<h1><a class="header" href="#copy-the-public-key-to-a-ssh-server" id="copy-the-public-key-to-a-ssh-server">copy the public key to a ssh server</a></h1>
<pre><code>cat ~/.ssh/id_rsa.pub | ssh &lt;user&gt;@&lt;hostname&gt; 'umask 0077; mkdir -p .ssh; cat &gt;&gt; .ssh/authorized_keys &amp;&amp; echo &quot;Key copied&quot;'
</code></pre>
<h1><a class="header" href="#host-config" id="host-config">Host config</a></h1>
<p>cfg:</p>
<p><code>.ssh/config</code>:</p>
<pre><code class="language-sh">Host host1
User    user1
HostName host1.com

Host host2
User    user2
HostName host2.com
Port    22322
</code></pre>
<p>Now can easy <code>ssh</code>:</p>
<pre><code class="language-sh">ssh host1
</code></pre>
<h1><a class="header" href="#ssh-agent" id="ssh-agent">ssh-agent</a></h1>
<h1><a class="header" href="#links-228" id="links-228">Links</a></h1>
<ul>
<li><a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/">Generating a new SSH key and adding it to the ssh-agent - User Documentation</a></li>
<li><a href="https://blog.gtwang.org/linux/using-ssh-agent-forwarding-to-avoid-being-asked-passphrase/">SSH 免除重複輸入金鑰密碼教學：SSH Agent 與 Forwarding - G. T. Wang</a></li>
<li><a href="https://serverfault.com/questions/132970/can-i-automatically-add-a-new-host-to-known-hosts/316100#316100">linux - Can I automatically add a new host to known_hosts? - Server Fault</a></li>
<li><a href="http://mah.everybody.org/docs/ssh">Using ssh-agent with ssh</a></li>
</ul>
<h1><a class="header" href="#overview-39" id="overview-39">Overview</a></h1>
<p>之前想要免密码登陆其它ssh-server, 统都要先把public key拷贝到server里，现在我已经烦这种方法罢。我感觉麻烦。</p>
<p>所以研究一下ssh-agent. </p>
<h1><a class="header" href="#howto-4" id="howto-4">HowTo</a></h1>
<pre><code class="language-sh">    SSH_ENV=&quot;$HOME/.ssh/environment&quot;

    function start_agent {
         echo &quot;Initialising new SSH agent...&quot;
         /usr/bin/ssh-agent | sed 's/^echo/#echo/' &gt; &quot;${SSH_ENV}&quot;
         echo succeeded
         chmod 600 &quot;${SSH_ENV}&quot;
         . &quot;${SSH_ENV}&quot; &gt; /dev/null
         /usr/bin/ssh-add;
    }

    # Source SSH settings, if applicable

    if [ -f &quot;${SSH_ENV}&quot; ]; then
         . &quot;${SSH_ENV}&quot; &gt; /dev/null
         #ps ${SSH_AGENT_PID} doesn't work under cywgin
         ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ &gt; /dev/null || {
             start_agent;
         }
    else
         start_agent;
    fi
</code></pre>
<ul>
<li>Run ssh-agent</li>
</ul>
<pre><code class="language-sh">eval $(ssh-agent)
</code></pre>
<ul>
<li>Generate a new key</li>
</ul>
<pre><code class="language-bash"># ssh-keygen [-q] [-b bits] [-t dsa | ecdsa | ed25519 | rsa] [-N new_passphrase] [-C comment] [-f output_keyfile]
ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot; -N *** -f .ssh/id20181223_rsa
</code></pre>
<ul>
<li>Adding your SSH key to the ssh-agent</li>
</ul>
<pre><code class="language-bash">ssh-add .ssh/id20181223_rsa
ssh-add -l
</code></pre>
<ul>
<li>cfg</li>
</ul>
<p><code>~/.ssh/config</code>:</p>
<pre><code>Host example.com
  ForwardAgent yes
</code></pre>
<p>or </p>
<p><code>/etc/ssh/ssh_config</code>:</p>
<pre><code>Host *
 ForwardAgent yes
</code></pre>
<p>or without config, just run <code>ssh</code> with <code>-A</code> option.</p>
<ul>
<li>run</li>
</ul>
<pre><code class="language-sh">ssh &lt;host&gt;
# or
ssh -A &lt;host&gt;
</code></pre>
<h1><a class="header" href="#help" id="help">Help</a></h1>
<pre><code>$ ssh-add --help
ssh-add: illegal option -- -
usage: ssh-add [options] [file ...]
Options:
  -l          List fingerprints of all identities.
  -E hash     Specify hash algorithm used for fingerprints.
  -L          List public key parameters of all identities.
  -k          Load only keys and not certificates.
  -c          Require confirmation to sign using identities
  -m minleft  Maxsign is only changed if less than minleft are left (for XMSS)
  -M maxsign  Maximum number of signatures allowed (for XMSS)
  -t life     Set lifetime (in seconds) when adding identities.
  -d          Delete identity.
  -D          Delete all identities.
  -x          Lock agent.
  -X          Unlock agent.
  -s pkcs11   Add keys from PKCS#11 provider.
  -e pkcs11   Remove keys provided by PKCS#11 provider.
  -q          Be quiet after a successful operation.
</code></pre>
<h1><a class="header" href="#conclusion-2" id="conclusion-2">Conclusion</a></h1>
<p>研究么半天，终于发觉这个不是我想要的东西。这个实现的是服务器之间免密码，而你本地还是需要把公钥copy到所有服务器上面去的。</p>
<h1><a class="header" href="#troubleshooting-2" id="troubleshooting-2">Troubleshooting</a></h1>
<p>其实困扰我的问题是这个：</p>
<pre><code>The authenticity of host '[xxxxxxx]:12345 ([123.123.123.123]:12345)' can't be established.
RSA key fingerprint is SHA256:832423werwqer9dsfioWERdafj@#$@%KJSERWe2ewrsd
Are you sure you want to continue connecting (yes/no)? 
</code></pre>
<p>这种情况就不方便放在脚本里处理罢，不推荐是解决办法是：<code>ssh -o StrictHostKeyChecking=no username@hostname.com</code>，这个有安全问题。</p>
<p>正确的方法是：</p>
<pre><code class="language-sh">#    -R hostname
#                 Removes all keys belonging to hostname from a known_hosts file.  This option is useful to delete hashed hosts (see the -H option above).
ssh-keygen -R [hostname]
ssh-keygen -R [ip_address]
# same as above two
ssh-keygen -R [hostname],[ip_address]

#    -H      Hash all hostnames and addresses in the output.  Hashed names may be used normally by ssh(1) and sshd(8), but they do not reveal identifying informa-
#                 tion should the file's contents be disclosed.

#    -p port
#            Connect to port on the remote host.
ssh-keyscan -H [ip_address] &gt;&gt; ~/.ssh/known_hosts
ssh-keyscan -H [hostname] &gt;&gt; ~/.ssh/known_hosts
# same as above two
ssh-keyscan -H [hostname],[ip_address] &gt;&gt; ~/.ssh/known_hosts
</code></pre>
<h1><a class="header" href="#qemu" id="qemu">qemu</a></h1>
<h1><a class="header" href="#links-229" id="links-229">Links</a></h1>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/QEMU">QEMU - ArchWiki</a></li>
</ul>
<h1><a class="header" href="#install-33" id="install-33">Install</a></h1>
<pre><code>// archlinux
pacman -S qemu
</code></pre>
<h1><a class="header" href="#by-specifying-kernel-and-initrd-manually" id="by-specifying-kernel-and-initrd-manually">By specifying kernel and initrd manually</a></h1>
<pre><code>qemu-system-x86_64  \
	-kernel /boot/vmlinuz-linux \
	-initrd /boot/initramfs-linux.img  \
	-append 'console=ttyS0 root=/dev/sda1' \
	--nographic \
	-serial mon:stdio \
	/dev/sda3 

// In the above example, the physical partition being used for the guest's root
// file system is /dev/sda3 on the host, but it shows up as /dev/sda on the guest.

</code></pre>
<p>a</p>
<h1><a class="header" href="#kvm" id="kvm">KVM</a></h1>
<h1><a class="header" href="#links-230" id="links-230">Links</a></h1>
<ul>
<li><a href="https://linux.dell.com/files/whitepapers/KVM_Virtualization_in_RHEL_7_Made_Easy.pdf">KVM_Virtualization_in_RHEL_7_Made_Easy</a> <strong>Excenlent</strong></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_getting_started_guide/index">Virtualization Getting Started Guide - Red Hat Customer Portal</a></li>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/index">Virtualization Deployment and Administration Guide - Red Hat Customer Portal</a></li>
</ul>
<h1><a class="header" href="#kvm-vs-libvirt-vs-qemu" id="kvm-vs-libvirt-vs-qemu">kvm vs libvirt vs qemu</a></h1>
<p>kvm virtualize cpu and mem</p>
<p>qemu virtualize others except cpu and mem</p>
<p>libvirt is an interface, an api.</p>
<p>libvirt supports qemu-kvm, vmware, virtualbox and xen.</p>
<h1><a class="header" href="#begin" id="begin">Begin</a></h1>
<ul>
<li>Verify your server support VT(Virtualization Technology)</li>
</ul>
<pre><code>grep -E 'svm|vmx' /proc/cpuinfo

	- vmx is for Intel processors
	- svm is for AMD processors
</code></pre>
<ul>
<li>Install KVM software</li>
</ul>
<pre><code>// on rhel7
yum install qemu-kvm libvirt libvirt-python libguestfs-tools virt-install virt-top
systemctl enable libvirtd 
systemctl start libvirtd

// verify kvm modules are loaded
# lsmod | grep kvm
kvm_intel              53484  3 
kvm                   316506  1 kvm_intel

// enable ip_forward
# grep ip_forward /etc/sysctl.conf
net.ipv4.ip_forward = 1

// load config 
# sysctl -p 

// print the full list of variant
// when creating vms, pick a suitable one.
virt-install --os-variant list
</code></pre>
<h1><a class="header" href="#creating-vms" id="creating-vms">Creating VMs</a></h1>
<p>If no network option is specified, the guest virtual machine is configured with a default network with NAT.</p>
<pre><code class="language-sh">virt-install -v \
--os-type=linux \
--os-variant=rhel7 \
--name=centos7.6 \
--vcpus=1 \
--memory=1024 \
--nographics --extra-args='console=ttyS0' \
--location=CentOS-7-x86_64-DVD-1810.iso
--disk=centos7.6.1810.img,size=10 \
</code></pre>
<h2><a class="header" href="#virt-viewer" id="virt-viewer">virt-viewer</a></h2>
<pre><code>virt-viewer [OPTION...] DOMAIN-NAME|ID|UUID - Virtual machine graphical console
</code></pre>
<p>Getting X11 forwarding through ssh working after running su:</p>
<pre><code>ssh -X user@hostname
su -
xauth merge /home/user/.Xauthority
virt-view &lt;id&gt;
</code></pre>
<p>There's one time I have trouble with keyboard when use <code>virt-view &lt;id&gt;</code>, I simply change to <code>vnc-view :5900</code>, then everything's ok.</p>
<h1><a class="header" href="#virsh---management-user-interface" id="virsh---management-user-interface">virsh - management user interface</a></h1>
<pre><code>// exit with ctrl-]
# console vm1

# list --all
# destroy vm1 
# undefine vm1

/*
      shutdown domain [--mode acpi|agent]
           Gracefully shuts down a domain.
       destroy domain [--graceful]
           Immediately terminate the domain domain.  This doesn’t give the domain OS any chance to react, and it’s the equivalent of ripping the power cord out
           on a physical machine.  In most cases you will want to use the shutdown command instead.  However, this does not delete any storage volumes used by
           the guest, and if the domain is persistent, it can be restarted later.
       undefine domain [--managed-save] [--snapshots-metadata] [ {--storage volumes | --remove-all-storage} --wipe-storage]
           Undefine a domain. If the domain is running, this converts it to a transient domain, without stopping it. If the domain is inactive, the domain
           configuration is removed.

simplely saying, destroy is same to &quot;poweroff&quot;,  undefine is same to &quot;delete&quot;.

*/


# dominfo vm1
# shutdown vm1
# start vm1
# autostart [--diable] vm1


# domifaddr vm1	    // obtain ip
</code></pre>
<p>and</p>
<pre><code># virt-top
# virt-df vm1
</code></pre>
<h1><a class="header" href="#cloning-vms" id="cloning-vms">Cloning VMs</a></h1>
<p>clone will have a new mac, but same ip, so we need to modify ip manually.</p>
<pre><code># virsh suspend vm1
# virt-clone --original vm1 -n vm1-clone -f vm/vm1-clone.img
# virsh resume vm1
</code></pre>
<h1><a class="header" href="#attaching-storage-device-to-a-vm" id="attaching-storage-device-to-a-vm">Attaching storage device to a VM</a></h1>
<pre><code>// vdb is the device name in vm1
# virsh attach-disk vm1 /dev/sdb vdb --driver qemu --mode shareable
# virsh detach-disk vm1 vdb
</code></pre>
<h1><a class="header" href="#memory" id="memory">Memory</a></h1>
<p>You can dynamically change the memory in a VM up to what its <strong>maximum memory setting</strong> is . </p>
<ul>
<li>reduce</li>
</ul>
<pre><code># virsh
# dominfo vm1-clone 
...
Max memory:     1048576 KiB
Used memory:    1048576 KiB
...

# setmem vm1-clone 512000
</code></pre>
<ul>
<li>
<p>increase</p>
<p><strong>increase the amount above maximum, must shutdown first.</strong></p>
</li>
</ul>
<pre><code># virsh shutdown vm1-clone
# virsh edit vm1-clone
// chage the value to
    &lt;memory unit='KiB'&gt;32000000&lt;/memory&gt;

# virsh create /etc/libvirt/qemu/vm1-clone.xml 
Domain vm1-clone created from /etc/libvirt/qemu/vm1-clone.xml

# virsh setmem &lt;id|name&gt; --size 32G
// make persistent
# virsh setmem 8 --size 32G --config
</code></pre>
<h1><a class="header" href="#vcpus" id="vcpus">vCPUs</a></h1>
<pre><code># virsh shutdown vm1-clone
// change the value
 &lt;vcpu placement='static'&gt;2&lt;/vcpu&gt;

# virsh create /etc/libvirt/qemu/vm1-clone.xml 
Domain vm1-clone created from /etc/libvirt/qemu/vm1-clone.xml 
</code></pre>
<h1><a class="header" href="#disk-capacity" id="disk-capacity">Disk capacity</a></h1>
<ol>
<li>
<p><code>fallocate -l 10G vm1-clone-add.img</code></p>
</li>
<li>
<p><code>virsh shutdown vm1-clone</code></p>
</li>
<li>
<p><code>virsh edit vm1-clone</code> </p>
<pre><code>    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='none'/&gt;
      &lt;source file='/mnt/vm/vm1-clone.img'/&gt;
      &lt;target dev='vda' bus='virtio'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;
    &lt;/disk&gt;
</code></pre>
<p>copy to below, and modify 3 place(file=, dev=, slot=):</p>
<pre><code>    &lt;disk type='file' device='disk'&gt;
      &lt;driver name='qemu' type='raw' cache='none'/&gt;
      &lt;source file='/mnt/vm/vm1-clone-add.img'/&gt;
      &lt;target dev='vdb' bus='virtio'/&gt;
      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0'/&gt;
    &lt;/disk&gt;
</code></pre>
<ul>
<li><strong>make sure that the name of the device (i.e. vdb) follows the first one in sequential order.</strong></li>
<li><strong>in the address tag, use a unique slot address ( check the address tag of ALL devices , not just storage devices)</strong></li>
</ul>
<p>as mine ,slot must change to <code>0x07</code>, but not <code>0x06</code>:</p>
<pre><code>error: XML error: Attempted double use of PCI Address '0:0:6.0'
Failed. Try again? [y,n,f,?]:
Domain vm1-clone XML configuration edited.
</code></pre>
</li>
<li>
<p><code>virsh create /etc/libvirt/qemu/vm1-clone.xml</code></p>
</li>
</ol>
<h1><a class="header" href="#deleting-vms" id="deleting-vms">Deleting VMs</a></h1>
<pre><code class="language-sh">virsh shutdown vm1-clone
virsh destroy vm1-clone
virsh undefine vm1-clone
rm /mnt/vm/vm1-clone.img
rm /mnt/vm/vm1-clone-add.img
</code></pre>
<h1><a class="header" href="#administration" id="administration">Administration</a></h1>
<h1><a class="header" href="#links-231" id="links-231">Links</a></h1>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/">Red Hat Enterprise Linux 7 Virtualization Deployment and Administration Guide - Red Hat Customer Portal</a></li>
</ul>
<h1><a class="header" href="#add-a-second-nic-for-a-libvirt-guest" id="add-a-second-nic-for-a-libvirt-guest">Add a second NIC for a libvirt guest</a></h1>
<ol>
<li><code>virsh domiflist vm1</code></li>
<li>
<pre><code>virsh attach-interface --domain vm1 --type network \
		--source openstackvms --model virtio \
		--mac 52:54:00:4b:73:5f --config --live
</code></pre>
</li>
</ol>
<ul>
<li><a href="https://unix.stackexchange.com/questions/52855/what-is-the-difference-between-virbr-and-vnet">linux - What is the difference between virbr# and vnet#? - Unix &amp; Linux Stack Exchange</a></li>
<li><a href="https://kashyapc.fedorapeople.org/virt/add-network-card-in-guest.txt">kashyapc.fedorapeople.org/virt/add-network-card-in-guest.txt</a></li>
</ul>
<h1><a class="header" href="#creating-a-virtual-machine" id="creating-a-virtual-machine">CREATING A VIRTUAL MACHINE</a></h1>
<h4><a class="header" href="#storage-pools" id="storage-pools">Storage Pools</a></h4>
<pre><code>// &lt;dp&gt; is the name of the pool.
virsh pool-define-as dp --type dir --target /mnt/vm/dirpool/

//this command will create the &lt;dirpool&gt; dir for us. we don't need create the dir by ourself.
virsh pool-build dp

virsh pool-start dp
virsh pool-autostart dp
virsh pool-info dp
virsh pool-list --all
virsh pool-destroy dp

// will delete the dir
virsh pool-delete dp

virsh pool-undefine dp
</code></pre>
<h4><a class="header" href="#storage-volumes" id="storage-volumes">Storage Volumes</a></h4>
<pre><code># virsh vol-create-as dp v1 10G --format qcow2
Vol v1 created

# virsh vol-create-as dp v2 10G 
Vol v2 created

# virsh vol-info dp v1
error: failed to get pool 'v1'
error: failed to get vol 'dp', specifying --pool might help
error: Storage volume not found: no storage vol with matching path

# virsh vol-info v1 dp
Name:           v1
Type:           file
Capacity:       10.00 GiB
Allocation:     196.00 KiB

# virsh vol-info v2 dp
Name:           v2
Type:           file
Capacity:       10.00 GiB
Allocation:     10.00 GiB

# ls -l dirpool/*
-rw------- 1 root root      197120 Mar 27 21:37 dirpool/v1
-rw------- 1 root root 10737418240 Mar 27 21:38 dirpool/v2
# du -sh dirpool/*
196K    dirpool/v1
11G     dirpool/v2

[root@host dirpool]# qemu-img info v1
image: v1
file format: qcow2
virtual size: 10G (10737418240 bytes)
disk size: 196K
cluster_size: 65536
[root@host dirpool]# qemu-img info v2
image: v2
file format: raw
virtual size: 10G (10737418240 bytes)
disk size: 10G
</code></pre>
<h4><a class="header" href="#convert-vm-image" id="convert-vm-image">Convert vm image</a></h4>
<pre><code># qemu-img info vdisk.img 
image: vdisk.img
file format: raw
virtual size: 10G (10737418240 bytes)
disk size: 5.0G
# qemu-img convert -f raw -O qcow2 vdisk.img vdisk.qcow2
</code></pre>
<h4><a class="header" href="#re-sizing-the-disk-image" id="re-sizing-the-disk-image">Re-sizing the Disk Image</a></h4>
<p><code> # qemu-img resize filename size</code></p>
<p>You can also resize relative to the current size of the disk image.</p>
<p>`# qemu-img resize filename [+|-]size[K|M|G|T]``</p>
<p><strong>This command doesn't affect <code>virsh volume</code> direct.</strong></p>
<pre><code> Before using this command to shrink a disk image, you must use file system and partitioning tools inside the VM itself to reduce allocated file systems and partition sizes accordingly. Failure to do so will result in data loss.
After using this command to grow a disk image, you must use file system and partitioning tools inside the VM to actually begin using the new space on the device. 
</code></pre>
<h1><a class="header" href="#links-232" id="links-232">Links</a></h1>
<p>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/pdf/virtualization_deployment_and_administration_guide/Red_Hat_Enterprise_Linux-7-Virtualization_Deployment_and_Administration_Guide-en-US.pdf</p>
<h1><a class="header" href="#kernel" id="kernel">kernel</a></h1>
<p>Links</p>
<ul>
<li><a href="https://www.kernel.org/">The Linux Kernel Archives</a></li>
</ul>
<h1><a class="header" href="#install-34" id="install-34">Install</a></h1>
<ul>
<li><a href="https://www.cyberciti.biz/linux-news/linux-kernel-5-3-released-and-here-is-how-to-install-it/">Linux Kernel 5.3 released and here is how to install it - nixCraft</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/README.html#configuring-the-kernel">Linux kernel release 5.x <a href="http://kernel.org/">http://kernel.org/</a> — The Linux Kernel documentation</a></li>
</ul>
<pre><code>// rhel
sudo yum groupinstall &quot;Development Tools&quot;
sudo yum install ncurses-devel bison flex elfutils-libelf-devel openssl-devel bc


xz -cd linux-5.x.tar.xz | tar xvf -
cd linux-5.3
make defconfig
make
sudo make modules_install install
</code></pre>
<h1><a class="header" href="#kexec---directly-boot-into-a-new-kernel" id="kexec---directly-boot-into-a-new-kernel">kexec - directly boot into a new kernel</a></h1>
<h1><a class="header" href="#links-233" id="links-233">Links</a></h1>
<ul>
<li><a href="https://linux.die.net/man/8/kexec">kexec(8): directly boot into new kernel - Linux man page</a></li>
</ul>
<h1><a class="header" href="#usage-1" id="usage-1">Usage</a></h1>
<p>Using <strong>kexec</strong> consists of:</p>
<ol>
<li>loading the kernel to be rebooted to into memory, and</li>
<li>actually rebooting to the pre-loaded kernel.</li>
</ol>
<pre><code>kexec -l kernel-image --append=command-line-options --initrd=initrd-image 

// After this kernel is loaded, it can be booted to at any time using the command:
kexec -e

		-e (--exec)
			Run the currently loaded kernel. 
		-l (--load) kernel
			Load the specified kernel into the current kernel. 

		--append=string
				Append string to the kernel command line.

		--command-line=string
				Set the kernel command line to string.

		--reuse-cmdline
				Use the command line from the running system. When a panic kernel is loaded, it strips the crashkernel parameter automatically. The BOOT_IMAGE parame‐
				ter is also stripped.
</code></pre>
<h1><a class="header" href="#example-2" id="example-2">Example</a></h1>
<p>With this, I can pxe boot into a raid-tool kernel, after raided, then <code>kexec</code>
into the real installation kernel. doesn't need to boot twice.</p>
<h1><a class="header" href="#initramfs" id="initramfs">initramfs</a></h1>
<h1><a class="header" href="#links-234" id="links-234">Links</a></h1>
<ul>
<li><a href="https://access.redhat.com/solutions/24029">How to unpack/uncompress and repack/re-compress an initial ramdisk (initrd/initramfs) boot image file? - Red Hat Customer Portal</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/initrd.html">Using the initial RAM disk (initrd) — The Linux Kernel documentation</a>(Good)</li>
<li><a href="https://www.jootamam.net/howto-initramfs-image.htm">Jootamam - Howto create an initramfs image</a></li>
</ul>
<h1><a class="header" href="#extract-and-repack" id="extract-and-repack">Extract and Repack</a></h1>
<ul>
<li>
<p>Identify compression format of the image<br />
The most common is a gzip-format image, However, there may also be an<br />
XZ/LZMA-format image</p>
<pre><code>file /boot/initramfs-($uname -r).img
</code></pre>
</li>
<li>
<p>gzip format</p>
</li>
</ul>
<pre><code>// Extract
zcat /boot/initrd-$(uname -r).img | cpio -idmv
// Repack
find . | cpio -o -c | gzip -9 &gt; new.img
// For rhel7
/usr/lib/dracut/skipcpio /boot/initramfs-$(uname -r).img | zcat | cpio -idmv

cpio --option:
   -i, --extract
	             Copy-in. 
	Operation modifiers valid in copy-in and copy-pass modes
   -o, --create
                 Copy-out. 

   -d, --make-directories
	             Create leading directories where needed.
   -m, --preserve-modification-time
                 Retain previous file modification times when creating
				 files.
   -v, --verbose
                 Verbosely list the files processed.

   -c     Use the old portable (ASCII) archive format. 
</code></pre>
<ul>
<li>xz format</li>
</ul>
<pre><code>// Extract
xz -cd &lt; /boot/initrd-$(uname -r).img | cpio -idmv
// Repack
find . 2&gt;/dev/null | cpio -c -o | xz -9 --format=lzma &gt; new.img

xz --option:

   -d, --decompress, --uncompress
   -c, --stdout, --to-stdout
</code></pre>
<h1><a class="header" href="#custom-initramfs" id="custom-initramfs">Custom initramfs</a></h1>
<ul>
<li><a href="https://wiki.gentoo.org/wiki/Custom_Initramfs">Custom Initramfs - Gentoo Wiki</a></li>
</ul>
<p>minimalistic /init example</p>
<pre><code class="language-sh">#!/bin/busybox sh

# Mount the /proc and /sys filesystems.
mount -t proc none /proc
mount -t sysfs none /sys

# Do your stuff here.
echo &quot;This script just mounts and boots the rootfs, nothing else!&quot;

# Mount the root filesystem.
mount -o ro /dev/sda1 /mnt/root

# Clean up.
umount /proc
umount /sys

# Boot the real thing.
exec switch_root /mnt/root /sbin/init
</code></pre>
<h1><a class="header" href="#parse-cmdline" id="parse-cmdline">Parse cmdline</a></h1>
<ul>
<li><a href="https://wiki.gentoo.org/wiki/Custom_Initramfs/Examples">Custom Initramfs/Examples - Gentoo Wiki</a></li>
</ul>
<pre><code>for x in $(cat /proc/cmdline); do
	case &quot;${x}&quot; in
		crypt_root=*)
			CRYPT_ROOT=${x#*=}
		;;
		net_ipv4=*)
			NET_IPv4=${x#*=}
		;;
		net_gw=*)
			NET_GW=${x#*=}
		;;
	esac
done
</code></pre>
<h1><a class="header" href="#dracut" id="dracut">dracut</a></h1>
<h1><a class="header" href="#links-235" id="links-235">Links</a></h1>
<ul>
<li><a href="https://dracut.wiki.kernel.org/index.php/Main_Page">Dracut Wiki</a></li>
<li><a href="https://www.systutorials.com/docs/linux/man/8-dracut/">dracut: low-level tool for generating an initramfs image - Linux Man Pages (8)</a></li>
<li><a href="https://wiki.gentoo.org/wiki/Dracut">Dracut - Gentoo Wiki</a></li>
</ul>
<p>Some people inside Red Hat started to name their projects after cities and
villages around the developer headquarters of Red Hat in Westford,
Massachusetts.</p>
<p>So, dracut is named after the town Dracut, similar to <code>Wayland</code> and <code>Weston</code>.</p>
<p>According to <a href="https://en.wikipedia.org/wiki/Dracut,_Massachusetts">Wikipedia</a>, dracut it is pronounced: <code>/ˈdreɪkət/</code></p>
<h1><a class="header" href="#usage-2" id="usage-2">Usage</a></h1>
<pre><code>Usage: /sbin/dracut [OPTION]... [&lt;initramfs&gt; [&lt;kernel-version&gt;]]
</code></pre>
<h1><a class="header" href="#liveos-image" id="liveos-image">LiveOS image</a></h1>
<h1><a class="header" href="#links-236" id="links-236">Links</a></h1>
<ul>
<li><a href="https://fedoraproject.org/wiki/LiveOS_image">LiveOS image - Fedora Project Wiki</a></li>
</ul>
<h1><a class="header" href="#modules-2" id="modules-2">modules</a></h1>
<h1><a class="header" href="#links-237" id="links-237">Links</a></h1>
<ul>
<li><a href="https://www.cyberciti.biz/faq/linux-how-to-load-a-kernel-module-automatically-at-boot-time/">Linux: How to load a kernel module automatically at boot time - nixCraft</a></li>
</ul>
<h1><a class="header" href="#modprobe-at-startup" id="modprobe-at-startup">modprobe at startup</a></h1>
<pre><code># cat /etc/modules-load.d/modules.conf 

# /etc/modules: kernel modules to load at boot time.
#
# This file contains the names of kernel modules that should be loaded
# at boot time, one per line. Lines beginning with &quot;#&quot; are ignored.
</code></pre>
<h1><a class="header" href="#basic-7" id="basic-7">Basic</a></h1>
<pre><code>modprobe {module_name}
lsmod
modinfo {module_name} 				
rmmod {module_name} 
// or 
modprobe -r {module_name}
</code></pre>
<h1><a class="header" href="#dhcpd" id="dhcpd">dhcpd</a></h1>
<h1><a class="header" href="#dhcrelay" id="dhcrelay">dhcrelay</a></h1>
<pre><code>dhcrelay -d &lt;dhcpd_server&gt;

	-d     Force dhcrelay to run as a foreground process. 
</code></pre>
<h1><a class="header" href="#a-hrefhttpsnginxorgendocsnginxa" id="a-hrefhttpsnginxorgendocsnginxa"><a href="https://nginx.org/en/docs/">nginx</a></a></h1>
<h1><a class="header" href="#links-238" id="links-238">Links</a></h1>
<h1><a class="header" href="#installation-3" id="installation-3">Installation</a></h1>
<p>Just install from prebuild package: </p>
<p><a href="https://nginx.org/en/linux_packages.html#RHEL-CentOS">nginx: Linux packages</a></p>
<h1><a class="header" href="#beginners-guide" id="beginners-guide">Beginner’s Guide</a></h1>
<ul>
<li><a href="https://nginx.org/en/docs/beginners_guide.html">Beginner’s Guide</a></li>
</ul>
<pre><code>nginx -s &lt;stop|quit|reload|reopen&gt;

    stop — fast shutdown
    quit — graceful shutdown
    reload — reloading the configuration file
    reopen — reopening the log files
</code></pre>
<h1><a class="header" href="#openresty-lua-support" id="openresty-lua-support">OpenResty Lua Support</a></h1>
<ul>
<li><a href="https://openresty.org/en/">OpenResty® - Official Site</a></li>
<li><a href="https://github.com/openresty/lua-nginx-module#installation">GitHub - openresty/lua-nginx-module: Embed the Power of Lua into NGINX HTTP servers</a></li>
</ul>
<h1><a class="header" href="#getting-started-4" id="getting-started-4">Getting Started</a></h1>
<ul>
<li><a href="https://openresty.org/en/getting-started.html">OpenResty - Getting Started</a></li>
</ul>
<p>Config PATH</p>
<pre><code># put them in ~/.bashrc or ~/.bash_profile
PATH=/usr/local/openresty/nginx/sbin:$PATH
export PATH
</code></pre>
<h1><a class="header" href="#test-1" id="test-1">Test</a></h1>
<pre><code>mkdir ~/work
cd ~/work
mkdir logs/ conf/
</code></pre>
<p>Create a simple plain text file named <code>conf/nginx.conf</code> with the following
contents in it:</p>
<pre><code>worker_processes  1;
error_log logs/error.log;
events {
    worker_connections 1024;
}
http {
    server {
        listen 8080;
        location / {
            default_type text/html;
            content_by_lua_block {
                ngx.say(&quot;&lt;p&gt;hello, world&lt;/p&gt;&quot;)
            }
        }
    }
}
</code></pre>
<p>Run:</p>
<pre><code>nginx -p `pwd`/ -c conf/nginx.conf
</code></pre>
<p>We can use curl to access our new web service that says HelloWorld:</p>
<p><code>curl http://localhost:8080/</code></p>
<p>If everything is okay, we should get the output</p>
<p><code>&lt;p&gt;hello, world&lt;/p&gt;</code></p>
<h1><a class="header" href="#console" id="console">console</a></h1>
<h1><a class="header" href="#a-hrefhttpscmusgithubioc-music-playera" id="a-hrefhttpscmusgithubioc-music-playera"><a href="https://cmus.github.io/">C* Music Player</a></a></h1>
<h1><a class="header" href="#links-239" id="links-239">Links</a></h1>
<ul>
<li><a href="https://github.com/cmus/cmus/wiki">Home · cmus/cmus Wiki · GitHub</a></li>
<li><a href="https://ok100.github.io/lyvi/">Lyvi</a></li>
<li><a href="https://github.com/cmus/cmus/blob/master/Doc/cmus-tutorial.txt">cmus/cmus-tutorial.txt at master · cmus/cmus</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Cmus">cmus - ArchWiki</a></li>
</ul>
<h1><a class="header" href="#install-35" id="install-35">Install</a></h1>
<pre><code class="language-sh">brew install cmus

--------------------------

pacman -S cmus alsa-lib 

~/.config/cmus/rc

set output_plugin=alsa
set dsp.alsa.device=default
set mixer.alsa.device=default
set mixer.alsa.channel=Master
</code></pre>
<h1><a class="header" href="#doc" id="doc">Doc</a></h1>
<pre><code class="language-sh">cmus		// launch

5		// file-browser
// under 5
a		// add files/folders

2		// library
// under 2
Enter		// play
c		// pause
&lt;-/-&gt;		// seek by 10s
&lt;/&gt;		// seek by 1m
z/b		// previous/next
y		// add to playlist

3		// Playlist

1		// Tree view
// under 1
&lt;space&gt;		// scroll to the artist
&lt;tab&gt;		// left/right column

7		// Settings

q		// quit

^R		// toggle repeat_current
D		// delete
</code></pre>
<h1><a class="header" href="#lyrics" id="lyrics">Lyrics</a></h1>
<h1><a class="header" href="#ffplay" id="ffplay">ffplay</a></h1>
<h1><a class="header" href="#links-240" id="links-240">Links</a></h1>
<ul>
<li><a href="https://ffmpeg.org/ffplay.html#While-playing">ffplay Documentation</a></li>
</ul>
<pre><code>q, ESC
    Quit.
f
    Toggle full screen.
p, SPC
    Pause.
m
    Toggle mute.
9, 0
    Decrease and increase volume respectively.
/, *
    Decrease and increase volume respectively.
a
    Cycle audio channel in the current program.
v
    Cycle video channel.
t
    Cycle subtitle channel in the current program.
c
    Cycle program.
w
    Cycle video filters or show modes.
s
    Step to the next frame. 
</code></pre>
<p>infile subtitle:</p>
<pre><code>infile=&lt;xxx.mp4&gt;; ffplay -vf subtitles=$infile:si=0 $infile
</code></pre>
<h1><a class="header" href="#a-hrefhttpsrg3githubioyoutube-dlyoutube-dla" id="a-hrefhttpsrg3githubioyoutube-dlyoutube-dla"><a href="https://rg3.github.io/youtube-dl/">youtube-dl</a></a></h1>
<h1><a class="header" href="#links-241" id="links-241">Links</a></h1>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/Youtube-dl">youtube-dl - ArchWiki</a></li>
</ul>
<h1><a class="header" href="#install-36" id="install-36">Install</a></h1>
<pre><code>brew install youtube-dl
</code></pre>
<p>cfgFile: <code>~/.config/youtube-dl/config</code></p>
<pre><code>--proxy socks5://127.0.0.1:1080

--ignore-errors
# --no-playlist
#

# Save in ~/Videos
-o ~/dl/youtube/%(title)s.%(ext)s
</code></pre>
<h1><a class="header" href="#usage-3" id="usage-3">Usage</a></h1>
<pre><code>youtube-dl [OPTIONS] URL

-f best 					// best resolution
-f bestvideo+bestaudio 		// best resolution
</code></pre>
<h1><a class="header" href="#downoad-subtitle" id="downoad-subtitle">Downoad Subtitle</a></h1>
<ul>
<li><a href="https://github.com/ytdl-org/youtube-dl#subtitle-options">subtitle-options</a></li>
</ul>
<pre><code>youtube-dl --write-auto-sub --skip-download
</code></pre>
<h1><a class="header" href="#a-hrefhttpswkhtmltopdforgwkhtmltopdfa" id="a-hrefhttpswkhtmltopdforgwkhtmltopdfa"><a href="https://wkhtmltopdf.org/">wkhtmltopdf</a></a></h1>
<h1><a class="header" href="#links-242" id="links-242">Links</a></h1>
<ul>
<li><a href="https://www.cyberciti.biz/open-source/html-to-pdf-freeware-linux-osx-windows-software/">Convert HTML Page To a PDF Using Open Source Tool [ Linux / OS X / Windows ] - nixCraft</a></li>
</ul>
<h1><a class="header" href="#install-37" id="install-37">Install</a></h1>
<pre><code>brew cask install wkhtmltopdf
</code></pre>
<h1><a class="header" href="#usage-4" id="usage-4">Usage</a></h1>
<pre><code>wkhtmltopdf &lt;url&gt; &lt;foo.pdf&gt;
</code></pre>
<h1><a class="header" href="#openssl" id="openssl">openssl</a></h1>
<h1><a class="header" href="#links-243" id="links-243">Links</a></h1>
<ul>
<li><a href="https://www.linode.com/docs/security/ssl/create-a-self-signed-tls-certificate/">Create a Self-Signed TLS Certificate</a></li>
<li><a href="https://gist.github.com/fntlnz/cf14feb5a46b2eda428e000157447309">Self Signed Certificate with Custom Root CA · GitHub</a></li>
</ul>
<h1><a class="header" href="#generate-self-signed-certificate-in-one-command" id="generate-self-signed-certificate-in-one-command">Generate Self-Signed Certificate in one command</a></h1>
<pre><code>openssl req -x509 -new -newkey rsa:4096 -keyout MyKey.key -sha256 -days 365 -nodes -out MyCertificate.crt 
chmod 400 /root/certs/MyKey.key
</code></pre>
<h1><a class="header" href="#generate-an-rsa-private-key-and-self-signed-certificate-in-two-command" id="generate-an-rsa-private-key-and-self-signed-certificate-in-two-command">Generate an RSA private key and Self-Signed Certificate in two command</a></h1>
<pre><code>openssl genrsa -aes256 -out foo.key 4096
openssl req -x509 -new -key foo.key -sha256 -days 1024 -nodes -out foo.crt

	req       PKCS#10 X.509 Certificate Signing Request (CSR) Management.
</code></pre>
<h1><a class="header" href="#generate-ca-signed-certificate" id="generate-ca-signed-certificate">Generate CA-Signed Certificate</a></h1>
<p>CSR is used to give it to a CA by you, then CA generate Certificate for you.</p>
<pre><code>// you create CSR
openssl req -new -sha256 -key mydomain.com.key -subj &quot;/C=US/ST=CA/O=MyOrg, Inc./CN=mydomain.com&quot; -out mydomain.com.csr
// verify the csr's content
openssl req -in mydomain.com.csr -noout -text

// CA do this
openssl x509 -req -in mydomain.com.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out mydomain.com.crt -days 500 -sha256
// verify the certificate's content
openssl x509 -in mydomain.com.crt -noout -text 

	x509      X.509 Certificate Data Management.
</code></pre>
<h1><a class="header" href="#pandoc" id="pandoc">pandoc</a></h1>
<h1><a class="header" href="#links-244" id="links-244">Links</a></h1>
<h1><a class="header" href="#install-38" id="install-38">Install</a></h1>
<pre><code>brew install pandoc
</code></pre>
<h1><a class="header" href="#usage-5" id="usage-5">Usage</a></h1>
<h1><a class="header" href="#tools-1" id="tools-1">Tools</a></h1>
<h1><a class="header" href="#tips-2" id="tips-2">Tips</a></h1>
<h1><a class="header" href="#google-dictionary" id="google-dictionary">Google Dictionary</a></h1>
<p>Bookmarks this in FireFox:</p>
<p>Location: <code>https://www.google.com/search?q=dictionary#dobs=%s</code><br />
keyword: <code>d</code></p>
<p>then input in the address bar: <code>d the word</code>, it will be substitute to:</p>
<p><code>&quot;https://www.google.com/search?q=dictionary#dobs=the word&quot;</code></p>
<h1><a class="header" href="#deprecated" id="deprecated">Deprecated</a></h1>
<ul>
<li>
<p><a href="tools/streama.html">Streama: Self hosted streaming media server</a></p>
<p>It needs Java 8, I don't like use something old. especially Java.</p>
</li>
</ul>
<h1><a class="header" href="#firefox" id="firefox">Firefox</a></h1>
<h1><a class="header" href="#links-245" id="links-245">Links</a></h1>
<h1><a class="header" href="#plugins-5" id="plugins-5">Plugins</a></h1>
<h1><a class="header" href="#elostonungoogled-chromium" id="elostonungoogled-chromium">Eloston/ungoogled-chromium</a></h1>
<h1><a class="header" href="#links-246" id="links-246">Links</a></h1>
<ul>
<li><a href="https://github.com/Eloston/ungoogled-chromium/blob/master/README.md">ungoogled-chromium/README.md at master · Eloston/ungoogled-chromium · GitHub</a></li>
</ul>
<h1><a class="header" href="#install-39" id="install-39">Install</a></h1>
<pre><code>brew cask install eloston-chromium
</code></pre>
<h1><a class="header" href="#four-column-ascii" id="four-column-ascii">Four Column ASCII</a></h1>
<h1><a class="header" href="#links-247" id="links-247">Links</a></h1>
<ul>
<li><a href="https://garbagecollected.org/2017/01/31/four-column-ascii/">Four Column ASCII</a></li>
</ul>
<p>In the terminal you can type these control characters by holding the CTRL
(control characters, get it?) key in combination with another key. For example,
as many experienced vim users know pressing CTRL+[ in the terminal (which is ^[
in caret notation) is the same as pressing the ESC key. <strong>But why is the escape
key triggered by the [ character? Why not another character?</strong> This is the
insight soneil shares with us.</p>
<p>Remember that ASCII is a 7 bit encoding. Let's say the following:</p>
<ul>
<li>The first two bits denote the group of the character (2^2 so 4 possible
values)</li>
<li>The remaining five bits describe a character (2^5 so 32 possible values)</li>
</ul>
<p>In the linked table, which I reproduce below, the four groups are represented by
the columns and the rows represent the values.</p>
<pre><code>00 	01 	10 	11 	
NUL 	Spc 	@ 	` 	00000
SOH 	! 	A 	a 	00001
STX 	&quot; 	B 	b 	00010
ETX 	# 	C 	c 	00011
EOT 	$ 	D 	d 	00100
ENQ 	% 	E 	e 	00101
ACK 	&amp; 	F 	f 	00110
BEL 	' 	G 	g 	00111
BS 	( 	H 	h 	01000
TAB 	) 	I 	i 	01001
LF 	* 	J 	j 	01010
VT 	+ 	K 	k 	01011
FF 	, 	L 	l 	01100
CR 	- 	M 	m 	01101
SO 	. 	N 	n 	01110
SI 	/ 	O 	o 	01111
DLE 	0 	P 	p 	10000
DC1 	1 	Q 	q 	10001
DC2 	2 	R 	r 	10010
DC3 	3 	S 	s 	10011
DC4 	4 	T 	t 	10100
NAK 	5 	U 	u 	10101
SYN 	6 	V 	v 	10110
ETB 	7 	W 	w 	10111
CAN 	8 	X 	x 	11000
EM 	9 	Y 	y 	11001
SUB 	: 	Z 	z 	11010
ESC 	; 	[ 	{ 	11011
FS 	&lt; 	\ 	| 	11100
GS 	= 	] 	} 	11101
RS 	&gt; 	^ 	~ 	11110
US 	? 	_ 	DEL 	11111
</code></pre>
<p>Now in this table, look for ESC. It's in the first group, fifth from the bottom.
It's in the first column so its group has bits '00', the row has bits '11011'.
Now look on the same line, what else is there? Yep, the '[' character is there,
be it in a different column:</p>
<ul>
<li>10 11011 means [</li>
<li>00 11011 means ESC</li>
</ul>
<p>So when we you type CTRL+[ for ESC, you're asking for the equivalent of the
character 11011 ([) out of the control set. Pressing CTRL simply sets all bits
but the last 5 to zero in the character that you typed. You can imagine it as a
bitwise AND.</p>
<pre><code>  10 11011 ([)
&amp; 00 11111 (CTRL)
= 00 11011 (ESC)
</code></pre>
<p>This is why ^J types a newline, ^H types a backspace and ^I types a tab. This is
why if you cat -A a Windows text file, it has ^M printed all over (meaning CR,
because newlines are CR+LF on Windows).</p>
<h1><a class="header" href="#markdown对照表" id="markdown对照表">Markdown对照表</a></h1>
<!-- ToC start -->
<h1><a class="header" href="#table-of-contents-2" id="table-of-contents-2">Table of Contents</a></h1>
<ol>
<li><a href="tools/markdown.html#links">Links</a></li>
<li><a href="tools/markdown.html#%E6%A0%87%E9%A2%98">标题</a></li>
<li><a href="tools/markdown.html#%E9%87%8D%E7%82%B9">重点</a></li>
<li><a href="tools/markdown.html#%E5%88%97%E8%A1%A8">列表</a></li>
<li><a href="tools/markdown.html#%E9%93%BE%E6%8E%A5">链接</a></li>
<li><a href="tools/markdown.html#%E5%9B%BE%E7%89%87">图片</a></li>
<li><a href="tools/markdown.html#%E4%BB%A3%E7%A0%81%E5%92%8C%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE">代码和语法高亮</a></li>
<li><a href="tools/markdown.html#%E8%A1%A8%E6%A0%BC">表格</a></li>
<li><a href="tools/markdown.html#%E5%9D%97%E5%BC%95%E7%94%A8">块引用</a></li>
<li><a href="tools/markdown.html#%E5%B5%8C%E5%85%A5html">嵌入HTML</a></li>
<li><a href="tools/markdown.html#%E6%B0%B4%E5%B9%B3%E7%BA%BF%E8%A7%84%E5%88%99">水平线规则</a></li>
<li><a href="tools/markdown.html#%E6%8D%A2%E8%A1%8C">换行</a></li>
<li><a href="tools/markdown.html#%E6%B2%B9%E7%AE%A1%E8%A7%86%E9%A2%91">油管视频</a></li>
</ol>
<!-- ToC end -->
<h1><a class="header" href="#links-248" id="links-248">Links</a></h1>
<ul>
<li><a href="https://meta.stackexchange.com/a/27111">为什么换行不是换行而要敲两下</a></li>
<li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Markdown对照表</a></li>
</ul>
<p>该文意为一份速查表和示例。更多完整信息，看<a href="http://daringfireball.net/projects/markdown/">John Gruber的原始规范</a>和<a href="http://github.github.com/github-flavored-markdown/">Github味儿的Markdown信息页</a>。</p>
<p>注意这还有一份<a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Here-Cheatsheet">针对Markdown Here的对照表</a>,如果你需要的话。你也可以看看<a href="https://github.com/adam-p/markdown-here/wiki/Other-Markdown-Tools">更多Markdown工具</a>。</p>
<h1><a class="header" href="#标题" id="标题">标题</a></h1>
<pre><code class="language-markdown"># 一级标题
## 二级标题
### 三级标题
#### 四级标题
##### 五级标题
###### 六级标题

另外，对于一级标题和二级标题,还有下划线风格： 

另一种一级标题
======

另一种二级标题
------
</code></pre>
<h1><a class="header" href="#一级标题" id="一级标题">一级标题</a></h1>
<h2><a class="header" href="#二级标题" id="二级标题">二级标题</a></h2>
<h3><a class="header" href="#三级标题" id="三级标题">三级标题</a></h3>
<h4><a class="header" href="#四级标题" id="四级标题">四级标题</a></h4>
<h5><a class="header" href="#五级标题" id="五级标题">五级标题</a></h5>
<h6><a class="header" href="#六级标题" id="六级标题">六级标题</a></h6>
<p>另外，对于一级标题和二级标题,还有下划线风格：</p>
<h1><a class="header" href="#另一种一级标题" id="另一种一级标题">另一种一级标题</a></h1>
<h2><a class="header" href="#另一种二级标题" id="另一种二级标题">另一种二级标题</a></h2>
<h1><a class="header" href="#重点" id="重点">重点</a></h1>
<pre><code class="language-markdown">重点,也就是斜体, 用*星号*或_下划线_。 
很重点,也就是粗体,用**双星号**或__双下划线__。 
重点里的重点，用**双星号和_单下划线_**一起。
删除线用两个波浪线。~~划这里~~.
</code></pre>
<p>重点,也就是斜体, 用<em>星号</em>或_下划线_。</p>
<p>很重点,也就是粗体,用<strong>双星号</strong>或__双下划线__。</p>
<p>重点里的重点，用**双星号和_单下划线_**一起。</p>
<p>删除线用两个波浪线。<del>划这里</del>.</p>
<h1><a class="header" href="#列表" id="列表">列表</a></h1>
<p>(这个例子里, 开头和结尾的空格用点表示：.)</p>
<pre><code class="language-markdown">1. 第一个带序号的项
2. 另一个项
⋅⋅* 不带序号的子列表
1. 实际上数字是几不重要，只要它是数字。
⋅⋅1. 带序号的子列表
4. 另一项

⋅⋅⋅你应该已经和列表项一起段落缩进了. 注意上面的空行和开头的空格 (至少一个, 但我们在这里也用了三个是为了对齐原始Markdown).

⋅⋅⋅为了只换行不分段, 你需要在行尾使用两个空格.⋅⋅
⋅⋅⋅注意这行是新行,但在同一个段落里.⋅⋅
⋅⋅⋅(这和典型的GFM换行行为相反,GFM不需要行尾空格.)..


* 无序号的列表可以用星号
- 或者减号
+ 或者加号
</code></pre>
<ol>
<li>第一个带序号的项</li>
<li>另一个项</li>
</ol>
<ul>
<li>不带序号的子列表</li>
</ul>
<ol>
<li>
<p>实际上数字是几不重要，只要它是数字。</p>
</li>
<li>
<p>带序号的子列表</p>
</li>
<li>
<p>另一项</p>
<p>你应该已经和列表项一起段落缩进了. 注意上面的空行和开头的空格 (至少一个, 但我们在这里也用了三个是为了对齐原始Markdown).</p>
<p>为了只换行不分段, 你需要在行尾使用两个空格.<br />
注意这行是新行,但在同一个段落里.<br />
(这和典型的GFM换行行为相反,GFM不需要行尾空格.)</p>
</li>
</ol>
<ul>
<li>无序号的列表可以用星号</li>
</ul>
<ul>
<li>或者减号</li>
</ul>
<ul>
<li>或者加号</li>
</ul>
<h1><a class="header" href="#链接" id="链接">链接</a></h1>
<p>有两种方式创建链接。</p>
<pre><code class="language-markdown">[我是一个内嵌链接](https://www.google.com)

[我是带标题的内嵌链接](https://www.google.com &quot;谷歌的主页&quot;)

[我是一个参考链接][任意的不区分大小写的参考文本]

[我是一个到库文件的相对引用](README.md)
[你可以用数字定义参考链接][1] 
或者留空使用[链接文本自身].

URLs 和尖括号中的URLs会自动转换成链接. 
http://www.example.com 或 &lt;http://www.example.com&gt; 和有时 
example.com (比如，github上就不会).

一些可以之后作为参考链接用的文本。

[任意的不区分大小写的参考文本]: https://www.mozilla.org
[1]: http://slashdot.org
[链接文本自身]: http://www.reddit.com
</code></pre>
<p><a href="https://www.google.com">我是一个内嵌链接</a></p>
<p><a href="https://www.google.com" title="谷歌的主页">我是带标题的内嵌链接</a></p>
<p><a href="https://www.mozilla.org">我是一个参考链接</a></p>
<p><a href="tools/README.html">我是一个到库文件的相对引用</a></p>
<p><a href="http://slashdot.org">你可以用数字定义参考链接</a></p>
<p>或者留空使用<a href="http://www.reddit.com">链接文本自身</a>.</p>
<p>URLs 和尖括号中的URLs会自动转换成链接. 
http://www.example.com 或 <a href="http://www.example.com">http://www.example.com</a> 和有时 
example.com (比如，github上就不会).</p>
<p>一些可以之后作为参考链接用的文本。</p>
<h1><a class="header" href="#图片" id="图片">图片</a></h1>
<pre><code class="language-markdown">这是我们的标志（悬停看标题文本）：

内嵌风格：
![alt text](images/icon48.png &quot;标志标题文本一&quot;)

引用风格：
![alt text][标志]

[标志]: images/icon48.png &quot;标志标题文本二&quot;
</code></pre>
<p>这是我们的标志（悬停看标题文本）：</p>
<p>内嵌风格：
<img src="tools/images/icon48.png" alt="alt text" title="标志标题文本一" /></p>
<p>引用风格：
<img src="tools/images/icon48.png" alt="alt text" title="标志标题文本二" /></p>
<h1><a class="header" href="#代码和语法高亮" id="代码和语法高亮">代码和语法高亮</a></h1>
<p>代码块是Markdown规范的一部分，但语法高亮不是。但是，许多渲染器--像Github的和Markdown Here -- 都支持语法高亮。支持哪些语言和那些语言的名字要怎么写渲染器和渲染器之间就会不同。Markdown Here支持数十种语言的语法高亮（还支持不是真正的语言，像diffs和HTTP头）;查看完整列表和怎么写语言名字，看<a href="http://softwaremaniacs.org/media/soft/highlight/test.html">highlight.js演示页面</a>。</p>
<pre><code class="language-markdown">行内 `代码` 用 `反斜杠包围` 它.
</code></pre>
<p>行内 <code>代码</code> 用 <code>反斜杠包围</code> 它.</p>
<p>代码块用三个反斜杠```的行隔开，或用4个空格缩进。我建议只用隔开的代码块--他们更简单和只有他们支持语法高亮。</p>
<pre>
```javascript
var s = "JavaScript 语法高亮";
alert(s);
```
 
```python
s = "Python 语法高亮"
print s
```
 
```
未指定语言, 所以没有语法高亮。  
但是我们扔一个&ltb&gt标记&lt/b&gt.
```
</pre>
<pre><code class="language-javascript">var s = &quot;JavaScript 语法高亮&quot;;
alert(s);
</code></pre>
<pre><code class="language-python">s = &quot;Python 语法高亮&quot;
print s
</code></pre>
<pre><code>未指定语言, 所以没有语法高亮。  
但是我们扔一个&lt;b&gt;标记&lt;/b&gt;.
</code></pre>
<h1><a class="header" href="#表格" id="表格">表格</a></h1>
<p>表格不是核心Markdown规范的一部分,但它们是GFM的一部分和Markdown Here 支持它们. 它们是一种給你的邮件添加表格的简单的方式.--否则完成这项任务就必须从其它应用程序复制粘贴了.</p>
<pre>
冒号可以用来对齐列.

| 表格        | 很           | 牛逼  |
| ------------|:------------:| -----:|
| 第三列是    | 右对齐       | $1600 |
| 第二列是    | 居中         |   $12 |
| 斑马条纹    | 是整洁的     |    $1 |

每个标题单元格必须至少有3个划线.
外围的管道(|)是可选的, 而且你不用一定让原始Markdown排列的整齐.
你也可以使用内嵌的Markdown.

Markdown | 不 | 整齐的
--- | --- | ---
*仍然* | `渲染的` | **很漂亮**
1 | 2 | 3
</pre>
<p>冒号可以用来对齐列.</p>
<table><thead><tr><th>表格</th><th align="center">很</th><th align="right">牛逼</th></tr></thead><tbody>
<tr><td>第三列是</td><td align="center">右对齐</td><td align="right">$1600</td></tr>
<tr><td>第二列是</td><td align="center">居中</td><td align="right">$12</td></tr>
<tr><td>斑马条纹</td><td align="center">是整洁的</td><td align="right">$1</td></tr>
</tbody></table>
<p>每个标题单元格必须至少有3个划线.
外围的管道(|)是可选的, 而且你不用一定让原始Markdown排列的整齐.
你也可以使用内嵌的Markdown.</p>
<table><thead><tr><th>Markdown</th><th>不</th><th>整齐的</th></tr></thead><tbody>
<tr><td><em>仍然</em></td><td><code>渲染的</code></td><td><strong>很漂亮</strong></td></tr>
<tr><td>1</td><td>2</td><td>3</td></tr>
</tbody></table>
<h1><a class="header" href="#块引用" id="块引用">块引用</a></h1>
<pre>
> 块引用非常方便在邮件中模拟回复文本.
> 这一行仍然是同一个引用的部分.

引用打断.

> 这是一行非常长的行就算超过屏幕了也能被正常引用.  噢男娃子我们接着写确保它足够长让每个人都真的可以超过屏幕. 噢, 你可以*放* **Markdown**在引用里. 
</pre>
<blockquote>
<p>块引用非常方便在邮件中模拟回复文本.<br />
这一行仍然是同一个引用的部分.</p>
</blockquote>
<p>引用打断.</p>
<blockquote>
<p>这是一行非常长的行就算超过屏幕了也能被正常引用.  噢男娃子我们接着写确保它足够长让每个人都真的可以超过屏幕. 噢, 你可以<em>放</em> <strong>Markdown</strong>在引用里. </p>
</blockquote>
<h1><a class="header" href="#嵌入html" id="嵌入html">嵌入HTML</a></h1>
<p>你也可以用纯HTML在你的Markdown里, 而且它大多数情况会工作的非常好.</p>
<pre>
&ltdl>
  &ltdt>定义列表&lt/dt>
  &ltdd>是人们有时用的一些东西&lt/dd>

  &ltdt>Markdown在HTML里&lt/dt>
  &ltdd>其 *未* 工作的 **很** 好. 用 HTML &ltem>标志&lt/em>.&lt/dd>
&lt/dl>
</pre>
<dl>
  <dt>定义列表</dt>
  <dd>是人们有时用的一些东西</dd>
<dt>Markdown在HTML里</dt>
  <dd>其 *未* 工作的 **很** 好. 用 HTML <em>标志</em>.</dd>
</dl>
<h1><a class="header" href="#水平线规则" id="水平线规则">水平线规则</a></h1>
<pre>
三个或更多...

---

连字符

***

星号

___

下划线

</pre>
<hr />
<p>连字符</p>
<hr />
<p>星号</p>
<hr />
<p>下划线</p>
<h1><a class="header" href="#换行" id="换行">换行</a></h1>
<p>对于换行是怎么工作的我的建议是试验和发现 -- 按 <Enter> 一次 (即, 插入一个换行符), 然后按两次(即, 插入两个换行符), 看发生了什么. 你会很快学到得到你想要的. &quot;Markdown Toggle&quot; 是你的朋友.</p>
<p>这里有一些事情要尝试:</p>
<pre>
我们用这行开始.

这行与上面那行用两个换行符隔开, 所以它会是 *单独的段落*.

这行也是一个单独的段落, 但...
这行只用一个换行符隔开, 所以它是单独的一行在 *同一个段落*.
</pre>
<p>我们用这行开始.</p>
<p>这行与上面那行用两个换行符隔开, 所以它会是 <em>单独的段落</em>.</p>
<p>这行也是一个单独的段落, 但...<br />
这行只用一个换行符隔开, 所以它是单独的一行在 <em>同一个段落</em>.</p>
<h1><a class="header" href="#油管视频" id="油管视频">油管视频</a></h1>
<p>他们不能被直接添加但你可以像这样添加一张带有到视频链接的图片:</p>
<pre>
&lta href="http://www.youtube.com/watch?feature=player_embedded&v=YOUTUBE_VIDEO_ID_HERE
" target="_blank">&ltimg src="http://img.youtube.com/vi/YOUTUBE_VIDEO_ID_HERE/0.jpg" 
alt="IMAGE ALT TEXT HERE" width="240" height="180" border="10" /></a>
</pre>
<p>或者, 在純Markdown里, 但失去图片尺寸和边框:</p>
<pre>
[![IMAGE ALT TEXT HERE](http://img.youtube.com/vi/YOUTUBE_VIDEO_ID_HERE/0.jpg)](http://www.youtube.com/watch?v=YOUTUBE_VIDEO_ID_HERE)
</pre> 
<p>在git commit中引用#bugID引起的错误将其链接到传票。 例如＃1。</p>
<p>许可証:<a href="http://creativecommons.org/licenses/by/3.0/">CC-BY</a></p>
<h1><a class="header" href="#mdbook" id="mdbook">mdbook</a></h1>
<h1><a class="header" href="#links-249" id="links-249">Links</a></h1>
<ul>
<li><a href="https://github.com/rust-lang-nursery/mdBook">rust-lang-nursery/mdBook: Create book from markdown files. Like Gitbook but implemented in Rust</a></li>
<li><a href="https://rust-lang-nursery.github.io/mdBook/">mdBook - mdBook Documentation</a></li>
<li><a href="https://github.com/rust-lang-nursery/mdBook/issues/431">Support in-repo links, with verification and output-dependent conversion · Issue #431 · rust-lang-nursery/mdBook · GitHub</a></li>
</ul>
<h1><a class="header" href="#为什么弃用gitbook" id="为什么弃用gitbook">为什么弃用gitbook</a></h1>
<p>脚本语言实现的东西 每个很小很小很小的功能或模块都是一个脚本文件.</p>
<p>所以稍微一点点复杂的功能 每次执行都意味着发生了巨量的硬盘读写</p>
<p>所以就是慢 </p>
<p>脚本语言就做做脚本语言适合做的简单的事情就好了</p>
<h1><a class="header" href="#install-40" id="install-40">Install</a></h1>
<p>This requires at least <a href="https://www.rust-lang.org/en-US/">Rust</a> 1.20 and Cargo
to be installed. Once you have installed Rust, type the following in the
terminal:</p>
<pre><code>cargo install mdbook
</code></pre>
<h1><a class="header" href="#basic-usage" id="basic-usage">Basic Usage</a></h1>
<pre><code>mdbook build
mdbook watch
mdbook serve
mdbook clean
</code></pre>
<h1><a class="header" href="#deploying-your-book-to-github-pages" id="deploying-your-book-to-github-pages">Deploying Your Book to GitHub Pages</a></h1>
<p><a href="https://rust-lang-nursery.github.io/mdBook/continuous-integration.html">Continuous Integration - mdBook Documentation</a></p>
<p>I have a question is whether dir <code>book</code> is needed to push to repo ?</p>
<p>不需要的，配置文件里的<code>script</code>里生成的就会被拿去使用</p>
<h1><a class="header" href="#在readmemd里面相对引用子目录里的md" id="在readmemd里面相对引用子目录里的md">在readme.md里面相对引用子目录里的md</a></h1>
<p>是可以的，不过不能引用<code>readmd.md</code>，因为<code>readmd.md</code>会被处理成<code>index.html</code>，这是
一个特殊情况</p>
<p><a href="https://rust-lang-nursery.github.io/mdBook/format/config.html">Configuration - mdBook Documentation</a></p>
<p>The following preprocessors are available and included by default:</p>
<ul>
<li>links: Expand the {{# playpen}} and {{# include}} handlebars helpers in
a chapter.</li>
<li>index: Convert all chapter files named README.md into index.md. That is
to say, all README.md would be rendered to an index file index.html in the
rendered book.</li>
</ul>
<h1><a class="header" href="#zhengma" id="zhengma">Zhengma</a></h1>
<h1><a class="header" href="#links-250" id="links-250">Links</a></h1>
<ul>
<li><a href="https://openvanilla.org/">OpenVanilla 輸入法套件</a></li>
</ul>
<h1><a class="header" href="#virtualbox-1" id="virtualbox-1">VirtualBox</a></h1>
<h1><a class="header" href="#links-251" id="links-251">Links</a></h1>
<ul>
<li><a href="https://www.virtualbox.org/manual/ch06.html#networkingmodes">Chapter 6. Virtual Networking</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsgithubcomgithuba" id="a-hrefhttpsgithubcomgithuba"><a href="https://github.com/">GitHub</a></a></h1>
<h1><a class="header" href="#links-252" id="links-252">Links</a></h1>
<ul>
<li><a href="https://github.com/search?q=stars%3A%3E10000&amp;type=Repositories">Search · stars:&gt;10000 · GitHub</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpsappsankiwebnetindexhtmlanki---powerful-intelligent-flashcardsa" id="a-hrefhttpsappsankiwebnetindexhtmlanki---powerful-intelligent-flashcardsa"><a href="https://apps.ankiweb.net/index.html">Anki - powerful, intelligent flashcards</a></a></h1>
<h1><a class="header" href="#links-253" id="links-253">Links</a></h1>
<ul>
<li><a href="https://apps.ankiweb.net/docs/manual.html">Anki Manual</a></li>
<li><a href="https://ankiweb.net/shared/decks/">Shared Decks - AnkiWeb</a></li>
</ul>
<p>There are two simple concepts behind Anki: active recall testing and spaced
repetition. </p>
<p><strong>Active Recall Testing</strong></p>
<p><strong>Active recall testing</strong> means being asked a question and trying to remember the
answer. This is in contrast to <strong>passive study</strong>, where we read, watch or listen to
something without pausing to consider if we know the answer. Research has shown
that active recall testing is far more effective at building strong memories
than passive study. </p>
<p>The brain’s <strong>“use it or lose it”</strong> policy applies to everything we learn. If you
spend an afternoon memorizing some science terms, and then don’t think about
that material for two weeks, you’ll probably have forgotten most of it. In
fact, studies show we forget about 75% of material learnt within a 48 hour
period. This can seem pretty depressing when you need to learn a lot of
information.</p>
<p>The solution is simple, however: <strong>review</strong>. By reviewing newly-learnt information,
we can greatly reduce forgetting.</p>
<p><strong>Spaced Repetition</strong></p>
<p>The spacing effect was reported by a German psychologist in 1885. He observed
that we tend to remember things more effectively if we spread reviews out over
time, instead of studying multiple times in one session. Since the 1930s there
have been a number of proposals for utilizing the spacing effect to improve
learning, in what has come to be called spaced repetition.</p>
<p><strong>Notes &amp; Fields</strong></p>
<p>When making flashcards, it’s often desirable to make more than one card that
relates to some information. For example, if you’re learning French, and you
learn that the word “bonjour” means “hello”, you may wish to create one card
that shows you “bonjour” and asks you to remember “hello”, and another card
that shows you “hello” and asks you to remember “bonjour”. One card is testing
your ability to recognize the foreign word, and the other card is testing your
ability to produce it.</p>
<p><strong>Note Types</strong></p>
<p>Basic (and reversed card)</p>
<pre><code>Like Basic, but creates two cards for the text you enter: one from front→
back and one from back→front.
</code></pre>
<h1><a class="header" href="#studying" id="studying">Studying</a></h1>
<p>On the decks screen, your decks will be displayed in a list. There are two
number columns, due and new. Due is the count of waiting reviews and cards
currently in learning. New is the number of new cards that are ready to be
learnt that day.</p>
<p><strong>Shortcuts</strong></p>
<pre><code>/	    Study Decks
s	    Study the currently selected decks, Study Overview
&lt;Space&gt;	    Show answer
</code></pre>
<h1><a class="header" href="#krita" id="krita">krita</a></h1>
<h1><a class="header" href="#links-254" id="links-254">Links</a></h1>
<ul>
<li><a href="https://krita.org/en/">Krita | Digital Painting. Creative Freedom.</a></li>
</ul>
<p>一个像PhotoShop GIMP 那样的画图工具，右键很舒服。</p>
<h1><a class="header" href="#a-hrefhttpswwwgimporggimp---gnu-image-manipulation-programa" id="a-hrefhttpswwwgimporggimp---gnu-image-manipulation-programa"><a href="https://www.gimp.org/">GIMP - GNU Image Manipulation Program</a></a></h1>
<h1><a class="header" href="#links-255" id="links-255">Links</a></h1>
<ul>
<li></li>
</ul>
<h1><a class="header" href="#install-41" id="install-41">Install</a></h1>
<pre><code>brew tap caskroom/cask &amp;&amp; brew cask install gimp
</code></pre>
<h1><a class="header" href="#cut-out-an-image" id="cut-out-an-image">Cut out an image</a></h1>
<ul>
<li>
<p>Advanced</p>
</li>
<li>
<p><a href="https://www.saxoprint.co.uk/blog/gimp-cut-out">Tutorial: GIMP cut out - remove background from hair » SAXOPRINT Blog UK</a></p>
</li>
<li>
<p>Simple</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=FjxELpQ3Cxo">Gimp/Photoshop-Cut out an image with free select tool/lasso tool (of furry cute kitten) - YouTube</a></p>
</li>
</ul>
<pre><code>add channel -&gt; free select -&gt; feather( 60 ) -&gt; invert -&gt; delete -&gt; add a layer(background)
</code></pre>
<h1><a class="header" href="#sxiv" id="sxiv">sxiv</a></h1>
<ul>
<li><a href="https://github.com/muennich/sxiv">muennich/sxiv: Simple X Image Viewer</a></li>
<li><a href="https://muennich.github.io/sxiv/sxiv.1.html">SXIV man page</a></li>
</ul>
<h1><a class="header" href="#a-hrefhttpskoditvkodi--open-source-home-theater-softwarea" id="a-hrefhttpskoditvkodi--open-source-home-theater-softwarea"><a href="https://kodi.tv/">Kodi | Open Source Home Theater Software</a></a></h1>
<h1><a class="header" href="#links-256" id="links-256">Links</a></h1>
<ul>
<li><a href="https://kodi.wiki/view/Keyboard_controls">Keyboard controls - Official Kodi Wiki</a></li>
<li><a href="https://kodi.tv/addons/browse?keyword=&amp;category=All&amp;author=&amp;sort=field_download_count_value+DESC">Browse all Add-Ons | Kodi | Open Source Home Theater Software</a></li>
</ul>
<h1><a class="header" href="#keyboard-controls" id="keyboard-controls">Keyboard controls</a></h1>
<pre><code>l			Next subtitle 
x			Stop
</code></pre>
<h1><a class="header" href="#add-ons" id="add-ons">Add-Ons</a></h1>
<h1><a class="header" href="#a-hrefhttpsmpviompvioa" id="a-hrefhttpsmpviompvioa"><a href="https://mpv.io/">mpv.io</a></a></h1>
<h1><a class="header" href="#links-257" id="links-257">Links</a></h1>
<ul>
<li><a href="https://linuxacademy.com/blog/linux/tutorial-playing-around-with-mplayer/">Tutorial: Playing around with MPlayer - Linux Academy Blog</a></li>
</ul>
<h1><a class="header" href="#install-42" id="install-42">Install</a></h1>
<pre><code>brew cask install mpv
</code></pre>
<h1><a class="header" href="#subtitle" id="subtitle">Subtitle</a></h1>
<pre><code>       --sub-auto=&lt;no|exact|fuzzy|all&gt;, --no-sub-auto
              Load additional subtitle files matching the video filename. The parameter specifies how external subtitle files are matched. exact is enabled by default.

              no     Don't automatically load external subtitle files.

              exact  Load the media filename with subtitle file extension (default).

              fuzzy  Load all subs containing media filename.

              all    Load all subs in the current and --sub-file-paths directories.

       --sub-file-paths=&lt;path-list&gt;
              Specify extra directories to search for subtitles matching the video.  Multiple directories can be separated by &quot;:&quot; (&quot;;&quot; on Windows).  Paths can be rela-
              tive or absolute. Relative paths are interpreted relative to video file directory.  If the file is a URL, only absolute paths and sub configuration  sub-
              directory will be scanned.

                 Example

                        Assuming  that  /path/to/video/video.avi  is  played  and --sub-file-paths=sub:subtitles is specified, mpv searches for subtitle files in these
                        directories:

                 o /path/to/video/

                 o /path/to/video/sub/

                 o /path/to/video/subtitles/

                 o the sub configuration subdirectory (usually ~/.config/mpv/sub/)

              This is a list option. See List Options for details.
</code></pre>
<p>cfgFile: <code>~/.config/mpv/mpv.conf</code></p>
<pre><code>sub-auto=all
sub-file-paths=sub:subtitles
</code></pre>
<h1><a class="header" href="#a-hrefhttpsdocsphotoprismorgenlatestphotoprisma" id="a-hrefhttpsdocsphotoprismorgenlatestphotoprisma"><a href="https://docs.photoprism.org/en/latest/">PhotoPrism</a></a></h1>
<h1><a class="header" href="#links-258" id="links-258">Links</a></h1>
<ul>
<li><a href="https://github.com/photoprism/photoprism">GitHub - photoprism/photoprism: Personal Photo Management powered by Go and Google TensorFlow</a></li>
</ul>
<h1><a class="header" href="#install-43" id="install-43">Install</a></h1>
<p>Open a terminal and run this command after replacing <code>~/Pictures</code> with the
folder containing your photos:</p>
<pre><code>docker run -p 2342:80 -d --name photoprism \
  -v ~/Pictures:/srv/photoprism/photos/originals photoprism/photoprism
</code></pre>
<p>Now open <code>http://localhost:2342/</code> in a Web browser to see the user interface.</p>
<p>Index photos</p>
<p><code>docker exec -ti photoprism photoprism index</code></p>
<h1><a class="header" href="#demo-1" id="demo-1">Demo</a></h1>
<pre><code>docker run -p 2342:80 -d --name demo photoprism/demo
docker rm -f demo
</code></pre>
<h1><a class="header" href="#updating" id="updating">Updating</a></h1>
<pre><code>docker pull photoprism/photoprism:latest
</code></pre>
<h1><a class="header" href="#a-hrefhttpstransmissionbtcomtransmissiona" id="a-hrefhttpstransmissionbtcomtransmissiona"><a href="https://transmissionbt.com/">Transmission</a></a></h1>
<h1><a class="header" href="#links-259" id="links-259">Links</a></h1>
<ul>
<li><a href="https://github.com/ngosang/trackerslist">GitHub - ngosang/trackerslist: An updated list of public BitTorrent trackers</a></li>
<li><a href="https://github.com/blind-oracle/transmission-trackers">GitHub - blind-oracle/transmission-trackers: Script to automatically add trackers from a list to all torrents in Transmission</a></li>
</ul>
<h1><a class="header" href="#transmission-trackers" id="transmission-trackers">transmission-trackers</a></h1>
<pre><code>pip3 install transmissionrpc
// put it into cron
python3 transmission-trackers.py 
</code></pre>
<h1><a class="header" href="#a-hrefhttpswwwaudacityteamorgaudacity-audio-editor-and-recordera" id="a-hrefhttpswwwaudacityteamorgaudacity-audio-editor-and-recordera"><a href="https://www.audacityteam.org">Audacity: audio editor and recorder</a></a></h1>
<h1><a class="header" href="#links-260" id="links-260">Links</a></h1>
<ul>
<li><a href="https://manual.audacityteam.org/">Audacity Manual</a></li>
<li><a href="https://manual.audacityteam.org/man/keyboard_shortcut_reference.html">Commands and Keyboard Shortcut Reference - Audacity Manual</a></li>
</ul>
<h1><a class="header" href="#mac" id="mac">Mac</a></h1>
<h1><a class="header" href="#index" id="index">Index</a></h1>
<ul>
<li><a href="macOS/newtomac.html">New to MAC</a></li>
<li><a href="macOS/homebrew.html">homebrew</a></li>
<li><a href="macOS/macports.html">MacPorts</a></li>
<li><a href="macOS/developers.html">More Downloads for Apple Developers</a></li>
<li><a href="macOS/Remapping_Caps_Lock_key_to_something_more_natural_on_Mac_OS_X.html">Remapping Caps Lock key to something more natural on Mac OS X</a></li>
</ul>
<h1><a class="header" href="#must-2" id="must-2">Must</a></h1>
<h2><a class="header" href="#stupid-replace-my-dir-but-not-merge" id="stupid-replace-my-dir-but-not-merge">Stupid REPLACE my dir but not MERGE</a></h2>
<p><strong>SB</strong><br />
Sun Jul 07 21:35:57 CST 2019</p>
<h2><a class="header" href="#disable-facetime" id="disable-facetime">Disable FaceTime</a></h2>
<ol>
<li>Open FaceTime</li>
<li>Click on the FaceTime menu in the top menu bar</li>
<li>Select the third option, Turn FaceTime Off</li>
</ol>
<h1><a class="header" href="#capture-a-screen-shot" id="capture-a-screen-shot">Capture a Screen Shot</a></h1>
<p><a href="https://www.itg.ias.edu/content/keyboard-shortcuts-capture-screen-shot-mac-os-x">Keyboard Shortcuts to Capture a Screen Shot with Mac OS X Mavericks and Yosemite | Information Technology Group</a></p>
<ul>
<li>To capture the entire screen, press <code>Command-Shift-3</code>.</li>
<li>To copy the entire screen, press <code>Command-Control-Shift-3</code>. </li>
<li>To capture a portion of the screen, press <code>Command-Shift-4</code>.</li>
<li>To copy a portion of the screen to the clipboard, press <code>Command-Control-Shift-4</code>.</li>
</ul>
<h1><a class="header" href="#how-to-write-to-ntfs-drives-on-a-mac" id="how-to-write-to-ntfs-drives-on-a-mac">How to Write to NTFS Drives on a Mac</a></h1>
<ul>
<li>install ntfs-3g</li>
</ul>
<p><code>brew install ntfs-3g</code></p>
<ul>
<li>mount</li>
</ul>
<pre><code>sudo mkdir /Volumes/ntfs1
diskutil list
</code></pre>
<p>The NTFS partition was probably automatically mounted by your Mac, so you’ll
need to unmount it first. Run the following command, replacing /dev/disk2s1
with the device name of your NTFS partition.</p>
<p><code>sudo umount /dev/disk2s1</code></p>
<ul>
<li>mount</li>
</ul>
<p><code>/usr/local/bin/ntfs-3g /dev/disk2s1 /Volumes/ntfs1 -olocal -oallow_other</code></p>
<h2><a class="header" href="#paragon" id="paragon">Paragon</a></h2>
<p><a href="https://www.paragon-software.com/home/ntfs-mac/">Microsoft NTFS for Mac | Paragon Software</a></p>
<ul>
<li>Reset trial</li>
</ul>
<p><a href="https://gist.github.com/guycalledseven/7b3fbeb521f74c682799932d64856f03">Manually remove Paragon NTFS v15 leftovers MacOS</a></p>
<pre><code>sudo su
rm -rf &quot;/Library/Application Support/Paragon Software/&quot;
rm /Library/LaunchDaemons/com.paragon-software.installer.plist
rm /Library/LaunchDaemons/com.paragon-software.ntfs.loader.plist
rm /Library/LaunchDaemons/com.paragon-software.ntfsd.plist
rm /Library/LaunchAgents/com.paragon-software.ntfs.notification-agent.plist
rm -rf /Library/PrivilegedHelperTools/com.paragon-software.installer
rm -rf /Library/PreferencePanes/ParagonNTFS.prefPane
</code></pre>
<h1><a class="header" href="#finder-is-not-responding" id="finder-is-not-responding">Finder is not responding</a></h1>
<pre><code>pgrep -fl Finder
kill &lt;pid&gt;
</code></pre>
<h1><a class="header" href="#if-the-sound-is-weird" id="if-the-sound-is-weird">If the sound is weird</a></h1>
<pre><code>sudo killall coreaudiod
</code></pre>
<h1><a class="header" href="#config-gateway" id="config-gateway">Config Gateway</a></h1>
<p><a href="https://apple.stackexchange.com/questions/33097/how-to-change-the-default-gateway-of-a-mac-osx-machine">macos - How to change the default gateway of a Mac OSX machine - Ask Different</a></p>
<pre><code>route delete default
route add default 192.168.0.1&lt;Paste&gt;
// or
$ route change default -interface $INTF
$ route change 192.168.0.0/16 -interface $INTF
</code></pre>
<h1><a class="header" href="#chattr-use-chflags" id="chattr-use-chflags">chattr use chflags</a></h1>
<pre><code>sudo chflags uimmutable /etc/resolv.conf
ls -lO /etc/resolv.conf
</code></pre>
<h1><a class="header" href="#shortcuts" id="shortcuts">Shortcuts</a></h1>
<h1><a class="header" href="#links-261" id="links-261">Links</a></h1>
<ul>
<li>
<p>cycle windows in app</p>
<p>To cycle windows in Safari, use command+backquote (above tab) (⌘<code>). To cycle backwards, use shift as a modifier (⇧⌘</code>).</p>
</li>
</ul>
<h1><a class="header" href="#diskutil" id="diskutil">diskutil</a></h1>
<h1><a class="header" href="#links-262" id="links-262">Links</a></h1>
<h1><a class="header" href="#basics-3" id="basics-3">Basics</a></h1>
<pre><code>diskutil list
diskutil listfilesystems

diskutil partitionDisk disk2 GPT jhfs+ Foo 100%
</code></pre>
<h1><a class="header" href="#delete-partition" id="delete-partition">Delete partition</a></h1>
<p>Since diskutil has no ablity to delete partition, Here is a hack:</p>
<pre><code>sudo dd if=/dev/zero of=/dev/disk2 bs=512 count=1
</code></pre>
<h1><a class="header" href="#a-hrefhttpsbrewshhomebrewa" id="a-hrefhttpsbrewshhomebrewa"><a href="https://brew.sh/">Homebrew</a></a></h1>
<h1><a class="header" href="#links-263" id="links-263">Links</a></h1>
<ul>
<li><a href="https://brew.sh/">The missing package manager for macOS — The missing package manager for macOS</a></li>
</ul>
<h1><a class="header" href="#install-44" id="install-44">Install</a></h1>
<p><code>/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></p>
<h1><a class="header" href="#install-package" id="install-package">Install Package</a></h1>
<pre><code>// export http_proxy

brew install XXX
</code></pre>
<h1><a class="header" href="#brew-analytics" id="brew-analytics">brew analytics</a></h1>
<ul>
<li><a href="https://docs.brew.sh/Analytics">Anonymous Aggregate User Behaviour Analytics — Homebrew Documentation</a></li>
</ul>
<p><strong>NOTE!</strong> Please be aware that it was announced recently that Homebrew is using
analytics. To turn this off in homebrew then run: brew analytics off You can
read more about this on Brew Analytics. </p>
<h1><a class="header" href="#a-hrefhttpswwwraspberrypiorgraspberry-pia" id="a-hrefhttpswwwraspberrypiorgraspberry-pia"><a href="https://www.raspberrypi.org/">Raspberry Pi</a></a></h1>
<h1><a class="header" href="#links-264" id="links-264">Links</a></h1>
<h1><a class="header" href="#change-source-mirror" id="change-source-mirror">change source mirror</a></h1>
<p><a href="https://www.raspbian.org/RaspbianMirrors">RaspbianMirrors - Raspbian</a></p>
<p>cfgFile: </p>
<pre><code>/etc/apt/sources.list.d/raspi.list
</code></pre>
<h1><a class="header" href="#updating-the-kernel" id="updating-the-kernel">Updating the kernel</a></h1>
<p><a href="https://www.raspberrypi.org/documentation/linux/kernel/updating.md">Updating the kernel - Raspberry Pi Documentation</a></p>
<p>simple this command:</p>
<pre><code>rpi-update
</code></pre>
<h1><a class="header" href="#kernel-headers" id="kernel-headers">kernel headers</a></h1>
<p><a href="https://github.com/notro/rpi-source/wiki">Home · notro/rpi-source Wiki · GitHub</a></p>
<p>simple this command:</p>
<pre><code>rpi-source
</code></pre>
<h1><a class="header" href="#kernel-building" id="kernel-building">kernel building</a></h1>
<p><a href="https://www.raspberrypi.org/documentation/linux/kernel/building.md">Kernel building - Raspberry Pi Documentation</a></p>
<h1><a class="header" href="#install-45" id="install-45">Install</a></h1>
<h1><a class="header" href="#links-265" id="links-265">Links</a></h1>
<ul>
<li><a href="https://www.raspberrypi.org/documentation/">Raspberry Pi Documentation</a></li>
<li><a href="https://www.raspberrypi.org/documentation/remote-access/">Remote Access - Raspberry Pi Documentation</a></li>
<li><a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md">Setting WiFi up via the command line - Raspberry Pi Documentation</a></li>
</ul>
<pre><code>// Mac
diskutil list

    /dev/disk2 (external, physical):

diskutil unmountDisk /dev/disk2s1

sudo dd bs=1m if=image.img of=/dev/rdisk&lt;disk# from diskutil&gt; conv=sync
or
sudo dd bs=1m if=image.img of=/dev/disk2 conv=sync // I choose this 

sudo diskutil eject /dev/rdisk&lt;disk# from diskutil&gt;
</code></pre>
<p>Enable SSH on a headless Raspberry Pi (add file to SD card on another machine)</p>
<p>For headless setup, SSH can be enabled by placing a file named ssh, without any extension, onto the boot partition of the SD card from another computer. When the Pi boots, it looks for the ssh file. If it is found, SSH is enabled and the file is deleted. The content of the file does not matter; it could contain text, or nothing at all.</p>
<p><code>cd /Volumes/boot &amp;&amp; echo ssh &gt; ssh</code></p>
<pre><code>unzip -p 2017-11-29-raspbian-stretch.zip | sudo dd of=/dev/sdX bs=4M conv=fsync
sync
/*  
       -p     extract  files  to pipe (stdout).  Nothing but the file data is sent to stdout, and the files are always extracted in binary format, just as they are stored (no
              conversions).
*/
</code></pre>
<h1><a class="header" href="#ip" id="ip">Ip</a></h1>
<pre><code>brew install nmap

nmap -sn 192.168.1.0/24	    // ping scan
</code></pre>
<h1><a class="header" href="#default-user" id="default-user">Default user</a></h1>
<p><code>pi/raspberry</code></p>
<p>Add user</p>
<pre><code>useradd -ms /bin/bash &lt;user&gt;
passwd &lt;user&gt;
</code></pre>
<h1><a class="header" href="#access-from-internet" id="access-from-internet">Access from Internet</a></h1>
<pre><code>curl -s 'https://pgp.mit.edu/pks/lookup?op=get&amp;search=0x1657198823E52A61' | gpg --import &amp;&amp; \
if z=$(curl -s 'https://install.zerotier.com/' | gpg); then echo &quot;$z&quot; | sudo bash; fi

sudo systemctl enable zerotier-one

sudo zerotier-cli status

sudo zerotier-cli join [Network ID]

Authenticate your device by going to https://my.zerotier.com/network/[Network ID]
</code></pre>
<h1><a class="header" href="#as-vpn-server" id="as-vpn-server">AS VPN Server</a></h1>
<pre><code>sudo vim /etc/sysctl.conf
net.ipv4.ip_forward = 1

sudo sysctl -p /etc/sysctl.conf
</code></pre>
<h1><a class="header" href="#update" id="update">update</a></h1>
<pre><code>apt update ; apt upgrade
apt install git vim curl neovim tmux
</code></pre>
<h1><a class="header" href="#wifi-1" id="wifi-1">WIFI</a></h1>
<p><a href="https://www.raspberrypi.org/documentation/configuration/wireless/wireless-cli.md">Setting WiFi up via the command line - Raspberry Pi Documentation</a></p>
<p>You will need to define a <code>wpa_supplicant.conf</code> file for your particular wireless
network. Put this file in the boot folder, and when the Pi first boots, it will
copy that file into the correct location in the Linux root file system and use
those settings to start up wireless networking.</p>
<pre><code>echo &quot;country=GB&quot; &gt;&gt; /etc/wpa_supplicant/wpa_supplicant.conf

iwlist wlan0 scan | grep SSID
wpa_passphrase &quot;&lt;SSID&gt;&quot; | sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf

wpa_cli -i wlan0 reconfigure
</code></pre>
<p><strong>priority</strong></p>
<pre><code>network={
    ssid=&quot;HomeOneSSID&quot;
    psk=&quot;passwordOne&quot;
    priority=1
    id_str=&quot;homeOne&quot;
}

network={
    ssid=&quot;HomeTwoSSID&quot;
    psk=&quot;passwordTwo&quot;
    priority=2
    id_str=&quot;homeTwo&quot;
    }
</code></pre>
<h1><a class="header" href="#android-1" id="android-1">Android</a></h1>
<h1><a class="header" href="#install-android-sdk" id="install-android-sdk">Install android sdk</a></h1>
<pre><code>brew cask install android-sdk
</code></pre>
<h1><a class="header" href="#project-treble" id="project-treble">Project Treble</a></h1>
<p>只是一个让手机更方便更新的项目。</p>
<h1><a class="header" href="#arm64a-arm64ab-是什么意思" id="arm64a-arm64ab-是什么意思">arm64a arm64ab 是什么意思</a></h1>
<p><a href="https://forum.xda-developers.com/showpost.php?p=77495536&amp;postcount=2">#2</a></p>
<pre><code>we should install only arm64 a only system. img 
arm64 a&amp;b are for google phones they have two partitions if u install a&amp;b system. img your device will brick. 
also arm32 system. img are for 32bit phones not for honor 6x.
</code></pre>
<p><a href="https://forum.xda-developers.com/showpost.php?p=77139285&amp;postcount=12">#12</a></p>
<pre><code>Install [Treble Check](https://play.google.com/store/apps/details?id=com.kevintresuelo.treble&amp;hl=en) from Google Play and see what you have.
</code></pre>
<p>Oneplus3 is not support Project Treble</p>
<h1><a class="header" href="#adb" id="adb">adb</a></h1>
<p>android debug bridge</p>
<h1><a class="header" href="#links-266" id="links-266">Links</a></h1>
<ul>
<li><a href="http://zmywly8866.github.io/2015/01/24/all-adb-command.html">Android ADB命令大全(通过ADB命令查看wifi密码、MAC地址、设备信息、操作文件、查看文件、日志信息、卸载、启动和安装APK等) | 张明云的博客</a></li>
</ul>
<h1><a class="header" href="#install-46" id="install-46">INSTALL</a></h1>
<pre><code class="language-sh">brew cask install android-platform-tools
</code></pre>
<p>Run <code>adb root &amp;&amp; adb shell</code> to get root permision</p>
<h1><a class="header" href="#set-proxy" id="set-proxy">set proxy</a></h1>
<ul>
<li><a href="https://android.stackexchange.com/questions/98287/how-to-set-wifi-proxy-via-adb-shell">wi fi - How to set WIFI proxy via adb shell? - Android Enthusiasts Stack Exchange</a></li>
<li><a href="https://stackoverflow.com/questions/31807559/undo-setting-proxy-via-settings-global-in-android">Undo setting proxy via Settings.Global in Android - Stack Overflow</a></li>
</ul>
<pre><code>adb shell settings put global http_proxy &lt;address&gt;:&lt;port&gt;

adb shell settings delete global http_proxy
adb shell settings delete global global_http_proxy_host
adb shell settings delete global global_http_proxy_port
</code></pre>
<h1><a class="header" href="#adb-sync" id="adb-sync">adb-sync</a></h1>
<p><a href="https://github.com/google/adb-sync">GitHub - google/adb-sync</a></p>
<p>works a little like <code>rsync</code></p>
<pre><code>adb-sync --help

adb-sync ~/Music /sdcard
adb-sync --delete ~/Music /sdcard

adb-sync --reverse /sdcard/Download/ ~/Downloads
</code></pre>
<h1><a class="header" href="#adb-over-net" id="adb-over-net">adb over net</a></h1>
<p><a href="https://stackoverflow.com/questions/2604727/how-can-i-connect-to-android-with-adb-over-tcp/3623727#3623727">networking - How can I connect to Android with ADB over TCP? - Stack Overflow</a></p>
<pre><code>adb connect 192.168.0.101:5555
adb root
adb shell
// To tell the ADB daemon return to listening over USB
adb usb
</code></pre>
<h1><a class="header" href="#command" id="command">Command</a></h1>
<pre>
获取序列号：
adb get-serialno

查看连接计算机的设备：
adb devices

重启机器：
adb reboot

重启到bootloader，即刷机模式：
adb reboot bootloader

重启到recovery，即恢复模式：
 adb reboot recovery

查看log：
adb logcat

终止adb服务进程：
adb kill-server

重启adb服务进程：
adb start-server

获取机器MAC地址：
adb shell  cat /sys/class/net/wlan0/address

获取CPU序列号：
adb shell cat /proc/cpuinfo

安装APK：
adb install <apkfile> //比如：adb install ss.apk

保留数据和缓存文件，重新安装apk：
adb install -r <apkfile> //比如：adb install -r ss.apk

安装apk到sd卡：
adb install -s <apkfile> // 比如：adb install -s ss.apk

卸载APK：
adb uninstall <package> //比如：adb uninstall com.ss.search

卸载app但保留数据和缓存文件：
adb uninstall -k <package> //比如：adb uninstall -k com.ss.search

启动应用：
adb shell am start -n <package_name>/.<activity_class_name>

查看设备cpu和内存占用情况：
adb shell top

查看占用内存前6的app：
adb shell top -m 6

刷新一次内存信息，然后返回：
adb shell top -n 1

查询各进程内存使用情况：
adb shell procrank

杀死一个进程：
adb shell kill [pid]

查看进程列表：
adb shell ps

查看指定进程状态：
adb shell ps -x [PID]

查看后台services信息：
adb shell service list

查看当前内存占用：
adb shell cat /proc/meminfo

查看IO内存分区：
adb shell cat /proc/iomem

将system分区重新挂载为可读写分区：
adb remount

从本地复制文件到设备  
adb push <local> <remote>

从设备复制文件到本地：
adb pull <remote>  <local>

列出目录下的文件和文件夹，等同于dos中的dir命令：
adb shell ls

进入文件夹，等同于dos中的cd 命令：
adb shell cd <folder>

重命名文件：
adb shell rename path/oldfilename path/newfilename

删除system/avi.apk：
adb shell rm /system/avi.apk

删除文件夹及其下面所有文件：
adb shell rm -r <folder>

移动文件：
adb shell mv path/file newpath/file

设置文件权限：
adb shell chmod 777 /system/fonts/DroidSansFallback.ttf

新建文件夹：
adb shell mkdir path/foldelname

查看文件内容：
adb shell cat <file>

查看wifi密码：
adb shell cat /data/misc/wifi/*.conf

清除log缓存：
adb logcat -c

查看bug报告：
adb bugreport

获取设备名称：
adb shell cat /system/build.prop

查看ADB帮助：
adb help

跑monkey：
adb shell monkey -v -p your.package.name 500
</pre>
<h1><a class="header" href="#rom" id="rom">ROM</a></h1>
<h1><a class="header" href="#一个rom包里有什么" id="一个rom包里有什么">一个ROM包里有什么</a></h1>
<p><strong>What does new Android zips (full roms, but also otas) contain?</strong></p>
<p>New Android flashable zips are made this way:</p>
<p>boot.img (kernel)
file_contexts (selinux related)
META-INF (folder containing scripts)
system.new.dat (compressed /system partition)
system.patch.dat (for OTAs)
system.transfer.list (see explanation below)</p>
<h1><a class="header" href="#怎么提取systemnewdat里的东西" id="怎么提取systemnewdat里的东西">怎么提取system.new.dat里的东西?</a></h1>
<p>因为我不小心在<code>/system/fonts/</code>目录里执行了<code>rm -f *</code>,所以我需要抽取出里面的字体文件.</p>
<p>使用<a href="android/git@github.com:xpirt/sdat2img.git">xpirt/sdat2img</a>:</p>
<h1><a class="header" href="#example-3" id="example-3">Example</a></h1>
<p>This is a simple example on a Linux system:</p>
<pre><code class="language-bash">~$ ./sdat2img.py system.transfer.list system.new.dat system.img
~$ sudo mount -o loop -t ext4 system.img /mnt/
</code></pre>
<h4><a class="header" href="#参考链接-2" id="参考链接-2">参考链接</a></h4>
<p>https://forum.xda-developers.com/android/software-hacking/how-to-conver-lollipop-dat-files-to-t2978952</p>
<h1><a class="header" href="#lineageos" id="lineageos">LineageOS</a></h1>
<h1><a class="header" href="#links-267" id="links-267">Links</a></h1>
<ul>
<li><a href="https://twrp.me/oneplus/oneplusthree.html">TWRP OnePlus 3/3T</a></li>
<li><a href="https://wiki.lineageos.org/devices/oneplus3/install">Install LineageOS on oneplus3 | LineageOS Wiki</a></li>
<li><a href="https://download.lineageos.org/oneplus3">LineageOS Downloads | oneplus3</a></li>
<li><a href="https://wiki.lineageos.org/gapps.html">Google apps | LineageOS Wiki</a><br />
Google apps should be installed via recovery immediately after installing LineageOS.(before reboot)</li>
<li><a href="https://download.lineageos.org/extras">LineageOS Downloads | su</a></li>
<li><a href="https://twrp.me/faq/openrecoveryscript.html">TWRP Commandline Guide</a></li>
<li><a href="https://twrp.me/FAQ/">TWRP FAQ</a></li>
</ul>
<h1><a class="header" href="#overview-40" id="overview-40">Overview</a></h1>
<p>Important steps:</p>
<ul>
<li>
<p>set <code>http_proxy</code> post install due to some <code>Checking info</code> process.</p>
<p>Sun Dec 08 18:39:14 CST 2019</p>
</li>
</ul>
<p>Ref.:</p>
<ul>
<li><a href="https://android.stackexchange.com/questions/98287/how-to-set-wifi-proxy-via-adb-shell">wi fi - How to set WIFI proxy via adb shell? - Android Enthusiasts Stack Exchange</a></li>
<li><a href="https://stackoverflow.com/questions/31807559/undo-setting-proxy-via-settings-global-in-android">Undo setting proxy via Settings.Global in Android - Stack Overflow</a></li>
</ul>
<pre><code>// add
adb shell settings put global http_proxy &lt;address&gt;:&lt;port&gt;
// delete
adb shell settings delete global global_http_proxy_port
</code></pre>
<h1><a class="header" href="#sun-jul-07-205457-cst-2019" id="sun-jul-07-205457-cst-2019">Sun Jul 07 20:54:57 CST 2019</a></h1>
<ul>
<li><a href="https://forum.xda-developers.com/oneplus-3t/how-to/guide-cope-9-0-3-5-0-8-firmware-barrier-t3941164">/GUIDE//MODDED FIRMWARE//9.0.4//OP3/T/The le… | OnePlus 3T</a><br />
Thank you very much.</li>
</ul>
<h1><a class="header" href="#backup-1" id="backup-1">Backup</a></h1>
<pre><code class="language-bash">cd ${BACKUPDIR}
adb pull /storage/emulated/0/DCIM/Camera .
adb pull /storage/emulated/0/Documents .
adb pull /storage/emulated/0/Pictures/Twitter .
</code></pre>
<h1><a class="header" href="#install-twrp" id="install-twrp">Install TWRP</a></h1>
<p><strong>troubleshooting:</strong></p>
<p><a href="https://forum.xda-developers.com/showpost.php?p=78332159&amp;postcount=373">[RECOVERY][unified] Official TWRP touch recovery for OnePlus 3/3T - Post #373</a></p>
<pre><code>adb reboot bootloader
fastboot oem unlock		if already unlocked, doesn't need do this.

fastboot flash recovery twrp.img
</code></pre>
<p><strong>then boot into recovery with power button</strong></p>
<p>or</p>
<pre><code>not every phone work this way, op3 is the one.
fastboot boot twrp-3.2.3-1-oneplus3.img
</code></pre>
<h1><a class="header" href="#install-rom" id="install-rom">Install ROM</a></h1>
<h2><a class="header" href="#packages-2" id="packages-2">Packages</a></h2>
<ul>
<li><a href="https://forum.xda-developers.com/oneplus-3/how-to/op3-flashable-firmware-modem-zips-t3816066">Flashable Firmware+Modem ZIPs | OnePlus 3</a></li>
<li><a href="https://opengapps.org/">The Open GApps Project</a></li>
</ul>
<pre><code>adb push {firmware,rom,gapps,addonsu}.zip /sdcard

adb shell
// now in twrp
// twrp wipe {system,data,cache,dalvik}
twrp wipe {cache,dalvik}
twrp install sdcard/{firmware,rom,gapps,addonsu}.zip

reboot
// Then should pray...
</code></pre>
<h1><a class="header" href="#post-install" id="post-install">Post Install</a></h1>
<p>If Failed to reboot, Maybe it's because the Encryption doesn't work. Must
format <code>data</code> in recovery, then reflash.</p>
<pre><code>Hey man. First of all you need to update your twrp to the latest version for op3. That is 3.2.3.0. 
and second of all. Google made changes in the vold with android pie,
so encryption isn't working at all and is not supported at the moment. So you have to decrypt first. 
Go to twrp recovery&gt;advanced&gt;format data and type 'yes'.
Remember this will erase your internal storage so backup to a pc is must.
After this,you can install the rom without any problems
</code></pre>
<h1><a class="header" href="#checking-info" id="checking-info">Checking info</a></h1>
<p>if stock at <code>Checking info</code>, boot into recovery, then factory reset. That is,
the default wipe option.</p>
<h1><a class="header" href="#basic-apk" id="basic-apk">Basic APK</a></h1>
<ul>
<li><a href="https://f-droid.org/en/">F-Droid</a></li>
<li><a href="https://f-droid.org/en/packages/net.typeblog.shelter/">Shelter</a></li>
<li><a href="https://github.com/shadowsocks/shadowsocks-android/releases">shadowsocks/shadowsocks-android</a></li>
<li><a href="https://f-droid.org/packages/com.termux/">Termux</a></li>
</ul>
<pre><code>// Doesn't need root shell
adb install xx.apk
</code></pre>
<h1><a class="header" href="#twrp-command" id="twrp-command">TWRP COMMAND</a></h1>
<pre><code>wipe cache (eg: “twrp wipe cache”)
wipe dalvik
wipe data
backup (switches, name)
restore (source, switches)
mount (partition)
unmount (partition)
set variable = something
install &lt;folder/filename&gt;
and many more
</code></pre>
<h1><a class="header" href="#termux" id="termux">Termux</a></h1>
<h1><a class="header" href="#links-268" id="links-268">Links</a></h1>
<ul>
<li><a href="https://wiki.termux.com/wiki/Termux-setup-storage">Termux-setup-storage - Termux Wiki</a></li>
<li><a href="https://wiki.termux.com/wiki/Remote_Access#SSH">Remote Access - Termux Wiki</a></li>
</ul>
<p>It is necessary to grant storage permission for Termux on Android 6 and higher. Use 'Settings&gt;Apps&gt;Termux&gt;Permissions&gt;Storage' and set to true.</p>
<p>Execute <code>termux-setup-storage</code> (run apt update &amp;&amp; apt upgrade to make sure that this tool is available) </p>
<h1><a class="header" href="#ssh-server" id="ssh-server">ssh server</a></h1>
<p>Default Port: <code>8022</code></p>
<h1><a class="header" href="#accessing-termux-from-the-internet--tor" id="accessing-termux-from-the-internet--tor">Accessing Termux from the Internet : Tor</a></h1>
<pre><code>pkg install tor torsocks

// modify $PREFIX/etc/tor/torrc

HiddenServiceDir /data/data/com.termux/files/home/tor/hidden_service
HiddenServicePort 22 127.0.0.1:8022

cat ~/.tor/hidden_ssh/hostname 
</code></pre>
<p>service test:</p>
<p><code>torsocks ssh &lt;hostname&gt;</code></p>
<h1><a class="header" href="#dns-error" id="dns-error">DNS error</a></h1>
<p>This can be resolved with <code>termux-chroot</code></p>
<h1><a class="header" href="#a-hrefhttpsgithubcomgenymobilescrcpygithub---genymobilescrcpy-display-and-control-your-android-devicea" id="a-hrefhttpsgithubcomgenymobilescrcpygithub---genymobilescrcpy-display-and-control-your-android-devicea"><a href="https://github.com/Genymobile/scrcpy">GitHub - Genymobile/scrcpy: Display and control your Android device</a></a></h1>
<h1><a class="header" href="#links-269" id="links-269">Links</a></h1>
<ul>
<li><a href="https://techwiser.com/cast-your-android-screen/">8 (+1 New) Ways To Mirror Your Android Screen to Any Computer | TechWiser</a></li>
</ul>
<h1><a class="header" href="#install-47" id="install-47">Install</a></h1>
<pre><code>brew install scrcpy
brew cask install android-platform-tools
</code></pre>
<h1><a class="header" href="#run" id="run">Run</a></h1>
<pre><code>scrcpy
</code></pre>
<h1><a class="header" href="#record-screen" id="record-screen">Record screen</a></h1>
<pre><code>scrcpy --record file.mp4
scrcpy -r file.mkv
</code></pre>
<h1><a class="header" href="#shortcuts-1" id="shortcuts-1">Shortcuts</a></h1>
<pre><code>click on HOME 			Ctrl+h | Middle-click
click on BACK 			Ctrl+b | Right-click²
click on APP_SWITCH 	Ctrl+s
click on MENU 			Ctrl+m

paste computer clipboard to device 	Ctrl+v	

turn screen on 	Right-click²
</code></pre>
<h1><a class="header" href="#magisk-and-edxposeddeprecated" id="magisk-and-edxposeddeprecated">Magisk and EdXposed(deprecated)</a></h1>
<h1><a class="header" href="#links-270" id="links-270">Links</a></h1>
<ul>
<li><a href="https://forum.xda-developers.com/apps/magisk/official-magisk-v7-universal-systemless-t3473445">Magisk v19.2 - Root &amp; Universal Systemless Interface</a></li>
<li><a href="https://www.xda-developers.com/how-to-install-magisk/">How to Install Magisk</a></li>
<li><a href="https://android.stackexchange.com/questions/207633/what-are-the-alternatives-for-xposed-framework-on-pie-preferably-without-trigge">9.0 pie - What are the alternatives for Xposed framework on Pie? Preferably without triggering Safety Net? - Android Enthusiasts Stack Exchange</a></li>
</ul>
<h1><a class="header" href="#install-48" id="install-48">Install</a></h1>
<p><a href="https://github.com/topjohnwu/Magisk/releases/">Releases · topjohnwu/Magisk · GitHub</a></p>
<ul>
<li>Flash <code>Magisk.zip</code> with twrp</li>
<li>Install <code>MagiskManager.apk</code><br />
This apk is used for install modules.</li>
</ul>
<h1><a class="header" href="#edxposed" id="edxposed">EdXposed</a></h1>
<h2><a class="header" href="#install-riru" id="install-riru">Install riru</a></h2>
<p>Install it in MagiskManager</p>
<p><a href="https://github.com/RikkaApps/Riru">GitHub - RikkaApps/Riru: Inject zygote process by replace libmemtrack</a></p>
<ul>
<li>Install <code>riru-core-v19.1.zip</code> in Magisk: </li>
<li>Install <code>riru-core-v19.1-magisk-v17.zip</code> in Magisk </li>
</ul>
<h2><a class="header" href="#install-edxposed" id="install-edxposed">Install EdXposed</a></h2>
<ul>
<li>
<p><a href="https://github.com/ElderDrivers/EdXposed">GitHub - ElderDrivers/EdXposed: Elder driver Xposed Framework.</a></p>
</li>
<li>
<p><a href="https://github.com/ElderDrivers/EdXposed/releases">Releases · ElderDrivers/EdXposed · GitHub</a><br />
<code>SandHook</code> vs <code>YAHFA</code> just choose one.</p>
</li>
<li>
<p>Install <code>magisk-EdXposed-SandHook-v0.4.1.2_beta-release.zip</code> in Magisk</p>
</li>
<li>
<p>Install Xposed Installer APK<br />
For v0.2.9.8 and later: EdXposed Installer and EdXposed Manager.</p>
<ul>
<li><a href="https://github.com/solohsu/XposedInstaller/releases">Releases · solohsu/XposedInstaller · GitHub</a></li>
<li><a href="https://github.com/ElderDrivers/EdXposedManager/releases">Releases · ElderDrivers/EdXposedManager · GitHub</a><br />
<strong>EdXposedManager doen's work. so don't install it.</strong></li>
</ul>
<pre><code>adb install EdXposedInstaller_v2.2.4-release.apk 
</code></pre>
</li>
<li>
<p>reboot</p>
</li>
</ul>
<h2><a class="header" href="#install-xposed-modules" id="install-xposed-modules">Install Xposed modules</a></h2>
<p><a href="https://forum.xda-developers.com/xposed/list-xposed-modules-android-pie-ed-t3892768">List of Xposed Modules For Android Pie Working With Ed Xposed F</a></p>
<ul>
<li><a href="https://repo.xposed.info/module/eu.faircode.xlua">XPrivacyLua | Xposed Module Repository</a></li>
</ul>
<pre><code>// after install active it then reboot
adb install eu.faircode.xlua_v125_25c714.apk 
</code></pre>
<p>network</p>
<h1><a class="header" href="#open-source-network-simulators" id="open-source-network-simulators">Open-Source Network Simulators</a></h1>
<h1><a class="header" href="#links-271" id="links-271">Links</a></h1>
<ul>
<li><a href="https://www.brianlinkletter.com/open-source-network-simulators/">Open-Source Routing and Network Simulation | Open-Source Network Simulators</a></li>
</ul>
<h1><a class="header" href="#gns3" id="gns3">GNS3</a></h1>
<ul>
<li><a href="https://www.gns3.com/">GNS3 | The software that empowers network professionals</a></li>
</ul>
<h1><a class="header" href="#vrnetlab" id="vrnetlab">Vrnetlab</a></h1>
<ul>
<li><a href="https://github.com/plajjan/vrnetlab">GitHub - plajjan/vrnetlab: Run virtual routers with docker</a></li>
</ul>
<p>It supports netconf</p>
<p>Vrnetlab, or VR Network Lab, is an open-source network emulator that runs
virtual routers using KVM and Docker. Software developers and network engineers
use vrnetlab, along with continuous-integration processes, for testing network
provisioning changes in a virtual network. Researchers and engineers may also
use the vrnetlab command line interface to create and modify network emulation
labs in an interactive way.</p>
<h1><a class="header" href="#switch" id="switch">Switch</a></h1>
<h1><a class="header" href="#protocols-1" id="protocols-1">Protocols</a></h1>
<h1><a class="header" href="#spanning-tree-protocol" id="spanning-tree-protocol">Spanning Tree Protocol</a></h1>
<h1><a class="header" href="#links-272" id="links-272">Links</a></h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Spanning_Tree_Protocol">Spanning Tree Protocol - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/Bridge_Protocol_Data_Unit">Bridge Protocol Data Unit - Wikipedia</a></li>
<li><a href="https://atlasgentech.co.nz/media/wysiwyg/pdf/Huawei/Data-Switches/HUAWEI_Sx700_Switch_Interoperation_with_PVST_Technical_White_Paper.pdf">HUAWEI_Sx700_Switch_Interoperation_with_PVST_Technical_White_Paper.pdf</a> </li>
<li><a href="https://support.huawei.com/enterprise/en/doc/EDOC1000069520/ff734cfa/interoperation-and-replacement-guide-for-spanning-tree-protocols-on-huawei-and-cisco-switches">Interoperation and Replacement Guide for Spanning Tree Protocols on Huawei and Cisco Switches - S2700, S3700, S5700, S6700, S7700, and S9700 Series Switches Typical Configuration Examples - Huawei</a></li>
</ul>
<h1><a class="header" href="#comparison-between-stp-on-huawei-and-cisco-switches" id="comparison-between-stp-on-huawei-and-cisco-switches">Comparison Between STP on Huawei and Cisco Switches</a></h1>
<h2><a class="header" href="#packet-processing-mode" id="packet-processing-mode">Packet Processing Mode</a></h2>
<p>Processing mode of Cisco PVST+ BPDUs (the implementation is similar to that of Rapid PVST+ BPDUs)</p>
<p>On a trunk interface:</p>
<ul>
<li>
<p>In VLAN 1, a PVST+ device sends standard STP BPDUs and untagged PVST BPDUs to
negotiate with the remote device.</p>
</li>
<li>
<p>In the native VLAN but not VLAN 1, a PVST+ device sends untagged PVST BPDUs
to negotiate with the remote device.</p>
</li>
<li>
<p>In other VLANs, a PVST+ device sends PVST BPDUs to negotiate with the remote
device.</p>
</li>
<li>
<p>A PVST+ device sends standard STP BPDUs to negotiate with the remote device
in VLAN 1 after the no spanning-tree vlan 1 command is configured globally.</p>
</li>
</ul>
<p>On an access interface:</p>
<ul>
<li>In all VLANs, a PVST+ device sends standard STP BPDUs to negotiate with the
remote device.</li>
</ul>
<p>Processing of Huawei VBST BPDUs</p>
<p>On a trunk interface:</p>
<ul>
<li>
<p>In VLAN 1, a VBST-enabled device sends standard STP or RSTP BPDUs and VBST
BPDUs to negotiate with the remote device.</p>
</li>
<li>
<p>In other VLANs, a VBST-enabled device sends VBST BPDUs to negotiate with the
remote device.</p>
</li>
</ul>
<p>On an access interface:</p>
<p>A VBST-enabled device sends standard STP or RSTP BPDUs to negotiate with the
remote device only in the VLAN where the access interface is located.</p>
<h1><a class="header" href="#differences-in-command-formats" id="differences-in-command-formats">Differences in Command Formats</a></h1>
<table><thead><tr><th align="left">Function</th><th align="left">Huawei</th><th align="left">Cisco</th></tr></thead><tbody>
<tr><td align="left">Configure a spanning tree mode.</td><td align="left">stp mode</td><td align="left">spanning-tree mode</td></tr>
<tr><td align="left">Configure a path cost algorithm.</td><td align="left">stp pathcost-standard</td><td align="left">spanning-tree pathcost method</td></tr>
<tr><td align="left">Configure a fast transition mode on an interface.</td><td align="left">stp no-agreement-check</td><td align="left">N/A</td></tr>
<tr><td align="left">Enable digest snooping.</td><td align="left">stp config-digest-snoop</td><td align="left">N/A</td></tr>
<tr><td align="left">path cost algorithms</td><td align="left">display stp</td><td align="left">show spanning-tree detail</td></tr>
<tr><td align="left">IEEE 802.1t</td><td align="left">stp pathcost-standard dot1t</td><td align="left">spanning-tree pathcost method long</td></tr>
<tr><td align="left">IEEE 802.1d-1998</td><td align="left">stp pathcost-standard dot1d-1998</td><td align="left">spanning-tree pathcost method short</td></tr>
<tr><td align="left">Check the digest information.</td><td align="left">display stp region-configuration digest</td><td align="left">show spanning-tree mst digest</td></tr>
<tr><td align="left">Enable digest snooping.</td><td align="left">stp config-digest-snoop</td><td align="left">N/A</td></tr>
</tbody></table>
<h1><a class="header" href="#bpdu" id="bpdu">BPDU</a></h1>
<p><strong>Bridge Protocol Data Units (BPDUs)</strong> are frames that contain information
about the spanning tree protocol (STP). A switch sends BPDUs using a unique MAC
address from its origin port and a multicast address as destination MAC
(<code>01:80:C2:00:00:00</code>, or <code>01:00:0C:CC:CC:CD</code> for Per VLAN Spanning Tree).</p>
<h1><a class="header" href="#history" id="history">History</a></h1>
<ul>
<li>
<p>The first spanning tree protocol was invented in 1985 at the Digital
Equipment Corporation by <a href="https://en.wikipedia.org/wiki/Radia_Perlman">Radia
Perlman</a>.In 1990, the IEEE
published the first standard for the protocol as 802.1D,[16] based on the
algorithm designed by Perlman.</p>
</li>
<li>
<p>In 2001, the IEEE introduced Rapid Spanning Tree Protocol (RSTP) as <code>802.1w</code>.
RSTP was designed to be backwards-compatible with standard STP. </p>
</li>
<li>
<p>STP was originally standardized as <code>IEEE 802.1D</code> but the functionality of
spanning tree (802.1D), rapid spanning tree (<code>802.1w</code>), and multiple spanning
tree (<code>802.1s</code>) has since been incorporated into <code>IEEE 802.1Q-2014</code>.</p>
</li>
</ul>
<h1><a class="header" href="#spanning-tree-protocol-standards-for-vlans" id="spanning-tree-protocol-standards-for-vlans">Spanning Tree Protocol standards for VLANs</a></h1>
<p>STP and RSTP do not segregate switch ports by VLAN.</p>
<p>Cisco developed, implemented and published the <strong>Per-VLAN Spanning Tree
(PVST)</strong> proprietary protocol using <strong>its own</strong> proprietary <strong>Inter-Switch Link
(ISL)</strong> for VLAN encapsulation, and <code>PVST+</code> which uses 802.1Q VLAN encapsulation. </p>
<p>Cisco also published a proprietary version of Rapid Spanning Tree Protocol. It
creates a spanning tree for each VLAN, just like PVST. Cisco refers to this as
Rapid Per-VLAN Spanning Tree (RPVST). </p>
<h1><a class="header" href="#configuring-a-spanning-tree" id="configuring-a-spanning-tree">Configuring a spanning tree</a></h1>
<p>Configuring STP and RSTP on switches in a LAN follows the same principles. STP
must be enabled on all switches in the LAN and the version of STP must be
chosen. All switches must use the same version of STP. </p>
<p>The root bridge of the spanning tree is the bridge with the smallest (lowest)
bridge ID. Each bridge has a configurable priority number and a MAC address;
the bridge ID is the concatenation of the bridge priority and the MAC address.
For example, the ID of a bridge with priority <code>32768</code> and mac <code>0200.0000.1111</code>
is <code>32768.0200.0000.1111</code>. </p>
<h1><a class="header" href="#cisco-pvst" id="cisco-pvst">Cisco PVST+</a></h1>
<p>Cisco Catalyst series switches of IOS 12.2 and later versions support <code>PVST+</code>,
<code>Rapid PVST+</code>, and <code>MST</code>. Some bridge protocol data units (BPDUs) of PVST+,
Rapid PVST+, and MST use Cisco proprietary BPDU formats, which are different
from the standard BPDU format defined by Institute of Electrical and
Electronics Engineers (IEEE). Trunk ports on PVST+ or Rapid PVST+ capable Cisco
switches send Cisco proprietary BPDUs in VLANs other than VLAN 1. </p>
<p><strong>The destination MAC address of PVST BPDUs is 01-00-0C-CC-CC-CD; therefore,
PVST cannot interoperate with standard IEEE spanning tree protocols.</strong></p>
<p>PVST+ improves PVST by adding interoperability with standard spanning tree
protocols. On an access port, PVST+ sends standard STP BPDUs in its native
VLAN. On a trunk port, PVST+ sends standard STP BPDUs with the destination MAC
address of 01-80-C2-00-00-00 only in VLAN 1, and sends Cisco proprietary BPDUs
with the destination MAC address of 01-00-0C-CC-CC-CD in other VLANs allowed by
the trunk port. Huawei switches transparently transmit Cisco proprietary BPDUs
as common multicast frames.</p>
<p>Rapid PVST+ is an extension of PVST+. Compared with PVST+, Rapid PVST+ uses the
Rapid Spanning Tree Protocol (RSTP) mechanism to implement rapid transition.</p>
<p>Cisco MST supports VLAN-instance mapping and defines the concept of domain;
therefore, it can be considered as a standard MSTP protocol. MST BPDUs use the
standard format defined by IEEE. Huawei and Cisco switches use different keys
to generate MSTP digests in BPDUs. By default, MSTP and Cisco MST can implement
only inter-domain interoperation because Huawei and Cisco switches generate
different digests. To enable MSTP and Cisco MST to interoperate within an MPST
domain, enable the digest snooping function on a Huawei switch's port connected
to a Cisco switch.</p>
<h1><a class="header" href="#interoperation-networking-design" id="interoperation-networking-design">Interoperation Networking Design</a></h1>
<p>PVST+ is a Cisco proprietary protocol that uses a Cisco reserved multicast MAC
address. Huawei switches do not support Cisco PVST+. The following methods can
implement interoperation between Cisco PVST+ switches and Huawei switches:</p>
<ul>
<li>
<p>On a trunk port, Cisco PVST+ sends two types of BPDUs in VLAN 1: untagged
Cisco PVST+ proprietary BPDUs and standard RSTP BPDUs. Huawei switches can
identify RSTP BPDUs. When a Huawei switch connects to a trunk port of a Cisco
PVST+ switch, enable RSTP or MSTP on the Huawei switch so that it can work
with the Cisco PVST+ switch.</p>
</li>
<li>
<p>On an access port, Cisco PVST+ sends standard BPDUs. When a Huawei switch
connects to an access port of a Cisco RVST+ switch, enable RSTP or MSTP on
the Huawei switch.</p>
</li>
<li>
<p>(Not recommended) Huawei switches forward Cisco PVST+ BPDUs as service
packets to access the Cisco PVST+ network. In this mode, the blocked ports
are located on Cisco switches.</p>
</li>
</ul>
<h1><a class="header" href="#example-1-interoperation-between-huawei-switches-root-bridge-and-cisco-pvst-switches" id="example-1-interoperation-between-huawei-switches-root-bridge-and-cisco-pvst-switches">Example 1: Interoperation Between Huawei Switches (Root Bridge) and Cisco PVST+ Switches</a></h1>
<p>Huawei switches do not support Cisco PVST+ and they run MSTP or RSTP to
interoperate with Cisco switches. Load balancing is required, so a Huawei
switch must be configured as the root bridge. When Huawei switches run MSTP,
their ports connected to Cisco switches automatically switch to the RSTP mode,
so the MSTP and RSTP modes have the same effect on Cisco PVST+ switches.</p>
<p><img src="switch/protocols/imgs/HWrootandCsPVSTplus.png" alt="hwroot" /></p>
<p><strong>Configuration Methods</strong></p>
<ul>
<li>
<p>On Cisco switches: Configure the same path cost algorithm on all Cisco
switches. Set an appropriate bridge priority for VLAN 1 to ensure that it is
lower than the bridge priority of Huawei CST, and set bridge priorities for
other VLANs based on the site requirements.</p>
</li>
<li>
<p>On Huawei switches: Configure the same path cost algorithm on all Huawei
switches.Ensure that the bridge priority of Huawei CST is higher than that of
Cisco VLAN 1.</p>
</li>
</ul>
<p><strong>Configuration Files</strong></p>
<p>Cisco</p>
<pre><code>spanning-tree mode rapid-pvst
spanning-tree logging
spanning-tree extend system-id
spanning-tree vlan 1 priority 4096
spanning-tree pathcost method long
!
interface GigabitEthernet1/0/1
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 1,30
 switchport mode trunk
 spanning-tree vlan 30 port-priority 48
end
!
interface GigabitEthernet1/0/2
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 1,30
 switchport mode trunk
end
</code></pre>
<p>Huawei</p>
<pre><code>stp root primary
#
interface GigabitEthernet1/0/1
undo shutdown
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet1/0/2
undo shutdown
port link-type trunk
port trunk allow-pass vlan 30
#

// may be useful
stp mode vbst
stp pathcost-standard dot1d-1998
interface gigabitethernet 1/0/1
stp no-agreement-check
#
interface gigabitethernet 1/0/2
stp no-agreement-check
#
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>Ensure that spanning trees in all VLANs use a Huawei switch as the root
bridge.</p>
</li>
<li>
<p>Configure Huawei switches to work in MSTP or RSTP mode, and do not use the
STP-compatible mode.</p>
</li>
<li>
<p>Cisco native VLAN traffic is untagged, so the PVID on Huawei switches must be
the same as the native VLAN ID on Cisco switches.</p>
</li>
</ul>
<h1><a class="header" href="#example-2-interoperation-between-huawei-switches-and-cisco-pvst-switches-root-bridge" id="example-2-interoperation-between-huawei-switches-and-cisco-pvst-switches-root-bridge">Example 2: Interoperation Between Huawei Switches and Cisco PVST+ Switches (Root Bridge)</a></h1>
<p>Load balancing is not required, so a Cisco PVST+ switch can be configured as
the root bridge.</p>
<p><img src="switch/protocols/imgs/HWandCsPVSTplus2.png" alt="Ciscoroot" /></p>
<p>Methods</p>
<ul>
<li>
<p>On Cisco switches: Configure a Cisco switch as the PVST+ root bridge.
Configure the same path cost algorithm on all Cisco switches. Set an
appropriate bridge priority for VLAN 1 to ensure that it is higher than the
bridge priority of Huawei CST.</p>
</li>
<li>
<p>On Huawei switches: Configure the same path cost algorithm on all Huawei
switches.Ensure that the bridge priority of Huawei CST is lower than that of
Cisco VLAN 1.</p>
</li>
</ul>
<p><strong>Configuration Files</strong></p>
<p>Cisco</p>
<pre><code>spanning-tree mode rapid-pvst
spanning-tree logging
spanning-tree extend system-id
spanning-tree vlan 1 priority 0
spanning-tree pathcost method long
!
interface GigabitEthernet1/0/1
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 1,30
 switchport mode trunk
end
!
interface GigabitEthernet1/0/2
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 1,30
 switchport mode trunk
end
</code></pre>
<p>Huawei</p>
<pre><code>interface GigabitEthernet1/0/1
undo shutdown
port link-type trunk
port trunk allow-pass vlan 30
#
interface GigabitEthernet1/0/2
undo shutdown
port link-type trunk
port trunk allow-pass vlan 30
#
</code></pre>
<h1><a class="header" href="#example-3-interoperation-with-cisco-pvst-switches-by-forwarding-pvst-bpdus" id="example-3-interoperation-with-cisco-pvst-switches-by-forwarding-pvst-bpdus">Example 3: Interoperation with Cisco PVST+ Switches by Forwarding PVST+ BPDUs</a></h1>
<p>Cisco switches do not process BPDUs of VLAN 1 forwarded by Huawei switches.
Therefore, this plan applies only to VLANs other than VLAN 1.</p>
<p><img src="switch/protocols/imgs/HWandCsPVSTplus3.png" alt="Figure 3" /></p>
<p>Methods</p>
<ul>
<li>
<p>On Cisco switches: Configure a Cisco switch as the PVST+ root bridge.
Configure the same path cost algorithm on all Cisco switches.</p>
</li>
<li>
<p>On Huawei switches: Add ports connected to Cisco switches to the
corresponding Cisco PVST VLANs. The ports do not participate in STP
calculation.</p>
</li>
</ul>
<p><strong>Configuration Files</strong></p>
<p>Cisco</p>
<pre><code>spanning-tree mode pvst
spanning-tree logging
spanning-tree extend system-id
spanning-tree pathcost method long
!
interface GigabitEthernet1/0/1
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 1,30
 switchport mode trunk
end
!
interface GigabitEthernet1/0/2
 switchport trunk encapsulation dot1q
 switchport trunk allowed vlan 1,30
 switchport mode trunk
end
</code></pre>
<p>Huawei</p>
<pre><code>interface GigabitEthernet1/0/1
undo shutdown
port link-type trunk
port trunk allow-pass vlan 30
stp disable
#
interface GigabitEthernet1/0/2
undo shutdown
port link-type trunk
port trunk allow-pass vlan 30
stp disable
#

// These commands may be useful
interface eth-trunk 1
l2protocol-tunnel PVST+ enable
l2protocol-tunnel STP enable
#
interface gigabitethernet 1/0/1
l2protocol-tunnel PVST+ enable
l2protocol-tunnel STP enable
#
interface gigabitethernet 1/0/2
l2protocol-tunnel PVST+ enable
l2protocol-tunnel STP enable
quit
</code></pre>
<p>Notes</p>
<ul>
<li>
<p>Do not enable STP on Huawei switch ports that transparently transmit Cisco
PVST+ BPDUs. Otherwise, these ports cannot forward PVST+ BPDUs but still send
BPDUs, which interfere with PVST+ calculation on Cisco switches.</p>
</li>
<li>
<p>Cisco native VLAN traffic is untagged, so the PVID on Huawei switches must be
the same as the native VLAN ID on Cisco switches.</p>
</li>
</ul>
<h1><a class="header" href="#s5720-56c-ei" id="s5720-56c-ei">S5720-56C-EI</a></h1>
<ul>
<li>telnet server</li>
</ul>
<pre><code>telnet server enable
#
aaa
local-user admin password irreversible-cipher xxx
local-user admint service-type telnet
#
user-interface vty 0 4
protocol inbound all
authentication-mode aaa
#

save
</code></pre>
<ul>
<li>reset</li>
</ul>
<p>reboot to console then hit <code>ctrl-b</code>, password is <code>Admin@huawei.com</code>, select <code>7</code>
then <code>1</code>:</p>
<pre><code>7. Clear password for console user
1. Boot with default mode
</code></pre>
<h1><a class="header" href="#blockchains" id="blockchains">Blockchains</a></h1>
<h1><a class="header" href="#a-hrefhttpswwwmyetherwalletcommyetherwallet--mewa" id="a-hrefhttpswwwmyetherwalletcommyetherwallet--mewa"><a href="https://www.myetherwallet.com/">MyEtherWallet | MEW</a></a></h1>
<h1><a class="header" href="#links-273" id="links-273">Links</a></h1>
<ul>
<li><a href="https://github.com/MyEtherWallet/MyEtherWallet">GitHub - MyEtherWallet/MyEtherWallet: MyEtherWallet (our friends call us MEW) is a free, client-side interface helping you interact with the Ethereum blockchain.</a></li>
</ul>
<h1><a class="header" href="#offline" id="offline">Offline</a></h1>
<ul>
<li><a href="https://kb.myetherwallet.com/en/offline/using-mew-offline/">Using MEW Offline (Cold Storage) | MyEtherWallet Knowledge Base</a></li>
<li><a href="https://github.com/MyEtherWallet/MyEtherWallet/releases">Releases · MyEtherWallet/MyEtherWallet · GitHub</a></li>
</ul>
<p>Download it, then open the <code>index.html</code> file.</p>
<h1><a class="header" href="#misc-3" id="misc-3">misc</a></h1>
<h1><a class="header" href="#links-274" id="links-274">Links</a></h1>
<ul>
<li><a href="https://gist.github.com/nyuszika7h/2188627f0860d2e3a1266c2660ab1ee3">Lossless stream rip cheatsheet · GitHub</a></li>
</ul>
<h1><a class="header" href="#ctcc" id="ctcc">CTCC</a></h1>
<p><a href="https://www.189.cn/nm/support/faq/customer/20806.html">189.cn/nm/support/faq/customer/20806.html</a></p>
<p>您可以编辑“102”发送到10001即可查余额。</p>
<h1><a class="header" href="#shure-bluetooth-earphones" id="shure-bluetooth-earphones">Shure Bluetooth® Earphones</a></h1>
<h1><a class="header" href="#links-275" id="links-275">Links</a></h1>
<ul>
<li><a href="https://pubs.shure.com/quickstart/BT2/en-US">Shure Publications | Quick Start Guides | BT2</a></li>
</ul>
<h1><a class="header" href="#pair-bluetooth" id="pair-bluetooth">Pair Bluetooth®</a></h1>
<ul>
<li>Turn off the earphones. Press and hold the center button on the earphone
remote until the LED flashes blue and red.</li>
<li>From your audio source, select &quot;Shure BT2.&quot;</li>
<li>When successfully paired, the LED turns blue.</li>
</ul>
<h1><a class="header" href="#using-the-remote" id="using-the-remote">Using the Remote</a></h1>
<p>The Center Button</p>
<pre><code>Power on 		Press and hold
Power off 		Press and hold, 5 seconds 
</code></pre>
<h1><a class="header" href="#图片-1" id="图片-1">图片</a></h1>
<p><strong>把9张图片3X3在一张A4纸上打印</strong></p>
<pre><code>apt-get install imagemagick
montage -geometry +15+15 -tile 3x3 pic.* foo.jpg
/*
-geometry +15+15 x, y 方向上的间隔15,单位应该是像素
-tile 3x3 平铺成3x3的样子
*/
</code></pre>
<h1><a class="header" href="#remap-keyboard-to-hhkb-use-xmodmap" id="remap-keyboard-to-hhkb-use-xmodmap">remap keyboard to hhkb use xmodmap</a></h1>
<p>使用的配置文件<a href="https://github.com/iofxl/hhkb/blob/master/hhkb.Xmodmap">hhkb.Xmodmap</a></p>
<p>使用方法:<br />
执行这两条命令:</p>
<pre><code># always recovery the default keymap first
setxkbmap
xmodmap hhkb.Xmodmap
</code></pre>
<p><strong>xmodmap配置文件格式</strong></p>
<pre><code>              Base Shift Alt_Gr Shift+Alt_Gr Compose(?) Shift+Compose(?)
keycode ?? =    ?     ?      ?        ?          ?              ?
</code></pre>
<h4><a class="header" href="#links-276" id="links-276">Links</a></h4>
<p>https://deskthority.net/wiki/Xmodmap</p>
<h4><a class="header" href="#关于xmodmap" id="关于xmodmap">关于xmodmap</a></h4>
<p><strong>常用命令</strong></p>
<pre><code># 打印modifier
xmodmap -pm 
# 以可恢复的格式打印配置
xmodmap -pke
</code></pre>
<p>每次执行<code>xmodmap &lt;config_file&gt;</code>前都要先执行<code>setxkbmap</code></p>
<h1><a class="header" href="#d7000" id="d7000">D7000</a></h1>
<h1><a class="header" href="#图像品质" id="图像品质">图像品质</a></h1>
<p>若要选择图像品质，请按下 QUAL 按钮并旋转主 指令拨盘直至控制面板中显示所需设定。</p>
<p>RAW 来自图像传感器的原始图像数据直接保存到存储卡 上。拍摄后可在计算机上调整白平衡和对比度等设定。</p>
<p>fine norm basic 压缩比 分别是 1:4 1:8 1:16</p>
<h1><a class="header" href="#图像尺寸" id="图像尺寸">图像尺寸</a></h1>
<p>若要选择图像尺寸，请按下 QUAL 按钮并旋转副 指令拨盘直至控制面板中显示所需设定。</p>
<h1><a class="header" href="#基础拍摄与播放" id="基础拍摄与播放">基础拍摄与播放</a></h1>
<ul>
<li>
<p>步骤 1:开启照相机</p>
<ul>
<li>开启照相机</li>
<li>检查电池电量级别。</li>
<li>检查剩余可拍摄张数。</li>
</ul>
</li>
<li>
<p>步骤2:选择自动或自动（闪光灯关）模式</p>
</li>
<li>
<p>步骤 3:构图</p>
<ul>
<li>在取景器中构图，将主要拍摄对象置于 AF 区 域框内。</li>
</ul>
</li>
<li>
<p>步骤 4:对焦</p>
<ul>
<li>半按快门释放按钮。</li>
<li>当对焦操作完成时，取景器中将显示对焦 指示 (圆点)。</li>
</ul>
</li>
<li>
<p>步骤 5:拍摄</p>
<p>平稳地完全按下快门释放按钮以释放快门并拍摄照片。当正在将照片记录到存储卡上时，存储卡插槽盖旁的存取指示灯将会点亮。在该指示灯熄灭且记录完成前，请勿弹出存储卡，也不要取出电池或切断电源。</p>
</li>
</ul>
<h1><a class="header" href="#创意拍摄-场景模式" id="创意拍摄-场景模式">创意拍摄 (场景模式)</a></h1>
<p>SCENE 模式</p>
<p>若要选择一种场景，请将模式拨盘旋转至SCENE，然后旋转主指令拨盘直 至显示屏中显示所需场景。旋转拨盘时显示屏将自动开启。</p>
<h2><a class="header" href="#场景模式" id="场景模式">场景模式</a></h2>
<ul>
<li>
<p>人像</p>
<p>适用于拍摄出肤色平滑自然的人像。当拍摄对象距离背景较远或使用了远摄镜头时，背景细节将被柔化以使构图具有层次感。</p>
</li>
<li>
<p>风景</p>
<p>适用于白天鲜艳的风景拍摄。内置闪光灯和AF辅助照明器关闭;推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>儿童照</p>
<p>适用于儿童快照。服饰和背景细节表现鲜明，而肤色保持柔和自然。</p>
</li>
<li>
<p>运动</p>
<p>高速快门可锁定动作以拍摄动态的运动照片，并在其中突出主要拍摄对象。内置闪光灯和 AF 辅助照明器关闭。若要进行连续拍摄，请选择连拍释放模式</p>
</li>
<li>
<p>近摄</p>
<p>适用于花卉、昆虫和其它小物体的特写拍摄 (微距镜头可用来在极其 近的距离内对焦) 。推荐使用三脚架以避免模糊。</p>
</li>
<li>
<p>夜间人像</p>
<p>适用于在光线不足的条件下拍摄人像，使主要拍摄对象与背景之间达到自然平衡。推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>夜景</p>
<p>拍摄包含路灯和霓虹灯的夜景时减少噪点和不自然的色彩。内置闪光 灯和 AF 辅助照明器关闭;推荐使用三脚架以避免模糊。</p>
</li>
<li>
<p>宴会/室内</p>
</li>
</ul>
<pre><code>适用于捕捉室内背景照明的效果。 用于聚会和其它室内场景。
</code></pre>
<ul>
<li>
<p>海滩 / 雪景</p>
<p>适用于捕捉阳光下水面、雪地或沙滩的亮度。内置闪光灯和 AF 辅助照明器关闭。</p>
</li>
<li>
<p>日落</p>
<p>适用于保持在日出或日落时看到的深色调。内置闪光灯和 AF 辅助照明器关闭;推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>黄昏/黎明</p>
<p>适用于保持在日出前或日落后微弱自然光下看到的颜色。内置闪光灯和 AF 辅助照明器关闭;推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>宠物像</p>
<p>适用于拍摄活泼的宠物。AF 辅助照明器关闭。</p>
</li>
<li>
<p>烛光</p>
<p>适用于在烛光下进行拍摄。内置闪光灯关闭;推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>花</p>
<p>适用于拍摄鲜花盛开的野地、果园 以及其它拥有大片鲜花的风景。内置闪光灯关闭;推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>秋色</p>
<p>适用于捕捉秋叶美丽的红色和黄色。内置闪光灯关闭;推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>食物</p>
</li>
</ul>
<pre><code>适用于拍摄逼真的食物照片。推荐使用三脚架以避免模糊;您还可以使用闪光灯
</code></pre>
<ul>
<li>
<p>剪影</p>
<p>适用于在明亮背景下使拍摄对象现出轮廓。内置闪光灯关闭;推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
<li>
<p>高色调</p>
<p>用于在拍摄明亮的场景时创建光线明亮的图像。内置闪光灯关闭。</p>
</li>
<li>
<p>低色调</p>
<p>用于在拍摄昏暗场景时创建突出亮部的暗淡图像。内置闪光灯关闭; 推荐使用三脚架以避免由于光线不足而产生的模糊。</p>
</li>
</ul>
<h1><a class="header" href="#即时取景" id="即时取景">即时取景</a></h1>
<ul>
<li>
<p>旋转即时取景开关</p>
<p>反光板将弹起且镜头视野将出现在照相机显示屏中。此时，取景器中将无法看见拍摄对象。</p>
</li>
<li>
<p>选择对焦模式</p>
<ul>
<li>若要选择一种自动对焦模式，请将对焦模式选择器旋转至AF，然后按下AF模式按钮并旋转主指令拨盘，直至显示屏中显示所需模式。
<ul>
<li>AF-S 单次伺服AF:适用于静止的拍摄对象。半按快门释放按钮时对焦锁定。</li>
<li>AF-F 全时伺服AF:适用于移动的拍摄对象。照相机连续进行对焦直至按下快门释放按钮。半按快门释放按钮时对焦锁定。</li>
</ul>
</li>
<li>若要使用手动对焦，请将对焦模式选择器旋转至 M</li>
</ul>
</li>
<li>
<p>选择AF区域模式。</p>
<p>若要选择一种 AF 区域模式，请按下 AF 模式按钮并旋转副指令拨盘，直至显示屏中显示所需模式。</p>
<ul>
<li>脸部优先 AF:照相机自动侦测并对焦于 面向照相机的人物拍摄对象。适用于人像 拍摄。</li>
<li>宽区域 AF:适用于以手持方式拍摄风景 和其它非人物拍摄对象。可使用多重选择 器选择对焦点。</li>
<li>标准区域 AF:适用于精确对焦于画面中的所选点。推荐使用三脚架。</li>
<li>对象跟踪 AF:跟踪在画面中移动的所选拍摄对象。</li>
</ul>
</li>
<li>
<p>选择对焦点。</p>
</li>
</ul>
<h1><a class="header" href="#p-s-a-和-m-模式" id="p-s-a-和-m-模式">P、 S、 A 和 M 模式</a></h1>
<ul>
<li>
<p>快门速度和光圈</p>
<p>使用快门速度和光圈的不同组合可获得相同曝光。高速快门和大光圈可锁定移动的物体并柔化背景细节，而低速快门和小光圈可模糊移动的物体并突出背景细节。</p>
</li>
</ul>
<h1><a class="header" href="#释放模式" id="释放模式">释放模式</a></h1>
<h1><a class="header" href="#恢复默认设定" id="恢复默认设定">恢复默认设定</a></h1>
<p>通过同时按住 QUAL 和 E 按钮 (这些按钮上标 有一个绿点) 2 秒以上，可恢复下列照相机设 定的默认值。重设设定期间控制面板将暂时关闭。</p>
<h1><a class="header" href="#hp-laserjet-pro-m1536dnf-multifunction-printer" id="hp-laserjet-pro-m1536dnf-multifunction-printer">HP LaserJet Pro M1536dnf Multifunction Printer</a></h1>
<h1><a class="header" href="#links-277" id="links-277">Links</a></h1>
<ul>
<li><a href="https://support.hp.com/us-en/product/hp-laserjet-pro-m1536-multifunction-printer-series/3974271/model/3974278">HP LaserJet Pro M1536dnf Multifunction Printer | HP® Customer Support</a></li>
</ul>
<h1><a class="header" href="#profile" id="profile">Profile</a></h1>
<h1><a class="header" href="#sakamichi-miru" id="sakamichi-miru">Sakamichi Miru</a></h1>
<ul>
<li><a href="https://onejav.com/actress/Miru%20Sakamichi">Miru Sakamichi</a></li>
</ul>
<h1><a class="header" href="#comedy" id="comedy">Comedy</a></h1>
<h1><a class="header" href="#links-278" id="links-278">Links</a></h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=L8KyI_ZXkp8">Louis CK - Live At Beacon Theatre - BEST STAND UP COMEDY [FULL SHOW] - YouTube</a> </li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
